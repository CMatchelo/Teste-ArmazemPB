function o_(e,t,r){e=e.split("."),r=r||o_a,e[0]in r||!r.execScript||r.execScript("var "+e[0]);for(var i;e.length&&(i=e.shift());)e.length||void 0===t?r=r[i]?r[i]:r[i]={}:r[i]=t}if(!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function r(e){var t=e.length,r=Z.type(e);return"function"!==r&&!Z.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e))}function i(e,t,r){if(Z.isFunction(t))return Z.grep(e,function(e,i){return!!t.call(e,i,e)!==r});if(t.nodeType)return Z.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(ne.test(t))return Z.filter(t,e,r);t=Z.filter(t,e)}return Z.grep(e,function(e){return W.call(t,e)>=0!==r})}function a(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=ge[e]={};return Z.each(e.match(he)||[],function(e,r){t[r]=!0}),t}function s(){X.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1),Z.ready()}function n(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+n.uid++}function c(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(ye,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:ve.test(r)?Z.parseJSON(r):r)}catch(e){}Ee.set(e,t,r)}else r=void 0;return r}function l(){return!0}function d(){return!1}function u(){try{return X.activeElement}catch(e){}}function p(e,t){return Z.nodeName(e,"table")&&Z.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function h(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function g(e){var t=ke.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function f(e,t){for(var r=0,i=e.length;i>r;r++)Ie.set(e[r],"globalEval",!t||Ie.get(t[r],"globalEval"))}function m(e,t){var r,i,a,o,s,n,c,l;if(1===t.nodeType){if(Ie.hasData(e)&&(o=Ie.access(e),s=Ie.set(t,o),l=o.events)){delete s.handle,s.events={};for(a in l)for(r=0,i=l[a].length;i>r;r++)Z.event.add(t,a,l[a][r])}Ee.hasData(e)&&(n=Ee.access(e),c=Z.extend({},n),Ee.set(t,c))}}function I(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&Z.nodeName(e,t)?Z.merge([e],r):r}function E(e,t){var r=t.nodeName.toLowerCase();"input"===r&&Se.test(e.type)?t.checked=e.checked:("input"===r||"textarea"===r)&&(t.defaultValue=e.defaultValue)}function v(t,r){var i,a=Z(r.createElement(t)).appendTo(r.body),o=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(a[0]))?i.display:Z.css(a[0],"display");return a.detach(),o}function y(e){var t=X,r=He[e];return r||(r=v(e,t),"none"!==r&&r||(Fe=(Fe||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Fe[0].contentDocument,t.write(),t.close(),r=v(e,t),Fe.detach()),He[e]=r),r}function b(e,t,r){var i,a,o,s,n=e.style;return r=r||qe(e),r&&(s=r.getPropertyValue(t)||r[t]),r&&(""!==s||Z.contains(e.ownerDocument,e)||(s=Z.style(e,t)),Ye.test(s)&&Ve.test(t)&&(i=n.width,a=n.minWidth,o=n.maxWidth,n.minWidth=n.maxWidth=n.width=s,s=r.width,n.width=i,n.minWidth=a,n.maxWidth=o)),void 0!==s?s+"":s}function T(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function P(e,t){if(t in e)return t;for(var r=t[0].toUpperCase()+t.slice(1),i=t,a=Qe.length;a--;)if(t=Qe[a]+r,t in e)return t;return i}function S(e,t,r){var i=$e.exec(t);return i?Math.max(0,i[1]-(r||0))+(i[2]||"px"):t}function C(e,t,r,i,a){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===r&&(s+=Z.css(e,r+Te[o],!0,a)),i?("content"===r&&(s-=Z.css(e,"padding"+Te[o],!0,a)),"margin"!==r&&(s-=Z.css(e,"border"+Te[o]+"Width",!0,a))):(s+=Z.css(e,"padding"+Te[o],!0,a),"padding"!==r&&(s+=Z.css(e,"border"+Te[o]+"Width",!0,a)));return s}function A(e,t,r){var i=!0,a="width"===t?e.offsetWidth:e.offsetHeight,o=qe(e),s="border-box"===Z.css(e,"boxSizing",!1,o);if(0>=a||null==a){if(a=b(e,t,o),(0>a||null==a)&&(a=e.style[t]),Ye.test(a))return a;i=s&&(z.boxSizingReliable()||a===e.style[t]),a=parseFloat(a)||0}return a+C(e,t,r||(s?"border":"content"),i,o)+"px"}function _(e,t){for(var r,i,a,o=[],s=0,n=e.length;n>s;s++)i=e[s],i.style&&(o[s]=Ie.get(i,"olddisplay"),r=i.style.display,t?(o[s]||"none"!==r||(i.style.display=""),""===i.style.display&&Pe(i)&&(o[s]=Ie.access(i,"olddisplay",y(i.nodeName)))):(a=Pe(i),"none"===r&&a||Ie.set(i,"olddisplay",a?r:Z.css(i,"display"))));for(s=0;n>s;s++)i=e[s],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[s]||"":"none"));return e}function O(e,t,r,i,a){return new O.prototype.init(e,t,r,i,a)}function R(){return setTimeout(function(){ze=void 0}),ze=Z.now()}function N(e,t){var r,i=0,a={height:e};for(t=t?1:0;4>i;i+=2-t)r=Te[i],a["margin"+r]=a["padding"+r]=e;return t&&(a.opacity=a.width=e),a}function D(e,t,r){for(var i,a=(rt[t]||[]).concat(rt["*"]),o=0,s=a.length;s>o;o++)if(i=a[o].call(r,t,e))return i}function L(e,t,r){var i,a,o,s,n,c,l,d,u=this,p={},h=e.style,g=e.nodeType&&Pe(e),f=Ie.get(e,"fxshow");r.queue||(n=Z._queueHooks(e,"fx"),null==n.unqueued&&(n.unqueued=0,c=n.empty.fire,n.empty.fire=function(){n.unqueued||c()}),n.unqueued++,u.always(function(){u.always(function(){n.unqueued--,Z.queue(e,"fx").length||n.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[h.overflow,h.overflowX,h.overflowY],l=Z.css(e,"display"),d="none"===l?Ie.get(e,"olddisplay")||y(e.nodeName):l,"inline"===d&&"none"===Z.css(e,"float")&&(h.display="inline-block")),r.overflow&&(h.overflow="hidden",u.always(function(){h.overflow=r.overflow[0],h.overflowX=r.overflow[1],h.overflowY=r.overflow[2]}));for(i in t)if(a=t[i],Je.exec(a)){if(delete t[i],o=o||"toggle"===a,a===(g?"hide":"show")){if("show"!==a||!f||void 0===f[i])continue;g=!0}p[i]=f&&f[i]||Z.style(e,i)}else l=void 0;if(Z.isEmptyObject(p))"inline"===("none"===l?y(e.nodeName):l)&&(h.display=l);else{f?"hidden"in f&&(g=f.hidden):f=Ie.access(e,"fxshow",{}),o&&(f.hidden=!g),g?Z(e).show():u.done(function(){Z(e).hide()}),u.done(function(){var t;Ie.remove(e,"fxshow");for(t in p)Z.style(e,t,p[t])});for(i in p)s=D(g?f[i]:0,i,u),i in f||(f[i]=s.start,g&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function M(e,t){var r,i,a,o,s;for(r in e)if(i=Z.camelCase(r),a=t[i],o=e[r],Z.isArray(o)&&(a=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),s=Z.cssHooks[i],s&&"expand"in s){o=s.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=a)}else t[i]=a}function w(e,t,r){var i,a,o=0,s=tt.length,n=Z.Deferred().always(function(){delete c.elem}),c=function(){if(a)return!1;for(var t=ze||R(),r=Math.max(0,l.startTime+l.duration-t),i=r/l.duration||0,o=1-i,s=0,c=l.tweens.length;c>s;s++)l.tweens[s].run(o);return n.notifyWith(e,[l,o,r]),1>o&&c?r:(n.resolveWith(e,[l]),!1)},l=n.promise({elem:e,props:Z.extend({},t),opts:Z.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:ze||R(),duration:r.duration,tweens:[],createTween:function(t,r){var i=Z.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var r=0,i=t?l.tweens.length:0;if(a)return this;for(a=!0;i>r;r++)l.tweens[r].run(1);return t?n.resolveWith(e,[l,t]):n.rejectWith(e,[l,t]),this}}),d=l.props;for(M(d,l.opts.specialEasing);s>o;o++)if(i=tt[o].call(l,e,d,l.opts))return i;return Z.map(d,D,l),Z.isFunction(l.opts.start)&&l.opts.start.call(e,l),Z.fx.timer(Z.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function U(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,a=0,o=t.toLowerCase().match(he)||[];if(Z.isFunction(r))for(;i=o[a++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function k(e,t,r,i){function a(n){var c;return o[n]=!0,Z.each(e[n]||[],function(e,n){var l=n(t,r,i);return"string"!=typeof l||s||o[l]?s?!(c=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),c}var o={},s=e===vt;return a(t.dataTypes[0])||!o["*"]&&a("*")}function x(e,t){var r,i,a=Z.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((a[r]?e:i||(i={}))[r]=t[r]);return i&&Z.extend(!0,e,i),e}function G(e,t,r){for(var i,a,o,s,n=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(a in n)if(n[a]&&n[a].test(i)){c.unshift(a);break}if(c[0]in r)o=c[0];else{for(a in r){if(!c[0]||e.converters[a+" "+c[0]]){o=a;break}s||(s=a)}o=o||s}return o?(o!==c[0]&&c.unshift(o),r[o]):void 0}function F(e,t,r,i){var a,o,s,n,c,l={},d=e.dataTypes.slice();if(d[1])for(s in e.converters)l[s.toLowerCase()]=e.converters[s];for(o=d.shift();o;)if(e.responseFields[o]&&(r[e.responseFields[o]]=t),!c&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=o,o=d.shift())if("*"===o)o=c;else if("*"!==c&&c!==o){if(s=l[c+" "+o]||l["* "+o],!s)for(a in l)if(n=a.split(" "),n[1]===o&&(s=l[c+" "+n[0]]||l["* "+n[0]])){s===!0?s=l[a]:l[a]!==!0&&(o=n[0],d.unshift(n[1]));break}if(s!==!0)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+c+" to "+o}}}return{state:"success",data:t}}function H(e,t,r,i){var a;if(Z.isArray(t))Z.each(t,function(t,a){r||St.test(e)?i(e,a):H(e+"["+("object"==typeof a?t:"")+"]",a,r,i)});else if(r||"object"!==Z.type(t))i(e,t);else for(a in t)H(e+"["+a+"]",t[a],r,i)}function V(e){return Z.isWindow(e)?e:9===e.nodeType&&e.defaultView}var Y=[],q=Y.slice,B=Y.concat,$=Y.push,W=Y.indexOf,j={},K=j.toString,Q=j.hasOwnProperty,z={},X=e.document,J="2.1.3",Z=function(e,t){return new Z.fn.init(e,t)},ee=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,te=/^-ms-/,re=/-([\da-z])/gi,ie=function(e,t){return t.toUpperCase()};Z.fn=Z.prototype={jquery:J,constructor:Z,selector:"",length:0,toArray:function(){return q.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:q.call(this)},pushStack:function(e){var t=Z.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return Z.each(this,e,t)},map:function(e){return this.pushStack(Z.map(this,function(t,r){return e.call(t,r,t)}))},slice:function(){return this.pushStack(q.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,r=+e+(0>e?t:0);return this.pushStack(r>=0&&t>r?[this[r]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:$,sort:Y.sort,splice:Y.splice},Z.extend=Z.fn.extend=function(){var e,t,r,i,a,o,s=arguments[0]||{},n=1,c=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[n]||{},n++),"object"==typeof s||Z.isFunction(s)||(s={}),n===c&&(s=this,n--);c>n;n++)if(null!=(e=arguments[n]))for(t in e)r=s[t],i=e[t],s!==i&&(l&&i&&(Z.isPlainObject(i)||(a=Z.isArray(i)))?(a?(a=!1,o=r&&Z.isArray(r)?r:[]):o=r&&Z.isPlainObject(r)?r:{},s[t]=Z.extend(l,o,i)):void 0!==i&&(s[t]=i));return s},Z.extend({expando:"jQuery"+(J+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===Z.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!Z.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"===Z.type(e)&&!e.nodeType&&!Z.isWindow(e)&&!(e.constructor&&!Q.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?j[K.call(e)]||"object":typeof e},globalEval:function(e){var t,r=eval;e=Z.trim(e),e&&(1===e.indexOf("use strict")?(t=X.createElement("script"),t.text=e,X.head.appendChild(t).parentNode.removeChild(t)):r(e))},camelCase:function(e){return e.replace(te,"ms-").replace(re,ie)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var a,o=0,s=e.length,n=r(e);if(i){if(n)for(;s>o&&(a=t.apply(e[o],i),a!==!1);o++);else for(o in e)if(a=t.apply(e[o],i),a===!1)break}else if(n)for(;s>o&&(a=t.call(e[o],o,e[o]),a!==!1);o++);else for(o in e)if(a=t.call(e[o],o,e[o]),a===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ee,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(r(Object(e))?Z.merge(i,"string"==typeof e?[e]:e):$.call(i,e)),i},inArray:function(e,t,r){return null==t?-1:W.call(t,e,r)},merge:function(e,t){for(var r=+t.length,i=0,a=e.length;r>i;i++)e[a++]=t[i];return e.length=a,e},grep:function(e,t,r){for(var i,a=[],o=0,s=e.length,n=!r;s>o;o++)i=!t(e[o],o),i!==n&&a.push(e[o]);return a},map:function(e,t,i){var a,o=0,s=e.length,n=r(e),c=[];if(n)for(;s>o;o++)a=t(e[o],o,i),null!=a&&c.push(a);else for(o in e)a=t(e[o],o,i),null!=a&&c.push(a);return B.apply([],c)},guid:1,proxy:function(e,t){var r,i,a;return"string"==typeof t&&(r=e[t],t=e,e=r),Z.isFunction(e)?(i=q.call(arguments,2),a=function(){return e.apply(t||this,i.concat(q.call(arguments)))},a.guid=e.guid=e.guid||Z.guid++,a):void 0},now:Date.now,support:z}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){j["[object "+t+"]"]=t.toLowerCase()});var ae=function(e){function t(e,t,r,i){var a,o,s,n,c,l,u,h,g,f;if((t?t.ownerDocument||t:H)!==L&&D(t),t=t||L,r=r||[],n=t.nodeType,"string"!=typeof e||!e||1!==n&&9!==n&&11!==n)return r;if(!i&&w){if(11!==n&&(a=Ee.exec(e)))if(s=a[1]){if(9===n){if(o=t.getElementById(s),!o||!o.parentNode)return r;if(o.id===s)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&G(t,o)&&o.id===s)return r.push(o),r}else{if(a[2])return J.apply(r,t.getElementsByTagName(e)),r;if((s=a[3])&&b.getElementsByClassName)return J.apply(r,t.getElementsByClassName(s)),r}if(b.qsa&&(!U||!U.test(e))){if(h=u=F,g=t,f=1!==n&&e,1===n&&"object"!==t.nodeName.toLowerCase()){for(l=C(e),(u=t.getAttribute("id"))?h=u.replace(ye,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",c=l.length;c--;)l[c]=h+p(l[c]);g=ve.test(e)&&d(t.parentNode)||t,f=l.join(",")}if(f)try{return J.apply(r,g.querySelectorAll(f)),r}catch(e){}finally{u||t.removeAttribute("id")}}}return _(e.replace(ce,"$1"),t,r,i)}function r(){function e(r,i){return t.push(r+" ")>T.cacheLength&&delete e[t.shift()],e[r+" "]=i}var t=[];return e}function i(e){return e[F]=!0,e}function a(e){var t=L.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var r=e.split("|"),i=e.length;i--;)T.attrHandle[r[i]]=t}function s(e,t){var r=t&&e,i=r&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(i)return i;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function n(e){return function(t){var r=t.nodeName.toLowerCase();return"input"===r&&t.type===e}}function c(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function l(e){return i(function(t){return t=+t,i(function(r,i){for(var a,o=e([],r.length,t),s=o.length;s--;)r[a=o[s]]&&(r[a]=!(i[a]=r[a]))})})}function d(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function u(){}function p(e){for(var t=0,r=e.length,i="";r>t;t++)i+=e[t].value;return i}function h(e,t,r){var i=t.dir,a=r&&"parentNode"===i,o=Y++;return t.first?function(t,r,o){for(;t=t[i];)if(1===t.nodeType||a)return e(t,r,o)}:function(t,r,s){var n,c,l=[V,o];if(s){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,r,s))return!0}else for(;t=t[i];)if(1===t.nodeType||a){if(c=t[F]||(t[F]={}),(n=c[i])&&n[0]===V&&n[1]===o)return l[2]=n[2];if(c[i]=l,l[2]=e(t,r,s))return!0}}}function g(e){return e.length>1?function(t,r,i){for(var a=e.length;a--;)if(!e[a](t,r,i))return!1;return!0}:e[0]}function f(e,r,i){for(var a=0,o=r.length;o>a;a++)t(e,r[a],i);return i}function m(e,t,r,i,a){for(var o,s=[],n=0,c=e.length,l=null!=t;c>n;n++)(o=e[n])&&(!r||r(o,i,a))&&(s.push(o),l&&t.push(n));return s}function I(e,t,r,a,o,s){return a&&!a[F]&&(a=I(a)),o&&!o[F]&&(o=I(o,s)),i(function(i,s,n,c){var l,d,u,p=[],h=[],g=s.length,I=i||f(t||"*",n.nodeType?[n]:n,[]),E=!e||!i&&t?I:m(I,p,e,n,c),v=r?o||(i?e:g||a)?[]:s:E;if(r&&r(E,v,n,c),a)for(l=m(v,h),a(l,[],n,c),d=l.length;d--;)(u=l[d])&&(v[h[d]]=!(E[h[d]]=u));if(i){if(o||e){if(o){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(E[d]=u);o(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=o?ee(i,u):p[d])>-1&&(i[l]=!(s[l]=u))}}else v=m(v===s?v.splice(g,v.length):v),o?o(null,s,v,c):J.apply(s,v)})}function E(e){for(var t,r,i,a=e.length,o=T.relative[e[0].type],s=o||T.relative[" "],n=o?1:0,c=h(function(e){return e===t},s,!0),l=h(function(e){return ee(t,e)>-1},s,!0),d=[function(e,r,i){var a=!o&&(i||r!==O)||((t=r).nodeType?c(e,r,i):l(e,r,i));return t=null,a}];a>n;n++)if(r=T.relative[e[n].type])d=[h(g(d),r)];else{if(r=T.filter[e[n].type].apply(null,e[n].matches),r[F]){for(i=++n;a>i&&!T.relative[e[i].type];i++);return I(n>1&&g(d),n>1&&p(e.slice(0,n-1).concat({value:" "===e[n-2].type?"*":""})).replace(ce,"$1"),r,i>n&&E(e.slice(n,i)),a>i&&E(e=e.slice(i)),a>i&&p(e))}d.push(r)}return g(d)}function v(e,r){var a=r.length>0,o=e.length>0,s=function(i,s,n,c,l){var d,u,p,h=0,g="0",f=i&&[],I=[],E=O,v=i||o&&T.find.TAG("*",l),y=V+=null==E?1:Math.random()||.1,b=v.length;for(l&&(O=s!==L&&s);g!==b&&null!=(d=v[g]);g++){if(o&&d){for(u=0;p=e[u++];)if(p(d,s,n)){c.push(d);break}l&&(V=y)}a&&((d=!p&&d)&&h--,i&&f.push(d))}if(h+=g,a&&g!==h){for(u=0;p=r[u++];)p(f,I,s,n);if(i){if(h>0)for(;g--;)f[g]||I[g]||(I[g]=z.call(c));I=m(I)}J.apply(c,I),l&&!i&&I.length>0&&h+r.length>1&&t.uniqueSort(c)}return l&&(V=y,O=E),f};return a?i(s):s}var y,b,T,P,S,C,A,_,O,R,N,D,L,M,w,U,k,x,G,F="sizzle"+1*new Date,H=e.document,V=0,Y=0,q=r(),B=r(),$=r(),W=function(e,t){return e===t&&(N=!0),0},j=1<<31,K={}.hasOwnProperty,Q=[],z=Q.pop,X=Q.push,J=Q.push,Z=Q.slice,ee=function(e,t){for(var r=0,i=e.length;i>r;r++)if(e[r]===t)return r;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",ie="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ae=ie.replace("w","w#"),oe="\\["+re+"*("+ie+")(?:"+re+"*([*^$|!~]?=)"+re+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ae+"))|)"+re+"*\\]",se=":("+ie+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",ne=new RegExp(re+"+","g"),ce=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),le=new RegExp("^"+re+"*,"+re+"*"),de=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),ue=new RegExp("="+re+"*([^\\]'\"]*?)"+re+"*\\]","g"),pe=new RegExp(se),he=new RegExp("^"+ae+"$"),ge={ID:new RegExp("^#("+ie+")"),CLASS:new RegExp("^\\.("+ie+")"),TAG:new RegExp("^("+ie.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},fe=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,Ie=/^[^{]+\{\s*\[native \w/,Ee=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ve=/[+~]/,ye=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+re+"?|("+re+")|.)","ig"),Te=function(e,t,r){var i="0x"+t-65536;return i!==i||r?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},Pe=function(){D()};try{J.apply(Q=Z.call(H.childNodes),H.childNodes),Q[H.childNodes.length].nodeType}catch(e){J={apply:Q.length?function(e,t){X.apply(e,Z.call(t))}:function(e,t){for(var r=e.length,i=0;e[r++]=t[i++];);e.length=r-1}}}b=t.support={},S=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},D=t.setDocument=function(e){var t,r,i=e?e.ownerDocument||e:H;return i!==L&&9===i.nodeType&&i.documentElement?(L=i,M=i.documentElement,r=i.defaultView,r&&r!==r.top&&(r.addEventListener?r.addEventListener("unload",Pe,!1):r.attachEvent&&r.attachEvent("onunload",Pe)),w=!S(i),b.attributes=a(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=a(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=Ie.test(i.getElementsByClassName),b.getById=a(function(e){return M.appendChild(e).id=F,!i.getElementsByName||!i.getElementsByName(F).length}),b.getById?(T.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&w){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}},T.filter.ID=function(e){var t=e.replace(be,Te);return function(e){return e.getAttribute("id")===t}}):(delete T.find.ID,T.filter.ID=function(e){var t=e.replace(be,Te);return function(e){var r="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return r&&r.value===t}}),T.find.TAG=b.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,i=[],a=0,o=t.getElementsByTagName(e);if("*"===e){for(;r=o[a++];)1===r.nodeType&&i.push(r);return i}return o},T.find.CLASS=b.getElementsByClassName&&function(e,t){return w?t.getElementsByClassName(e):void 0},k=[],U=[],(b.qsa=Ie.test(i.querySelectorAll))&&(a(function(e){M.appendChild(e).innerHTML="<a id='"+F+"'></a><select id='"+F+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&U.push("[*^$]="+re+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||U.push("\\["+re+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+F+"-]").length||U.push("~="),e.querySelectorAll(":checked").length||U.push(":checked"),e.querySelectorAll("a#"+F+"+*").length||U.push(".#.+[+~]")}),a(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&U.push("name"+re+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||U.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),U.push(",.*:")})),(b.matchesSelector=Ie.test(x=M.matches||M.webkitMatchesSelector||M.mozMatchesSelector||M.oMatchesSelector||M.msMatchesSelector))&&a(function(e){b.disconnectedMatch=x.call(e,"div"),x.call(e,"[s!='']:x"),k.push("!=",se)}),U=U.length&&new RegExp(U.join("|")),k=k.length&&new RegExp(k.join("|")),t=Ie.test(M.compareDocumentPosition),G=t||Ie.test(M.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(r.contains?r.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return N=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!b.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===H&&G(H,e)?-1:t===i||t.ownerDocument===H&&G(H,t)?1:R?ee(R,e)-ee(R,t):0:4&r?-1:1)}:function(e,t){if(e===t)return N=!0,0;var r,a=0,o=e.parentNode,n=t.parentNode,c=[e],l=[t];if(!o||!n)return e===i?-1:t===i?1:o?-1:n?1:R?ee(R,e)-ee(R,t):0;if(o===n)return s(e,t);for(r=e;r=r.parentNode;)c.unshift(r);for(r=t;r=r.parentNode;)l.unshift(r);for(;c[a]===l[a];)a++;return a?s(c[a],l[a]):c[a]===H?-1:l[a]===H?1:0},i):L},t.matches=function(e,r){return t(e,null,null,r)},t.matchesSelector=function(e,r){if((e.ownerDocument||e)!==L&&D(e),r=r.replace(ue,"='$1']"),!(!b.matchesSelector||!w||k&&k.test(r)||U&&U.test(r)))try{var i=x.call(e,r);if(i||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){}return t(r,L,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==L&&D(e),G(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==L&&D(e);var r=T.attrHandle[t.toLowerCase()],i=r&&K.call(T.attrHandle,t.toLowerCase())?r(e,t,!w):void 0;return void 0!==i?i:b.attributes||!w?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,r=[],i=0,a=0;if(N=!b.detectDuplicates,R=!b.sortStable&&e.slice(0),e.sort(W),N){for(;t=e[a++];)t===e[a]&&(i=r.push(a));for(;i--;)e.splice(r[i],1)}return R=null,e},P=t.getText=function(e){var t,r="",i=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=P(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[i++];)r+=P(t);return r},T=t.selectors={cacheLength:50,createPseudo:i,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,Te),e[3]=(e[3]||e[4]||e[5]||"").replace(be,Te),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return ge.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&pe.test(r)&&(t=C(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,Te).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=q[e+" "];return t||(t=new RegExp("(^|"+re+")"+e+"("+re+"|$)"))&&q(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,r,i){return function(a){var o=t.attr(a,e);return null==o?"!="===r:!r||(o+="","="===r?o===i:"!="===r?o!==i:"^="===r?i&&0===o.indexOf(i):"*="===r?i&&o.indexOf(i)>-1:"$="===r?i&&o.slice(-i.length)===i:"~="===r?(" "+o.replace(ne," ")+" ").indexOf(i)>-1:"|="===r&&(o===i||o.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,r,i,a){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),n="of-type"===t;return 1===i&&0===a?function(e){return!!e.parentNode}:function(t,r,c){var l,d,u,p,h,g,f=o!==s?"nextSibling":"previousSibling",m=t.parentNode,I=n&&t.nodeName.toLowerCase(),E=!c&&!n;if(m){if(o){for(;f;){for(u=t;u=u[f];)if(n?u.nodeName.toLowerCase()===I:1===u.nodeType)return!1;g=f="only"===e&&!g&&"nextSibling"}return!0}if(g=[s?m.firstChild:m.lastChild],s&&E){for(d=m[F]||(m[F]={}),l=d[e]||[],h=l[0]===V&&l[1],p=l[0]===V&&l[2],u=h&&m.childNodes[h];u=++h&&u&&u[f]||(p=h=0)||g.pop();)if(1===u.nodeType&&++p&&u===t){d[e]=[V,h,p];break}}else if(E&&(l=(t[F]||(t[F]={}))[e])&&l[0]===V)p=l[1];else for(;(u=++h&&u&&u[f]||(p=h=0)||g.pop())&&((n?u.nodeName.toLowerCase()!==I:1!==u.nodeType)||!++p||(E&&((u[F]||(u[F]={}))[e]=[V,p]),u!==t)););return p-=a,p===i||p%i===0&&p/i>=0}}},PSEUDO:function(e,r){var a,o=T.pseudos[e]||T.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[F]?o(r):o.length>1?(a=[e,e,"",r],T.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,a=o(e,r),s=a.length;s--;)i=ee(e,a[s]),e[i]=!(t[i]=a[s])}):function(e){return o(e,0,a)}):o}},pseudos:{not:i(function(e){var t=[],r=[],a=A(e.replace(ce,"$1"));return a[F]?i(function(e,t,r,i){for(var o,s=a(e,null,i,[]),n=e.length;n--;)(o=s[n])&&(e[n]=!(t[n]=o))}):function(e,i,o){return t[0]=e,a(t,null,o,r),t[0]=null,!r.pop()}}),has:i(function(e){return function(r){return t(e,r).length>0}}),contains:i(function(e){return e=e.replace(be,Te),function(t){return(t.textContent||t.innerText||P(t)).indexOf(e)>-1}}),lang:i(function(e){return he.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,Te).toLowerCase(),function(t){var r;do if(r=w?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return r=r.toLowerCase(),r===e||0===r.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===M},focus:function(e){return e===L.activeElement&&(!L.hasFocus||L.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!T.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return fe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,r){return[0>r?r+t:r]}),even:l(function(e,t){for(var r=0;t>r;r+=2)e.push(r);return e}),odd:l(function(e,t){for(var r=1;t>r;r+=2)e.push(r);return e}),lt:l(function(e,t,r){for(var i=0>r?r+t:r;--i>=0;)e.push(i);return e}),gt:l(function(e,t,r){for(var i=0>r?r+t:r;++i<t;)e.push(i);return e})}},T.pseudos.nth=T.pseudos.eq;for(y in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})T.pseudos[y]=n(y);for(y in{submit:!0,reset:!0})T.pseudos[y]=c(y);return u.prototype=T.filters=T.pseudos,T.setFilters=new u,C=t.tokenize=function(e,r){var i,a,o,s,n,c,l,d=B[e+" "];if(d)return r?0:d.slice(0);for(n=e,c=[],l=T.preFilter;n;){(!i||(a=le.exec(n)))&&(a&&(n=n.slice(a[0].length)||n),c.push(o=[])),i=!1,(a=de.exec(n))&&(i=a.shift(),o.push({value:i,type:a[0].replace(ce," ")}),n=n.slice(i.length));for(s in T.filter)!(a=ge[s].exec(n))||l[s]&&!(a=l[s](a))||(i=a.shift(),o.push({value:i,type:s,matches:a}),n=n.slice(i.length));if(!i)break}return r?n.length:n?t.error(e):B(e,c).slice(0)},A=t.compile=function(e,t){var r,i=[],a=[],o=$[e+" "];if(!o){for(t||(t=C(e)),r=t.length;r--;)o=E(t[r]),o[F]?i.push(o):a.push(o);o=$(e,v(a,i)),o.selector=e}return o},_=t.select=function(e,t,r,i){var a,o,s,n,c,l="function"==typeof e&&e,u=!i&&C(e=l.selector||e);if(r=r||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&b.getById&&9===t.nodeType&&w&&T.relative[o[1].type]){if(t=(T.find.ID(s.matches[0].replace(be,Te),t)||[])[0],!t)return r;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(a=ge.needsContext.test(e)?0:o.length;a--&&(s=o[a],!T.relative[n=s.type]);)if((c=T.find[n])&&(i=c(s.matches[0].replace(be,Te),ve.test(o[0].type)&&d(t.parentNode)||t))){if(o.splice(a,1),e=i.length&&p(o),!e)return J.apply(r,i),r;break}}return(l||A(e,u))(i,t,!w,r,ve.test(e)&&d(t.parentNode)||t),r},b.sortStable=F.split("").sort(W).join("")===F,b.detectDuplicates=!!N,D(),b.sortDetached=a(function(e){return 1&e.compareDocumentPosition(L.createElement("div"))}),a(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,r){return r?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&a(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,r){return r||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),a(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,r){var i;return r?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);Z.find=ae,Z.expr=ae.selectors,Z.expr[":"]=Z.expr.pseudos,Z.unique=ae.uniqueSort,Z.text=ae.getText,Z.isXMLDoc=ae.isXML,Z.contains=ae.contains;var oe=Z.expr.match.needsContext,se=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ne=/^.[^:#\[\.,]*$/;Z.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?Z.find.matchesSelector(i,e)?[i]:[]:Z.find.matches(e,Z.grep(t,function(e){
return 1===e.nodeType}))},Z.fn.extend({find:function(e){var t,r=this.length,i=[],a=this;if("string"!=typeof e)return this.pushStack(Z(e).filter(function(){for(t=0;r>t;t++)if(Z.contains(a[t],this))return!0}));for(t=0;r>t;t++)Z.find(e,a[t],i);return i=this.pushStack(r>1?Z.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&oe.test(e)?Z(e):e||[],!1).length}});var ce,le=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,de=Z.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:le.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||ce).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof Z?t[0]:t,Z.merge(this,Z.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:X,!0)),se.test(r[1])&&Z.isPlainObject(t))for(r in t)Z.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=X.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=X,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):Z.isFunction(e)?"undefined"!=typeof ce.ready?ce.ready(e):e(Z):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),Z.makeArray(e,this))};de.prototype=Z.fn,ce=Z(X);var ue=/^(?:parents|prev(?:Until|All))/,pe={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(e,t,r){for(var i=[],a=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&Z(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}}),Z.fn.extend({has:function(e){var t=Z(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(Z.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,a=this.length,o=[],s=oe.test(e)||"string"!=typeof e?Z(e,t||this.context):0;a>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(s?s.index(r)>-1:1===r.nodeType&&Z.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?Z.unique(o):o)},index:function(e){return e?"string"==typeof e?W.call(Z(e),this[0]):W.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Z.unique(Z.merge(this.get(),Z(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Z.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Z.dir(e,"parentNode")},parentsUntil:function(e,t,r){return Z.dir(e,"parentNode",r)},next:function(e){return a(e,"nextSibling")},prev:function(e){return a(e,"previousSibling")},nextAll:function(e){return Z.dir(e,"nextSibling")},prevAll:function(e){return Z.dir(e,"previousSibling")},nextUntil:function(e,t,r){return Z.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return Z.dir(e,"previousSibling",r)},siblings:function(e){return Z.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return Z.sibling(e.firstChild)},contents:function(e){return e.contentDocument||Z.merge([],e.childNodes)}},function(e,t){Z.fn[e]=function(r,i){var a=Z.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(a=Z.filter(i,a)),this.length>1&&(pe[e]||Z.unique(a),ue.test(e)&&a.reverse()),this.pushStack(a)}});var he=/\S+/g,ge={};Z.Callbacks=function(e){e="string"==typeof e?ge[e]||o(e):Z.extend({},e);var t,r,i,a,s,n,c=[],l=!e.once&&[],d=function(o){for(t=e.memory&&o,r=!0,n=a||0,a=0,s=c.length,i=!0;c&&s>n;n++)if(c[n].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,c&&(l?l.length&&d(l.shift()):t?c=[]:u.disable())},u={add:function(){if(c){var r=c.length;!function t(r){Z.each(r,function(r,i){var a=Z.type(i);"function"===a?e.unique&&u.has(i)||c.push(i):i&&i.length&&"string"!==a&&t(i)})}(arguments),i?s=c.length:t&&(a=r,d(t))}return this},remove:function(){return c&&Z.each(arguments,function(e,t){for(var r;(r=Z.inArray(t,c,r))>-1;)c.splice(r,1),i&&(s>=r&&s--,n>=r&&n--)}),this},has:function(e){return e?Z.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){return c=[],s=0,this},disable:function(){return c=l=t=void 0,this},disabled:function(){return!c},lock:function(){return l=void 0,t||u.disable(),this},locked:function(){return!l},fireWith:function(e,t){return!c||r&&!l||(t=t||[],t=[e,t.slice?t.slice():t],i?l.push(t):d(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},Z.extend({Deferred:function(e){var t=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var e=arguments;return Z.Deferred(function(r){Z.each(t,function(t,o){var s=Z.isFunction(e[t])&&e[t];a[o[1]](function(){var e=s&&s.apply(this,arguments);e&&Z.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?Z.extend(e,i):i}},a={};return i.pipe=i.then,Z.each(t,function(e,o){var s=o[2],n=o[3];i[o[1]]=s.add,n&&s.add(function(){r=n},t[1^e][2].disable,t[2][2].lock),a[o[0]]=function(){return a[o[0]+"With"](this===a?i:this,arguments),this},a[o[0]+"With"]=s.fireWith}),i.promise(a),e&&e.call(a,a),a},when:function(e){var t,r,i,a=0,o=q.call(arguments),s=o.length,n=1!==s||e&&Z.isFunction(e.promise)?s:0,c=1===n?e:Z.Deferred(),l=function(e,r,i){return function(a){r[e]=this,i[e]=arguments.length>1?q.call(arguments):a,i===t?c.notifyWith(r,i):--n||c.resolveWith(r,i)}};if(s>1)for(t=new Array(s),r=new Array(s),i=new Array(s);s>a;a++)o[a]&&Z.isFunction(o[a].promise)?o[a].promise().done(l(a,i,o)).fail(c.reject).progress(l(a,r,t)):--n;return n||c.resolveWith(i,o),c.promise()}});var fe;Z.fn.ready=function(e){return Z.ready.promise().done(e),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(e){e?Z.readyWait++:Z.ready(!0)},ready:function(e){(e===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,e!==!0&&--Z.readyWait>0||(fe.resolveWith(X,[Z]),Z.fn.triggerHandler&&(Z(X).triggerHandler("ready"),Z(X).off("ready"))))}}),Z.ready.promise=function(t){return fe||(fe=Z.Deferred(),"complete"===X.readyState?setTimeout(Z.ready):(X.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1))),fe.promise(t)},Z.ready.promise();var me=Z.access=function(e,t,r,i,a,o,s){var n=0,c=e.length,l=null==r;if("object"===Z.type(r)){a=!0;for(n in r)Z.access(e,t,n,r[n],!0,o,s)}else if(void 0!==i&&(a=!0,Z.isFunction(i)||(s=!0),l&&(s?(t.call(e,i),t=null):(l=t,t=function(e,t,r){return l.call(Z(e),r)})),t))for(;c>n;n++)t(e[n],r,s?i:i.call(e[n],n,t(e[n],r)));return a?e:l?t.call(e):c?t(e[0],r):o};Z.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},n.uid=1,n.accepts=Z.acceptData,n.prototype={key:function(e){if(!n.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=n.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,Z.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,a=this.key(e),o=this.cache[a];if("string"==typeof t)o[t]=r;else if(Z.isEmptyObject(o))Z.extend(this.cache[a],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var r=this.cache[this.key(e)];return void 0===t?r:r[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,Z.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,a,o=this.key(e),s=this.cache[o];if(void 0===t)this.cache[o]={};else{Z.isArray(t)?i=t.concat(t.map(Z.camelCase)):(a=Z.camelCase(t),t in s?i=[t,a]:(i=a,i=i in s?[i]:i.match(he)||[])),r=i.length;for(;r--;)delete s[i[r]]}},hasData:function(e){return!Z.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var Ie=new n,Ee=new n,ve=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ye=/([A-Z])/g;Z.extend({hasData:function(e){return Ee.hasData(e)||Ie.hasData(e)},data:function(e,t,r){return Ee.access(e,t,r)},removeData:function(e,t){Ee.remove(e,t)},_data:function(e,t,r){return Ie.access(e,t,r)},_removeData:function(e,t){Ie.remove(e,t)}}),Z.fn.extend({data:function(e,t){var r,i,a,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(a=Ee.get(o),1===o.nodeType&&!Ie.get(o,"hasDataAttrs"))){for(r=s.length;r--;)s[r]&&(i=s[r].name,0===i.indexOf("data-")&&(i=Z.camelCase(i.slice(5)),c(o,i,a[i])));Ie.set(o,"hasDataAttrs",!0)}return a}return"object"==typeof e?this.each(function(){Ee.set(this,e)}):me(this,function(t){var r,i=Z.camelCase(e);if(o&&void 0===t){if(r=Ee.get(o,e),void 0!==r)return r;if(r=Ee.get(o,i),void 0!==r)return r;if(r=c(o,i,void 0),void 0!==r)return r}else this.each(function(){var r=Ee.get(this,i);Ee.set(this,i,t),-1!==e.indexOf("-")&&void 0!==r&&Ee.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Ee.remove(this,e)})}}),Z.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=Ie.get(e,t),r&&(!i||Z.isArray(r)?i=Ie.access(e,t,Z.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=Z.queue(e,t),i=r.length,a=r.shift(),o=Z._queueHooks(e,t),s=function(){Z.dequeue(e,t)};"inprogress"===a&&(a=r.shift(),i--),a&&("fx"===t&&r.unshift("inprogress"),delete o.stop,a.call(e,s,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return Ie.get(e,r)||Ie.access(e,r,{empty:Z.Callbacks("once memory").add(function(){Ie.remove(e,[t+"queue",r])})})}}),Z.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?Z.queue(this[0],e):void 0===t?this:this.each(function(){var r=Z.queue(this,e,t);Z._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&Z.dequeue(this,e)})},dequeue:function(e){return this.each(function(){Z.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,a=Z.Deferred(),o=this,s=this.length,n=function(){--i||a.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)r=Ie.get(o[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(n));return n(),a.promise(t)}});var be=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Te=["Top","Right","Bottom","Left"],Pe=function(e,t){return e=t||e,"none"===Z.css(e,"display")||!Z.contains(e.ownerDocument,e)},Se=/^(?:checkbox|radio)$/i;!function(){var e=X.createDocumentFragment(),t=e.appendChild(X.createElement("div")),r=X.createElement("input");r.setAttribute("type","radio"),r.setAttribute("checked","checked"),r.setAttribute("name","t"),t.appendChild(r),z.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",z.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ce="undefined";z.focusinBubbles="onfocusin"in e;var Ae=/^key/,_e=/^(?:mouse|pointer|contextmenu)|click/,Oe=/^(?:focusinfocus|focusoutblur)$/,Re=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(e,t,r,i,a){var o,s,n,c,l,d,u,p,h,g,f,m=Ie.get(e);if(m)for(r.handler&&(o=r,r=o.handler,a=o.selector),r.guid||(r.guid=Z.guid++),(c=m.events)||(c=m.events={}),(s=m.handle)||(s=m.handle=function(t){return typeof Z!==Ce&&Z.event.triggered!==t.type?Z.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(he)||[""],l=t.length;l--;)n=Re.exec(t[l])||[],h=f=n[1],g=(n[2]||"").split(".").sort(),h&&(u=Z.event.special[h]||{},h=(a?u.delegateType:u.bindType)||h,u=Z.event.special[h]||{},d=Z.extend({type:h,origType:f,data:i,handler:r,guid:r.guid,selector:a,needsContext:a&&Z.expr.match.needsContext.test(a),namespace:g.join(".")},o),(p=c[h])||(p=c[h]=[],p.delegateCount=0,u.setup&&u.setup.call(e,i,g,s)!==!1||e.addEventListener&&e.addEventListener(h,s,!1)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?p.splice(p.delegateCount++,0,d):p.push(d),Z.event.global[h]=!0)},remove:function(e,t,r,i,a){var o,s,n,c,l,d,u,p,h,g,f,m=Ie.hasData(e)&&Ie.get(e);if(m&&(c=m.events)){for(t=(t||"").match(he)||[""],l=t.length;l--;)if(n=Re.exec(t[l])||[],h=f=n[1],g=(n[2]||"").split(".").sort(),h){for(u=Z.event.special[h]||{},h=(i?u.delegateType:u.bindType)||h,p=c[h]||[],n=n[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)d=p[o],!a&&f!==d.origType||r&&r.guid!==d.guid||n&&!n.test(d.namespace)||i&&i!==d.selector&&("**"!==i||!d.selector)||(p.splice(o,1),d.selector&&p.delegateCount--,u.remove&&u.remove.call(e,d));s&&!p.length&&(u.teardown&&u.teardown.call(e,g,m.handle)!==!1||Z.removeEvent(e,h,m.handle),delete c[h])}else for(h in c)Z.event.remove(e,h+t[l],r,i,!0);Z.isEmptyObject(c)&&(delete m.handle,Ie.remove(e,"events"))}},trigger:function(t,r,i,a){var o,s,n,c,l,d,u,p=[i||X],h=Q.call(t,"type")?t.type:t,g=Q.call(t,"namespace")?t.namespace.split("."):[];if(s=n=i=i||X,3!==i.nodeType&&8!==i.nodeType&&!Oe.test(h+Z.event.triggered)&&(h.indexOf(".")>=0&&(g=h.split("."),h=g.shift(),g.sort()),l=h.indexOf(":")<0&&"on"+h,t=t[Z.expando]?t:new Z.Event(h,"object"==typeof t&&t),t.isTrigger=a?2:3,t.namespace=g.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),r=null==r?[t]:Z.makeArray(r,[t]),u=Z.event.special[h]||{},a||!u.trigger||u.trigger.apply(i,r)!==!1)){if(!a&&!u.noBubble&&!Z.isWindow(i)){for(c=u.delegateType||h,Oe.test(c+h)||(s=s.parentNode);s;s=s.parentNode)p.push(s),n=s;n===(i.ownerDocument||X)&&p.push(n.defaultView||n.parentWindow||e)}for(o=0;(s=p[o++])&&!t.isPropagationStopped();)t.type=o>1?c:u.bindType||h,d=(Ie.get(s,"events")||{})[t.type]&&Ie.get(s,"handle"),d&&d.apply(s,r),d=l&&s[l],d&&d.apply&&Z.acceptData(s)&&(t.result=d.apply(s,r),t.result===!1&&t.preventDefault());return t.type=h,a||t.isDefaultPrevented()||u._default&&u._default.apply(p.pop(),r)!==!1||!Z.acceptData(i)||l&&Z.isFunction(i[h])&&!Z.isWindow(i)&&(n=i[l],n&&(i[l]=null),Z.event.triggered=h,i[h](),Z.event.triggered=void 0,n&&(i[l]=n)),t.result}},dispatch:function(e){e=Z.event.fix(e);var t,r,i,a,o,s=[],n=q.call(arguments),c=(Ie.get(this,"events")||{})[e.type]||[],l=Z.event.special[e.type]||{};if(n[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){for(s=Z.event.handlers.call(this,e,c),t=0;(a=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=a.elem,r=0;(o=a.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((Z.event.special[o.origType]||{}).handle||o.handler).apply(a.elem,n),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,a,o,s=[],n=t.delegateCount,c=e.target;if(n&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!==this;c=c.parentNode||this)if(c.disabled!==!0||"click"!==e.type){for(i=[],r=0;n>r;r++)o=t[r],a=o.selector+" ",void 0===i[a]&&(i[a]=o.needsContext?Z(a,this).index(c)>=0:Z.find(a,this,null,[c]).length),i[a]&&i.push(o);i.length&&s.push({elem:c,handlers:i})}return n<t.length&&s.push({elem:this,handlers:t.slice(n)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var r,i,a,o=t.button;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||X,i=r.documentElement,a=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||a&&a.scrollLeft||0)-(i&&i.clientLeft||a&&a.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||a&&a.scrollTop||0)-(i&&i.clientTop||a&&a.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[Z.expando])return e;var t,r,i,a=e.type,o=e,s=this.fixHooks[a];for(s||(this.fixHooks[a]=s=_e.test(a)?this.mouseHooks:Ae.test(a)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,e=new Z.Event(o),t=i.length;t--;)r=i[t],e[r]=o[r];return e.target||(e.target=X),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==u()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return Z.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var a=Z.extend(new Z.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?Z.event.trigger(a,null,t):Z.event.dispatch.call(t,a),a.isDefaultPrevented()&&r.preventDefault()}},Z.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)},Z.Event=function(e,t){return this instanceof Z.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?l:d):this.type=e,t&&Z.extend(this,t),this.timeStamp=e&&e.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(e,t)},Z.Event.prototype={isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=l,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Z.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,a=e.relatedTarget,o=e.handleObj;return(!a||a!==i&&!Z.contains(i,a))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),z.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){Z.event.simulate(t,e.target,Z.event.fix(e),!0)};Z.event.special[t]={setup:function(){var i=this.ownerDocument||this,a=Ie.access(i,t);a||i.addEventListener(e,r,!0),Ie.access(i,t,(a||0)+1)},teardown:function(){var i=this.ownerDocument||this,a=Ie.access(i,t)-1;a?Ie.access(i,t,a):(i.removeEventListener(e,r,!0),Ie.remove(i,t))}}}),Z.fn.extend({on:function(e,t,r,i,a){var o,s;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(s in e)this.on(s,t,r,e[s],a);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=d;else if(!i)return this;return 1===a&&(o=i,i=function(e){return Z().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=Z.guid++)),this.each(function(){Z.event.add(this,e,i,r,t)})},one:function(e,t,r,i){return this.on(e,t,r,i,1)},off:function(e,t,r){var i,a;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,Z(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=d),this.each(function(){Z.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){Z.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?Z.event.trigger(e,t,r,!0):void 0}});var Ne=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,De=/<([\w:]+)/,Le=/<|&#?\w+;/,Me=/<(?:script|style|link)/i,we=/checked\s*(?:[^=]|=\s*.checked.)/i,Ue=/^$|\/(?:java|ecma)script/i,ke=/^true\/(.*)/,xe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ge.optgroup=Ge.option,Ge.tbody=Ge.tfoot=Ge.colgroup=Ge.caption=Ge.thead,Ge.th=Ge.td,Z.extend({clone:function(e,t,r){var i,a,o,s,n=e.cloneNode(!0),c=Z.contains(e.ownerDocument,e);if(!(z.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Z.isXMLDoc(e)))for(s=I(n),o=I(e),i=0,a=o.length;a>i;i++)E(o[i],s[i]);if(t)if(r)for(o=o||I(e),s=s||I(n),i=0,a=o.length;a>i;i++)m(o[i],s[i]);else m(e,n);return s=I(n,"script"),s.length>0&&f(s,!c&&I(e,"script")),n},buildFragment:function(e,t,r,i){for(var a,o,s,n,c,l,d=t.createDocumentFragment(),u=[],p=0,h=e.length;h>p;p++)if(a=e[p],a||0===a)if("object"===Z.type(a))Z.merge(u,a.nodeType?[a]:a);else if(Le.test(a)){for(o=o||d.appendChild(t.createElement("div")),s=(De.exec(a)||["",""])[1].toLowerCase(),n=Ge[s]||Ge._default,o.innerHTML=n[1]+a.replace(Ne,"<$1></$2>")+n[2],l=n[0];l--;)o=o.lastChild;Z.merge(u,o.childNodes),o=d.firstChild,o.textContent=""}else u.push(t.createTextNode(a));for(d.textContent="",p=0;a=u[p++];)if((!i||-1===Z.inArray(a,i))&&(c=Z.contains(a.ownerDocument,a),o=I(d.appendChild(a),"script"),c&&f(o),r))for(l=0;a=o[l++];)Ue.test(a.type||"")&&r.push(a);return d},cleanData:function(e){for(var t,r,i,a,o=Z.event.special,s=0;void 0!==(r=e[s]);s++){if(Z.acceptData(r)&&(a=r[Ie.expando],a&&(t=Ie.cache[a]))){if(t.events)for(i in t.events)o[i]?Z.event.remove(r,i):Z.removeEvent(r,i,t.handle);Ie.cache[a]&&delete Ie.cache[a]}delete Ee.cache[r[Ee.expando]]}}}),Z.fn.extend({text:function(e){return me(this,function(e){return void 0===e?Z.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?Z.filter(e,this):this,a=0;null!=(r=i[a]);a++)t||1!==r.nodeType||Z.cleanData(I(r)),r.parentNode&&(t&&Z.contains(r.ownerDocument,r)&&f(I(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(Z.cleanData(I(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return Z.clone(this,e,t)})},html:function(e){return me(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Me.test(e)&&!Ge[(De.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ne,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(Z.cleanData(I(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,Z.cleanData(I(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=B.apply([],e);var r,i,a,o,s,n,c=0,l=this.length,d=this,u=l-1,p=e[0],f=Z.isFunction(p);if(f||l>1&&"string"==typeof p&&!z.checkClone&&we.test(p))return this.each(function(r){var i=d.eq(r);f&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t)});if(l&&(r=Z.buildFragment(e,this[0].ownerDocument,!1,this),i=r.firstChild,1===r.childNodes.length&&(r=i),i)){for(a=Z.map(I(r,"script"),h),o=a.length;l>c;c++)s=r,c!==u&&(s=Z.clone(s,!0,!0),o&&Z.merge(a,I(s,"script"))),t.call(this[c],s,c);if(o)for(n=a[a.length-1].ownerDocument,Z.map(a,g),c=0;o>c;c++)s=a[c],Ue.test(s.type||"")&&!Ie.access(s,"globalEval")&&Z.contains(n,s)&&(s.src?Z._evalUrl&&Z._evalUrl(s.src):Z.globalEval(s.textContent.replace(xe,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Z.fn[e]=function(e){for(var r,i=[],a=Z(e),o=a.length-1,s=0;o>=s;s++)r=s===o?this:this.clone(!0),Z(a[s])[t](r),$.apply(i,r.get());return this.pushStack(i)}});var Fe,He={},Ve=/^margin/,Ye=new RegExp("^("+be+")(?!px)[a-z%]+$","i"),qe=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",a.appendChild(o);var t=e.getComputedStyle(s,null);r="1%"!==t.top,i="4px"===t.width,a.removeChild(o)}var r,i,a=X.documentElement,o=X.createElement("div"),s=X.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",z.clearCloneStyle="content-box"===s.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(s),e.getComputedStyle&&Z.extend(z,{pixelPosition:function(){return t(),r},boxSizingReliable:function(){return null==i&&t(),i},reliableMarginRight:function(){var t,r=s.appendChild(X.createElement("div"));return r.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",r.style.marginRight=r.style.width="0",s.style.width="1px",a.appendChild(o),t=!parseFloat(e.getComputedStyle(r,null).marginRight),a.removeChild(o),s.removeChild(r),t}}))}(),Z.swap=function(e,t,r,i){var a,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];a=r.apply(e,i||[]);for(o in t)e.style[o]=s[o];return a};var Be=/^(none|table(?!-c[ea]).+)/,$e=new RegExp("^("+be+")(.*)$","i"),We=new RegExp("^([+-])=("+be+")","i"),je={position:"absolute",visibility:"hidden",display:"block"},Ke={letterSpacing:"0",fontWeight:"400"},Qe=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=b(e,"opacity");return""===r?"1":r}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,o,s,n=Z.camelCase(t),c=e.style;return t=Z.cssProps[n]||(Z.cssProps[n]=P(c,n)),s=Z.cssHooks[t]||Z.cssHooks[n],void 0===r?s&&"get"in s&&void 0!==(a=s.get(e,!1,i))?a:c[t]:(o=typeof r,"string"===o&&(a=We.exec(r))&&(r=(a[1]+1)*a[2]+parseFloat(Z.css(e,t)),o="number"),void(null!=r&&r===r&&("number"!==o||Z.cssNumber[n]||(r+="px"),z.clearCloneStyle||""!==r||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(r=s.set(e,r,i))||(c[t]=r))))}},css:function(e,t,r,i){var a,o,s,n=Z.camelCase(t);return t=Z.cssProps[n]||(Z.cssProps[n]=P(e.style,n)),s=Z.cssHooks[t]||Z.cssHooks[n],s&&"get"in s&&(a=s.get(e,!0,r)),void 0===a&&(a=b(e,t,i)),"normal"===a&&t in Ke&&(a=Ke[t]),""===r||r?(o=parseFloat(a),r===!0||Z.isNumeric(o)?o||0:a):a}}),Z.each(["height","width"],function(e,t){Z.cssHooks[t]={get:function(e,r,i){return r?Be.test(Z.css(e,"display"))&&0===e.offsetWidth?Z.swap(e,je,function(){return A(e,t,i)}):A(e,t,i):void 0},set:function(e,r,i){var a=i&&qe(e);return S(e,r,i?C(e,t,i,"border-box"===Z.css(e,"boxSizing",!1,a),a):0)}}}),Z.cssHooks.marginRight=T(z.reliableMarginRight,function(e,t){return t?Z.swap(e,{display:"inline-block"},b,[e,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(e,t){Z.cssHooks[e+t]={expand:function(r){for(var i=0,a={},o="string"==typeof r?r.split(" "):[r];4>i;i++)a[e+Te[i]+t]=o[i]||o[i-2]||o[0];return a}},Ve.test(e)||(Z.cssHooks[e+t].set=S)}),Z.fn.extend({css:function(e,t){return me(this,function(e,t,r){var i,a,o={},s=0;if(Z.isArray(t)){for(i=qe(e),a=t.length;a>s;s++)o[t[s]]=Z.css(e,t[s],!1,i);return o}return void 0!==r?Z.style(e,t,r):Z.css(e,t)},e,t,arguments.length>1)},show:function(){return _(this,!0)},hide:function(){return _(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Pe(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=O,O.prototype={constructor:O,init:function(e,t,r,i,a,o){this.elem=e,this.prop=r,this.easing=a||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(Z.cssNumber[r]?"":"px")},cur:function(){var e=O.propHooks[this.prop];return e&&e.get?e.get(this):O.propHooks._default.get(this)},run:function(e){var t,r=O.propHooks[this.prop];return this.pos=t=this.options.duration?Z.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):O.propHooks._default.set(this),this}},O.prototype.init.prototype=O.prototype,O.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=Z.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){Z.fx.step[e.prop]?Z.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[Z.cssProps[e.prop]]||Z.cssHooks[e.prop])?Z.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},O.propHooks.scrollTop=O.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Z.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},Z.fx=O.prototype.init,Z.fx.step={};var ze,Xe,Je=/^(?:toggle|show|hide)$/,Ze=new RegExp("^(?:([+-])=|)("+be+")([a-z%]*)$","i"),et=/queueHooks$/,tt=[L],rt={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),a=Ze.exec(t),o=a&&a[3]||(Z.cssNumber[e]?"":"px"),s=(Z.cssNumber[e]||"px"!==o&&+i)&&Ze.exec(Z.css(r.elem,e)),n=1,c=20;if(s&&s[3]!==o){o=o||s[3],a=a||[],s=+i||1;do n=n||".5",s/=n,Z.style(r.elem,e,s+o);while(n!==(n=r.cur()/i)&&1!==n&&--c)}return a&&(s=r.start=+s||+i||0,r.unit=o,r.end=a[1]?s+(a[1]+1)*a[2]:+a[2]),r}]};Z.Animation=Z.extend(w,{tweener:function(e,t){Z.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,a=e.length;a>i;i++)r=e[i],rt[r]=rt[r]||[],rt[r].unshift(t)},prefilter:function(e,t){t?tt.unshift(e):tt.push(e)}}),Z.speed=function(e,t,r){var i=e&&"object"==typeof e?Z.extend({},e):{complete:r||!r&&t||Z.isFunction(e)&&e,duration:e,easing:r&&t||t&&!Z.isFunction(t)&&t};return i.duration=Z.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in Z.fx.speeds?Z.fx.speeds[i.duration]:Z.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){Z.isFunction(i.old)&&i.old.call(this),i.queue&&Z.dequeue(this,i.queue)},i},Z.fn.extend({fadeTo:function(e,t,r,i){return this.filter(Pe).css("opacity",0).show().end().animate({opacity:t},e,r,i)},animate:function(e,t,r,i){var a=Z.isEmptyObject(e),o=Z.speed(t,r,i),s=function(){var t=w(this,Z.extend({},e),o);(a||Ie.get(this,"finish"))&&t.stop(!0)};return s.finish=s,a||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,a=null!=e&&e+"queueHooks",o=Z.timers,s=Ie.get(this);if(a)s[a]&&s[a].stop&&i(s[a]);else for(a in s)s[a]&&s[a].stop&&et.test(a)&&i(s[a]);for(a=o.length;a--;)o[a].elem!==this||null!=e&&o[a].queue!==e||(o[a].anim.stop(r),t=!1,o.splice(a,1));(t||!r)&&Z.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=Ie.get(this),i=r[e+"queue"],a=r[e+"queueHooks"],o=Z.timers,s=i?i.length:0;
for(r.finish=!0,Z.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),Z.each(["toggle","show","hide"],function(e,t){var r=Z.fn[t];Z.fn[t]=function(e,i,a){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(N(t,!0),e,i,a)}}),Z.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){Z.fn[e]=function(e,r,i){return this.animate(t,e,r,i)}}),Z.timers=[],Z.fx.tick=function(){var e,t=0,r=Z.timers;for(ze=Z.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||Z.fx.stop(),ze=void 0},Z.fx.timer=function(e){Z.timers.push(e),e()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Xe||(Xe=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Xe),Xe=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(e,t){return e=Z.fx?Z.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var i=setTimeout(t,e);r.stop=function(){clearTimeout(i)}})},function(){var e=X.createElement("input"),t=X.createElement("select"),r=t.appendChild(X.createElement("option"));e.type="checkbox",z.checkOn=""!==e.value,z.optSelected=r.selected,t.disabled=!0,z.optDisabled=!r.disabled,e=X.createElement("input"),e.value="t",e.type="radio",z.radioValue="t"===e.value}();var it,at,ot=Z.expr.attrHandle;Z.fn.extend({attr:function(e,t){return me(this,Z.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){Z.removeAttr(this,e)})}}),Z.extend({attr:function(e,t,r){var i,a,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===Ce?Z.prop(e,t,r):(1===o&&Z.isXMLDoc(e)||(t=t.toLowerCase(),i=Z.attrHooks[t]||(Z.expr.match.bool.test(t)?at:it)),void 0===r?i&&"get"in i&&null!==(a=i.get(e,t))?a:(a=Z.find.attr(e,t),null==a?void 0:a):null!==r?i&&"set"in i&&void 0!==(a=i.set(e,r,t))?a:(e.setAttribute(t,r+""),r):void Z.removeAttr(e,t))},removeAttr:function(e,t){var r,i,a=0,o=t&&t.match(he);if(o&&1===e.nodeType)for(;r=o[a++];)i=Z.propFix[r]||r,Z.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!z.radioValue&&"radio"===t&&Z.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),at={set:function(e,t,r){return t===!1?Z.removeAttr(e,r):e.setAttribute(r,r),r}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(e,t){var r=ot[t]||Z.find.attr;ot[t]=function(e,t,i){var a,o;return i||(o=ot[t],ot[t]=a,a=null!=r(e,t,i)?t.toLowerCase():null,ot[t]=o),a}});var st=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(e,t){return me(this,Z.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[Z.propFix[e]||e]})}}),Z.extend({propFix:{for:"htmlFor",class:"className"},prop:function(e,t,r){var i,a,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!Z.isXMLDoc(e),o&&(t=Z.propFix[t]||t,a=Z.propHooks[t]),void 0!==r?a&&"set"in a&&void 0!==(i=a.set(e,r,t))?i:e[t]=r:a&&"get"in a&&null!==(i=a.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||st.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),z.optSelected||(Z.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var nt=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(e){var t,r,i,a,o,s,n="string"==typeof e&&e,c=0,l=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).addClass(e.call(this,t,this.className))});if(n)for(t=(e||"").match(he)||[];l>c;c++)if(r=this[c],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(nt," "):" ")){for(o=0;a=t[o++];)i.indexOf(" "+a+" ")<0&&(i+=a+" ");s=Z.trim(i),r.className!==s&&(r.className=s)}return this},removeClass:function(e){var t,r,i,a,o,s,n=0===arguments.length||"string"==typeof e&&e,c=0,l=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).removeClass(e.call(this,t,this.className))});if(n)for(t=(e||"").match(he)||[];l>c;c++)if(r=this[c],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(nt," "):"")){for(o=0;a=t[o++];)for(;i.indexOf(" "+a+" ")>=0;)i=i.replace(" "+a+" "," ");s=e?Z.trim(i):"",r.className!==s&&(r.className=s)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(Z.isFunction(e)?function(r){Z(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r)for(var t,i=0,a=Z(this),o=e.match(he)||[];t=o[i++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else(r===Ce||"boolean"===r)&&(this.className&&Ie.set(this,"__className__",this.className),this.className=this.className||e===!1?"":Ie.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",r=0,i=this.length;i>r;r++)if(1===this[r].nodeType&&(" "+this[r].className+" ").replace(nt," ").indexOf(t)>=0)return!0;return!1}});var ct=/\r/g;Z.fn.extend({val:function(e){var t,r,i,a=this[0];return arguments.length?(i=Z.isFunction(e),this.each(function(r){var a;1===this.nodeType&&(a=i?e.call(this,r,Z(this).val()):e,null==a?a="":"number"==typeof a?a+="":Z.isArray(a)&&(a=Z.map(a,function(e){return null==e?"":e+""})),t=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,a,"value")||(this.value=a))})):a?(t=Z.valHooks[a.type]||Z.valHooks[a.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(a,"value"))?r:(r=a.value,"string"==typeof r?r.replace(ct,""):null==r?"":r)):void 0}}),Z.extend({valHooks:{option:{get:function(e){var t=Z.find.attr(e,"value");return null!=t?t:Z.trim(Z.text(e))}},select:{get:function(e){for(var t,r,i=e.options,a=e.selectedIndex,o="select-one"===e.type||0>a,s=o?null:[],n=o?a+1:i.length,c=0>a?n:o?a:0;n>c;c++)if(r=i[c],!(!r.selected&&c!==a||(z.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&Z.nodeName(r.parentNode,"optgroup"))){if(t=Z(r).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var r,i,a=e.options,o=Z.makeArray(t),s=a.length;s--;)i=a[s],(i.selected=Z.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(e,t){return Z.isArray(t)?e.checked=Z.inArray(Z(e).val(),t)>=0:void 0}},z.checkOn||(Z.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){Z.fn[t]=function(e,r){return arguments.length>0?this.on(t,null,e,r):this.trigger(t)}}),Z.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,i){return this.on(t,e,r,i)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)}});var lt=Z.now(),dt=/\?/;Z.parseJSON=function(e){return JSON.parse(e+"")},Z.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(e){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&Z.error("Invalid XML: "+e),t};var ut=/#.*$/,pt=/([?&])_=[^&]*/,ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,gt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ft=/^(?:GET|HEAD)$/,mt=/^\/\//,It=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Et={},vt={},yt="*/".concat("*"),bt=e.location.href,Tt=It.exec(bt.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt,type:"GET",isLocal:gt.test(Tt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":yt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?x(x(e,Z.ajaxSettings),t):x(Z.ajaxSettings,e)},ajaxPrefilter:U(Et),ajaxTransport:U(vt),ajax:function(e,t){function r(e,t,r,s){var c,d,I,E,y,T=t;2!==v&&(v=2,n&&clearTimeout(n),i=void 0,o=s||"",b.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(E=G(u,b,r)),E=F(u,E,b,c),c?(u.ifModified&&(y=b.getResponseHeader("Last-Modified"),y&&(Z.lastModified[a]=y),y=b.getResponseHeader("etag"),y&&(Z.etag[a]=y)),204===e||"HEAD"===u.type?T="nocontent":304===e?T="notmodified":(T=E.state,d=E.data,I=E.error,c=!I)):(I=T,(e||!T)&&(T="error",0>e&&(e=0))),b.status=e,b.statusText=(t||T)+"",c?g.resolveWith(p,[d,T,b]):g.rejectWith(p,[b,T,I]),b.statusCode(m),m=void 0,l&&h.trigger(c?"ajaxSuccess":"ajaxError",[b,u,c?d:I]),f.fireWith(p,[b,T]),l&&(h.trigger("ajaxComplete",[b,u]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,a,o,s,n,c,l,d,u=Z.ajaxSetup({},t),p=u.context||u,h=u.context&&(p.nodeType||p.jquery)?Z(p):Z.event,g=Z.Deferred(),f=Z.Callbacks("once memory"),m=u.statusCode||{},I={},E={},v=0,y="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!s)for(s={};t=ht.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?o:null},setRequestHeader:function(e,t){var r=e.toLowerCase();return v||(e=E[r]=E[r]||e,I[e]=t),this},overrideMimeType:function(e){return v||(u.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>v)for(t in e)m[t]=[m[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||y;return i&&i.abort(t),r(0,t),this}};if(g.promise(b).complete=f.add,b.success=b.done,b.error=b.fail,u.url=((e||u.url||bt)+"").replace(ut,"").replace(mt,Tt[1]+"//"),u.type=t.method||t.type||u.method||u.type,u.dataTypes=Z.trim(u.dataType||"*").toLowerCase().match(he)||[""],null==u.crossDomain&&(c=It.exec(u.url.toLowerCase()),u.crossDomain=!(!c||c[1]===Tt[1]&&c[2]===Tt[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(Tt[3]||("http:"===Tt[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=Z.param(u.data,u.traditional)),k(Et,u,t,b),2===v)return b;l=Z.event&&u.global,l&&0===Z.active++&&Z.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!ft.test(u.type),a=u.url,u.hasContent||(u.data&&(a=u.url+=(dt.test(a)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=pt.test(a)?a.replace(pt,"$1_="+lt++):a+(dt.test(a)?"&":"?")+"_="+lt++)),u.ifModified&&(Z.lastModified[a]&&b.setRequestHeader("If-Modified-Since",Z.lastModified[a]),Z.etag[a]&&b.setRequestHeader("If-None-Match",Z.etag[a])),(u.data&&u.hasContent&&u.contentType!==!1||t.contentType)&&b.setRequestHeader("Content-Type",u.contentType),b.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+yt+"; q=0.01":""):u.accepts["*"]);for(d in u.headers)b.setRequestHeader(d,u.headers[d]);if(u.beforeSend&&(u.beforeSend.call(p,b,u)===!1||2===v))return b.abort();y="abort";for(d in{success:1,error:1,complete:1})b[d](u[d]);if(i=k(vt,u,t,b)){b.readyState=1,l&&h.trigger("ajaxSend",[b,u]),u.async&&u.timeout>0&&(n=setTimeout(function(){b.abort("timeout")},u.timeout));try{v=1,i.send(I,r)}catch(e){if(!(2>v))throw e;r(-1,e)}}else r(-1,"No Transport");return b},getJSON:function(e,t,r){return Z.get(e,t,r,"json")},getScript:function(e,t){return Z.get(e,void 0,t,"script")}}),Z.each(["get","post"],function(e,t){Z[t]=function(e,r,i,a){return Z.isFunction(r)&&(a=a||i,i=r,r=void 0),Z.ajax({url:e,type:t,dataType:a,data:r,success:i})}}),Z._evalUrl=function(e){return Z.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},Z.fn.extend({wrapAll:function(e){var t;return Z.isFunction(e)?this.each(function(t){Z(this).wrapAll(e.call(this,t))}):(this[0]&&(t=Z(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(Z.isFunction(e)?function(t){Z(this).wrapInner(e.call(this,t))}:function(){var t=Z(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=Z.isFunction(e);return this.each(function(r){Z(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},Z.expr.filters.visible=function(e){return!Z.expr.filters.hidden(e)};var Pt=/%20/g,St=/\[\]$/,Ct=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,_t=/^(?:input|select|textarea|keygen)/i;Z.param=function(e,t){var r,i=[],a=function(e,t){t=Z.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(e)||e.jquery&&!Z.isPlainObject(e))Z.each(e,function(){a(this.name,this.value)});else for(r in e)H(r,e[r],t,a);return i.join("&").replace(Pt,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Z.prop(this,"elements");return e?Z.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Z(this).is(":disabled")&&_t.test(this.nodeName)&&!At.test(e)&&(this.checked||!Se.test(e))}).map(function(e,t){var r=Z(this).val();return null==r?null:Z.isArray(r)?Z.map(r,function(e){return{name:t.name,value:e.replace(Ct,"\r\n")}}):{name:t.name,value:r.replace(Ct,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Ot=0,Rt={},Nt={0:200,1223:204},Dt=Z.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Rt)Rt[e]()}),z.cors=!!Dt&&"withCredentials"in Dt,z.ajax=Dt=!!Dt,Z.ajaxTransport(function(e){var t;return z.cors||Dt&&!e.crossDomain?{send:function(r,i){var a,o=e.xhr(),s=++Ot;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)o[a]=e.xhrFields[a];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(a in r)o.setRequestHeader(a,r[a]);t=function(e){return function(){t&&(delete Rt[s],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?i(o.status,o.statusText):i(Nt[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=Rt[s]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return Z.globalEval(e),e}}}),Z.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Z.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,a){t=Z("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&a("error"===e.type?404:200,e.type)}),X.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Lt=[],Mt=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Lt.pop()||Z.expando+"_"+lt++;return this[e]=!0,e}}),Z.ajaxPrefilter("json jsonp",function(t,r,i){var a,o,s,n=t.jsonp!==!1&&(Mt.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Mt.test(t.data)&&"data");return n||"jsonp"===t.dataTypes[0]?(a=t.jsonpCallback=Z.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,n?t[n]=t[n].replace(Mt,"$1"+a):t.jsonp!==!1&&(t.url+=(dt.test(t.url)?"&":"?")+t.jsonp+"="+a),t.converters["script json"]=function(){return s||Z.error(a+" was not called"),s[0]},t.dataTypes[0]="json",o=e[a],e[a]=function(){s=arguments},i.always(function(){e[a]=o,t[a]&&(t.jsonpCallback=r.jsonpCallback,Lt.push(a)),s&&Z.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),Z.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||X;var i=se.exec(e),a=!r&&[];return i?[t.createElement(i[1])]:(i=Z.buildFragment([e],t,a),a&&a.length&&Z(a).remove(),Z.merge([],i.childNodes))};var wt=Z.fn.load;Z.fn.load=function(e,t,r){if("string"!=typeof e&&wt)return wt.apply(this,arguments);var i,a,o,s=this,n=e.indexOf(" ");return n>=0&&(i=Z.trim(e.slice(n)),e=e.slice(0,n)),Z.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(a="POST"),s.length>0&&Z.ajax({url:e,type:a,dataType:"html",data:t}).done(function(e){o=arguments,s.html(i?Z("<div>").append(Z.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Z.fn[t]=function(e){return this.on(t,e)}}),Z.expr.filters.animated=function(e){return Z.grep(Z.timers,function(t){return e===t.elem}).length};var Ut=e.document.documentElement;Z.offset={setOffset:function(e,t,r){var i,a,o,s,n,c,l,d=Z.css(e,"position"),u=Z(e),p={};"static"===d&&(e.style.position="relative"),n=u.offset(),o=Z.css(e,"top"),c=Z.css(e,"left"),l=("absolute"===d||"fixed"===d)&&(o+c).indexOf("auto")>-1,l?(i=u.position(),s=i.top,a=i.left):(s=parseFloat(o)||0,a=parseFloat(c)||0),Z.isFunction(t)&&(t=t.call(e,r,n)),null!=t.top&&(p.top=t.top-n.top+s),null!=t.left&&(p.left=t.left-n.left+a),"using"in t?t.using.call(e,p):u.css(p)}},Z.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){Z.offset.setOffset(this,e,t)});var t,r,i=this[0],a={top:0,left:0},o=i&&i.ownerDocument;return o?(t=o.documentElement,Z.contains(t,i)?(typeof i.getBoundingClientRect!==Ce&&(a=i.getBoundingClientRect()),r=V(o),{top:a.top+r.pageYOffset-t.clientTop,left:a.left+r.pageXOffset-t.clientLeft}):a):void 0},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===Z.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),Z.nodeName(e[0],"html")||(i=e.offset()),i.top+=Z.css(e[0],"borderTopWidth",!0),i.left+=Z.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-Z.css(r,"marginTop",!0),left:t.left-i.left-Z.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Ut;e&&!Z.nodeName(e,"html")&&"static"===Z.css(e,"position");)e=e.offsetParent;return e||Ut})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var i="pageYOffset"===r;Z.fn[t]=function(a){return me(this,function(t,a,o){var s=V(t);return void 0===o?s?s[r]:t[a]:void(s?s.scrollTo(i?e.pageXOffset:o,i?o:e.pageYOffset):t[a]=o)},t,a,arguments.length,null)}}),Z.each(["top","left"],function(e,t){Z.cssHooks[t]=T(z.pixelPosition,function(e,r){return r?(r=b(e,t),Ye.test(r)?Z(e).position()[t]+"px":r):void 0})}),Z.each({Height:"height",Width:"width"},function(e,t){Z.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){Z.fn[i]=function(i,a){var o=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||a===!0?"margin":"border");return me(this,function(t,r,i){var a;return Z.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===i?Z.css(t,r,s):Z.style(t,r,i,s)},t,o?i:void 0,o,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var kt=e.jQuery,xt=e.$;return Z.noConflict=function(t){return e.$===Z&&(e.$=xt),t&&e.jQuery===Z&&(e.jQuery=kt),Z},typeof t===Ce&&(e.jQuery=e.$=Z),Z}),define("spinner",["knockout","imagesloaded"],function(e,t){"use strict";function r(){var e=this;e.spinnerId="cc-spinner",e.spinnerContainer="cc-spinner",e.spinnerCSS="cc-spinner-css",e.spinnerTimeOutId=null,e.create=function(t){return e.time=(new Date).getTime(),e.parent=t.parent,e.selector=t.selector?t.selector:t.parent,e.centerOn=t.centerOn,e.posTop=t.posTop?t.posTop:"50%",e.posLeft=t.posLeft?t.posLeft:"44%",e.loadingText=t.loadingText?t.loadingText:"Loading...",e.processingText=t.processingText,e.processingPosTop=t.processingPosTop?t.processingPosTop:"5%",e.textWidth=t.textWidth?t.textWidth:"100%",!!e.parent&&("body"===e.parent&&(e.centerOn&&0!==$(e.centerOn).length?(e.posTop=$(e.centerOn).height()/2-27+$(e.centerOn).position().top+"px",e.processingPosTop=$(e.centerOn).height()/2-54+$(e.centerOn).position().top+"px",e.posLeft=$(e.centerOn).width()/2-27+$(e.centerOn).position().left+"px"):(e.posTop=$(window).height()/2-27+"px",e.processingPosTop=$(window).height()/2-54+"px",e.posLeft=$(window).width()/2-27+"px")),void(0===$(e.selector).find("."+e.spinnerContainer).not(".cc-spinner-exclude").length&&(e.buildCSS(e.selector,e.posTop,e.posLeft),t.createWithTimeout&&e.setDestroyTimeoutWithId(t.parent,t.waitTime,t.callBackFn,t.context))))},e.buildCSS=function(t,r,i){var a,o;a=$("<div />").attr({id:e.spinnerId,class:e.spinnerContainer}),o=$("<div />").attr({class:e.spinnerCSS,style:"top:"+r+";left:"+i});for(var s=1;s<13;s++)$(o).append($("<div />").attr({class:e.spinnerCSS+"-"+s}));e.processingText?$(a).prepend($("<div/>").css("padding-top",e.processingPosTop).append($('<span class="center-block"/>').css("width",e.textWidth).text(e.processingText))):$(o).prepend($('<span class="ie-show">').text(e.loadingText)),$(a).append(o),"body"===t?$(t).prepend(a):$(t).append(a)},e.loadCheck=function(t,r){var i=e.parent,a=e.selector;r&&(i=r.parent?r.parent:r.parent,a=r.selector?r.selector:i),(t||0==t)&&(0===$(a).find("."+e.spinnerContainer).length&&e.buildCSS(a,e.posTop,e.posLeft),$(i+" img")?$(i+" img").imagesLoaded(function(){0!==$(a).find("."+e.spinnerContainer).not(".cc-spinner-exclude").length&&e.destroy(t,i,a)}):e.destroy(t,i,a))},e.destroy=function(t,r,i){var a,o,i=i?i:e.parent,r=r?r:e.parent;e.spinnerContainer;a=e.time+250-(new Date).getTime(),$(r).children().length===t?a>0?o=setTimeout(e.destroyWithoutDelay,a):e.destroyWithoutDelay(i):t&&null!==t?setTimeout(e.destroy,1):a>0?o=setTimeout(e.destroyWithoutDelay(i),a):e.destroyWithoutDelay(i)},e.destroyWithoutDelay=function(t){var r=t?t:e.selector,i=e.spinnerContainer;$(r).find("."+i).remove()},e.createWithTimeout=function(t,r,i,a){t.waitTime=r,t.callBackFn=i,t.context=a,t.createWithTimeout=!0,e.create(t)},e.destroyAndClearTimeout=function(t,r){e.destroyWithoutDelay(),null!=e.spinnerTimeOutId&&clearTimeout(e.spinnerTimeOutId),null!=t&&t.call(r)},e.destroyAndClearCreateTimeout=function(t){e.destroyWithoutDelay(t),null!=e.spinnerTimeOutId&&clearTimeout(e.spinnerTimeOutId)},e.setDestroyTimeout=function(t,r,i){e.spinnerTimeOutId=setTimeout(function(){e.destroyWithoutDelay(),null!=r&&r.call(i)},t)},e.createAndReturnWithTimeout=function(t,r,i,a){return e.create(t),e.setDestroyTimeout(r,i,a),e.spinnerTimeOutId},e.destroyAndClearTimeoutWithId=function(t,r,i,a){e.destroyWithoutDelay(t),null!=r&&clearTimeout(r),null!=i&&i.call(a)},e.setDestroyTimeoutWithId=function(t,r,i,a){e.spinnerTimeOutId=setTimeout(function(){e.destroyWithoutDelay(t),null!=i&&i.call(a)},r)}}return new r}),define("pubsubImpl",["jquery"],function(){"use strict";function e(){this.topics={}}return e.prototype.topic=function(e){var t,r=e&&this.topics[e],i="unique";return r||(/\.memory/.test(e)&&(i+=" memory"),t=$.Callbacks(i),window.pubsubevents=t,r={publish:t.fire,publishWith:t.fireWith,subscribe:t.add,unsubscribe:t.remove},e&&(this.topics[e]=r)),r},e}),define("pubsub",["pubsubImpl","jquery"],function(e){"use strict";var t={REGISTER_SUBMIT:"register.submit",REGISTER_SUCCESS:"register.success",REGISTER_FAILURE:"register.failure",CART_ADD:"cart.add",CART_REMOVE:"cart.remove",CART_UPDATE_QUANTITY:"cart.updatequantity",CART_READY:"cart.ready",CART_UPDATED:"cart.updated",CART_UPDATED_PENDING_PAYMENT:"cart.updated.pendingpayment",CART_ADD_SUCCESS:"cart.add.success",CART_UPDATE_SUCCESS:"cart.update.success",CART_PRICE_COMPLETE:"cart.price.complete",CART_EDIT_ADD_ON:"cart.edit.add.on",CART_SAVE_ADD_ON:"cart.save.add.on",CART_DELETE_ADD_ON:"cart.delete.add.on",CART_EDIT_ADD_ONS_AT_CART:"cart.edit.add.ons.at.cart",CART_SAVE_ADD_ONS_AT_CART:"cart.save.add.ons.at.cart",REFRESH_USER_CART:"cart.refresh",REMOVE_INVALID_ITEMS:"cart.remove.invalid.items",CART_REMOVE_SUCCESS:"cart.remove.success",CART_UPDATE_QUANTITY_SUCCESS:"cart.updatequantity.success",MINI_CART_SHOW:"mini.cart.show",MINI_CART_HIDE:"mini.cart.hide",USER_LOAD_CART:"user.cart.load",CART_ADD_SUCCESS_CPQ:"cart.add.success.cpq",CART_CHILD_ITEM_SELECTED:"cart.child.item.selected",CART_DETAILS_CHILD_ITEM_SELECTED:"cart.details.child.item.selected",CART_PRICE_SUCCESS:"cart.price.success",CART_LOADED:"cart.loaded",CART_LOADED_FOR_PROFILE:"cart.loaded.for.profile",DEFERRED_CART_LOAD:"deferred.cart.load.memory",SHIPPING_GROUP_REMOVE_SUCCESS:"cart.item.shipping.group.remove.success",PAGE_VIEW_CHANGED:"page.view.changed",PAGE_CONTEXT_CHANGED:"page.context.changed",PAGE_CHANGED:"page.changed.memory",PAGE_READY:"page.ready.memory",PAGE_METADATA_CHANGED:"page.metadata.changed",PAGE_LAYOUT_LOADED:"page.layout.loaded.memory",PAGE_LAYOUT_SERVER_ERROR:"page.layout.server.error",PAGE_LAYOUT_UPDATED:"page.layout.updated.memory",PAGE_PARAMETERS_CHANGED:"page.parameters.changed",PAGE_PARAMETERS:"page.parameters.memory",PAGE_PAGINATION_CHANGE:"page.pagination.change.memory",PAGE_PAGINATION_CALCULATED:"page.pagination.calculated.memory",RECORD_PAGINATION_PAGE_CHANGE:"record.pagination.page.changed",UPDATE_HASH_CHANGES:"update.hash.changes.memory",HISTORY_PUSH_STATE:"history.push.state.memory",REGION_METADATA_CHANGED:"region.metadata.changed.memory",AUTH_LOGIN_SUBMIT:"auth.login.submit",AUTH_LOGIN_SUCCESS:"auth.login.success",AUTH_LOGIN_FAILURE:"auth.login.failure",AUTH_LOGOUT_SUBMIT:"auth.logout.submit",AUTH_LOGOUT_SUCCESS:"auth.logout.success",AUTH_LOGOUT_FAILURE:"auth.logout.failure",AUTH_REQUEST_FAILURE:"auth.request.failure",USER_CREATION_FAILURE:"user.creation.failure.memory",USER_LOGIN_SUCCESSFUL:"user.login.successful",USER_LOGIN_FAILURE:"user.login.failure",SAML_LOGIN_SUCCESSFUL:"user.saml.login.successful.memory",SAML_LOGIN_FAILURE:"user.saml.login.failure.memory",USER_LOGOUT_SUCCESSFUL:"user.logout.successful",USER_LOGOUT_FAILURE:"user.logout.failure",USER_REGISTRATION_SUBMIT:"user.registration.submit",USER_LOGOUT_SUBMIT:"user.logout.submit",USER_LOGIN_SUBMIT:"user.login.submit",USER_LOGIN_CANCEL:"user.login.cancel",USER_LOAD_SHIPPING:"user.load.shipping",USER_PROFILE_LOADED:"user.profile.loaded",USER_PROFILE_UPDATE_SUCCESSFUL:"user.profile.update.successful.memory",USER_PROFILE_PASSWORD_UPDATE_SUCCESSFUL:"user.profile.pwd.update.successful",USER_PROFILE_PASSWORD_UPDATE_FAILURE:"user.profile.pwd.update.failure",USER_PROFILE_UPDATE_FAILURE:"user.profile.update.failure.memory",USER_PROFILE_UPDATE_SUBMIT:"user.profile.update.submit",USER_PROFILE_UPDATE_CANCEL:"user.profile.update.cancel",USER_PROFILE_UPDATE_INVALID:"user.profile.update.invalid",USER_PROFILE_UPDATE_NOCHANGE:"user.profile.update.nochange",USER_PROFILE_ADDRESSES_REMOVED:"user.profile.addresses.removed",USER_AUTO_LOGIN_SUCCESSFUL:"user.auto.login.successful",AUTO_LOGIN_AND_GET_USER_DATA_SUCCESSFUL:"auto.login.and.get.user.data.successful",USER_AUTO_LOGIN_FAILURE:"user.auto.login.failure.memory",USER_PROFILE_PASSWORD_UPDATE:"user.profile.password.update",USER_UNAUTHORIZED:"user.unauthorized.memory",USER_SESSION_EXPIRED:"user.session.expired.memory",USER_SESSION_VALID:"user.session.validated.memory",USER_SESSION_RESET:"user.session.reset",USER_PROFILE_SESSION_RESET:"user.profile.session.reset",USER_CLEAR_CART:"user.clear.cart",USER_RESET_PASSWORD_FAILURE:"user.reset.password.failure",USER_RESET_PASSWORD_SUCCESS:"user.reset.password.success",USER_PASSWORD_EXPIRED:"user.password.expired",USER_PASSWORD_GENERATED:"user.password.generated",USER_NETWORK_ERROR:"user.network.error",USER_LOCALE_NOT_SUPPORTED:"user.locale.not.supported",UPDATE_USER_LOCALE_NOT_SUPPORTED_ERROR:"update.user.locale.not.supported.error.memory",DISCARD_ADDRESS_CHANGES:"discard.address.changes",USER_LOYALTY_DETAILS_UPDATED:"user.loyalty.details.updated",PURCHASE_LIST_FETCH_SUCCESS:"purchase.list.fetch.success",FETCH_PURCHASE_LIST_AFTER_DELETE:"fetch.purchase.list.after.delete",ADD_TO_PURCHASE_LIST:"add.to.purchase.list",PRODUCT_ADDED_TO_PURCHASE_LIST_SUCCESS:"product.added.to.purchase.list.success",ADD_ITEM_TO_PURCHASE_LIST:"add.item.to.purchase.list",PRODUCT_VIEWED:"product.viewed.memory",SKU_SELECTED:"sku.selected",PRODUCTS_PER_ROW_CHANGES:"products.per.row.changed",UPDATE_FOCUS:"update.focus.memory",UPDATE_LISTING_FOCUS:"update.listing.focus.memory",ITEM_TRIGGER_RECONFIGURE:"item.trigger.reconfigure",CHECKOUT_BILLING_ADDRESS:"checkout.billing.address",CHECKOUT_SHIPPING_ADDRESS:"checkout.shipping.address",CHECKOUT_SHIPPING_ADDRESS_UPDATED:"checkout.shipping.address.updated",PAYPAL_SHIPPING_ADDRESS_ALTERED:"paypal.shipping.address.altered",ADD_NEW_CHECKOUT_SHIPPING_ADDRESS:"add.new.checkout.shipping.address",CART_SHIPPING_ADDRESS_UPDATED:"cart.shipping.address.updated",USER_SELECTED_SHIPPING_ADDRESS_UPDATED:"user.selected.shipping.address.updated",BILLING_ADDRESS_POPULATED:"billing.address.populated.memory",SHIPPING_ADDRESS_POPULATED:"shipping.address.populated.memory",PAYPAL_CHECKOUT_SHIPPING_ADDRESS:"paypal.checkout_shipping_address",EXTERNAL_CHECKOUT_BILLING_ADDRESS:"external.checkout_billing_address",LOADED_ORDER_SHIPPING_ADDRESS:"loaded.order.shipping.address.memory",GET_INITIAL_ORDER_FAIL:"order.retrieval.fail",WEB_CHECKOUT_SHIPPING_ADDRESS:"web.checkout.shipping.address",CHECKOUT_SAVE_SHIPPING_ADDRESS:"checkout.save.shipping.address",LOAD_ORDER_RESET_ADDRESS:"load.order.reset.address",CONTINUE_TO_PAYPAL:"continue.to.paypal",PAYPAL_EMAIL_VALIDATION:"paypal.email.validation",CHECKOUT_SHIPPING_ADDRESS_INVALID:"checkout.shipping.address.invalid",CHECKOUT_SHIPPING_METHOD:"checkout.shipping.method",PAYPAL_CHECKOUT_SHIPPING_METHOD_VALUE:"paypal.checkout.shipping.method.value",PAYPAL_CHECKOUT_NO_SHIPPING_METHOD:"paypal.checkout.no.shipping.method",CHECKOUT_RESET_SHIPPING_METHOD:"checkout.reset.shipping.method",CHECKOUT_EMAIL_ADDRESS:"checkout.email.address.memory",CHECKOUT_VALIDATE_NOW:"checkout.validate.now",CHECKOUT_NOT_VALID:"checkout.not.valid",CHECKOUT_PAYMENT_DETAILS:"checkout.payment.details",CHECKOUT_REGISTER_USER:"checkout.register.user",CHECKOUT_USER_LOCALE:"checkout.user.locale",ORDER_CREATE:"order.create",ORDER_CREATED:"order.created",ORDER_CREATED_INITIAL:"order.created.initial",ORDER_RETRIEVED_INITIAL:"order.retrieved.initial",ORDER_COMPLETED:"order.completed",ORDER_SUBMISSION_FAIL:"order.submission.fail",ORDER_SUBMISSION_SUCCESS:"order.submission.success",ORDER_AUTHORIZE_PAYMENT:"order.payment.auth.memory",ORDER_SECONDARY_INFO_LOADED:"order.secondary.info.loaded.memory",ORDER_PRICING_FAILED:"order.pricing.failed",ORDER_PRICING_SUCCESS:"order.pricing.success",DESTROY_SHIPPING_METHODS_SPINNER:"destroy_shipping_methods_spinner",DESTROY_SHIPPING_OPTIONS_SPINNER:"destroy.shipping.options.spinner",DESTROY_SHOPPING_CART_SPINNER:"destroy.shopping.cart.spinner",ORDERS_GET_HISTORY_FAILED:"orders.getOrderHistory.failed",ORDERS_GET_PENDING_APPROVAL_LIST_FAILED:"orders.getPendingApprovalList.failed",POPULATE_SHIPPING_METHODS:"populate.shipping.methods",PAYMENT_AUTH_SUCCESS:"payment.auth.success",PAYMENT_AUTH_DECLINED:"payment.auth.declined",PAYMENT_AUTH_TIMED_OUT:"payment.auth.timedout",
PAYMENT_GET_AUTH_RESPONSE:"payment.auth.getresponse",PAYMENTS_DISABLED:"payments.disabled",PAYULATAM_WEB_CHECKOUT:"payulatam.web.checkout",SAVE_CART_BEFORE_REFRESH:"save.cart.before.refresh",SCHEDULE_ORDERS_LIST_FAILED:"scheduleorders.scheduleOrderList.failed",SCHEDULED_ORDER_SUBMISSION_SUCCESS:"scheduledorder.submission.success",SCHEDULED_ORDER_LOAD_SCUCCESS:"scheduledorder.load.success",SCHEDULED_ORDER_LOAD_ERROR:"scheduledorder.load.error",ADD_TO_QUICK_ORDER:"quick.order.add.item",REFRESH_ORDER_DETAILS:"refresh.order.details",APPROVE_ORDER_DETAILS_SUCCESS:"approve.order.details.success",REJECT_ORDER_SUCCESS:"reject.order.success",SCHEDULED_ORDER_LOAD_SUCCESS_AGENT:"scheduled.order.load.success.agent",REREQUEST_REJECT_QUOTE_ORDER_SUCCESS:"rerequest.reject.quote.order.success",SEARCH_CREATE:"search.create",SEARCH_CREATE_CATEGORY_LISTING:"search.create.listing",SEARCH_RESULTS_UPDATED:"search.results.updated.memory",SEARCH_RESULTS_FOR_CATEGORY_UPDATED:"search.results.category.updated.memory",SEARCH_TYPEAHEAD:"search.typeahead",SEARCH_TYPEAHEAD_UPDATED:"search.typeahead.updated",SEARCH_TYPEAHEAD_CANCEL:"search.typeahead.cancel",SEARCH_TERM:"search.terms.memory",SEARCH_FAILED_TO_PERFORM:"search.failed.memory",OVERLAYED_GUIDEDNAVIGATION_HIDE:"overlayed.guidednavigation.hide",OVERLAYED_GUIDEDNAVIGATION_SHOW:"overlayed.guidednavigation.show",OVERLAYED_GUIDEDNAVIGATION_CLEAR:"guidednavigation.clear.memory",COUPON_ADD_CLEAR_INPUT:"add.coupon.clearInput",COUPON_APPLY_SUCCESSFUL:"add.coupon.successful",COUPON_DELETE_SUCCESSFUL:"delete.coupon.successful",GIFTCARD_UPDATE_FROM_CART:"giftcard.updateGiftCards",UPDATE_AMOUNT_REMAINING:"giftcard.update.amountRemaining",GIFTCARD_PRICING_FAILED:"giftcard.pricing.failed",GIFTCARD_REAPPLY_PINS:"giftcard.reapply.pins",SHOW_GIFT_CARD_ERROR_PANEL:"giftcard.error.panel",UPDATE_AMOUNT_REMAINING_PENDING_PAYMENT:"giftcard.update.amountRemainingPendingPayment",ADMIN_CONTENT_LANGUAGE_CHANGED:"admin.content.language.changed",ADMIN_USER_UPDATE:"admin.user.update",ADMIN_AUTH_API_UNAUTHORIZED:"admin.auth.api-unauthorized",ADMIN_AUTH_SSO_REFRESH:"admin.auth.sso-refresh",ADMIN_AUTH_SSO_SUCCESS:"admin.auth.sso-refresh-success",ADMIN_AUTH_SSO_FAILURE:"admin.auth.sso-refresh-failure",PRODUCT_EDIT:"catalog.product.edit",PRODUCT_EDIT_CREATE_PERSIST:"catalog.product.persist",PRODUCT_EDIT_CREATE_SUCCESS:"catalog.product.success",PRODUCT_EDIT_CREATE_ERROR:"catalog.product.error",PRODUCT_FILTER_MODE:"catalog.product.filter.mode",PRODUCT_VIEW_UPDATE_REQUESTED:"catalog.view.updateRequested",PRODUCT_VIEW_UPDATED:"catalog.view.updated",PRODUCT_VIEW_CLEAR_DATA:"catalog.view.clearData",PRODUCT_VIEW_SET_DATA:"catalog.view.setData",PRODUCT_PRICE_CHANGED:"product.price.changed",PRODUCT_SKUS_UPDATED:"product.skus.updated",PRODUCT_LISTING_CONFIGS_UPDATED:"product.listingConfigs.updated",CATALOG_VIEW_MODE_CHANGED:"catalog.view.mode.changed",COLLECTION_EDIT:"catalog.collection.edit",COLLECTION_CREATE:"catalog.collection.create",COLLECTION_REFRESH_GRID:"catalog.collection.refresh.grid",COLLECTION_EDIT_CREATE_PERSIST:"catalog.collection.persist",COLLECTION_EDIT_CREATE_SUCCESS:"catalog.collection.editcreate.success",COLLECTION_DELETE_SUCCESS:"catalog.collection.delete.success",COLLECTION_EDIT_CREATE_ERROR:"catalog.collection.error",COLLECTION_REMOVE_PRODUCT:"catalog.collection.remove.product",COLLECTION_REORDER_PRODUCTS:"catalog.collection.reorder.products",COLLECTION_REORDER_PRODUCTS_SUCCESS:"catalog.collection.reorder.products.success",COLLECTION_REORDER_PRODUCTS_ERROR:"catalog.collection.reorder.products.error",COLLECTION_RELOAD_PRODUCTLIST:"catalog.collection.reload.productlist",COLLECTION_IMPORT:"catalog.category.import",COLLECTION_ADD_PRODUCTS_SUCCESS:"catalog.collection.add.products.success",PRODUCT_TO_CATEGORY_DROP:"catalog.product.category.drop",PRODUCT_DEFINITION_UPDATE:"catalog.product.definition.update",PRODUCT_SHOPPER_INPUT_DEFINITION_UPDATE:"catalog.product.shopperInput.definition.update",TYPE_PROPERTY_UPDATE:"property.definition.update",PRODUCT_SKU_DEFINITION_UPDATE:"catalog.product.sku.definition.update",LOCALE_AWARE_PRODUCT_DEFINITION_UPDATE:"catalog.product.localeAwareDefinition.update",LOCALE_AWARE_SHOPPER_INPUT_DEFINITION_UPDATE:"catalog.product.localeAwareShopperInputDefinition.update",LOCALE_AWARE_SKU_UPDATE:"catalog.product.localeAwareSku.update",PRODUCT_DEFINITION_UPDATE_PROPERTIES:"catalog.product.definition.update.properties",COLLECTION_DEFINITION_UPDATE:"catalog.collection.definition.update",PRODUCT_TYPE_EDIT_CREATE_PERSIST:"product.type.persist",PRODUCT_TYPE_EDIT_CREATE_SUCCESS:"product.type.success",PRODUCT_TYPE_EDIT_CREATE_ERROR:"product.type.error",PRODUCT_TYPE_UPDATE:"product.type.update",PRODUCT_TYPE_MANAGE_UPDATE:"product.type.manage.update",PRICE_LIST_GROUP_UPDATE:"price.list.group.update",ACCOUNTS_LIST_REFRESH:"accounts.list.refresh",CONTACTS_LIST_REFRESH:"contacts.list.refresh",CONTRACTS_LIST_REFRESH:"contracts.list.refresh",CONTACT_ROLE_CHANGED:"contact.role.changed",ACCOUNT_CONTACTS_LIST_REFRESH:"accounts.contacts.list.refresh",REFRESH_OVERLAY_FOR_CREATE:"refresh.overlay.for.create",REFRESH_OVERLAY_FOR_EDIT:"refresh.overlay.for.edit",REFRESH_ACCOUNT_ADDRESSES:"refresh.account.addresses",SEARCH_RESET:"account.name.reset",REGISTRATION_REQUESTS_LIST_REFRESH:"registration.requests.list.refresh",CONTACT_REQUESTS_LIST_REFRESH:"contact.requests.list.refresh",INVENTORY_REFRESH:"inventory.update",PROMOTION_EDIT:"marketing.promotion.edit",PROMOTION_CLONE:"marketing.promotion.clone",PROMOTION_SELECTION:"marketing.promotion.selection",PROMOTION_LIST_REFRESH:"marketing.promotion.listRefresh",PROMOTION_TEMPLATE_EDITOR_HIDE:"marketing.promotion.templateEditorHide",PROMOTION_TEMPLATE_EDITOR_SHOW:"marketing.promotion.templateEditorShow",PROMOTION_TEMPLATE_EDITOR_CHANGE_VALUE:"marketing.promotion.templateEditorChangeValue",RANKING_RULE_LIST_REFRESH:"search.ranking.listRefresh",FACET_RULE_LIST_REFRESH:"search.facets.listRefresh",STACKING_RULE_LOAD_CREATE:"marketing.stackingRule.loadCreate",STACKING_RULE_LIST_REFRESH:"marketing.stackingRule.listRefresh",AUDIENCE_LOAD_CREATE:"marketing.audience.loadCreate",AUDIENCE_LIST_REFRESH:"marketing.audience.listRefresh",LAYOUT_EDIT:"sitestudio.layout.edit",LAYOUT_CLONE:"sitestudio.layout.clone",LAYOUT_EDIT_CREATE_PERSIST:"sitestudio.layout.persist",LAYOUT_EDIT_CREATE_SUCCESS:"sitestudio.layout.success",LAYOUT_EDIT_CREATE_ERROR:"sitestudio.layout.error",LAYOUT_DELETE_SUCCESS:"sitestudio.layout.delete.success",LAYOUT_DEFINITION_UPDATE:"sitestudio.layout.definition.update",LAYOUT_LIST_UPDATE:"sitestudio.layout.list.update",LAYOUT_LIST_HIDE:"sitestudio.layout.list.hide",LAYOUT_REFRESH_DISPLAY:"sitestudio.layout.refresh.display",LAYOUT_REFRESH_COMPLETE:"sitestudio.layout.refresh.complete",LAYOUT_WIDGET_LOADED:"sitestudio.layout.widget.loaded",LAYOUT_STACK_LOADED:"sitestudio.layout.stack.loaded",LAYOUT_SELECTED:"sitestudio.layout.selected",WIDGET_LAYOUT_EDIT:"sitestudio.widget.layout.edit.memory",WIDGET_LIBRARY_HIDE:"sitestudio.widget.library.hide",THEME_UPDATE:"sitestudio.theme.update",CODE_VIEW_MAXIMIZE:"sitestudio.codeview.maximize",CODE_VIEW_MINIMIZE:"sitestudio.codeview.minimize",ORGANIZE_MODE_STATE:"organize.state",STOP_ORGANIZE_MODE:"organize.stop",NOTIFICATION_ADD:"notification.message.add",NOTIFICATION_DELETE:"notification.message.delete",NOTIFICATION_TEMPLATE_ADD:"notification.template.add",ALL_COLLECTIONS_UPDATED:"catalog.allcollections.updated",EXCEPTION_HANDLER:"exception.handler",ONERROR_EXCEPTION_HANDLER:"onerror.exception.handler",LOADING_INDICATOR_ADD:"loading.indicator.add",ARIA_ANNOUNCEMENT_REQUESTED:"aria.announcement.requested",SHIPPING_METHODS_LOADED:"shipping.method.loaded",LOAD_SHIPPING_METHODS_FAILED:"load.shipping.methods.failed",SHIPPING_METHOD_SUCCESS:"shipping.method.success",SHIPPING_METHOD_EDIT:"shipping.method.edit",SHIPPING_METHOD_DEFINITION_UPDATE:"shipping.method.definition.update",RELOAD_SHIPPING_METHODS:"shipping.method.reload",NO_SHIPPING_METHODS:"no.shipping.methods.available",VERIFY_SHIPPING_METHODS:"verify.shipping.methods",INVALID_SHIPPING_METHOD:"invalid.shipping.method",SHIPPING_REGION_LOADED:"shipping.region.loaded",SHIPPING_REGION_SUCCESS:"shipping.region.success",SHIPPING_REGION_EDIT:"shipping.region.edit",SHIPPING_REGION_DEFINITION_UPDATE:"shipping.region.definition.update",RELOAD_SHIPPING_REGIONS:"shipping.region.reload",CATEGORY_GROUP_CHANGED:"category.group.changed",CATEGORY_UPDATED:"category.updated",CATEGORY_CRUMB_UPDATED:"send.category.memory",SHOPPINGCART_VALIDATE_NOW:"shoppingcart.validate.now",LOAD_CHECKOUT:"redirect.checkout.cart",ADMIN_CONTAINER_CONFIGURATION_LOADED:"admin.container.configuration.loaded",EXTERNAL_SERVICE_CONFIGURATION_LOADED:"external.service.configuration.loaded",EXTERNAL_SERVICE_EXPERIMENTS_SIGNON:"external.service.experiments.signon",SOCIAL_SPACE_ADD:"social.space.add",SOCIAL_SPACE_ADD_TO_SELECTED_SPACE:"social.space.add.selected",SOCIAL_SPACE_ADD_SUCCESS:"social.space.add.success",SOCIAL_SPACE_SELECTOR_ADD:"social.space.selector.add",SOCIAL_SPACE_PRODUCT_REMOVED:"social.space.product.removed",SOCIAL_SPACE_PRODUCT_MOVED:"social.space.product.moved",SOCIAL_SPACE_SELECT:"social.space.select",SOCIAL_SPACE_UNAVAILABLE:"social.space.unavailable",SOCIAL_SPACE_DELETED:"social.space.deleted",SOCIAL_SPACE_MEMBER_JOIN:"social.space.member.join",SOCIAL_SPACE_MEMBER_LEFT:"social.space.member.left",SOCIAL_SPACE_MODEL_MEMBERS_CHANGED:"social.space.model.members.changed",SOCIAL_SPACE_MEMBERS_INFO_CHANGED:"social.space.member.info.changed",SOCIAL_REFRESH_SPACES:"social.refresh.spaces",SOCIAL_CURRENT_USER:"social.current.user",SOCIAL_POST_MESSAGE:"social.space.post.message",SOCIAL_FACEBOOK_JS_READY:"social.facebook.js.ready",RECS_WANT_RECS:"recs.display.want.recs.memory",RECS_WHO_WANT_RECS:"recs.display.who.want.recs.memory",RECS_HAVE_RECS:"recs.display.have.recs.memory",RECS_RECOMMENDATIONS_CHANGED:"recs.display.recommendations.changed",ORDER_EDIT_POST_ACTION:"edit.order.post.action",ORDER_EDIT_INIT_ACTION:"edit.order.init.action",RETURN_CCI18N_RESOURCE_LOADED:"return.cci18n.resource.loaded",AGENT_UNSELECT_SHIPPING_METHOD:"shipping.unselect.price.order",AGENT_SELECT_ITEM_FOR_EXCHANGE:"agent.select.item.exchange",SEARCH_SELECTED:"search.selected",LOAD_DEFAULT_CATEGORY:"load.default.category",ON_CLOSE_PDP_MODAL:"on.close.pdp.modal",LOCALE_SET:"cc.locale.set",LOCALE_READY:"cc.locale.ready.memory",SUPPORTED_LOCALES_UPDATE:"supported.locales.update",PAGINATION_PAGE_CHANGE:"pagination.page.change",REPORTING_TIMEFRAME_UPDATED:"reporting.timeframe.updated",REPORTING_SELECTED_SUMMARY_METRIC:"reporting.selected.summaryMetric",REPORTING_FILTER_CHANGES:"reporting.filter.changes.memory",REPORTING_DATA_LOADED:"reporting.data.loaded.memory",REPORTING_MULTIPLE_DAYS_RANGE_SELECTED:"reporting.validdate.selected",REPORTING_SINGLE_DAY_RANGE_SELECTED:"reporting.invaliddate.selected",REPORTING_APPLIED_USER_SELECTIONS_UPDATED:"reporting.applied.user.selections.updated",REPORTING_CURRENCY_LOADED:"reporting.currency.loaded",REPORTING_RESET_FILTERS:"reporting.reset.filters",COLLECTION_SELECTION_CHANGED:"collection.selection.changed",GWP_QUALIFIED_MESSAGE:"gwp.qualified.message",GWP_INVALIDATED_MESSAGE:"gwp.invalidated.message",GWP_CLEAR_QUALIFIED_MESSAGE:"gwp.clear.qualified.message",PLACE_HOLDER_REMOVE:"place.holder.remove",GET_GIFT_CHOICES_SUCCESSFUL:"get.gift.choices.successful",GET_GIFT_CHOICES_FAILURE:"get.gift.choices.failure",GIFT_CHOICES_NOT_AVAILABLE:"gift.choices.not.available",GWP_FAILURE_MESSAGE:"gwp.failure.message",GUIDED_SEARCH_INDEX_FIELDS_REFRESH:"guided.search.index.fields.refresh",ADD_PRODUCTS_TAB_TO_PRICE_GROUP:"add.products.tab.to.price.group",ADD_NEW_NAVIGATION:"add.new.navigation",UPDATE_NAVIGATION:"update.navigation",REMOVE_NAVIGATION:"remove.navigation",NAVIGATE_TO_INTERCEPTED_LINK:"go.to.intercepted.link",SET_IS_NEW_FLAG:"set.is.new.flag",PRICE_GROUP_LIST_REFRESH:"price.groups.list.refresh",DELEGATED_CONTACTS_LIST_FAILED:"delegated.contacts.list.failed",UPDATE_STOREFRONT_ROLE_SUCCESS:"update.storefront.role.success",CART_DELETE_SUCCESS:"cart.delete.success",CART_DELETE_ERROR:"cart.delete.error",MULTICART_LISTING_ERROR:"multicart.listing.error",ACCOUNT_LOGO_ITEM_IMAGE_DELETED:"account.logo.item.image.deleted",DEFAULT_ACCOUNT_MODIFIED:"default.account.modified",SHOPPER_CONTEXT_LOAD_ERROR:"shopper.context.load.failed",OPTION_DATA_RECEIVED:"option.data.received",PUBLISH_START:"publish.start",SITE_ADDED:"site.added",SITE_SELECTION_RESET:"site.selection.reset",SITE_SELECTION_CHANGED:"site.selection.changed",USER_PRODUCT_NOTIFICATION_SUCCESS:"user.product.notification.success",USER_PRODUCT_NOTIFICATION_FAILED:"user.product.notification.failed"},r=new e;return r.topicNames=t,$.Topic=r.topic.bind(r),r}),define("xDomainProxy",["jquery"],function(e){"use strict";function t(e,r,i){var a=this;a.profileType=e,a.httpPort=r||"8080",a.httpsPort=i||"8443",a.parentURL=t.getCrossDomainURL(e,t.HTTP_PROTOCOL,a.httpPort,!1),document.referrer&&t.urlProtocolOnly(document.referrer)!=t.HTTPS_PROTOCOL&&null!=window&&null!=window.parent&&window.parent.postMessage(JSON.stringify({id:t.IFRAME_INIT_COMPLETE_EVENT,success:!0,payload:null}),a.parentURL)}return t.POST="POST",t.GET="GET",t.DELETE="DELETE",t.METHOD="method",t.URL="url",t.DATA="data",t.SUCCESS="success",t.FAILURE="failure",t.HEADERS="headers",t.CONTENT_TYPE="Content-Type",t.ACCEPT="Accept",t.TEXT_PLAIN="text/plain",t.APPLICATION_JSON="application/json",t.JSON="json",t.ETAG="ETag",t.ETAG_PROPERTY="___etag___",t.LAST_PUBLISHED_TIME="LastPublishedTime",t.LAST_PUBLISHED_TIME_PROPERTY="lastPublishedTime",t.XSTATEDATA="X-OCStateData",t.STATEDATA_PROPERTY="__stateData__",t.AMPERSAND="&",t.EQUALS="=",t.DOUBLE_SLASH="//",t.SLASH="/",t.EMPTY_STRING="",t.PROTOCOL_SEP="://",t.COLON=":",t.QUESTION_MARK="?",t.SPACE=" ",t.SEMICOLON=";",t.DASH="-",t.CURLY_BRACES="{}",t.PERIOD=".",t.OAUTH_ACCESS_TOKEN_PARAM="access_token",t.OAUTH_REFRESH_TOKEN_PARAM="refresh_token",t.LOGIN_SERVICE_PATH="/ccstoreui/v1/login/",t.ADMIN_LOGIN_SERVICE_PATH="/ccadminui/v1/mfalogin/",t.AGENT_LOGIN_SERVICE_PATH="/ccagentui/v1/login/",t.HTTP_PROTOCOL="http",t.HTTPS_PROTOCOL="https",t.HTTPS_FRAME_PATH="/https/https.html",t.HTTPS_ADMIN_FRAME_PATH="/https/httpsAdmin.html",t.GRANT_TYPE_PARAM="grant_type",t.PASSWORD_GRANT_TYPE_VALUE="password",t.USERNAME_PARAM="username",t.PASSWORD_PARAM="password",t.TOTP_CODE_PARAM="totp_code",t.SAML_GRANT_TYPE_VALUE="saml_credentials",t.SAML_RESPONSE_PARAM="saml_response",t.RELAY_STATE="relay_state",t.AUTH_HEADER_NAME="Authorization",t.AUTH_HEADER_PREFIX="Bearer ",t.PROFILE_TYPE_HEADER_NAME="X-CCProfileType",t.IFRAME_INIT_COMPLETE_EVENT="iframeInitComplete",t.ASSET_LANGUAGE_HEADER_NAME="X-CCAsset-Language",t.PRICE_LIST_GROUP_ID="X-CCPriceListGroup",t.ORGANIZATION_ID="X-CCOrganization",t.AGENT_CONTEXT="X-CCAgentContext",t.VIEWPORT_HEADER_NAME="X-CCViewport",t.SITE_ID="x-ccsite",t.AUDIENCE_HEADER_NAME="X-CCAudience",t.VISIT_ID="X-CCVisitId",t.VISITOR_ID="X-CCVisitorId",t.prototype.init=function(){var e=this;e.targetMap={login:function(t,r,i){e.loginRequest(t.user,t.password,r,i)},auth:function(t,r,i){e.request(t.url,t.data,r,i,t.method,t.clientProps)},noauth:function(t,r,i){e.request(t.url,t.data,r,i,t.method)}};var t=function(t){var r=t.origin;if(r==e.parentURL){var i;i="string"==typeof t.data?JSON.parse(t.data):t.data;var a=i.id,o=i.target,s=i.payload,n=function(e,i){var o={};o.id=a,o.success=e,o.payload=i,t.source.postMessage(JSON.stringify(o),r)},c=function(e){n(!0,e)},l=function(e){n(!1,e)},d=e.targetMap[o];d&&d(s,c,l)}};window.addEventListener("message",t,!1)},t.prototype.loginRequest=function(e,t,r,i,a){this.mfaLoginRequest(e,t,null,r,i,a)},t.prototype.mfaLoginRequest=function(e,r,i,a,o,s){var n=this,c={};c[t.USERNAME_PARAM]=e,c[t.PASSWORD_PARAM]=r,i&&(c[t.TOTP_CODE_PARAM]=i),c[t.GRANT_TYPE_PARAM]=t.PASSWORD_GRANT_TYPE_VALUE,n.loginRequestInternal(c,a,o,s)},t.prototype.samlLoginRequest=function(e,r,i,a,o){var s=this,n={};n[t.SAML_RESPONSE_PARAM]=e,n[t.RELAY_STATE]=o,n[t.GRANT_TYPE_PARAM]=t.SAML_GRANT_TYPE_VALUE,s.loginRequestInternal(n,r,i,a)},t.prototype.loginRequestInternal=function(r,i,a,o){var s=this,n=t.LOGIN_SERVICE_PATH;"admin"==s.profileType||"adminUI"==s.profileType?n=t.ADMIN_LOGIN_SERVICE_PATH:"agent"!=s.profileType&&"agentUI"!=s.profileType||(n=t.AGENT_LOGIN_SERVICE_PATH);var c={};c[t.GRANT_TYPE_PARAM]=r[t.GRANT_TYPE_PARAM],r[t.GRANT_TYPE_PARAM]==t.PASSWORD_GRANT_TYPE_VALUE?(c[t.USERNAME_PARAM]=r[t.USERNAME_PARAM],c[t.PASSWORD_PARAM]=r[t.PASSWORD_PARAM],r[t.TOTP_CODE_PARAM]&&null!==r[t.TOTP_CODE_PARAM]&&(c[t.TOTP_CODE_PARAM]=r[t.TOTP_CODE_PARAM])):r[t.GRANT_TYPE_PARAM]==t.SAML_GRANT_TYPE_VALUE&&(c[t.SAML_RESPONSE_PARAM]=r[t.SAML_RESPONSE_PARAM],c[t.RELAY_STATE]=r[t.RELAY_STATE]);var l=function(e){var t=e.data;i(t)},d=function(e){var t=e.jqXHR.responseText;t&&(t=JSON.parse(t)),a(t)},u=null,p=!1;if(o&&(p=o.suppressProfileType),s.profileType&&!p&&(u={},u[t.PROFILE_TYPE_HEADER_NAME]=s.profileType),o&&o[t.SITE_ID]&&(u||(u={}),u[t.SITE_ID]=o[t.SITE_ID]),o&&o.tokenSecret){u||(u={});var h=t.AUTH_HEADER_PREFIX+o.tokenSecret;u[t.AUTH_HEADER_NAME]=h}o&&o[t.VISITOR_ID]&&(u||(u={}),u[t.VISITOR_ID]=o[t.VISITOR_ID]),o&&o[t.VISIT_ID]&&(u||(u={}),u[t.VISIT_ID]=o[t.VISIT_ID]);var g={type:t.POST,dataType:t.JSON,url:n,data:c,processData:!0,success:function(e,t,r){l({data:e,textStatus:t,jqXHR:r})},error:function(e,t,r){d({jqXHR:e,textStatus:t,errorThrown:r})}};u&&(g.headers=u),e.ajax(g)},t.prototype.request=function(r,i,a,o,s,n,c,l,d){var u=this,p=r;p=encodeURI(p);var h=s;h||(h=t.GET);var g=null;i&&(h===t.GET||h===t.DELETE?p=t.addQueryParams(p,i,!0):g=JSON.stringify(i)),d&&(p=t.addQueryParams(p,d,!0)),h===t.GET&&(p=t.fixIECaching(p));var f=function(e){var r=e.data,i=e.jqXHR.getResponseHeader(t.ETAG),o=e.jqXHR.getResponseHeader(t.XSTATEDATA);i&&r&&(i=i.replace(/["]+/g,""),r[t.ETAG_PROPERTY]=i),o&&r&&(r[t.STATEDATA_PROPERTY]=o);var s=e.jqXHR.getResponseHeader(t.LAST_PUBLISHED_TIME);r&&s&&(r[t.LAST_PUBLISHED_TIME_PROPERTY]=Number(s)),a(r)},m=function(e){var r=e.jqXHR.status,i=e.jqXHR.responseText,a=e.jqXHR.getResponseHeader(t.XSTATEDATA);if(i)try{i=JSON.parse(i)}catch(e){i={}}a&&i&&(i[t.STATEDATA_PROPERTY]=a),o(i,r)},I={dataType:t.JSON,contentType:t.APPLICATION_JSON,type:h,url:p,processData:!1,success:function(e,t,r){f({data:e,textStatus:t,jqXHR:r})},error:function(e,t,r){m({jqXHR:e,textStatus:t,errorThrown:r})},beforeSend:l},E=null,v=!1;if(n&&(v=n.suppressProfileType),u.profileType&&!v&&(E={},E[t.PROFILE_TYPE_HEADER_NAME]=u.profileType),c){E||(E={});for(var y in c)c.hasOwnProperty(y)&&(c[y]instanceof Object?E[y]=JSON.stringify(c[y]):E[y]=c[y])}if(n&&n.tokenSecret){E||(E={});var b=t.AUTH_HEADER_PREFIX+n.tokenSecret;E[t.AUTH_HEADER_NAME]=b}g&&(I.data=g),E&&(I.headers=E),e.ajax(I)},t.parseQueryParams=function(e){if(null===e)return null;for(var r=e.split(t.AMPERSAND),i={},a=0;a<r.length;a++){var o=r[a].split(t.EQUALS);i[o[0]]=o[1]}return i},t.addQueryParams=function(e,t,r){if(!e)return null;if(!t)return e;var i=Object.keys(t);if(i&&0===i.length)return e;var a=e,o=!0;a.indexOf("?")!==-1&&(o=!1);for(var s=0;s<i.length;s++){var n=i[s],c=t[i[s]];r&&(n=encodeURIComponent(n),c=encodeURIComponent(c));var l=n+"="+c,d="&";o&&(d="?",o=!1),a+=d+l}return a},t.getTimestamp=function(e){var t=new Date/1e3,r=parseInt(e,10),i=t+r;return parseInt(+i,10)},t.getCrossDomainURL=function(e,r,i,a){var o=r+t.PROTOCOL_SEP+t.urlHostnameOnly(window.location.href)+t.COLON+i;return a===!0&&("storefront"===e||"storefrontUI"==e?o+=t.HTTPS_FRAME_PATH:"admin"!==e&&"adminUI"!=e||(o+=t.HTTPS_ADMIN_FRAME_PATH)),o},t.convertUrl=function(e){if(null!=e&&e.charAt(0)!=t.SLASH)return[e];var r=t.urlPathPortionOnly(e),i=r.split(t.SLASH);if(1==i.length)return[t.SLASH];i[0]||(i=i.slice(1));var a=new Array(i.length+1);a[0]=t.SLASH,a[1]=i[0];for(var o=1;o<i.length;o++)a[o+1]=t.SLASH+i[o];return a},t.urlNoProtocolOrQueryParams=function(e){if(null==e)return null;var r=e.split(t.QUESTION_MARK),i=null;return i=r.length>1?r[0]:e,r=i.split(t.PROTOCOL_SEP),r.length>1&&(i=r[1]),i},t.urlPathPortionOnly=function(e){var r=t.urlNoProtocolOrQueryParams(e);return r.substring(0,1)!==t.SLASH&&(r=t.removeBeforeFirstSlash(r)),r},t.urlHostnamePortPortionOnly=function(e){var r=t.urlNoProtocolOrQueryParams(e);if(r.substring(0,1)==t.SLASH)return null;var i=r.split(t.SLASH);return i[0]},t.urlHostnameOnly=function(e){var r=t.urlHostnamePortPortionOnly(e),i=r&&r.split(t.COLON);return i?i[0]:null},t.urlProtocolOnly=function(e){var r=e.split(t.PROTOCOL_SEP);return r[0]},t.removeBeforeFirstSlash=function(e){var r=e.split(t.SLASH),i=e.substring(r[0].length);return i},t.fixIECaching=function(e){return e},t.insertAuthHeadersAsQueryParams=function(e,t,r){return uri},t.parseClaimsFromAccessToken=function(e){if(!e)return null;var r=e.split(t.PERIOD),i=r[1],a=t.decodeBase64(i),o=JSON.parse(a);return o},t.decodeBase64=function(e){var t,r,i,a,o={},s=0,n=0,c="",l=String.fromCharCode,d=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;t<64;t++)o[u.charAt(t)]=t;for(i=0;i<d;i++)for(r=o[e.charAt(i)],s=(s<<6)+r,n+=6;n>=8;)((a=s>>>(n-=8)&255)||i<d-2)&&(c+=l(a));return c},t}),define("storageApi",["knockout","xDomainProxy"],function(e,t){"use strict";function r(){if(r.singleInstance)throw new Error("Cannot instantiate more than one StorageApi, use getInstance()");var e=this;e.data={},e.validSyncSessionKeyPrefixes=["oauth_token_secret"];try{e.storage=window.localStorage,e.sessionStorage=window.sessionStorage}catch(e){}if(e.sessionStorageSupported=!1,e.localStorageSupported=!1,e.isIE=function(){return!(!navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/Edge/))},e.isIE())try{e.sessionStorage=window.localStorage}catch(e){}e.url=t.urlHostnamePortPortionOnly(document.URL),e.isSessionStorageSynced=!1,e.hasLocalStorageSupport=function(){try{var t=new Date,r="test-"+t.toUTCString();e.storage.setItem(r,r);var i=e.storage.getItem(r);if(r===i)return e.storage.removeItem(r),!0}catch(e){}return!1},e.hasSessionStorageSupport=function(){if(e.isIE())return!1;try{var t=new Date,r="test-"+t.toUTCString();e.sessionStorage.setItem(r,r);var i=e.sessionStorage.getItem(r);if(r===i)return e.sessionStorage.removeItem(r),!0}catch(e){}return!1},e.localStorageSupported=e.hasLocalStorageSupport(),e.saveToLocalStorage=function(t,r){try{e.storage.setItem(t,r);var i={};return i[t]=r,!0}catch(e){}return!1},e.readFromLocalStrorage=function(t){try{return e.storage.getItem(t)}catch(e){}return null},e.saveToSessionStorage=function(t,r){try{e.sessionStorage.setItem(t,r);var i={};return i[t]=r,window.localStorage.setItem("sendSessionStorage",JSON.stringify(i)),!0}catch(e){}return!1},e.readFromSessionStorage=function(t){try{var r=e.sessionStorage.getItem(t);return r}catch(e){}return null},e.hasCookiesSupport=function(){try{return window.navigator&&window.navigator.cookieEnabled}catch(e){return!1}},e.saveToCookies=function(e,t,r){try{var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3);var a="; expires="+i.toUTCString(),o="; path=/";return document.cookie=e+"="+t+a+o,!0}catch(e){}return!1},e.saveToSessionCookies=function(e,t){try{var r="; path=/";return document.cookie=e+"="+t+r,!0}catch(e){}return!1},e.readFromCookies=function(e){try{var t=null;if(""!==document.cookie){var r=document.cookie.split("; ");if(void 0!==r)for(var i=0;i<r.length;i++){var a=r[i].split("="),o=a[0],s=a[1];if(o==e){t=s;break}}}return t}catch(e){}return null},e.saveToMemory=function(t,r){r=e.encodeData(r),e.data[t]=r},e.readFromMemory=function(t){return e.data.hasOwnProperty(t)?e.decodeData(e.data[t]):null},e.removeFromMemory=function(t){e.data[t]="",delete e.data[t]},e.removeItem=function(t){try{var r=null;return e.localStorageSupported&&(r=e.readFromLocalStrorage(t)),r?(e.saveToLocalStorage(t,""),e.storage.removeItem(t)):e.hasCookiesSupport()&&e.readFromCookies(t)?e.saveToCookies(t,"",-1):e.removeFromMemory(t),!0}catch(e){}return!1},e.setItem=function(t,r){try{var i=!1;return e.localStorageSupported&&(i=e.saveToLocalStorage(t,r)),!i&&e.hasCookiesSupport()&&(r=e.encodeData(r),i=e.saveToCookies(t,r,365)),i||saveToMemory(t,r),!0}catch(e){}return!1},e.getItem=function(t){var r=null;return e.localStorageSupported&&(r=e.readFromLocalStrorage(t)),!r&&e.hasCookiesSupport()&&(r=e.decodeData(e.readFromCookies(t))),null===r&&(r=e.readFromMemory(t)),r},e.removeSessionItem=function(t){try{var r=null;return e.sessionStorageSupported&&(r=e.readFromSessionStrorage(t)),r?(e.saveToSessionStorage(t,""),e.sessionStorage.removeItem(t)):e.removeSessionCookieItem(t),!0}catch(e){}return!1},e.setSessionItem=function(t,r){try{var i=!1;return e.sessionStorageSupported&&(i=e.saveToSessionStorage(t,r)),i||e.setSessionCookieItem(t,r),!0}catch(e){}return!1},e.getSessionItem=function(t){var r=null;return e.sessionStorageSupported&&(r=e.readFromSessionStrorage(t)),null===r&&(r=e.getSessionCookieItem(t)),r},e.removeSessionCookieItem=function(t){e.hasCookiesSupport()&&e.readFromCookies(t)?e.saveToSessionCookies(t,""):(e.data[t]="",delete e.data[t])},e.setSessionCookieItem=function(t,r){var i=!1;r=e.encodeData(r),e.hasCookiesSupport()&&(i=e.saveToSessionCookies(t,r)),i||(e.data[t]=r)},e.getSessionCookieItem=function(t){var r=null;return e.hasCookiesSupport()&&(r=e.decodeData(e.readFromCookies(t))),null===r&&(r=e.decodeData(e.data[t])),r},e.encodeData=function(e){try{e&&(e=encodeURIComponent(JSON.stringify(e)))}catch(e){}return e},e.decodeData=function(e){try{if(e)return e=JSON.parse(decodeURIComponent(e))}catch(e){}return null},e.initSyncing=function(r){if(!e.localStorageSupported||!e.sessionStorageSupported)return void(r&&r());var i=function(i){i||(i=window.event);var a=t.urlHostnamePortPortionOnly(i.url);if(a==e.url&&i.newValue)if("getSessionStorage"==i.key){var o=JSON.stringify(e.sessionStorage);window.localStorage.setItem("sendSessionStorage",o)}else if("sendSessionStorage"==i.key){var o=JSON.parse(i.newValue);for(var s in o){for(var n=!1,c=0;c<e.validSyncSessionKeyPrefixes.length&&0==n;c++){var l=e.validSyncSessionKeyPrefixes[c];0===s.lastIndexOf(l,0)&&(n=!0)}n&&e.sessionStorage.setItem(s,o[s])}r&&!e.isSessionStorageSynced&&r(),e.isSessionStorageSynced=!0}};window.addEventListener?window.addEventListener("storage",i,!1):window.attachEvent("onstorage",i);var a=new Date,o="test-"+a.toUTCString();try{window.localStorage.setItem("getSessionStorage",o)}catch(e){}}}return r.getInstance=function(){return r.singleInstance||(r.singleInstance=new r),r.singleInstance},r}),define("viewportHelper",["jquery","knockout","ccConstants"],function(e,t,r){"use strict";function i(){if(i.singleInstance)throw new Error("Cannot instantiate more than one ViewportHelper, use getInstance()");var r=this;return this.viewportMode=t.observable(null),this.viewportDesignation=t.observable(null),this.layoutViewports=t.observable(null),this.setViewport(e(window)[0].innerWidth||e(window).width()),e(window).resize(function(){r.setViewport(e(window)[0].innerWidth||e(window).width())}),this}return i.XS_CLASS="col-xs-",i.SM_CLASS="col-sm-",i.MD_CLASS="col-md-",i.LG_CLASS="col-lg-",i.XS_OFFSET="col-xs-offset-",i.SM_OFFSET="col-sm-offset-",i.MD_OFFSET="col-md-offset-",i.LG_OFFSET="col-lg-offset-",i.prototype.setViewport=function(e){e>=r.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?this.viewportMode()!==r.LARGE_DESKTOP_VIEW&&(this.viewportMode(r.LARGE_DESKTOP_VIEW),this.viewportDesignation(r.VIEWPORT_LARGE)):e>r.VIEWPORT_TABLET_UPPER_WIDTH&&e<r.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?this.viewportMode()!==r.DESKTOP_VIEW&&(this.viewportMode(r.DESKTOP_VIEW),this.viewportDesignation(r.VIEWPORT_MEDIUM)):e>=r.VIEWPORT_TABLET_LOWER_WIDTH&&e<=r.VIEWPORT_TABLET_UPPER_WIDTH?this.viewportMode()!==r.TABLET_VIEW&&(this.viewportMode(r.TABLET_VIEW),this.viewportDesignation(r.VIEWPORT_SMALL)):this.viewportMode()!==r.PHONE_VIEW&&(this.viewportMode(r.PHONE_VIEW),this.viewportDesignation(r.VIEWPORT_XS))},i.prototype.getWidthClass=function(e,t){var a=i.SM_CLASS,o=i.SM_OFFSET;return!e||""===e||isNaN(e)?"":(this.layoutViewports&&null!=this.layoutViewports()&&""!==this.layoutViewports()&&(this.layoutViewports().toLowerCase().indexOf(r.VIEWPORT_XS.toLowerCase())!==-1?(a=i.XS_CLASS,o=i.XS_OFFSET):this.layoutViewports().toLowerCase().indexOf(r.VIEWPORT_SMALL.toLowerCase())!==-1?(a=i.SM_CLASS,o=i.SM_OFFSET):this.layoutViewports().toLowerCase().indexOf(r.VIEWPORT_MEDIUM.toLowerCase())!==-1?(a=i.MD_CLASS,o=i.MD_OFFSET):this.layoutViewports().toLowerCase().indexOf(r.VIEWPORT_LARGE.toLowerCase())!==-1&&(a=i.LG_CLASS,o=i.LG_OFFSET)),a+=e,t&&""!==t&&!isNaN(t)&&(a+=" "+o+t),a)},i.getInstance=function(){return i.singleInstance||(i.singleInstance=new i),i.singleInstance},i.getInstance()}),define("ccStoreConfiguration",["knockout"],function(e){"use strict";function t(){if(t.prototype.singleInstance)throw new Error("Cannot instantiate more than one CCStoreConfiguration. Use getInstance() method")}return t.setAddressMaxLengths=function(e,r,i,a,o,s,n){e&&e>0&&e<254&&(t.ADDRESS_ALIAS_MAXIMUM_LENGTH=e),r&&r>0&&r<254&&(t.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH=r),i&&i>0&&i<254&&(t.ADDRESS_LASTNAME_MAXIMUM_LENGTH=i),a&&a>0&&a<254&&(t.ADDRESS_ADDRESS1_MAXIMUM_LENGTH=a),o&&o>0&&o<254&&(t.ADDRESS_ADDRESS2_MAXIMUM_LENGTH=o),s&&s>0&&s<254&&(t.ADDRESS_ADDRESS3_MAXIMUM_LENGTH=s),n&&n>0&&n<254&&(t.ADDRESS_CITY_MAXIMUM_LENGTH=n)},t.prototype.filterMap={getCollection:{megaMenuNavigation:{ccFilterConfigKey:"categoryNavData"},categoryNavigation:{ccFilterConfigKey:"categoryNavData"}},listProducts:{productListingData:{ccFilterConfigKey:"PLPData"},collectionWidget:{ccFilterConfigKey:"collectionData"},getProductData:{ccFilterConfigKey:"productData"},getProductDataAndRedirect:{ccFilterConfigKey:"productData"},listProductsForAddons:{ccFilterConfigKey:"addonProductsData"}}},t.prototype.largeCart=void 0,t.prototype.isCVVRequiredForSavedCards=e.observable(!0),t.prototype.allowSavingCards=e.observable(!1),t.prototype.priorityList=["endpoint","page","identifier"],t.prototype.filterEnabled=!1,t.prototype.enablePrioritizedLoading=!(!window.clientConfigData||!window.clientConfigData.prioritizedLoading||"true"!=window.clientConfigData.prioritizedLoading),t.prototype.batchSizeForProdAndSkuData=200,t.prototype.threshholdSizeForStockStatusData=200,t.prototype.resetShippingGroupRelationships=!0,t.prototype.allowSiteSwitchingOnProduction=e.observable(!1),t.prototype.skipLoadingProductTypes=!(!window.clientConfigData||!window.clientConfigData.skipLoadingProductTypes||"true"!=window.clientConfigData.skipLoadingProductTypes),t.prototype.lazilyLoadImages=!(!window.clientConfigData||!window.clientConfigData.loadImagesLazily||"true"!=window.clientConfigData.loadImagesLazily),t.prototype.delayBeforeLoadingOutOfFocusImages=window.clientConfigData&&window.clientConfigData.delayBeforeLoadingOutOfFocusImages?Number(window.clientConfigData.delayBeforeLoadingOutOfFocusImages):-1,t.prototype.getFilterToUse=function(e){var t=this;if(t.filterEnabled&&null!=e&&e.constructor===Object){for(var r=Object.keys(e).length,i=t.filterMap,a="",o=null,s=0;s<t.priorityList.length;s++)if(a=t.priorityList[s],e[a]){if(r--,o=i[e[a]],null!=o&&o.constructor===Object&&o.ccFilterConfigKey&&0==r)return o.ccFilterConfigKey;if(null!=o&&o.constructor===Object)i=o;else{if(null!=o||!i.default)return null!=o&&0!=r||!i.ccFilterConfigKey?null:i.ccFilterConfigKey;if(o=i.default,o.constructor===Object&&o.ccFilterConfigKey&&0==r)return o.ccFilterConfigKey;if(o.constructor!==Object)return null!=o&&0!=r||!i.ccFilterConfigKey?null:i.ccFilterConfigKey;i=o}}if(null!=o&&o.constructor===Object&&o.ccFilterConfigKey)return o.ccFilterConfigKey}return null},t.prototype.enableFilter=function(){this.filterEnabled=!0},t.prototype.disableFilter=function(){this.filterEnabled=!1},t.prototype.updateFiltersToUse=function(e){var t=this;if(null!=e&&e.constructor===Object)for(var r=Object.keys(e),i=0;i<r.length;i++)t.filterMap[r[i]]=e[r[i]]},t.prototype.replaceAllFiltersToUse=function(e){var t=this;null!=e&&e.constructor===Object&&(t.filterMap=e)},t.prototype.addDataToPriorityList=function(e){var t=this;if(null!=e&&e.constructor===Array)for(var r=0;r<e.length;r++)t.priorityList.push(e[r]);
},t.prototype.replacePriorityList=function(e){var t=this;null!=e&&e.constructor===Array&&(t.priorityList=e)},t.prototype.layoutIdsRendered=[],t.prototype.layoutsRenderedArraySize=15,t.prototype.refreshAfter=e.observable(600),t.prototype.isFreshPageLoad=void 0,t.prototype.enableLayoutsRenderedForLayout=!1,t.prototype.getLayoutIdsRendered=function(){return this.layoutIdsRendered},t.prototype.storeLayoutIdsRendered=function(e){var t=this;e&&e.layout&&null!=e.layout&&t.layoutIdsRendered.indexOf(e.layout)==-1&&(t.layoutIdsRendered.length==t.layoutsRenderedArraySize&&t.layoutIdsRendered.shift(),t.layoutIdsRendered.push(e.layout))},t.prototype.enableSpinnerOnPageLoad=!1,t.prototype.discardPageScopedCallResponses=!1,t.prototype.pageScopedCalls=["getlayout","getPage","getCollection","search"],t.prototype.getPageScopedCalls=function(){return this.pageScopedCalls},t.prototype.addPageScopedCalls=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.pageScopedCalls.indexOf(r)==-1&&this.pageScopedCalls.push(r)}},t.prototype.removePageScopedCalls=function(e){for(var t=0;t<e.length;t++){var r=e[t],i=this.pageScopedCalls.indexOf(r);i>-1&&this.pageScopedCalls.splice(i,1)}},t.prototype.enableQueueingSimultaneousCalls=!1,t.prototype.queueableCalls=[],t.prototype.getQueueableCalls=function(){return this.queueableCalls},t.prototype.addQueueableCalls=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.queueableCalls.indexOf(r)==-1&&this.queueableCalls.push(r)}},t.prototype.removeQueueableCalls=function(e){for(var t=0;t<e.length;t++){var r=e[t],i=this.queueableCalls.indexOf(r);i>-1&&this.queueableCalls.splice(i,1)}},t.prototype.isLargeCart=function(e){var t=this;return t.largeCart},t.getInstance=function(){return t.singleInstance||(t.singleInstance=new t),t.singleInstance},t}),define("ccRestClientConstructor",["xDomainProxy","ccConstants","jquery","pubsub","storageApi","viewportHelper","ccStoreConfiguration"],function(e,t,r,i,a,o,s){"use strict";function n(a,o){var c=this;c.profileId=null,c.profileRoles=null,c.tokenSecret=null,c.refreshTokenSecret=null,c.ssoTokenSecret=null,c.endpointRegistry=null,c.loggedIn=!1,c.initComplete=!1,c.initCompleteCallbacks=[],c.initCompleteCallbacksDone=!1,c.storageSyncCallbacks=[],c.storageSyncDone=!1,c.loginUpdateCallbacks=[],c.logoutUpdateCallbacks=[],c.loginAdminUpdateCallbacks=[],c.logoutAdminUpdateCallbacks=[],c.iframeLoadCompleteCallbacks=[],c.initIframeLoadComplete=!1,c.initIframeLoadCompleteDone=!1,c.profileType=a,c.previewMode=!1,c.allowSiteSwitchingOnProduction=!1,c.initFailed=!1,c.disableLoginErrorRedirect=!1,c.commonErrorCallback=o,c.url=e.urlHostnamePortPortionOnly(document.URL),c.urlProtocol=e.urlProtocolOnly(document.URL),c.NULL=n.NULL,c.currentRequestId=0,c.storeRequestWasMade=!1,c.etagCache=[],c.storeConfiguration=s.getInstance(),c.handleSessionExpiry=function(){r.Topic(i.topicNames.USER_SESSION_EXPIRED).publish()},c.isRefreshRequired=!1,c.lastPublishedTimeStamp=null,c.isNotStore=!(!window.isPreviewMode&&c.profileType==t.PROFILE_TYPE_STOREFRONT),c.external=!1}return n.NULL="cc-rest-null",n.LOCAL_STORAGE_TOKEN="oauth_token_secret",n.LOCAL_STORAGE_REFRESH_TOKEN="oauth_fresh_token_secret",n.LOCAL_STORAGE_LAST_UPDATE="oauth_last_update",n.LOCAL_STORAGE_EXPIRES=";expires=",n.LOCAL_STORAGE_LIFE_DAYS=1,n.TOKEN_FRESH_TIME=36e5,n.HTTP_UNAUTHORIZED_ERROR="401",n.DELETE="delete",n.ADMIN_LOGOUT_SERVICE_PATH="/ccadminui/v1/logout",n.ADMIN_REFRESH_SERVICE_PATH="/ccadminui/v1/refresh",n.ADMIN_ENDPOINT_REGISTRY_SERVICE_PATH="/ccadminui/v1/registry",n.ADMIN_VERIFY_SERVICE_PATH="/ccadminui/v1/verify",n.ADMIN_LOGIN_SCREEN_URL="/occs-admin",n.LOGOUT_SERVICE_PATH="/ccstoreui/v1/logout",n.REFRESH_SERVICE_PATH="/ccstoreui/v1/refresh",n.ENDPOINT_REGISTRY_SERVICE_PATH="/ccstoreui/v1/registry",n.VERIFY_SERVICE_PATH="/ccstoreui/v1/verify",n.SAML_AUTHN_REQUEST_SERVICE_URL="samlAuthnRequest",n.AGENT_LOGOUT_SERVICE_PATH="/ccagentui/v1/logout",n.AGENT_REFRESH_SERVICE_PATH="/ccagentui/v1/refresh",n.AGENT_ENDPOINT_REGISTRY_SERVICE_PATH="/ccagentui/v1/registry",n.AGENT_VERIFY_SERVICE_PATH="/ccagentui/v1/verify",n.AGENT_LOGIN_SCREEN_URL="/occs-agent",n.LOCAL_STORAGE_LOGIN_KEY="cc.login.update.",n.LOCAL_STORAGE_LOGOUT_KEY="cc.logout.update.",n.INPUT_ELEMENT="input",n.IFRAME_ELEMENT="iframe",n.ZERO="0",n.IFRAME_STYLE="width: 0; height: 0; border: none;",n.IFRAME_NAME="https_iframe",n.ID_ATTRIBUTE="id",n.NAME_ATTRIBUTE="name",n.WIDTH_ATTRIBUTE="width",n.HEIGHT_ATTRIBUTE="height",n.BORDER_ATTRIBUTE="border",n.STYLE_ATTRIBUTE="style",n.SRC_ATTRIBUTE="src",n.MAX_INT=4294967295,n.LOCALE_HINT="localeHint",n.HINT_BROWSER="browser",n.HINT_ASSET_LANGUAGE_OPTIONAL="assetLanguageOptional",n.HINT_ASSET_LANGUAGE_REQUIRED="assetLanguageRequired",n.BEFORE_SEND_NOT_SUPPORTED="Before-send callback not supported for proxy requests.",n.LAST_PUBLISHED_TIME_STAMP="lastPublishedTimeStamp",n.prototype.initProxy=function(t,r){var i=this,a=t,o=r;a||(a=location.port),o||(o=location.port),i.crossDomainURL=e.getCrossDomainURL(i.profileType,e.HTTPS_PROTOCOL,o,!0),i.crossDomainURLNoPath=e.getCrossDomainURL(i.profileType,e.HTTPS_PROTOCOL,o,!1),i.proxy=new e(i.profileType,a,o)},n.prototype.registerInitFailCallback=function(e){var t=this;t.initFailCallback=e,t.initFailed&&t.initFailCallback()},n.prototype.registerStorageSyncCallback=function(e){var t=this;t.storageSyncDone?e():t.storageSyncCallbacks.push(e)},n.prototype.registerInitCallback=function(e){var t=this;t.initComplete?e():t.initCompleteCallbacks.push(e)},n.prototype.registerLoginUpdateCallback=function(e){var t=this;t.loginUpdateCallbacks.push(e)},n.prototype.registerLogoutUpdateCallback=function(e){var t=this;t.logoutUpdateCallbacks.push(e)},n.prototype.registerLoginAdminUpdateCallback=function(e){var t=this;t.loginAdminUpdateCallbacks.push(e)},n.prototype.registerLogoutAdminUpdateCallback=function(e){var t=this;t.logoutAdminUpdateCallbacks.push(e)},n.prototype.init=function(r,i,o){var s=this,n=function(){if(!s.initCompleteCallbacksDone){s.initComplete=!0;for(var e=0;e<s.initCompleteCallbacks.length;e++)s.initCompleteCallbacks[e]();s.initCompleteCallbacks.length=0,s.initCompleteCallbacksDone=!0}},c=function(){s.refresh(n,n)},l=function(){for(var e=0;e<s.storageSyncCallbacks.length;e++)s.storageSyncCallbacks[e]();s.storageSyncDone=!0};a.getInstance().initSyncing(function(){s.reloadStoredValueAuth(),s.proxy&&s.refresh(l,l)}),s.reloadStoredValueAuth(),s.registerAsLoginLogoutEventListener();var d=function(){if(s.urlProtocol!=e.HTTPS_PROTOCOL&&s.crossDomainRequestsEnabled===!0){s.useIframe=!0,s.eventHandlerMap={},s.eventHandlerMap[e.IFRAME_INIT_COMPLETE_EVENT]={success:c,error:c},s.initXDomainMessageListener();var t=s.createCrossDomainIFrame();null!=t&&(s.proxyFrame=t.contentWindow)}else s.useIframe=!1,c()};window.urlLocale?s.setStoredValue(t.LOCAL_STORAGE_USER_CONTENT_LOCALE,window.urlLocale):s.profileType!==t.PROFILE_TYPE_ADMIN&&s.clearStoredValue(t.LOCAL_STORAGE_USER_CONTENT_LOCALE);var u=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))};if(s.previewMode||s.allowSiteSwitchingOnProduction){var p=u(t.URL_SITE_PARAM);p&&s.setStoredValue(t.LOCAL_STORAGE_SITE_ID,p)}else window.siteId&&s.setStoredValue(t.LOCAL_STORAGE_SITE_ID,window.siteId);var h=function(){if(null==s.endpointRegistry){var e=function(e){s.initProxy(e.httpPort,e.httpsPort),d()},t=function(e){var t=JSON.parse(e);"401"==t.status&&s.redirectToAdminLoginScreen(),null!=s.initFailCallback&&s.initFailCallback(),s.initFailed=!0};s.requestEndpointRegistry(e,t)}else d()},g=function(){if(s.profileType==t.PROFILE_TYPE_STOREFRONT&&!s.previewMode){var e=function(e){"401"==e.status&&s.redirectToAdminLoginScreen()};s.request(t.ENDPOINT_GET_MERCHANT_TIMEZONE,{},function(e){},e)}};if(r){if(o){var f=o;"string"==typeof o&&(f=JSON.parse(o)),s.endpointRegistry=f.endpointMap,s.crossDomainRequestsEnabled=f.crossDomainRequestsEnabled,s.profileType==t.PROFILE_TYPE_STOREFRONT&&s.initializeLastPublishedTimeStamp()}window.isPreviewMode&&(s.previewMode=window.isPreviewMode),s.initProxy(location.port,location.port),c()}else h(),i||g()},n.prototype.initXDomainMessageListener=function(){var e=this;window.addEventListener("message",function(t){var r=t.origin;if(r==e.crossDomainURLNoPath){var i;i="string"==typeof t.data?JSON.parse(t.data):t.data;var a=i.id,o=i.success,s=i.payload,n=e.eventHandlerMap[a];n&&(o?n.success(s):n.error(s))}},!1)},n.prototype.proxyRequest=function(e,t,r,i,a){var o=this;o.currentRequestId>=n.MAX_INT?o.currentRequestId=0:o.currentRequestId++;var s=o.currentRequestId;o.eventHandlerMap[s]={success:r,error:i};var c={};c.id=s,c.target=e,c.payload=t,o.proxyFrame.postMessage(JSON.stringify(c),o.crossDomainURL,a)},n.prototype.proxyRequestRequired=function(e){var t=this;return!(!e||e.httpsRequired!==!0||"https"==t.urlProtocol)},n.prototype.login=function(e,t,r,i){var a={user:e,password:t};this.loginInternal(a,r,i)},n.prototype.mfaLogin=function(e,t,r,i,a){var o={user:e,password:t,totp_code:r};this.loginInternal(o,i,a)},n.prototype.samlLogin=function(e,t,r,i){var a=this,o={samlResponse:e,relayState:i};a.loginInternal(o,t,r)},n.prototype.loginInternal=function(a,o,s){var c=this,l=function(t){c.tokenSecret=t[e.OAUTH_ACCESS_TOKEN_PARAM],c.parseAndStoreClaims(),c.storeToken(c.tokenSecret),c.loggedIn=!0,o()},d=function(e){c.loggedIn=!1,e?s(e):r.Topic(i.topicNames.USER_NETWORK_ERROR).publish([{message:"failure"}])},u={};c.previewMode?(c.resetAdminPreviewToken(),u.tokenSecret=c.tokenSecret):c.clearSessionStoredValue(n.LOCAL_STORAGE_TOKEN,t.PROFILE_TYPE_LAYOUT_PREVIEW),c.updateHeaderWithVisitData(u),u=c.updateHeaderWithSiteId(u,!1,!0,null),null!=a.samlResponse?c.doSamlLogin(a.samlResponse,l,d,u,a.relayState):a.totp_code&&null!==a.totp_code?c.doMFALogin(a.user,a.password,a.totp_code,l,d,u):c.doLogin(a.user,a.password,l,d,u)},n.prototype.doLogin=function(e,t,r,i,a){var o=this;o.useIframe&&o.proxyRequestRequired({httpsRequired:!0})?o.proxyRequest("login",{user:e,password:t},r,i):o.proxy.loginRequest(e,t,r,i,a)},n.prototype.doMFALogin=function(e,t,r,i,a,o){var s=this;s.useIframe&&s.proxyRequestRequired({httpsRequired:!0})?s.proxyRequest("login",{user:e,password:t},i,a):s.proxy.mfaLoginRequest(e,t,r,i,a,o)},n.prototype.doSamlLogin=function(e,t,r,i,a){var o=this;o.useIframe&&o.proxyRequestRequired({httpsRequired:!0})?o.proxyRequest("login",{samlResponse:e,relayState:a},t,r):o.proxy.samlLoginRequest(e,t,r,i,a)},n.prototype.generateSamlAuthnRequest=function(e,t){var r=this;r.request(n.SAML_AUTHN_REQUEST_SERVICE_URL,{},e,t,null,null,null,null,null,{encode:!0})},n.prototype.logout=function(r,i){var a=this,o=n.LOGOUT_SERVICE_PATH;a.profileType==t.PROFILE_TYPE_ADMIN?o=n.ADMIN_LOGOUT_SERVICE_PATH:a.profileType==t.PROFILE_TYPE_AGENT&&(o=n.AGENT_LOGOUT_SERVICE_PATH);var s=function(){a.clearStoredValues(),a.clearValues(),a.loggedIn=!1,a.resetAdminPreviewToken()},c=function(e){s(),r()},l=function(e){s(),i(e)};a.authenticatedRequest(o,{},c,l,e.POST)},n.prototype.verify=function(r,i){var a=this,o=function(){a.loggedIn=!0,r()},s=function(e){a.clearStoredValues(),a.clearValues(),a.resetAdminPreviewToken(),i(e)},c=n.VERIFY_SERVICE_PATH;a.profileType==t.PROFILE_TYPE_ADMIN?c=n.ADMIN_VERIFY_SERVICE_PATH:a.profileType==t.PROFILE_TYPE_AGENT&&(c=n.AGENT_VERIFY_SERVICE_PATH),a.tokenSecret?a.authenticatedRequest(c,{},o,s,e.POST):s()},n.prototype.refresh=function(r,i){var a=this,o=n.REFRESH_SERVICE_PATH;a.profileType==t.PROFILE_TYPE_ADMIN||a.profileType==t.PROFILE_TYPE_LAYOUT_PREVIEW?o=n.ADMIN_REFRESH_SERVICE_PATH:a.profileType==t.PROFILE_TYPE_AGENT&&(o=n.AGENT_REFRESH_SERVICE_PATH);var s=function(t){a.tokenSecret=t[e.OAUTH_ACCESS_TOKEN_PARAM],a.parseAndStoreClaims(),a.storeToken(a.tokenSecret);var i=t[e.OAUTH_REFRESH_TOKEN_PARAM];i&&(a.refreshTokenSecret=i,a.storeRefreshToken(a.refreshTokenSecret)),a.loggedIn=!0,r(t)},c=function(e){e&&(a.handleSessionExpiry(),a.clearStoredValues(),a.clearValues(),a.resetAdminPreviewToken()),i(e)};if(a.ssoTokenSecret=null,a.external&&a.tokenSecret){var l=this.readToken();l||(a.clearStoredValues(),a.clearValues())}if(a.tokenSecret)if(a.refreshTokenSecret){var d={refresh_token:a.refreshTokenSecret};a.authenticatedRequest(o,d,s,c,e.POST,!1,!0)}else a.authenticatedRequest(o,{},s,c,e.POST,!1,!0);else c()},n.prototype.registerAsLoginLogoutEventListener=function(){var r=this,i=function(i){i||(i=window.event);var a=e.urlHostnamePortPortionOnly(i.url);if(a==r.url)if(i.key==r.getStoredValueName(n.LOCAL_STORAGE_TOKEN)){var o=!1;if(i.newValue&&(o=!0,r.tokenSecret=i.newValue,r.parseAndStoreClaims()),o){r.loggedIn=!0;for(var s=0;s<r.loginUpdateCallbacks.length;s++)r.loginUpdateCallbacks[s]()}else{r.clearValues();for(var c=0;c<r.logoutUpdateCallbacks.length;c++)r.logoutUpdateCallbacks[c]()}}else if(r.previewMode&&i.key==r.getStoredValueName(n.LOCAL_STORAGE_TOKEN,t.PROFILE_TYPE_ADMIN))if(!i.newValue&&i.oldValue)for(var c=0;c<r.logoutAdminUpdateCallbacks.length;c++)r.logoutAdminUpdateCallbacks[c]();else for(var s=0;s<r.loginAdminUpdateCallbacks.length;s++)r.loginAdminUpdateCallbacks[s]()};window.addEventListener?window.addEventListener("storage",i,!1):window.attachEvent("onstorage",i)},n.prototype.reloadStoredValueAuth=function(){var e=this.readToken();if(e){this.tokenSecret=e,this.parseAndStoreClaims(),this.checkPreviewWhenLoggedIn();var t=this.readRefreshToken();return t&&(this.refreshTokenSecret=t),this.ssoTokenSecret=null,!0}return this.resetAdminPreviewToken()},n.prototype.checkPreviewWhenLoggedIn=function(){return this.resetAdminPreviewToken(!0)},n.prototype.resetAdminPreviewToken=function(e){var r=this;e=e&&"boolean"==typeof e;var i=r.getStoredValueName(n.LOCAL_STORAGE_TOKEN,t.PROFILE_TYPE_ADMIN),o=r.getSessionStoredValue(i);return!(!o||r.profileType!=t.PROFILE_TYPE_STOREFRONT&&r.profileType!=t.PROFILE_TYPE_LAYOUT_PREVIEW||!r.isNotStore)&&(e||(r.tokenSecret=o),r.previewMode||(r.registerLoginAdminUpdateCallback(function(){r.resetAdminPreviewToken()}),r.registerLogoutAdminUpdateCallback(function(){r.clearStoredValues(),r.clearValues(),r.loggedIn=!1,a.getInstance().removeItem("user"),r.redirectToAdminLoginScreen()})),r.previewMode=!0,!0)},n.prototype.getAjaxConfig=function(e,t,r,i,a,o,s,n,c){var l=null,d=function(e,t){return t.beforeSend=c,l=t,!1};return this.request(e,t,r,i,a,o,s,n,d),l},n.prototype.runningRequests={},n.prototype.queuedRequests={},n.prototype.request=function(e,t,r,i,a,o,s,n,c,l){var d=this,u=function(e,t,r,i,a,o,s,n,c,l){this.url=e,this.data=t,this.successCallback=r,this.errorCallback=i,this.param1=a,this.param2=o,this.param3=s,this.param4=n,this.beforeSendCallback=c,this.scope=l};if(d.storeConfiguration.enableQueueingSimultaneousCalls&&d.storeConfiguration.getQueueableCalls().indexOf(e)>-1){var p=new u(e,t,r,i,a,o,s,n,c,l);if(d.runningRequests.hasOwnProperty(e))d.queuedRequests[e]=p;else{d.runningRequests[e]=p;var h=function(t){p.successCallback&&"function"==typeof p.successCallback&&p.successCallback(t),delete d.runningRequests[e];var r=d.queuedRequests[e];r&&(d.request(r.url,r.data,r.successCallback,r.errorCallback,r.param1,r.param2,r.param3,r.param4,r.beforeSendCallback,r.scope),delete d.queuedRequests[e])},g=function(t){p.errorCallback&&"function"==typeof p.errorCallback&&p.errorCallback(t),delete d.runningRequests[e];var r=d.queuedRequests[e];r&&(d.request(r.url,r.data,r.successCallback,r.errorCallback,r.param1,r.param2,r.param3,r.param4,r.beforeSendCallback,r.scope),delete d.queuedRequests[e])};d.performRequest(p.url,p.data,h,g,p.param1,p.param2,p.param3,p.param4,p.beforeSendCallback,p.scope)}}else d.performRequest(e,t,r,i,a,o,s,n,c,l)},n.prototype.performRequest=function(e,r,i,a,o,s,n,c,l,d){var u=!0;this.profileType==t.PROFILE_TYPE_ADMIN&&(u=!1),this.requestWithSite(e,u,r,i,a,o,s,n,c,l,null,d)},n.prototype.requestWithSite=function(i,o,c,l,d,u,p,h,g,f,m,I){var E=this,v=function(){var v=E.registryLookup(i),y="GET",b=!1,T=i,P={};null!=v&&(b=v.authRequired,y=v.method,null!=T&&T.charAt(0)!=e.SLASH&&(T=v.url)),T=E.insertParamsIntoUri(T,[u,p,h,g]);var S=!1;E.useIframe&&E.proxyRequestRequired(v)&&(S=!0);var C="global";E.storeConfiguration.discardPageScopedCallResponses&&E.storeConfiguration.getPageScopedCalls().indexOf(i)&&(C="page");var A=r.extend(!0,{},window.location),_=function(r){if(r&&r[e.ETAG_PROPERTY])try{var i=JSON.parse(e.decodeBase64(r[e.ETAG_PROPERTY]));i&&i.user&&(r.etag_lastModifiedBy=i.user),E.etagCache[T]=r[e.ETAG_PROPERTY]}catch(e){console.log("ETAG parse error: ",e)}if(r&&r[e.LAST_PUBLISHED_TIME_PROPERTY]){var o=r[e.LAST_PUBLISHED_TIME_PROPERTY];if(null!=E.lastPublishedTimeStamp&&E.lastPublishedTimeStamp<o){var n=a.getInstance().getItem(t.LAST_REFRESH_TIME);if(s.getInstance().refreshAfter()&&0!=s.getInstance().refreshAfter()&&null!=n){var c=s.getInstance().refreshAfter(),d=new Date(n);d.setSeconds(d.getSeconds()+c);var u=new Date;(u.toDateString()!==d.toDateString()||u.toDateString()===d.toDateString()&&u.getTime()>d.getTime())&&(E.lastPublishedTimeStamp=o,a.getInstance().setItem(t.LAST_REFRESH_TIME,new Date),E.isRefreshRequired=!0)}else E.lastPublishedTimeStamp=o,a.getInstance().setItem(t.LAST_REFRESH_TIME,new Date),E.isRefreshRequired=!0}}var p=window.location.href,h=A.href;"global"!=C&&p!=h||l(r)};if(!b&&E.loggedIn&&(b=!0),P=E.updateHeaderWithLocaleHint(v),P=E.updateHeaderWithPriceListGroupId(P),P=E.updateHeaderWithSelectedOrganization(P),P=E.updateHeaderWithAgentContext(P),P=E.updateHeaderWithViewport(P),P=E.updateHeaderWithShopperContext(P),P=E.updateHeaderWithSiteId(P,!1,o,m),E.previewMode&&(P=E.updateHeaderWithAudience(P)),null!=v&&"PUT"===v.method&&E.etagCache[T]&&(P[e.ETAG]=E.etagCache[T],delete E.etagCache[T],v.useOptimisticLock&&(P["If-Match"]=P[e.ETAG])),1==b){var O=function(e){if(e)if(E.profileType==t.PROFILE_TYPE_AGENT){if(e.errorCode===t.ERRORCODE_INVALID_SITE_ID)return localStorage.clear(),window.location.assign("/occs-agent/agentError"),!1;e.status==n.HTTP_UNAUTHORIZED_ERROR&&(E.clearStoredValues(),E.clearValues(),E.handleSessionExpiry())}else if(e.status!=n.HTTP_UNAUTHORIZED_ERROR&&e.errorCode!==t.ERRORCODE_INVALID_SITE_ID||(E.clearStoredValues(),E.clearValues(),E.handleSessionExpiry()),e.errorCode===t.ERRORCODE_INVALID_SITE_ID)return localStorage.clear(),window.location.reload(!0),!1;d(e)};E.authenticatedRequest(T,c,_,O,y,S,null,P,f,I)}else E.unauthenticatedRequest(T,c,_,d,y,null,P,f,I)};E.registerInitCallback(v)},n.prototype.updateHeaderWithLocaleHint=function(i,a,o){var s=r.extend({},a),c=o||!1;if(!i)return s;if(!c&&s[e.ASSET_LANGUAGE_HEADER_NAME])return s;var l=i[n.LOCALE_HINT];if(!l)return s;var d;if(l===n.HINT_ASSET_LANGUAGE_OPTIONAL||l===n.HINT_ASSET_LANGUAGE_REQUIRED){var u=JSON.parse(this.getStoredValue(t.LOCAL_STORAGE_USER_CONTENT_LOCALE));u&&u[0]?d=u[0].name:l===n.HINT_ASSET_LANGUAGE_REQUIRED&&(d="en")}return d&&d.length>0&&(s[e.ASSET_LANGUAGE_HEADER_NAME]=d),s},n.prototype.updateHeaderWithPriceListGroupId=function(i,a){var o=r.extend({},i),s=a||!1;if(!s&&o[e.PRICE_LIST_GROUP_ID])return o;var n;return n="string"==typeof this.getStoredValue(t.LOCAL_STORAGE_PRICELISTGROUP_ID)?JSON.parse(this.getStoredValue(t.LOCAL_STORAGE_PRICELISTGROUP_ID)):this.getStoredValue(t.LOCAL_STORAGE_PRICELISTGROUP_ID),n&&(o[e.PRICE_LIST_GROUP_ID]=n),o},n.prototype.updateHeaderWithSelectedOrganization=function(i,o){var s=this,n=r.extend({},i),c=o||!1;if(!c&&n[e.ORGANIZATION_ID])return n;var l;return l="string"==typeof s.getStoredValue(t.LOCAL_STORAGE_ORGANIZATION_ID)?JSON.parse(s.getStoredValue(t.LOCAL_STORAGE_ORGANIZATION_ID)):s.getStoredValue(t.LOCAL_STORAGE_ORGANIZATION_ID),s.profileType===t.PROFILE_TYPE_AGENT&&(l=a.getInstance().readFromMemory(t.LOCAL_STORAGE_ORGANIZATION_ID)),l&&(n[e.ORGANIZATION_ID]=l),n},n.prototype.updateHeaderWithAgentContext=function(i,o){var s=r.extend({},i),n=o||!1;if(!n&&s[e.AGENT_CONTEXT])return s;var c=a.getInstance().readFromMemory(t.LOCAL_STORAGE_AGENT_CONTEXT);return"string"==typeof c&&(c=JSON.parse(c)),c&&(s[e.AGENT_CONTEXT]=c),s},n.prototype.updateHeaderWithAudience=function(t){var i=r.extend({},t),a=decodeURIComponent(this.getStoredValue("audience"));return i[e.AUDIENCE_HEADER_NAME]=a,i},n.prototype.updateHeaderWithViewport=function(t,i){var a=r.extend({},t),s=i||!1;if(!s&&a[e.VIEWPORT_HEADER_NAME])return a;var n=o.viewportDesignation();return n&&(a[e.VIEWPORT_HEADER_NAME]=n),a},n.prototype.updateHeaderWithShopperContext=function(i,o){var s=this,n=r.extend({},i),c=o||!1;if(!c&&n[e.XSTATEDATA])return n;if(s.profileType==t.PROFILE_TYPE_STOREFRONT||s.profileType==t.PROFILE_TYPE_AGENT){var l;l=a.getInstance().getItem(t.LOCAL_STORAGE_SHOPPER_CONTEXT),l&&(n[e.XSTATEDATA]=l)}return n},n.prototype.updateHeaderWithSiteId=function(i,o,s,n){var c=this,l=r.extend({},i),d=o||!1,u=s||!1;if(!d&&l[e.SITE_ID])return l;var p;return(c.allowSiteSwitchingOnProduction||c.previewMode||u)&&(p=n?n:!c.previewMode&&window.siteId?window.siteId:c.getStoredValue(t.LOCAL_STORAGE_SITE_ID),p&&(l[e.SITE_ID]=p)),c.profileType===t.PROFILE_TYPE_AGENT&&(p=a.getInstance().readFromMemory(t.LOCAL_STORAGE_SITE_ID),p&&(l[e.SITE_ID]=p)),l},n.prototype.updateHeaderWithVisitData=function(r){var i=window.OracleUnifiedVisit,a=null,o=null;return i&&i.visitId&&i.visitorId&&(a=i.visitId(),o=i.visitorId()),a||o||window.visitorId&&window.visitId&&(o=window.visitorId,a=window.visitId),o||(o=window.localStorage.getItem(t.VISITOR_ID)),a&&(r[e.VISIT_ID]=a),o&&(r[e.VISITOR_ID]=o),r},n.prototype.requestWithoutAssetLocale=function(t,r,i,a,o,s,c,l){var d=this,u=function(){var u,p,h=d.registryLookup(t),g="GET",f=!1,m=t;null!=h&&(f=h.authRequired,g=h.method,null!=m&&m.charAt(0)!=e.SLASH&&(m=h.url)),m=d.insertParamsIntoUri(m,[o,s,c,l]);var I=!1;d.useIframe&&d.proxyRequestRequired(h)&&(I=!0);var E=function(e){i(e)};if(!f&&d.loggedIn&&(f=!0),u=d.updateHeaderWithLocaleHint(h),u=d.updateHeaderWithViewport(u),p=h[n.LOCALE_HINT],p&&p!==n.HINT_ASSET_LANGUAGE_OPTIONAL||delete u[e.ASSET_LANGUAGE_HEADER_NAME],1==f){var v=function(e){e&&e.status==n.HTTP_UNAUTHORIZED_ERROR&&(d.clearStoredValues(),d.clearValues(),d.handleSessionExpiry()),a(e)};d.authenticatedRequest(m,r,E,v,g,I,null,u)}else d.unauthenticatedRequest(m,r,E,a,g,null,u)};d.registerInitCallback(u)},n.prototype.authenticatedRequest=function(e,t,r,i,a,o,s,n,c,l){var d=this;if(d.storeRequestWasMade=!0,n||(n={}),n=d.updateHeaderWithVisitData(n),n=d.updateHeaderWithSiteId(n,!1,!0,null),d.external&&d.tokenSecret){var u=this.readToken();u||d.clearValues()}var p={tokenSecret:d.tokenSecret},h=function(e){var t=e;null!=t&&t.items&&t.autoWrap&&(t=t.items),r(t)},g=function(e,t){d.previewMode&&401==t&&!s&&d.redirectToAdminLoginScreen(),null!=d.commonErrorCallback&&p.tokenSecret===d.tokenSecret&&d.commonErrorCallback(e,t),i(e,t)};d.doAuthRequest(e,t,h,g,p,a,o,n,c,l)},n.prototype.doAuthRequest=function(e,t,r,i,a,o,s,c,l,d){var u=this;if(s){if(l)throw n.BEFORE_SEND_NOT_SUPPORTED;u.proxyRequest("auth",{url:e,data:t,clientProps:a,method:o},r,i,c)}else u.proxy.request(e,t,r,i,o,a,c,l,d)},n.prototype.unauthenticatedRequest=function(e,t,r,i,a,o,s,c,l){var d=this;d.storeRequestWasMade=!0,s||(s={}),s=d.updateHeaderWithVisitData(s);var u=function(e){var t=e;null!=t&&t.items&&t.autoWrap&&(t=t.items),r(t)},p=function(e,t){null!=d.commonErrorCallback&&d.commonErrorCallback(e,t),i(e,t)};if(o){if(c)throw n.BEFORE_SEND_NOT_SUPPORTED;d.proxyRequest("noauth",{url:e,data:t,method:a},r,p,s)}else d.proxy.request(e,t,u,p,a,null,s,c,l)},n.prototype.requestEndpointRegistry=function(i,a){var o=this,s=function(e){o.endpointRegistry=e.endpointMap,o.crossDomainRequestsEnabled=e.crossDomainRequestsEnabled,o.profileType==t.PROFILE_TYPE_STOREFRONT&&o.initializeLastPublishedTimeStamp(),i(e)},c=function(e){a(e)},l=n.ENDPOINT_REGISTRY_SERVICE_PATH;o.profileType==t.PROFILE_TYPE_ADMIN?l=n.ADMIN_ENDPOINT_REGISTRY_SERVICE_PATH:o.profileType==t.PROFILE_TYPE_AGENT&&(l=n.AGENT_ENDPOINT_REGISTRY_SERVICE_PATH);var d=null,u={dataType:e.JSON,type:e.GET,url:l,processData:!1,success:function(e,t,r){s(e)},error:function(e,t,r){var i=e.responseText;if(""!==i)try{i=JSON.parse(i)}catch(e){}c(e.responseText)}};o.profileType&&!o.previewMode&&(d={},d[e.PROFILE_TYPE_HEADER_NAME]=o.profileType),o.tokenSecret&&(null==d&&(d={}),d[e.AUTH_HEADER_NAME]=e.AUTH_HEADER_PREFIX+o.tokenSecret),null==d&&(d={}),o.updateHeaderWithVisitData(d),d&&(u.headers=d),r.ajax(u)},n.prototype.initializeLastPublishedTimeStamp=function(){var e=this,t=function(t){t&&t.hasOwnProperty(n.LAST_PUBLISHED_TIME_STAMP)&&(e.lastPublishedTimeStamp=t[n.LAST_PUBLISHED_TIME_STAMP])},r=function(e){};e.request("getLastPublishedTime",null,t,r)},n.prototype.registryLookup=function(t){var r=this;if(null==this.endpointRegistry)return null;var i=e.convertUrl(t);if(null==i)return null;for(var a=null,o=i.length;o>0&&null==a;o--){var s=null,n=i.slice(0,o);if(s=n.join(e.EMPTY_STRING),a=r.endpointRegistry[s],null==a)for(var c=0;c<n.length&&null==a;c++){for(var l=0;l<c;l++){var d=n.length-1-l;1==d?n[d]=e.CURLY_BRACES:n[d]=e.SLASH+e.CURLY_BRACES}s=n.join(e.EMPTY_STRING),a=r.endpointRegistry[s]}}return a},n.prototype.insertParamsIntoUri=function(t,r){for(var i=t,a=0;a<r.length;a++)r[a]&&(i=i.replace(e.CURLY_BRACES,r[a]));return i},n.prototype.getStoredValueName=function(t,r){var i=this,a=r;return a||(a=i.profileType),a?t+e.DASH+a:t},n.prototype.storeToken=function(e){var t=this,r=t.getStoredValueName(n.LOCAL_STORAGE_TOKEN);t.setSessionStoredValue(r,e)},n.prototype.storeRefreshToken=function(e){var t=this,r=t.getStoredValueName(n.LOCAL_STORAGE_REFRESH_TOKEN);t.setSessionStoredValue(r,e)},n.prototype.readToken=function(){var e=this,t=e.getStoredValueName(n.LOCAL_STORAGE_TOKEN),r=null;return r=e.getSessionStoredValue(t)},n.prototype.getSSOToken=function(e){var r=this;r.external?null!=r.ssoTokenSecret?e():r.request(t.ENDPOINT_SSO_GET_TOKEN,{},function(t){r.ssoTokenSecret=t.token,e()},function(t){console.log("Unable to retrieve SSO token."),r.ssoTokenSecret=null,e()}):e()},n.prototype.readSSOToken=function(){var e=this;return e.external?e.ssoTokenSecret:e.readToken()},n.prototype.readRefreshToken=function(){var e=this,t=e.getStoredValueName(n.LOCAL_STORAGE_REFRESH_TOKEN),r=null;return r=e.getSessionStoredValue(t)},n.prototype.clearStoredValues=function(){var e=this;e.clearSessionStoredValue(n.LOCAL_STORAGE_TOKEN),e.clearSessionStoredValue(n.LOCAL_STORAGE_REFRESH_TOKEN),e.profileType!==t.PROFILE_TYPE_LAYOUT_PREVIEW&&e.clearSessionStoredValue(n.LOCAL_STORAGE_TOKEN,t.PROFILE_TYPE_LAYOUT_PREVIEW)},n.prototype.clearValues=function(){var e=this;e.tokenSecret=null,e.refreshTokenSecret=null,e.ssoTokenSecret=null,e.profileId=null,e.loggedIn=!1,e.external=!1},n.prototype.setStoredValue=function(e,t){var r=this,i=r.getStoredValueName(e);try{a.getInstance().setItem(i,t)}catch(e){}},n.prototype.getStoredValue=function(e){var t=this,r=t.getStoredValueName(e),i=null;try{i=a.getInstance().getItem(r)}catch(e){}return i},n.prototype.clearStoredValue=function(e){var t=this.getStoredValueName(e);void 0!==t&&null!==t&&a.getInstance().removeItem(t)},n.prototype.setSessionStoredValue=function(e,t){try{a.getInstance().setSessionItem(e,t)}catch(e){}},n.prototype.getSessionStoredValue=function(e){var t=null;try{t=a.getInstance().getSessionItem(e)}catch(e){}return t},n.prototype.clearSessionStoredValue=function(e,t){var r=this.getStoredValueName(e,t);void 0!==r&&null!==r&&a.getInstance().removeSessionItem(r)},n.prototype.parseAndStoreClaims=function(){var r=this,i=e.parseClaimsFromAccessToken(r.tokenSecret);null!=i&&(r.profileId=i[t.TOKEN_PROFILEID_PROPERTY],r.profileLogin=i[t.TOKEN_SUBJECT_PROPERTY],r.profileRoles=i[t.TOKEN_ROLES_PROPERTY])},n.prototype.insertAuthHeadersAsQueryParams=function(e,t){return e},n.prototype.createCrossDomainIFrame=function(){var e=this,t=n.IFRAME_NAME+"_"+e.profileType,r=e.crossDomainURL,i=document.createElement(n.IFRAME_ELEMENT);i.setAttribute(n.ID_ATTRIBUTE,t),i.setAttribute(n.NAME_ATTRIBUTE,t),i.setAttribute(n.WIDTH_ATTRIBUTE,n.ZERO),i.setAttribute(n.HEIGHT_ATTRIBUTE,n.ZERO),i.setAttribute(n.BORDER_ATTRIBUTE,n.ZERO),i.setAttribute(n.STYLE_ATTRIBUTE,n.IFRAME_STYLE),i.setAttribute(n.SRC_ATTRIBUTE,r);var a=null;try{document.body.appendChild(i),window.frames[t].name=t,a=document.getElementById(t)}catch(e){}return a},n.prototype.redirectToAdminLoginScreen=function(){var e=this;e.disableLoginErrorRedirect||(window.top!==window.self&&e.profileType==t.PROFILE_TYPE_LAYOUT_PREVIEW?window.top.location.href=n.ADMIN_LOGIN_SCREEN_URL:document.location.href=n.ADMIN_LOGIN_SCREEN_URL)},n.prototype.generateAuthUrl=function(t,r,i){var a,o=this,s=o.registryLookup(t),n=t;return null!=s&&(a=s.authRequired,n=s.url),n=o.insertParamsIntoUri(n,r),n=e.addQueryParams(n,i),a&&(n=o.insertAuthHeadersAsQueryParams(n,!0)),n},n.prototype.getURLParameter=function(e){var t=document.location.search;if(t&&""!==t){var r,i=(t.split("?")[0],[]),a=t.split("?")[1];if(""!==a){i=a.split("&");for(var o=i.length-1;o>=0;o-=1)if(r=i[o].split("=")[0],r===e)return i[o].split("=")[1]}}return null},n}),define("ccRestClient",["ccRestClientConstructor","ccConstants","pubsub","ccStoreConfiguration"],function(e,t,r,i){"use strict";var a=function(e,i){(0==i||i<100||i>600)&&!e&&$.Topic(r.topicNames.USER_NETWORK_ERROR).publish([{message:"failure"}]),i==t.HTTP_UNAUTHORIZED_ERROR&&$.Topic(r.topicNames.USER_SESSION_EXPIRED).publish()},o=t.PROFILE_TYPE_STOREFRONT;window.CCStorefrontPreviewMode===!0?o=t.PROFILE_TYPE_LAYOUT_PREVIEW:window.isAgentApplication===!0&&(o=t.PROFILE_TYPE_AGENT);var s=new e(o,a);s.allowSiteSwitchingOnProduction=i.getInstance().allowSiteSwitchingOnProduction(),i.getInstance().allowSiteSwitchingOnProduction.subscribe(function(){s.allowSiteSwitchingOnProduction=i.getInstance().allowSiteSwitchingOnProduction()}),window.endpointRegistry?s.init(!0,!window.isPreviewMode,window.endpointRegistry):s.init(!1,!window.isPreviewMode);try{delete window.isPreviewMode,delete window.endpointRegistry}catch(e){window.isPreviewMode=void 0,window.endpointRegistry=void 0}return s}),define("profiletools",["ccRestClient","knockout","pubsub"],function(e,t,r){"use strict";function i(){var t=this;return t.restApi=e,$.Topic(r.topicNames.REGISTER_SUBMIT).subscribe(this.register),this}return i.prototype.login=function(e,t,r,i){var a=this;a.restApi.login(e,t,function(){r()},function(e){i(e)})},i.prototype.logout=function(){},i.prototype.register=function(e){var i,a,o;i=t.utils.unwrapObservable(e.email),a=t.utils.unwrapObservable(e.password),o=t.utils.unwrapObservable(e.confirmPassword),i&&a?a!==o?$.Topic(r.topicNames.REGISTER_FAILURE).publishWith(this,[{message:"Passwords do not match."}]):$.Topic(r.topicNames.REGISTER_SUCCESS).publishWith(this,[{message:"success"}]):$.Topic(r.topicNames.REGISTER_FAILURE).publishWith(this,[{message:"You must include at least a username and password."}])},i}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("i18nextBackend",t):e.i18nextXHRBackend=t()}(this,function(){"use strict";function e(e){return a.call(o.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e}function t(e,t,r,i,a){if(i&&"object"===("undefined"==typeof i?"undefined":s(i))){var o="",n=encodeURIComponent;for(var c in i)o+="&"+n(c)+"="+n(i[c]);i=o.slice(1)+(a?"":"&_t="+new Date)}try{var l=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");l.open(i?"POST":"GET",e,1),t.crossDomain||l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.withCredentials=!!t.withCredentials,i&&l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){l.readyState>3&&r&&r(l.responseText,l)},l.send(i)}catch(e){window.console&&console.log(e)}}function r(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,crossDomain:!1,ajax:t}}var i=[],a=i.forEach,o=i.slice,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e;
},n=(function(){function e(e){this.value=e}function t(t){function r(e,t){return new Promise(function(r,a){var n={key:e,arg:t,resolve:r,reject:a,next:null};s?s=s.next=n:(o=s=n,i(e,t))})}function i(r,o){try{var s=t[r](o),n=s.value;n instanceof e?Promise.resolve(n.value).then(function(e){i("next",e)},function(e){i("throw",e)}):a(s.done?"return":"normal",s.value)}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}o=o.next,o?i(o.key,o.arg):s=null}var o,s;this._invoke=r,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),c=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this.init(e,r),this.type="backend"}return c(t,[{key:"init",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=t,this.options=e(i,this.options||{},r())}},{key:"readMulti",value:function(e,t,r){var i=this.options.loadPath;"function"==typeof this.options.loadPath&&(i=this.options.loadPath(e,t));var a=this.services.interpolator.interpolate(i,{lng:e.join("+"),ns:t.join("+")});this.loadUrl(a,r)}},{key:"read",value:function(e,t,r){var i=this.options.loadPath;"function"==typeof this.options.loadPath&&(i=this.options.loadPath([e],[t]));var a=this.services.interpolator.interpolate(i,{lng:e,ns:t});this.loadUrl(a,r)}},{key:"loadUrl",value:function(e,t){var r=this;this.options.ajax(e,this.options,function(i,a){if(a.status>=500&&a.status<600)return t("failed loading "+e,!0);if(a.status>=400&&a.status<500)return t("failed loading "+e,!1);var o=void 0,s=void 0;try{o=r.options.parse(i,e)}catch(t){s="failed parsing "+e+" to json"}return s?t(s,!1):void t(null,o)})}},{key:"create",value:function(e,t,r,i){var a=this;"string"==typeof e&&(e=[e]);var o={};o[r]=i||"",e.forEach(function(e){var r=a.services.interpolator.interpolate(a.options.addPath,{lng:e,ns:t});a.options.ajax(r,a.options,function(e,t){},o)})}}]),t}();return l.type="backend",l}),define("ccLogger",[],function(){"use strict";function e(){}return e.prototype.info=function(e,t){"undefined"!=typeof console&&(void 0!==t&&null!==t?console.info("(INFO) "+e,t):console.info("(INFO) "+e))},e.prototype.debug=function(e,t){"undefined"!=typeof console&&(console.debug||"undefined"==typeof console.log||(console.debug=console.log),"undefined"!==t&&null!==t?console.debug("(DEBUG) "+e,t):console.debug("(DEBUG) "+e))},e.prototype.warn=function(e,t){"undefined"!=typeof console&&(void 0!==t&&null!==t?console.warn("(WARN) "+e,t):console.warn("(WARN) "+e))},e.prototype.error=function(e,t){"undefined"!=typeof console&&(void 0!==t&&null!==t?console.error("(ERROR) "+e,t):console.error("(ERROR) "+e))},new e}),define("ccDate",["moment","ccConstants","ccLogger"],function(e,t,r){"use strict";function i(){}return i.prototype.DEFAULT_DATE_FORMAT="MM-DD-YYYY HH:mm:ss.SSS",i.prototype.init=function(e){e!=t.DEFAULT_LANG&&(requirejs.s.contexts._.nextTick=function(e){e()},require(["momentLangs/"+e.toLowerCase()],function(){},function(t){r.warn("No language file found for locale "+e)}),requirejs.s.contexts._.nextTick=requirejs.nextTick)},i.prototype.formats={time:"LT",short:"L",medium:"LL",long:"LLL",full:"LLLL",default:"LL"},i.prototype.getDateFormat=function(t){return t?e.localeData()._longDateFormat[this.formats[t]]:e.localeData()._longDateFormat[this.formats.default]},i.prototype.setDateToTimeZone=function(t,r){var i,a,o="";return!!t&&(a=new Date,i=a.toString().split(" ")[5].split("T")[1],r&&(t=t.slice(0,19)+i),o=e(t).format())},i.prototype.formatDateForEndpoint=function(t,r){var i;return!!t&&(i=r?e(t).format():e(t))},i.prototype.dateTimeFormatter=function(t,r,i){var a,o="";return!!t&&(r?o+=r:o=i&&this.formats[i]?this.formats[i]:this.formats.default,a=e(t).format(o))},i.prototype.formatDateAndTime=function(t,r,i,a){var o=this,s="";if(!t)return"";i?s+=i:s=a&&this.formats[a]?this.formats[a]:this.formats.default;var n=null;return r?(e(t,r).isValid()||(t=e(t).format(r)),t=e(t,r).format(o.DEFAULT_DATE_FORMAT),n=e(t,o.DEFAULT_DATE_FORMAT)):n=e(t),n.format(s)},i.prototype.parseDateAndTime=function(t,r){var i=null;return t&&r?i=e(t,r):""},new i}),define("CCi18n",["i18next","i18nextBackend","pubsub","ccDate","ccRestClient","ccConstants"],function(e,t,r,i,a,o){"use strict";function s(){var e,t,r,i=[];if(this.languageSet=!1,this.languageSetComplete=!1,this.initialized=!1,this.initComplete=!1,this.localeDeferred=$.Deferred(),this.initDeferred=$.Deferred(),t=$(":root").attr("lang")){var a=t.replace("-","_").split("_");a=this.normalizeLocale(a),e=a.join("-")}if(r=$(":root").data("accepted-langs")){for(var o=r.split(","),s=!1,n=0;n<o.length;n++){var c=o[n].replace("_","-");c=c.replace("_#",""),c!==t&&("zh-CN"===c&&(c="zh-Hans"),"zh-TW"===c&&(c="zh-Hant"),i.push(c),"en"===c&&(s=!0))}s||i.push("en")}this.i18nOptions={lng:e,compatibilityJSON:"v1",compatibilityAPI:"v1",preload:["en"],fallbackLng:i.length>1?i:"en",ns:["ns.common","ns.ccformats"],defaultNs:["ns.common"],contextSeparator:":",debug:!1,useLocalStorage:!1,useCookie:!1}}return s.prototype.normalizeLocale=function(e){return 3==e.length&&""===e[1]&&(e.splice(1,1),e[1]=e[1].replace("#","")),"zh"===e[0]&&"CN"===e[1]&&(e[1]="Hans"),"zh"===e[0]&&"TW"===e[1]&&(e[1]="Hant"),e},s.prototype.init=function(i,a){this.initialized=!0;var o=this;e.use(t).init(i,function(e){o.initComplete=!0,a&&a.apply(e),$.Topic(r.topicNames.LOCALE_READY).publish(e)})},s.prototype.deferInit=function(i,a){return this.initDeferred.done(function(o,s){$.extend(i,o),e.use(t).init(i,function(e){a&&a.apply(e),s&&s.apply(e),$.Topic(r.topicNames.LOCALE_READY).publish(e)})}),this.initDeferred.promise()},s.prototype.loadNamespace=function(t,r,i){e.loadNamespaces("ns."+t,function(){var a=r;r?a.returnObjectTrees=!0:a={returnObjectTrees:!0};var o=e.t("ns."+t+":resources",a);i(o)})},s.prototype.t=e.t.bind(e),s.prototype.addResourceBundle=function(t,r,i,a,o){e.addResourceBundle(t,r,i,a,o)},s.prototype.setLocale=function(t,a){var o=function(o){i.init(t),t!==e.lng()&&e.setLng(t,function(e){$.Topic(r.topicNames.LOCALE_SET).publish(t),a&&a.apply(e)})};this.initialized||this.initDeferred.isResolved?o():(this.initDeferred.resolve({fallbackLng:t,lng:t},a),this.localeDeferred.done(o))},s.prototype.setLocaleOnce=function(e,t){var r=e.replace("-","_").split("_");if("zh"===r[0]&&(r=this.normalizeLocale(r),e=r.join("-")),this.languageSet)this.languageSetComplete?t&&t.call(this):this.localeDeferred.done(t);else{var i=this;this.setLocale(e,function(e){t&&t.apply(this,e),i.languageSetComplete=!0,i.localeDeferred.resolve()}),this.languageSet=!0}},s.prototype.loadResources=function(e,t,r,i){var s={};s.locale=e;var n=function(e){if(e.hasOwnProperty(o.RESOURCES_KEY)){var t={};t.resources=e[o.RESOURCES_KEY],i(null,t)}else c(e)},c=function(e){a.commonErrorCallback(e,e.status),e.hasOwnProperty(o.ERRORS_KEY)&&i(e[o.ERRORS_KEY],null)};a.request(o.ENDPOINT_RESOURCES_GET_BUNDLE,s,n,c,t)},s.prototype.getLanguagesToResolveHierarchy=function(t){var r=e.services.languageUtils.toResolveHierarchy(t);return r},s.prototype.ajax=function(e,t,r){var i=e.match(/\/(ns\..*)\?locale=(.*)/),s=i[1],n=i[2],c={};c.locale=n;var l=function(e){if(e.hasOwnProperty(o.RESOURCES_KEY)){var t={};t.resources=e[o.RESOURCES_KEY],r(JSON.stringify(t),{status:200})}else d(e)},d=function(e){a.commonErrorCallback(e,e.status),e.hasOwnProperty(o.ERRORS_KEY)&&r(e[o.ERRORS_KEY],{status:e.status})};a.request(o.ENDPOINT_RESOURCES_GET_BUNDLE,c,l,d,s)},new s}),define("ccPasswordValidator",["knockout","CCi18n"],function(e,t){"use strict";function r(){}return r.prototype.LOWER_CASE_LETTERS="abcdefghijklmnopqrstuvwxyz",r.prototype.UPPER_CASE_LETTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.prototype.NUMBER_LIST="0123456789",r.prototype.SYMBOLS_LIST="~!@#$%^&*()_-+={}[]|:;<>,./?",r.prototype.embeddedAssistance="",r.prototype.validate=function(e,t,r,i){var a=this;if(!r)return!0;var o=r.useMinPasswordLength,s=r.minPasswordLength,n=r.cannotUseUsername,c=r.useMixedCase,l=r.useNumber,d=r.useSymbol,u=r.allowedSymbols,p=(r.cannotUsePreviousPasswords,r.numberOfPreviousPasswords,!1);null!=e&&void 0!=e&&""!=e||(p=!0);var h,g=!1;"true"==o&&e.length<s&&(g=!0),"true"==n&&""!=t&&e.toLowerCase()===t.toLowerCase()&&(g=!0),"true"==l&&(h=a.checkAgainst(e,a.NUMBER_LIST),h||(g=!0)),"true"==d&&(h=a.checkAgainst(e,u),h||(g=!0)),"true"==c&&(h=a.hasMixedCase(e),h||(g=!0));var f=!1;return g?(f=!1,a.embeddedAssistance=a.getAllEmbeddedAssistance(r,i)):(a.embeddedAssistance="",f=!0),!!p||f},r.prototype.getAllEmbeddedAssistance=function(e,r){var i=e.useMinPasswordLength,a=e.minPasswordLength,o=e.cannotUseUsername,s=e.useMixedCase,n=e.useNumber,c=e.useSymbol,l=e.allowedSymbols,d=e.cannotUsePreviousPasswords,u=(e.numberOfPreviousPasswords,t.t("ns.common:resources.embeddedAssistancePreText")),p=!1;return"true"==i&&(u+=" "+t.t("ns.common:resources.embeddedAssistanceMinPasswordLengthText",{min:a}),p=!0),"true"==o&&(u+=1==p?", ":" ",u+=t.t("ns.common:resources.embeddedAssistanceCannotUseUsernameText"),p=!0),"true"==n&&(u+=1==p?", ":" ",u+=t.t("ns.common:resources.embeddedAssistanceUseNumber"),p=!0),"true"==c&&(u+=1==p?", ":" ",u+=t.t("ns.common:resources.embeddedAssistanceUseSymbol",{chars:l}),p=!0),"true"==s&&(u+=1==p?", ":" ",u+=t.t("ns.common:resources.embeddedAssistanceUseMixedCase"),p=!0),1==r&&"true"==d&&(u+=1==p?", ":" ",u+=t.t("ns.common:resources.embeddedAssistanceNotInPreviousNPasswords"),p=!0),u+="."},r.prototype.hasMixedCase=function(e){var t=this,r=!1;if(null==e)return!1;for(var i=!1,a=!1,o=0;o<e.length;o++){var s=e.charAt(o);t.LOWER_CASE_LETTERS.lastIndexOf(s)!=-1&&(i=!0),t.UPPER_CASE_LETTERS.lastIndexOf(s)!=-1&&(a=!0)}return i&&a&&(r=!0),r},r.prototype.checkAgainst=function(e,t){var r=!1;if(null==e)return!1;if(0==t.length)return!0;for(var i=0;i<e.length;i++){var a=e.charAt(i);t.lastIndexOf(a)!=-1&&(r=!0)}return r},new r}),define("ccKoValidateRules",["knockout","jqueryui","koValidate","ccPasswordValidator"],function(e,t,r,i){"use strict";e.validation.rules.creditcard={validator:function(t,r){if(!r)return!1;if(!(r.iin&&r.length&&e.isObservable(r.iin)&&e.isObservable(r.length)))return!1;var i=r.iin(),a=r.length();if(!i||!a||""===i||""===a)return!1;if(!t||""===t)return"0"===a;var o=t,s=new RegExp("^("+i+")");if(!o.match(s))return!1;for(var n=a.split("|"),c="",l=0;l<n.length;l++)0!==l&&(c+="|"),c+="^[0-9]{"+n[l]+"}$";var d=new RegExp(c);if(!o.match(d))return!1;var u=function(e){for(var t=0,r=e.length,i=1;i<=r;i++){var a=parseInt(e[r-i],10);i%2==0&&(a*=2,a>9&&(a-=9)),t+=a}return t%10==0};return!!u(o)},message:"Card Number is invalid."},e.validation.rules.cvv={validator:function(t,r){if(!r)return!1;var i=0;if(i=e.isObservable(r)?r():r,i=parseInt(i,10),!t||""===t)return 0===i;var a=new RegExp("^[0-9]{"+i+"}$");return!!t.match(a)},message:"Card CVV is invalid."};var a=e.observable(!0),o=e.observable(!0);e.validation.rules.startmonth={validator:function(t,r){if(!r||!e.isObservable(r))return!1;if(!t||""===t)return!0;var i=t,o=new RegExp("^((0[1-9])|(1[0-2]))$");if(!i.match(o))return!1;if(!r())return!0;var s=new Date,n=s.getUTCFullYear(),c=s.getUTCMonth();return parseInt(r(),10)===n&&parseInt(i,10)>++c?(a(!1),!1):(a(!0),!0)},message:"Start Month is invalid."},e.validation.rules.startyear={validator:function(e){return!e||""===e||a()},message:"Start Year is invalid."},e.validation.rules.importFileName={validator:function(e){var t=[".csv"];return new RegExp("("+t.join("|").replace(/\./g,"\\.")+")$").test(e)},message:"invalid file extension."},e.validation.rules.mediaZipFileName={validator:function(e){var t=[".zip"];return new RegExp("("+t.join("|").replace(/\./g,"\\.")+")$").test(e)}},e.validation.rules.endmonth={validator:function(e,t){if(!e||""===e)return!0;var r=e,i=new RegExp("^((0[1-9])|(1[0-2]))$");if(!r.match(i))return!1;if(!t)return!0;var a=new Date,s=a.getUTCFullYear(),n=a.getUTCMonth();return parseInt(t,10)===s&&parseInt(r,10)<++n?(o(!1),!1):(o(!0),!0)},message:"End Month is invalid."},e.validation.rules.endyear={validator:function(e){return!e||""===e||o()},message:"End Year is invalid."},e.validation.rules.observablePattern={validator:function(t,r){if(!r)return!1;var i="";if(i=e.isObservable(r)?r():r,!i||""===i)return!1;if(!t||""===t)return!0;var a=new RegExp(i);return!!t.match(a)},message:"Observable Pattern Match Failed."},e.validation.rules.alphaNumeric={validator:function(e){return!e||e.match(/^[A-Za-z0-9(\s)]+$/)},message:"Field may only contain alphanumeric characters"},e.validation.rules.bool={validator:function(e){return e===!0||!e},message:"Value must be true or false"},e.validation.rules.alphaNumericWithSeperators={validator:function(e){return!e||e.match(/^[A-Za-z0-9_\-\s]+$/)},message:"Field may only contain alphanumeric characters and -, spaces, or _"},e.validation.rules.alphaNumericNoSpacesWithSeperators={validator:function(e){return!e||e.match(/^[A-Za-z0-9_\-]+$/)},message:"Field may only contain alphanumeric characters and - or _"},e.validation.rules.alphaNumericNoSpacesNoDashesWithSeperators={validator:function(e){return!e||e.match(/^[A-Za-z0-9_]+$/)},message:"Field may only contain alphanumeric characters and _"},e.validation.rules.alphaNumericNoSpacesNoDashesWithSeperators={validator:function(e){return!e||e.match(/^[A-Za-z0-9_]+$/)},message:"Field may only contain alphanumeric characters and _"},e.validation.rules.restrictSlashCharacters={validator:function(e){return!e||!e.match(/[\/\\]+/)},message:"Field may not contain forwardslash or backslash."},e.validation.rules.alphaNumericNoSpaces={validator:function(e){return!e||e.match(/^[A-Za-z0-9]+$/)},message:"Field may only contain alphanumeric characters and no spaces"},e.validation.rules.cartPicker={validator:function(e){if(!e)return!0;var t,r=e.length;for(t=0;t<r;t++){var i=parseInt(e[t].quantity,10);if(""!=e[t].productId){if(isNaN(i)||i<=0||i>=100)return!1}else if(""!=e[t].quantity)return!1}var a=0,o=[],s={};for(t=0;t<r;t++)""!=e[t].productId&&(s[e[t].productId]=0,a+=1);for(t in s)o.push(t);return!(a>o.length)},message:"Please ensure each item has a quantity specified"},e.validation.rules.cartPickerUniqueProducts={validator:function(e){if(!e)return!0;var t,r=e.length,i=0,a=[],o={};for(t=0;t<r;t++)""!=e[t].productId&&(o[e[t].productId]=0,i+=1);for(t in o)a.push(t);return!(i>a.length)},message:"Please ensure there are no Duplicate product IDs"},e.validation.rules.price={validator:function(e,t){return!t||(null===e||"undefined"==typeof e||""===e||/^\d*\.?\d+$/.test(e))},message:"Please enter a valid price"},e.validation.rules.laterDate={validator:function(e,t){var r,i,a;return!!e&&(r=new Date(e),i=new Date,a=i-r,a<0)},message:"Please enter a proper date"},e.validation.rules.url={validator:function(e,t){if("boolean"==typeof t&&!t)return!0;if(t instanceof Object&&t.validate&&t.validate===!1)return!0;var r=!1;t instanceof Object&&t.protocolOptional&&(r=t.protocolOptional);var i=/^(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!-\/]))?$/,a=/^(ftp|http|https)?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!-\/]))?$/;if(e){for(var o=e.split("\n"),s=[],n=0;n<o.length;n++)for(var c=o[n].split(","),l=0;l<c.length;l++)s.push(c[l]);for(var d=/^(ftp|http|https):\/\//,u=/:\/\//,p=0;p<s.length;p++)if(!r||u.test(s[p].trim())||d.test(s[p].trim())){if(!a.test(s[p].trim()))return!1}else if(!i.test(s[p].trim()))return!1;return!0}return!0},message:"Please enter a valid URL"},e.validation.rules.absoluteOrRelativeURL={validator:function(e,t){if(!t)return!0;var r=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))?\.?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i,i=/^\/\S*$/i;return!e||!(!r.test(e)&&!i.test(e))},message:"Please enter a valid URL"},e.validation.rules.number={validator:function(e,t){return!t||(null===e||"undefined"==typeof e||""===e||t&&/^-?\d*\.?\d+$/.test(e))},message:"Please enter a number"},e.validation.rules.match={getValue:function(e){return"function"==typeof e?e():e},validator:function(e,t){return e===this.getValue(t)},message:"Values must match"},e.validation.rules.propertyIdAlreadyInUse={validator:function(e,t){var r;if(t&&e&&t.createProperty()&&t.existingPropertyids())for(var i=(t.existingPropertyids,0),a=t.existingPropertyids().length;i<a;++i)if(t.existingPropertyids()[i]&&(r=t.existingPropertyids()[i].id,r&&e.toLowerCase()===r.toLowerCase()))return!1;return!0},message:"Property Id is already in use"},e.validation.rules.propertyNameAlreadyInUse={validator:function(e,t){var r;if(t&&e&&t.existingPropertyName())for(var i=(t.existingPropertyName,0),a=t.existingPropertyName().length;i<a;++i)if(t.existingPropertyName()[i]&&(r=t.existingPropertyName()[i].displayName))if(t.createProperty()){if(e.toLowerCase()===r.toLowerCase())return!1}else if(""!=t.prevPropertyName()&&null!=t.prevPropertyName()&&e.toLowerCase()!==t.prevPropertyName().toLowerCase()&&e.toLowerCase()===r.toLowerCase())return!1;return!0},message:"Property Name is already in use"},e.validation.rules.password={validator:function(t,r){var a=r.login(),o=r.policies(),s=r.observable,n=r.includePreviousNPasswordRule(),c=i.validate(t,a,o,n);return s.embeddedAssistance=e.observable(i.embeddedAssistance),c},message:"The password entered does not comply with the password policy"},e.validation.rules.uniqueTrimmed={validator:function(t,r){return e.validation.rules.unique.validator(t.trim(),r)}},e.validation.rules.uniqueTrimmedCaseInsensitive={validator:function(t,r){return!t||e.validation.rules.uniqueTrimmed.validator(t.toLowerCase(),r)}},e.validation.rules.maxItemQuantity={validator:function(e,t){if(t&&e){if(t.orderableQuantity&&t.totalQuantity&&t.totalQuantity(!0)>t.orderableQuantity)return!1;if(t.orderLimit&&t.orderLimit<t.totalQuantity(!1))return!1;if("number"==typeof t&&e>t)return!1;if(t.childItems)for(var r=0;r<t.childItems.length;r++){var i=t.childItems[r].productId;if(t.totalQuantity&&t.totalQuantity(!1,i)>t.childItems[r].orderableQuantity)return!1}}return!0}},e.validation.registerExtenders()}),define("pageLayout/simple-cache",["knockout"],function(e){"use strict";function t(){return this.cache={},this}return t.prototype.set=function(e,t,r){var i;this.cache[e]?i=this.cache[e]:(i={},this.cache[e]=i),i[t]=r},t.prototype.get=function(e,t){var r;return this.cache[e]&&(r=this.cache[e][t],r||null===r||r===!1)?{result:r,hit:!0}:{result:null,hit:!1}},t.prototype.flush=function(){this.cache={}},t}),define("navigation",["jquery","crossroads","hasher","pubsub","storageApi","ccConstants","ccRestClient"],function(e,t,r,i,a,o,s){"use strict";function n(){var t,n=this,c=e.Deferred();e.Topic(i.topicNames.USER_UNAUTHORIZED).subscribe(function(e){n.loginHandlerPage=n.getPath(),c.done(function(){t(e)})}),n.setHash=function(e){r.setHash(e)},n.getHash=function(){return r.getHash()},n.setLoginHandler=function(e){t=e,c.resolve()},n.checkLogin=function(e){if(e.indexOf("?loggedIn=false")>-1){var r=e.indexOf("page=")+5,i=decodeURIComponent(e.substr(r));i.indexOf("&")>-1&&(i=i.substr(0,i.indexOf("&"))),i="/"===i.charAt(0)?i:"/"+i;var a=[{message:"success",linkToRedirect:i}];"/"==e.charAt(0)?n.loginHandlerPage=e.substr(1,e.indexOf("?")-1):n.loginHandlerPage=e.substr(0,e.indexOf("?")-1),c.done(function(){t(a)})}},n.goTo=function(t,r,a){var c=n.getPathWithLocale(t),l=s.profileType==o.PROFILE_TYPE_AGENT?window.applicationContextPath:"";if(l.length>0&&0!=c.indexOf(l)&&(c=l+c),r)e.Topic(i.topicNames.HISTORY_PUSH_STATE).publish(c);else if(window.history&&window.history.pushState)a?window.history.replaceState(null,"",c):window.history.pushState(null,"",c),e.Topic(i.topicNames.HISTORY_PUSH_STATE).publish(c),n.checkLogin&&n.checkLogin(t);else{var d=n.getBaseURL()+("/"===c.charAt(0)?c:"/"+c);window.location.assign(d)}},n.getPath=function(){var e=window.location.pathname;return"/"===e.charAt(0)&&(e=e.substr(1)),e},n.getRelativePath=function(){var e=window.location.pathname;return"/"!==e.charAt(0)&&(e="/"+e),e},n.isPathEqualTo=function(e){if(e){var t=n.getPathWithoutLocale(),r=n.getPathWithoutLocale(e);return t="/"===t.charAt(0)?t.substr(1):t,r="/"===r.charAt(0)?r.substr(1):r,0===t.indexOf(r)}return!1},n.getQueryString=function(){return window.location.search},n.getBaseURL=function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var e=window.siteBaseURLPath;return e&&"/"!==e?"/"===e.substr(0,1)?window.location.origin+e:window.location.origin+"/"+e:window.location.origin},n.getPathWithoutLocale=function(e){var t=e?e:window.location.pathname+window.location.search;if(t=n.getPathWithoutSiteBasePath(t),window.urlLocale){var r=JSON.parse(window.urlLocale)[0].name,i=t.split("/");if(i.length>=2)for(var a=0;a<i.length;a++)i[a]===r&&(t=t==="/"+i[a]?"/":t.replace("/"+i[a]+"/","/"))}return t},n.getPathWithoutSiteBasePath=function(e){var t=e?e:window.location.pathname+window.location.search,r=!1,i=window.siteBaseURLPath?window.siteBaseURLPath.split("/"):[];return"/"===t.substr(0,1)&&(r=!0),t=t.split("/").filter(function(e,t){return!(t<i.length)||e!==i[t]}).join("/"),r&&"/"!==t.substr(0,1)&&(t="/"+t),t},n.getPathWithoutApplicationContext=function(e){var t=e;if(window.applicationContextPath&&window.applicationContextPath.length>0){var r=window.applicationContextPath;t=t.replace(r,"")}return t},n.getPathWithoutFacebookContext=function(e){var t=e?e:window.location.pathname+window.location.search;if(window.FacebookCanvas){var r=t.split("/");r.length>=2&&"facebook"==r[1]&&(t=t.replace("/"+r[1],"/wishlist"))}return t},n.getPathWithoutContext=function(e){return e=n.getPathWithoutApplicationContext(e),e=n.getPathWithoutLocale(e),e=n.getPathWithoutFacebookContext(e)},n.getPathWithLocale=function(e){var t=e?e:window.location.pathname+window.location.search;if(window.urlLocale){var r=JSON.parse(window.urlLocale)[0].name;t="/"===t.charAt(0)?t:"/"+t,t.indexOf("/"+r)===-1&&(t.indexOf("/")===-1&&(t="/"+t),t="/"+r+t)}var i=window.siteBaseURLPath;return s.profileType!==o.PROFILE_TYPE_AGENT&&i&&t.substr(0,i.length)!==i?i+t:t},n.getLocaleBasedUrl=function(e){var t=window.siteBaseURLPath,r=n.getPathWithoutLocale(),i="";return i="/"!==t?n.getBaseURL()+"/"+e+r.replace(t,""):n.getBaseURL()+"/"+e+r},n.doLogin=function(e,t){if(n.getPathWithoutLocale().indexOf("?loggedIn=false")<0){var r=t?t:window.location.pathname;if(1!=a.getInstance().readFromMemory(o.CC_IS_SSO_LOGIN_UNDER_PROGRESS)){if(1==a.getInstance().readFromMemory(o.CC_IS_SSO_LOGIN_FAILURE))return;r=r+"?loggedIn=false&page="+encodeURIComponent(e),n.goTo(r)}}},n.cancelLogin=function(){n.goTo(window.location.pathname)}}return new n}),define("pageLayout/rest-adapter",["jquery","knockout","ccRestClient","ccConstants","pageLayout/simple-cache","navigation"],function(e,t,r,i,a,o){"use strict";function s(e){return this.basePath=e,this.cache=new a,this.cacheLoaders={},this.registerCacheLoader(c,this.defaultCacheLoader),this}var n=r,c="__default__";return s.prototype.restToDataTypes={widget:"widget",widgetDefinition:"widgetDefinition",layout:"layout",cart:"product",productList:"product",categoryList:"category"},s.prototype.defaultCacheLoader=function(e,t,r,i){for(var a=0;a<i.length;a++)r[a]&&r[a].id&&i[a]===r[a].id&&e.set(t,i[a],r[a])},s.prototype.registerCacheLoader=function(e,t){this.cacheLoaders[e]=t},s.prototype.getCacheLoader=function(e){return this.cacheLoaders[e]},s.prototype.reassembleDataFromCache=function(e,t){for(var r=this,i=[],a=0;a<t.length;a++)i.push(r.cache.get(e,t[a]).result);return i},s.prototype.cachedRootCategories=function(e,t){},s.prototype.cachedLoadJSON=function(e,t,r,i,a){var o,s,n=this,l=this.restToDataTypes[e],d=function(r){var a,o;o=n.getCacheLoader(e),o||(o=n.getCacheLoader(c)),l&&(s instanceof Array?s instanceof Array&&(o(n.cache,l,r,s),a=n.reassembleDataFromCache(l,t)):(o(n.cache,l,r,[s]),a=r)),i(a)};if(t instanceof Array){s=[];for(var u=0;u<t.length;u++)o=n.cache.get(l,t[u]),o.hit||s.push(t[u]);if(!(s.length>0))return n.reassembleDataFromCache(l,t);this.loadJSON(e,s,r,d,a)}else s=t,o=n.cache.get(l,t),o.hit?i(o.result):this.loadJSON(e,s,r,d,a)},s.prototype.loadJSON=function(t,r,a,s,c){var l,d,u;switch(e.isFunction(a)&&(c=s,s=a,a=null),t){case"widget":l="../shared/widget/"+r+"/non-dist/data/widget.json";break;case"widgetDefinition":l="../shared/widget/"+r+"/non-dist/data/widget.json"}if(l)return void e.ajax({url:l,dataType:"json",type:"GET",success:s,error:c});d={};var p=null,h=!1;switch(t){case"layout":l=i.ENDPOINT_PAGES_GET_PAGE,p=r,d=a;break;case"cart":if(!r||"object"!=typeof r||r.length<1)throw"Error with getting cart";a&&(d=a),d[i.CATALOG]=r[0],d[i.PRODUCT_IDS]=r[1],r[2]&&(d[i.INCLUDE_HISTORICAL]=r[2]),r[3]&&(d[i.STORE_PRICELISTGROUP_ID]=r[3]),r[4]&&(d[i.FIELDS_QUERY_PARAM]=r[4]),r[5]&&(d[i.INCLUDE_CKILD_SKUS_LISTING_IDS]=r[5]),l=i.ENDPOINT_PRODUCTS_LIST_PRODUCTS;break;case"getCurrentProfileOrder":a&&(d=a),l=i.ENDPOINT_GET_PROFILE_ORDER,u="price";break;case i.ENDPOINT_ORDERS_SEARCH:a&&(d=a),l=i.ENDPOINT_ORDERS_SEARCH;break;case"getStockStatus":a&&(d=a),p=r[1],d[i.SKU_ID]=r[0],d[i.CATALOG]=r[2],l=i.ENDPOINT_GET_PRODUCT_AVAILABILITY;break;case i.ENDPOINT_GET_INITIAL_ORDER:p=r,d=a,l=i.ENDPOINT_GET_INITIAL_ORDER;break;case"getStockStatuses":d[i.PRODUCTS_PARAM]=a.products,d[i.CATALOG]=a.catalogId,a.filterKey&&a.filterKey.length>0&&(d[i.FILTER_KEY]=a.filterKey),a.locationIds&&null!==a.locationIds&&""!==a.locationIds&&(d[i.LOCATION_IDS]=a.locationIds),a.includeDefaultLocationInventory&&null!==a.includeDefaultLocationInventory&&(d[i.INCLUDE_DEFAULT_INVENTORY_LOCATION]=a.includeDefaultLocationInventory),l=i.ENDPOINT_PRODUCTS_AVAILABILITY;break;case i.ENDPOINT_GET_PRODUCT_PRICES:p=r,a&&(d[i.SKU_ID]=a),null!=a&&a.constructor===Object&&a.filterKey&&a.filterKey.length>0&&(d[i.FILTER_KEY]=a.filterKey),l=i.ENDPOINT_GET_PRODUCT_PRICES;break;case"orderPricing":d=a,l=i.ENDPOINT_ORDERS_PRICE_ORDER,d[i.CHECKOUT]=!0,u="price";break;case i.ENDPOINT_ORDERS_CREATE_ORDER:d=a,l=i.ENDPOINT_ORDERS_CREATE_ORDER,d[i.CHECKOUT]=!0,u="price";break;case"product":if(!r||"object"!=typeof r||r.length<=1)throw"Error with getting product";a&&(d=a),d[i.CATALOG]=r[1],l=i.ENDPOINT_PRODUCTS_GET_PRODUCT,p=r[0],u="product";break;case"productList":l=i.ENDPOINT_PRODUCTS_LIST_PRODUCTS,a&&(d=a),d[i.CATEGORY]=r,d[i.INCL_CHILDREN]=!0;break;case"categoryList":if(!r||"object"!=typeof r||r.length<=1)throw"Error with getting category list";a&&(d=a),d[i.CATALOG]=r[1],d[i.CATALOG_MAXLEVEL_PARAM]=r[2],d[i.EXPAND_QUERY_PARAM]="childCategories",r[3]?d[i.FIELDS_QUERY_PARAM]=r[3]:d.filterKey||(d[i.FIELDS_QUERY_PARAM]="childCategories(items)"),h=!0,l=i.ENDPOINT_COLLECTIONS_GET_COLLECTION,p=r[0];break;case i.ENDPOINT_SEARCH_SEARCH:d=a,l=i.ENDPOINT_SEARCH_SEARCH;break;case i.ENDPOINT_SEARCH_ASSEMBLER_PAGES:d=a,l=i.ENDPOINT_SEARCH_ASSEMBLER_PAGES,p=r;break;case"assembler":d=a,l=i.ENDPOINT_ASSEMBLE,p="assemble";break;case"paymentauthresponse":p=r,d=a,l=i.ENDPOINT_PAYMENT_GET_PAYMENT_AUTH_RESPONSE;break;case"paymentGroup":a&&(d=a),p=r,l=i.ENDPOINT_GET_PAYMENT_GROUP;break;case"getUser":a&&(d=a),l=i.ENDPOINT_GET_CURRENT_USER;break;case"updateProfile":p=r,d=a,l=i.ENDPOINT_UPDATE_PROFILE;break;case"changePassword":p=null,d=a,l=i.ENDPOINT_UPDATE_PROFILE;break;case"getAllOrdersForProfile":d=a,l=i.ENDPOINT_GET_ALL_ORDERS_FOR_PROFILE;break;case"getAllOrdersCountForProfile":d=a,null===d&&(d={}),d[i.COUNT_ONLY]=!0,l=i.ENDPOINT_GET_ALL_ORDERS_FOR_PROFILE;break;case"dynamicProperties":p=r,l=i.ENDPOINT_METADATA_GET_METADATA,d=a,null===d&&(d={}),d[i.DYNAMIC_ONLY]=!0;break;case"getItemType":p=r,l=i.ENDPOINT_GET_ITEM_TYPE,d=a,null===d&&(d={}),d[i.INCLUDE_BASE]=!1,d[i.PARENT]=r;break;case"sku":if(!r||"object"!=typeof r||r.length<1)throw"Error with getting sku";a&&(d=a),d[i.CATALOG]=r[0],d[i.SKU_IDS]=r[1],d[i.PROD_STATE]=r[2],r[3]&&(d[i.STORE_PRICELISTGROUP_ID]=r[3]),l=i.ENDPOINT_PRODUCTS_LIST_SKUS;break;case"getGiftWithPurchaseChoices":l=i.ENDPOINT_GET_GIFT_CHOICES,a&&(d=a),d[i.GIFT_WITH_PURCHASE_DETAIL]=r[0],d[i.GIFT_WITH_PURCHASE_TYPE]=r[1];break;case"scheduledOrder":d=a,p=r,l=i.ENDPOINT_GET_SCHEDULED_ORDER;break;case"scheduledOrders":d=a,l=i.ENDPOINT_LIST_SCHEDULED_ORDERS_BY_PROFILE;break;case"listMembers":d=a,l=i.ENDPOINT_LIST_CONTACTS_BY_ORGANIZATION}if(!l)throw"No REST target found for item type: "+t;n.request(l,d,function(e){if(s){var t=e;h&&(t=t.items),s(t,u)}},function(e){e.status==i.HTTP_NOT_FOUND?o.goTo("/404",!0,!0):c&&e&&c(e)},p)},s.prototype.persistCreate=function(t,r,a,o,s,c){var l,d={};switch(e.isFunction(o)&&(c=s,s=o,o=null),t){case i.ENDPOINT_ORDERS_PRICE_ORDER:d=a,l=i.ENDPOINT_ORDERS_PRICE_ORDER;break;case i.ENDPOINT_ORDERS_CREATE_ORDER:d=a,l=i.ENDPOINT_ORDERS_CREATE_ORDER;break;case i.ENDPOINT_CREATE_PROFILE:d=a,l=i.ENDPOINT_CREATE_PROFILE;break;case i.ENDPOINT_FORGOT_PASSWORD:d=a,l=i.ENDPOINT_FORGOT_PASSWORD;break;case i.ENDPOINT_UPDATE_EXPIRED_PASSWORD:d=a,l=i.ENDPOINT_UPDATE_EXPIRED_PASSWORD;break;case i.ENDPOINT_SHIPPING_METHODS_LIST_SHIPPING_METHODS:d=a,l=i.ENDPOINT_SHIPPING_METHODS_LIST_SHIPPING_METHODS;break;case"product":break;case"order":d=a,null!=o&&o.incomplete?(l=i.ENDPOINT_UPDATE_PROFILE_ORDER,o.allowMultipleCart?d[i.OP]=i.CREATE_NEW_OP:d[i.OP]=i.CREATE_OP):l=i.ENDPOINT_ORDERS_CREATE_ORDER;break;case"requestQuote":d=a,l=i.ENDPOINT_QUOTE_REQUEST;break;case"rejectQuote":d=a,l=i.ENDPOINT_QUOTE_REJECT;break;case"payment":d=a,l=i.ENDPOINT_PAYMENT_AUTH_PAYMENT,d[i.SITE_ID]=o;break;case"scheduledOrder":d=a,l=i.ENDPOINT_CREATE_SCHEDULED_ORDER;break;case"addPayments":d=a,l=i.ADD_ORDER_PAYMENTS;break;case i.ENDPOINT_PRODUCT_NOTIFY:d=a,l=i.ENDPOINT_PRODUCT_NOTIFY}if(!l)throw"No REST target found for item type: "+t;n.request(l,d,s,c)},s.prototype.persistUpdate=function(t,r,a,o,s,c){var l,d,u,p,h,g,f={};console.log(t);var m=null;switch(e.isFunction(o)&&(c=s,s=o,o=null),t){case"handleOrderAmendment":d={includeShippingGroups:o.includeShippingGroups},f=a,m=r,l=i.ENDPOINT_AMEND_ORDER;break;case"product":break;case"order":f=a,l=i.ENDPOINT_UPDATE_PROFILE_ORDER,f[i.OP]=i.UPDATE_OP;break;case"updateOrder":f=a,m=r,l=i.ENDPOINT_UPDATE_ORDER;break;case"createOrder":f=a,m=r,l=i.ENDPOINT_ORDERS_CREATE_ORDER;break;case"scheduledOrder":f=a,m=r,l=i.ENDPOINT_UPDATE_SCHEDULED_ORDER;break;case"updateOrganization":f=a,m=r,l=i.ENDPOINT_UPDATE_ORGANIZATION}if(!l)throw"No REST target found for item type: "+t;n.request(l,f,s,c,m,u,p,h,g,d)},s.prototype.persistRemove=function(t,r,a,o,s){var c,l={},d=null;switch(e.isFunction(a)&&(s=o,o=a,a=null),t){case"product":break;case"order":c=i.ENDPOINT_REMOVE_PROFILE_INCOMPLETE_ORDER;break;case"scheduledOrder":c=i.ENDPOINT_DELETE_SCHEDULED_ORDER,d=r}if(!c)throw"No REST target found for item type: "+t;n.request(c,l,o,s,d)},s}),define("pageLayout/api-builder",["knockout"],function(e){"use strict";return{regionBuilder:function(e,t){},widgetBuilder:function(e,t){e.prototype.getCurrent=function(e){var r=t.viewModelBuilder[e];return r?r.scope?t.contextHandler.get(e,r.scope):t.contextHandler.get(e,"page"):t.contextHandler.get(e)},e.prototype.setCurrent=function(e,r){
var i=t.viewModelBuilder[e];i?i.scope?t.contextHandler.set(e,r,i.scope):t.contextHandler.set(e,r,"page"):t.contextHandler.set(e,r)},e.prototype.listen=function(e,r){t.contextHandler.listen(e,r)},e.prototype.load=function(e,r,i,a,o,s){t.load(e,r,i,a,o,s)},e.prototype.update=function(e,r,i,a,o,s,n){t.update(e,r,i,a,o,s,n)},e.prototype.create=function(e,r,i,a,o,s,n){t.create(e,r,i,a,o,s,n)},e.prototype.remove=function(e,r,i,a,o,s){t.remove(e,r,i,a,o,s)}}}}),define("ccNavState",["module","knockout","pubsub","ccConstants","navigation"],function(e,t,r,i,a){"use strict";function o(){var e=this;e.statusCode=t.observable(),e.referrer=t.observable(),e.slug=t.observable(),e.pageId=t.observable(),e.pageNumber=t.observable(),e.pageContext=t.observable(),e.route=t.observable(),$.Topic(r.topicNames.PAGE_VIEW_CHANGED).subscribe(function(t){t.pageId!=i.HTTP_NOT_FOUND?(e.statusCode(i.HTTP_OK),e.referrer(a.getPathWithLocale()),e.pageId(t.pageId),e.slug(t.seoslug),e.pageContext(t.contextId),e.pageNumber(t.pageNumber)):e.statusCode(i.HTTP_NOT_FOUND)})}return function(){var t;return null!=o.prototype._singleInstance?t=o.prototype._singleInstance:(t=new o,t.statusCode(e.config().statusCode),t.referrer(e.config().referrer),t.slug(e.config().slug),t.pageId(e.config().pageid),t.pageNumber(e.config().pageNumber),t.pageContext(e.config().pageContext),o.prototype._singleInstance=t),t}()}),define("routing",["jquery","crossroads","pubsub","ccConstants","navigation","ccNavState"],function(e,t,r,i,a,o){"use strict";function s(){function s(e,t){return e&&(e="/"===e.charAt(0)?e.substr(1):e),t&&(t="/"===t.charAt(0)?t.substr(1):t),e===t}function g(t,i,o){"/"==t&&(t=window.isAgentApplication?"agentHome":"home"),t="/"===t.charAt(0)?t.substr(1):t;var l=!1;t=a.getPathWithoutLocale(t),s(n,t)&&o&&(l=!0),e.Topic(r.topicNames.PAGE_PAGINATION_CHANGE).publish({page:o,paginationOnly:l},[{message:"success"}]),i&&v.shouldDecode(t)&&(i=decodeURIComponent(i));var d={path:t,parameters:i,page:o,paginationOnly:l};l?c!==i&&e.Topic(r.topicNames.PAGE_PARAMETERS_CHANGED).publish(d):v.handleViewChanged(d),n=t,c=i,p=!0}function f(e,t,r){g(e,r,t)}function m(e){o.route(e),h[e]||(h[e]={pageNumber:t.addRoute(e+"/{pageNumber}",null,800),pageNumberParameters:t.addRoute(e+"/{pageNumber}?{parameters}",null,850)},h[e].pageNumber.matched.add(function(t){f(e,t)}),h[e].pageNumberParameters.matched.add(function(t,r){f(e,t,r)}))}function I(e,t){if("category"===e.data.page.pageId){var r=e.data.page.category.route;m(r)}}function E(){var t=window.location.pathname;if("200"===o.statusCode()&&o.pageNumber()&&o.pageNumber()>1){var s="",n=t.split("/"),c=n[n.length-1];if(c===o.pageNumber()){for(var l=0;l<n.length-1;l++)""!==n[l]&&(s=s+"/"+n[l]);s=a.getPathWithoutContext(s),m(s)}}window.location.search!=i.URL_SERVERSIDE&&(t+=window.location.search),"404"===o.statusCode()&&(t="/404"),e.Topic(r.topicNames.HISTORY_PUSH_STATE).publish(t),a.checkLogin&&a.checkLogin(t)}var v=this,y=t.parse;return t.parse=function(t,i){for(var o=t,s=!0,n=0;n<u.length;n++)if(t&&t.indexOf(u[n])!==-1){s=!1;break}s&&(o=v.uriEncodeQueryString(t));var c=a.getPath(),l={oldHash:c,newHash:o};e.Topic(r.topicNames.UPDATE_HASH_CHANGES).publish(l),o=a.getPathWithoutContext(o),y.call(this,o,i)},e.Topic(r.topicNames.HISTORY_PUSH_STATE).subscribe(v.historyPushed.bind(v)),l=t.addRoute("{path*}",null,500),l.matched.add(g),d=t.addRoute("{path*}?{parameters}",null,600),d.matched.add(g),e.Topic(r.topicNames.PAGE_LAYOUT_LOADED).subscribe(I),window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){t.parse(location.pathname+location.search)}),E(),v}var n=null,c=null,l=null,d=null,u=["searchresults"],p=!1,h={};return s.prototype.uriEncodeQueryString=function(e){if(!e)return null;var t=e,r={};if(e.indexOf("?")!=-1){for(var i=e.split("?"),a=i[1].split("&"),o="",s=0;s<a.length;s++){var n=a[s].split("=");r[n[0]]=encodeURIComponent(n[1])}var c=!1;for(var l in r){var d=r[l];c&&(o+="&"),o+=l+"="+d,c=!0}t=i[0]+"?"+o}return t},s.prototype.historyPushed=function(e){t.parse(e)},s.prototype.handleViewChanged=function(t){e.Topic(r.topicNames.PAGE_VIEW_CHANGED).publish(t)},s.prototype.handleParametersChanged=function(t){e.Topic(r.topicNames.PAGE_PARAMETERS_CHANGED).publish(t)},s.prototype.shouldDecode=function(e){for(var t=!0,r=0;r<u.length;r++)if(u[r].indexOf(e)!==-1){t=!1;break}return t},s}),define("ccEETagProcessor",["pubsub","ccConstants","ccRestClient","jquery"],function(e,t,r,i){"use strict";function a(){}return a.prototype.excludedPages=[],a.prototype.location="",a.prototype.ccMetricsLocation="",a.prototype.configurations={},a.prototype.eeid=0,a.prototype.enabled=!0,a.prototype.tagLoaded=!1,a.prototype.metricsLoaded=!1,a.prototype.layoutId="",a.prototype.ccMetricsTracker={},a.prototype.init=function(){var a=this;a.enabled&&(a.deferred=i.Deferred(),r.request(t.ENDPOINT_GET_EE_PAGE_TAG_DATA,null,a.updateEETagDataSuccess.bind(a),a.updateEETagDataFail.bind(a)),i.Topic(e.topicNames.PAGE_READY).subscribe(function(e){""==a.location?a.deferred.done(function(){a.pageReady(e)}):a.pageReady(e)}),i.Topic(e.topicNames.PAGE_LAYOUT_LOADED).subscribe(a.setLayout.bind(a)),i.Topic(e.topicNames.PAGE_METADATA_CHANGED).subscribe(a.setLayout.bind(a)),i.Topic(e.topicNames.PAGE_VIEW_CHANGED).subscribe(a.pageChanged.bind(a)),i.Topic(e.topicNames.PAGE_CONTEXT_CHANGED).subscribe(a.pageChanged.bind(a)),i.Topic(e.topicNames.PAGE_PARAMETERS_CHANGED).subscribe(a.pageChanged.bind(a)))},a.prototype.updateEETagDataSuccess=function(e){var t=this;t.location=e.location,t.excludedPages=e.excludedPages,t.eeid=e.eeid,t.configurations=e.configurations,t.ccMetricsLocation=e.ccMetricsUrl,t.deferred.resolve()},a.prototype.updateEETagDataFail=function(t){i.Topic(e.topicNames.PAGE_READY).unsubscribe(self.pageReady.bind(self)),i.Topic(e.topicNames.PAGE_VIEW_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_CONTEXT_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_PARAMETERS_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_LAYOUT_LOADED).unsubscribe(self.setLayout.bind(self)),i.Topic(e.topicNames.PAGE_METADATA_CHANGED).unsubscribe(self.setLayout.bind(self))},a.prototype.pageReady=function(e){var t=this;t.excludedPages.indexOf(e.pageId)==-1&&t.location&&(t.tagLoaded?window.ATGSvcs&&(ATGSvcs.setCfg&&ATGSvcs.setCfg("layoutId",t.layoutId),ATGSvcs.ee&&ATGSvcs.ee.reset()):(require([t.location],function(){if(window.ATGSvcs){window.OracleUnifiedVisit&&OracleUnifiedVisit.eeid&&ATGSvcs.setEXPID?(ATGSvcs.setEEID&&ATGSvcs.setEEID(OracleUnifiedVisit.eeid),ATGSvcs.setEXPID(t.eeid)):ATGSvcs.setEEID&&ATGSvcs.setEEID(t.eeid);for(var e in t.configurations)ATGSvcs.setCfg&&ATGSvcs.setCfg(e,t.configurations[e]);ATGSvcs.setCfg&&ATGSvcs.setCfg("layoutId",t.layoutId),ATGSvcs.ee&&ATGSvcs.ee.reset()}}),t.tagLoaded=!0)),t.excludedPages.indexOf(e.pageId)==-1&&t.ccMetricsLocation&&!t.metricsLoaded&&(require([t.ccMetricsLocation],function(e){t.ccMetricsTracker=e}),t.metricsLoaded=!0)},a.prototype.pageChanged=function(e){var t=this;"undefined"!=typeof window.ATGSvcs&&window.ATGSvcs&&t.excludedPages.indexOf(e.pageId)>-1&&(ATGSvcs.stopRules&&ATGSvcs.stopRules(),delete window.ATGSvcs,require.undef(t.location),t.tagLoaded=!1),t.ccMetricsLocation&&t.excludedPages.indexOf(e.pageId)>-1&&(t.ccMetricsTracker.ccMetricUnhook&&t.ccMetricsTracker.ccMetricUnhook(),require.undef(t.ccMetricsLocation),t.metricsLoaded=!1)},a.prototype.setLayout=function(e,t){var r=this;r.layoutId=e.layout()},new a}),define("addThis",["ccConstants","ccRestClient"],function(e,t){"use strict";function r(){var r=0,i=setInterval(function(){var a=addthis.user.interests();if(void 0!==a&&void 0!==a.length&&a.length>0||100==r){clearInterval(i);var o={};o.interests=addthis.user.interests(),t.request(e.ENDPOINT_SAVE_ADDTHIS_INTERESTS,o,function(e){},function(e){})}r++},100)}window.addthis&&void 0!==window.addthis.user&&void 0!==window.addthis.user.ready&&addthis.user.ready(r)}),define("notifications",["jquery","knockout","ccConstants","CCi18n","pubsub"],function(e,t,r,i,a){"use strict";function o(){var o,s,n=this,c=0,l=65;n.enabled=!0,n.publishAccessibleMessages=!1,n.CLOSE_BUTTON_HTML='<a href="#cc-notification-close-button" class="close cc-notification-close pull-right" data-dismiss="alert"><i class="fa fa-times-circle"></i><span class="cc-reader-text">Close notification</span></a>',n.notify=function(t,r){if(n.enabled||r)if(Array.isArray(t))e.each(t,function(e,t){if(null===t.style)throw"Notification type unknown";n.notifyBuild(t)});else{if(null===t.style)throw"Notification type unknown";n.notifyBuild(t)}},n.growlSuccess=function(t,r){Array.isArray(t)?e.each(t,function(e,r){r.style="growl",r.status="success",r.close=!0,r.fade=!0,r.header=t.header||i.t("ns.common:resources.successText")}):(t.style="growl",t.status="success",t.close=!0,t.fade=!0,t.header=t.header||i.t("ns.common:resources.successText")),n.notify(t,r)},n.growlError=function(t,r){Array.isArray(t)?e.each(t,function(e,r){r.style="growl",r.status="error",r.close=!0,r.fade=!0,r.header=t.header||i.t("ns.common:resources.errorText")}):(t.style="growl",t.status="error",t.close=!0,t.fade=!0,t.header=t.header||i.t("ns.common:resources.errorText")),n.notify(t,r)},n.growlRestError=function(e,t,r){var i;e.errors&&e.errors.length>0&&(e.errors[0].message&&(t.message=e.errors[0].message),e.errors[0].errorCode&&(i=e.errors[0].errorCode)),t.code=e.errorCode||i||" ",n.growlError(t,r)},n.inlineError=function(t,r){Array.isArray(t)?e.each(t,function(e,t){t.style="inline",t.status="error",t.close=!1,t.fade=!1}):(t.style="inline",t.status="error",t.close=!1,t.fade=!1),n.notify(t,r)},n.inlineConfirm=function(t,r){Array.isArray(t)?e.each(t,function(e,t){t.style="inline",t.status="confirm",t.curtain=!0,t.close=!1,t.fade=!1}):(t.style="inline",t.status="confirm",t.curtain=!0,t.close=!1,t.fade=!1),n.notify(t,r)},n.growlInfo=function(t,r){Array.isArray(t)?e.each(t,function(e,t){t.style="growl",t.status="info",t.close=!0,t.fade=!0,t.header=this.header||i.t("ns.common:resources.warningText")}):(t.style="growl",t.status="info",t.close=!0,t.fade=!0,t.header=this.header||i.t("ns.common:resources.warningText")),n.notify(t,r)},n.okCancel=function(e,t){e.style="inline",e.status="confirm",e.curtain=!0,e.close?e.actionOptionsFocus=1:e.close=!1,e.fade=!1,e.actionOptions=[{actionOption1:[{text:e.okButtonText||i.t("ns.common:resources.okText"),classes:this.PRIMARY_BUTTON_CLASS,callback:e.okCallback}],actionOption2:[{text:e.cancelButtonText||i.t("ns.common:resources.cancelText"),classes:this.BUTTON_CLASS,callback:e.cancelCallback}]}],n.notify(e,t)},n.continueConfirm=function(e,t){e.style="inline",e.status="confirm",e.curtain=!0,e.close=!1,e.fade=!1,e.actionOptions=[{actionOption1:[{text:i.t("ns.common:resources.continueText"),action:"",classes:"btn cc-btn-primary"}]}],n.notify(e,t)},n.unsavedChangesConfirm=function(e,t){e.header=i.t("ns.common:resources.unsavedChangesHeaderText"),e.message=i.t("ns.common:resources.unsavedChangesMsgText"),e.okButtonText=e.okButtonText||i.t("ns.common:resources.saveChangesText"),e.cancelButtonText=i.t("ns.common:resources.discardChangesText"),e.okCallback=e.okCallback||e.saveCallback,e.cancelCallback=e.cancelCallback||e.discardCallback,n.okCancel(e,t)},n.clearNotifications=function(t){0!==e(t).find(".cc-notification").length&&e(t).find(".cc-notification").remove()},n.emptyNotifications=function(t){e(t).empty()},n.emptyGrowlMessages=function(){e(".cc-notification-growl").remove()},n.notifyID=function(e){var t="cc-notification-"+e+"-";return t+c},n.notifyBuild=function(o){var c,l,d,u="alert cc-notification ",p="",h="",g="",f="",m=0,I="",E=0,v="",y=!1;if(e("#cc-notification-aria-message").remove(),u+="cc-notification-"+o.style+" ",o.status&&""!==o.status&&(u+="alert-"+o.status),d=o.customNotificationID&&""!==o.customNotificationID?o.customNotificationID:n.notifyID(o.style),c=e("<div />").attr({id:d,class:u}),o.close&&e(c).append(n.CLOSE_BUTTON_HTML),o.header&&(e(c).append(e("<div />").attr({class:"cc-notification-header"}).html(e("<div />").text(o.header).html())),I+=o.header+" "),o.message&&(v="cc-notification-message"+(o.header?"":" cc-notification-message-only"),"string"!=typeof o.message?e.each(o.message,function(t,r){e(c).append(e("<div />").attr("class",v).html(e("<div />").text(r).html())),I+=r}):(e(c).append(e("<div />").attr("class",v).html(e("<div />").text(o.message).html())),I+=o.message)),o.template){var b=n.parseTemplateUrl(o.template),T=e("<div/>").attr("data-bind",'template: {name: "'+b.name+'", templateUrl: "'+b.url+'"}');e(c).append(T),t.applyBindings(o.templateData,T.get(0))}if(o.actionOptions&&(y=n.hasCallbacks(o.actionOptions[0]),l=e("<div />").attr("class","cc-notification-actions"),"inline"===o.style&&o.curtain===!0&&(e(c).addClass("cc-notification-with-curtain"),h="$('.cc-curtain').remove();",g="$(this).closest('.cc-notification-inline').remove();$('body').removeClass('no-scroll');",g+="if($('.cc-notification-outer').length > 0) {$('.cc-notification-outer').remove();}",o.modal===!0&&e(o.id).parent(".modal").on("hidden",function(){e(".cc-curtain").remove()})),e.each(o.actionOptions[0],function(t,r){f="",r[0].onCloseFocus&&(f="$('"+r[0].onCloseFocus+"').notificationsSetFocus();");var i="";r[0].readerText&&(i=r[0].readerText),y?e(l).append(e("<button />").attr({id:"cc-notification-actionbutton-"+t,class:"cc-notification-actionbutton-class "+r[0].classes}).attr("data-bind","makeAccess: {readerText: "+i+"}").text(r[0].text)):e(l).append(e("<button />").attr({class:r[0].classes,onClick:g+h+f+r[0].action}).attr("data-bind","makeAccess: {readerText: "+i+"}").text(r[0].text))}),e(c).append(l)),o.formErrors){var P,S,C=e("<div />").attr("class","cc-notification-errorFields").append(e("<ul />"));e.each(o.formErrors,function(t,r){p="$('#"+r.formId+"').notificationsSetFocus()",o.focusFunction?C.append(e("<li />").append(e("<a />").attr({href:"javascript:void(0);"}).text(r.label).on("click",function(){o.focusFunction(r.formId)}))):1===e("#"+r.formId).parents(".tab-pane").length?(S=e("#"+r.formId).parents(".tab-pane"),1===e("#"+S[0].id).closest(".modal").length?P=e("#"+S[0].id).closest(".modal").find(".cc-alta-nav-tabs a[href='#"+S[0].id+"']").parent():(P=e("#tab-"+S[0].id),0===P.length&&(P=e("#"+S[0].id).closest(".panel").find(".cc-alta-nav-tabs a[href='#"+S[0].id+"']").parent())),C.append(e("<li />").append(e("<a />").attr({href:"javascript:void(0);",onClick:"$('#"+P[0].id+" a').tab('show');$('#"+r.formId+"').notificationsSetFocus()"}).text(r.label)))):C.append(e("<li />").append(e("<a />").attr({href:"javascript:void(0);",onClick:"$('#"+r.formId+"').notificationsSetFocus()"}).text(r.label))),I+=" "+r.label}),e(c).append(C)}if(n.publishAccessibleMessages){var A="error"===o.status||"danger"===o.status||"confirm"===o.status;e.Topic(a.topicNames.ARIA_ANNOUNCEMENT_REQUESTED).publish(I,A)}else e("body").prepend(e("<div />").attr({id:"cc-notification-aria-message",class:"cc-reader-text",role:"alert","aria-relevant":"additions removals","aria-live":"assertive"}).text(I));if(o.code){var _=i.t("ns.common:resources.returnCodeLabel");e(c).append(e("<div />").attr({class:"cc-notification-errorCode"}).text(_+": "+o.code))}if("inline"==o.style?o.curtain===!0?(e(c).addClass("cc-inline-curtain"),s=e("<div />").attr({class:"cc-notification-outer"}),e(o.id).prepend(e(s).append(e(c)))):e(o.id).hasClass("oj-tabs")?e(o.id).children("div").each(function(){e(this).prepend(e(c).clone(!0))}):e(o.id).prepend(e(c)):"growl"==o.style&&(e("body").append(e(c)),n.notifyTop(),e(c).bind("closed",function(){setTimeout(function(){n.notifyTop()},100);n.notifyFocus()})),e(".cc-notification-close").on("click",function(){var t=e(".cc-notification-outer");if(e("body").hasClass("no-scroll")&&e("body").removeClass("no-scroll"),e(".cc-curtain")&&e(".cc-curtain").remove(),t){var r=t.parent();e(".cc-notification-outer").remove(),e(r).find(":tabbable").first().focus()}o.closeHandler&&o.closeHandler()}),y&&e.each(o.actionOptions[0],function(t,r){var i=e("#cc-notification-actionbutton-"+t);i&&i.on("click",function(){"inline"===o.style&&o.curtain===!0&&(e(this).closest(".cc-notification-inline").remove(),e(this).closest(".cc-notification-growl").remove(),e("body").removeClass("no-scroll"),e(".cc-notification-outer").length>0&&e(".cc-notification-outer").remove(),e(".cc-curtain").remove()),r[0].onCloseFocus&&e(r[0].onCloseFocus).notificationsSetFocus(),n.cleanUp(),r[0].callback&&r[0].callback()})}),o.fade!==!1){var O=r.NOTIFICATION_FADE_DEFAULT;o.fade!==!0&&(O=o.fade);var R=r.NOTIFICATION_DELAY_DEFAULT;o.delay&&(R=o.delay),e(c).delay(R).fadeOut(O,n.doFade),e(c).mouseenter(function(){e(this).stop(!0,!0)}),e(c).mouseleave(function(){e(this).fadeOut(O,n.doFade)})}o.curtain===!0&&("inline"===o.style?0!==e(o.id).parents(".modal-content").length?e(o.id).parents(".modal-content").append(e("<div />").attr("class","cc-curtain fade in")):(e(o.id).append(e("<div />").attr("class","cc-curtain fade in").attr("style","z-index:1042")),window.scrollTo(0,e(o.id).offset().top),window.setTimeout(function(){e("body").addClass("no-scroll")},0)):e("body").append(e("<div />").attr("class","modal-backdrop fade in")),E=e(".cc-notification-with-curtain :tabbable"),m=E.length,E.each(function(t){e(this).on("keydown",function(t){if(9===t.keyCode){var r;t.shiftKey?(r=parseInt(E.index(e(this)),10)-1,r<0&&(t.preventDefault(),E[m-1].focus())):(r=parseInt(E.index(e(this)),10)+1,r===m&&(t.preventDefault(),E[0].focus()))}})}),o.actionOptionsFocus?e(E[o.actionOptionsFocus]).focus():e(E[0]).focus())},n.doFade=function(){e(this).remove(),e("#notification-info").text("");setTimeout(function(){n.notifyTop()},100);n.notifyFocus()},n.notifyTop=function(){o=e("body").children(".cc-notification-growl"),o.length>=0&&e.each(o,function(t,r){t>0&&(l+=30),e(r).css("top",l),l+=e(r).height()}),l=65},n.notifyFocus=function(){e("#CC-Oracle-Nav UL.nav.nav-pills LI A:first").focus()},n.parseTemplateUrl=function(e){for(""!==infuser.defaults.templateSuffix&&e.indexOf(".")>=0&&(e=e.substring(0,e.lastIndexOf(".")));0===e.indexOf("/");)e=e.substring(1);return{url:e.substring(0,e.lastIndexOf("/")),name:e.substring(e.lastIndexOf("/")+1)}},n.cleanUp=function(){var t=e(".cc-notification-actionbutton-class");t&&t.off("click");var r=e(".cc-notification-close");r&&r.off("click")},n.hasCallbacks=function(t){var r=!1;return e.each(t,function(e,t){t[0].callback&&(r=!0)}),r},n.overlayId="#cc-overlay-clone",n.createNotificationOverlay=function(){var t=e('div[id$="_layer_overlay"]');if(t){var r=t.clone();r.attr("id","cc-overlay-clone"),r.css("opacity","1"),r.css("background","none"),e("#__oj_zorder_container").append(r),r.zIndex(r.zIndex()+1)}},n.destroyNotificationOverlay=function(){var t=e("#cc-overlay-clone");t&&t.length>0&&t.remove()}}return e.fn.notificationsSetFocus=function(){this.is(":visible")?this.focus():this.triggerHandler("focus"),this.data&&this.data().select2&&this.select2("open")},o.prototype.PRIMARY_BUTTON_CLASS="btn cc-btn-primary pull-right",o.prototype.DEFAULT_BUTTON_CLASS="btn btn-default",o.prototype.BUTTON_CLASS="btn",new o}),define("ccOAuthTimeout",["ccConstants","jquery","pubsub","notifications","CCi18n"],function(e,t,r,i,a){"use strict";function o(o){var s=!0,n=null,c=e.TOKEN_WARNING_TIMEOUT,l=null,d=null,u=null,p="cc-warn-session-timeout-alert",h="cc-expire-session-alert",g=function(){t.Topic(r.topicNames.USER_SESSION_VALID).publish(),o.storeRequestWasMade=!1,s=!1,T()},f=function(){var t=function(e){};o.loggedIn&&(s||o.storeRequestWasMade)&&o.refresh(function(t){var r=t.expires_in;if(r){var i=1e3*r-e.TOKEN_EXPIRED_MESSAGE_TIMEOUT;c=Math.max(i,e.TOKEN_REFRESH_INTERVAL+1e4)}g()},t)},m=function(){o.loggedIn&&null==n&&(n=setInterval(f,e.TOKEN_REFRESH_INTERVAL))},I=function(){n&&(clearInterval(n),n=null)},E=function(){if(u=t(document.activeElement),u.is("iframe"))try{u=t(document.activeElement.contentWindow.document.activeElement)}catch(e){}},v=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&0==t(".cc-notification").length&&(E(),i.notify([{style:"inline",id:"#cc-message-center",customNotificationID:p,status:"confirm",curtain:!0,close:!1,fade:!1,header:a.t("ns.common:resources.sessionTimeoutHeader"),message:a.t("ns.common:resources.sessionTimeoutMessage"),actionOptions:[{actionOption1:[{text:a.t("ns.common:resources.okText"),action:"",classes:"btn cc-submit-changes-btn cc-btn-primary"}]}]}]),t("button","#"+p).each(function(){var e=this.onclick.bind(this);t(this).prop("onclick",null).on("click",function(){C(),f(),u&&u.focus(),e instanceof Function&&e()})}),t("#"+p).closest("div.cc-notification-outer").next("div.cc-curtain").on("click",function(){t("button","#"+p).focus()}),S())},y=function(){t("#"+p).closest("div.cc-notification-outer").next("div.cc-curtain").addBack().remove()},b=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&t("#"+p).length&&(y(),i.notify([{style:"inline",id:"#cc-message-center",customNotificationID:h,status:"confirm",curtain:!0,close:!1,fade:!1,header:a.t("ns.common:resources.sessionExpiryHeader"),message:a.t("ns.common:resources.sessionExpiryMessage"),actionOptions:[{actionOption1:[{text:a.t("ns.common:resources.okText"),action:"",classes:"btn cc-submit-changes-btn cc-btn-primary"}]}]}]),t("button","#"+h).each(function(){t(this).prop("onclick",null).on("click",function(){if(o.external&&window.idcsEnabled)window.location="sso-logout.jsp";else{var e=o.redirectToAdminLoginScreen.bind(o);o.logout(e,e)}})}),t("#"+h).closest("div.cc-notification-outer").next("div.cc-curtain").on("click",function(){t("button","#"+h).focus()}))},T=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&(P(),l=setTimeout(v,c))},P=function(){l&&(clearTimeout(l),l=null)},S=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&(C(),d=setTimeout(b,e.TOKEN_EXPIRED_MESSAGE_TIMEOUT))},C=function(){d&&(clearTimeout(d),d=null)},A=function(){t("html").off(".cctimer"),o.loggedIn&&(m(),o.profileType==e.PROFILE_TYPE_ADMIN?(T(),t("html").on("keyup.cctimer mouseup.cctimer",function(){s=!0}),o.registerLoginUpdateCallback(function(){C(),y(),g()}),o.registerLogoutUpdateCallback(function(){t("button","#"+h).trigger("click")})):o.profileType==e.PROFILE_TYPE_LAYOUT_PREVIEW&&parent.$&&t("html").on("keyup.cctimer mouseup.cctimer",function(e){parent.$("html",parent.document).trigger(e)}))},_=function(){I(),P(),C(),t("html").off(".cctimer")};o.registerInitCallback(A),t.Topic(r.topicNames.AUTH_LOGIN_SUCCESS).subscribe(A),t.Topic(r.topicNames.AUTH_LOGOUT_SUCCESS).subscribe(_),t.Topic(r.topicNames.USER_LOGIN_SUCCESSFUL).subscribe(A),t.Topic(r.topicNames.USER_AUTO_LOGIN_SUCCESSFUL).subscribe(A),t.Topic(r.topicNames.USER_LOGOUT_SUCCESSFUL).subscribe(_),t.Topic(r.topicNames.USER_SESSION_EXPIRED).subscribe(_),o.profileType==e.PROFILE_TYPE_LAYOUT_PREVIEW&&t.Topic(r.topicNames.PAGE_READY).subscribe(A)}return o}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var r in t)if(void 0!==e.style[r])return{end:t[r]};return!1}e.fn.emulateTransitionEnd=function(t){var r=!1,i=this;e(this).one(e.support.transition.end,function(){r=!0});var a=function(){r||e(i).trigger(e.support.transition.end)};return setTimeout(a,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){"use strict";var t='[data-dismiss="alert"]',r=function(r){e(r).on("click",t,this.close)};r.prototype.close=function(t){function r(){o.trigger("closed.bs.alert").remove()}var i=e(this),a=i.attr("data-target");a||(a=i.attr("href"),a=a&&a.replace(/.*(?=#[^\s]*$)/,""));var o=e(a);t&&t.preventDefault(),o.length||(o=i.hasClass("alert")?i:i.parent()),o.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one(e.support.transition.end,r).emulateTransitionEnd(150):r())};var i=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var i=e(this),a=i.data("bs.alert");a||i.data("bs.alert",a=new r(this)),"string"==typeof t&&a[t].call(i)})},e.fn.alert.Constructor=r,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",t,r.prototype.close)}(jQuery),+function(e){"use strict";var t=function(r,i){this.$element=e(r),this.options=e.extend({},t.DEFAULTS,i),this.isLoading=!1};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(t){var r="disabled",i=this.$element,a=i.is("input")?"val":"html",o=i.data();t+="Text",o.resetText||i.data("resetText",i[a]()),i[a](o[t]||this.options[t]),setTimeout(e.proxy(function(){"loadingText"==t?(this.isLoading=!0,i.addClass(r).attr(r,r)):this.isLoading&&(this.isLoading=!1,i.removeClass(r).removeAttr(r))},this),0)},t.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var r=this.$element.find("input");"radio"==r.prop("type")&&(r.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&r.prop("checked",!this.$element.hasClass("active")).trigger("change")}e&&this.$element.toggleClass("active")};var r=e.fn.button;e.fn.button=function(r){return this.each(function(){var i=e(this),a=i.data("bs.button"),o="object"==typeof r&&r;a||i.data("bs.button",a=new t(this,o)),"toggle"==r?a.toggle():r&&a.setState(r)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=r,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var r=e(t.target);r.hasClass("btn")||(r=r.closest(".btn")),r.button("toggle"),t.preventDefault()})}(jQuery),+function(e){"use strict";var t=function(t,r){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=r,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var r=this,i=this.getActiveIndex();if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){r.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){if(!this.sliding)return this.slide("next")},t.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},t.prototype.slide=function(t,r){var i=this.$element.find(".item.active"),a=r||i[t](),o=this.interval,s="next"==t?"left":"right",n="next"==t?"first":"last",c=this;if(!a.length){if(!this.options.wrap)return;a=this.$element.find(".item")[n]()}if(a.hasClass("active"))return this.sliding=!1;var l=e.Event("slide.bs.carousel",{relatedTarget:a[0],direction:s});return this.$element.trigger(l),l.isDefaultPrevented()?void 0:(this.sliding=!0,o&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(c.$indicators.children()[c.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")?(a.addClass(t),a[0].offsetWidth,i.addClass(s),a.addClass(s),i.one(e.support.transition.end,function(){a.removeClass([t,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),c.sliding=!1,setTimeout(function(){c.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*i.css("transition-duration").slice(0,-1))):(i.removeClass("active"),a.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),o&&this.cycle(),this)};var r=e.fn.carousel;e.fn.carousel=function(r){return this.each(function(){var i=e(this),a=i.data("bs.carousel"),o=e.extend({},t.DEFAULTS,i.data(),"object"==typeof r&&r),s="string"==typeof r?r:o.slide;a||i.data("bs.carousel",a=new t(this,o)),"number"==typeof r?a.to(r):s?a[s]():o.interval&&a.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=r,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var r,i=e(this),a=e(i.attr("data-target")||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),o=e.extend({},a.data(),i.data()),s=i.attr("data-slide-to");s&&(o.interval=!1),a.carousel(o),(s=i.attr("data-slide-to"))&&a.data("bs.carousel").to(s),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){"use strict";var t=function(r,i){this.$element=e(r),this.options=e.extend({},t.DEFAULTS,i),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t=e.Event("show.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var r=this.$parent&&this.$parent.find("> .panel > .in");if(r&&r.length){var i=r.data("bs.collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("bs.collapse",null)}var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0),this.transitioning=1;var o=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return o.call(this);var s=e.camelCase(["scroll",a].join("-"));this.$element.one(e.support.transition.end,e.proxy(o,this)).emulateTransitionEnd(350)[a](this.$element[0][s])}}},t.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var r=this.dimension();this.$element[r](this.$element[r]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?void this.$element[r](0).one(e.support.transition.end,e.proxy(i,this)).emulateTransitionEnd(350):i.call(this)}}},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var r=e.fn.collapse;e.fn.collapse=function(r){return this.each(function(){var i=e(this),a=i.data("bs.collapse"),o=e.extend({},t.DEFAULTS,i.data(),"object"==typeof r&&r);!a&&o.toggle&&"show"==r&&(r=!r),a||i.data("bs.collapse",a=new t(this,o)),"string"==typeof r&&a[r]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=r,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var r,i=e(this),a=i.attr("data-target")||t.preventDefault()||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),o=e(a),s=o.data("bs.collapse"),n=s?"toggle":i.data(),c=i.attr("data-parent"),l=c&&e(c);s&&s.transitioning||(l&&l.find('[data-toggle=collapse][data-parent="'+c+'"]').not(i).addClass("collapsed"),i[o.hasClass("in")?"addClass":"removeClass"]("collapsed")),o.collapse(n)})}(jQuery),+function(e){"use strict";function t(t){e(i).remove(),e(a).each(function(){var i=r(e(this)),a={relatedTarget:this};i.hasClass("open")&&(i.trigger(t=e.Event("hide.bs.dropdown",a)),
t.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",a))})}function r(t){var r=t.attr("data-target");r||(r=t.attr("href"),r=r&&/#[A-Za-z]/.test(r)&&r.replace(/.*(?=#[^\s]*$)/,""));var i=r&&e(r);return i&&i.length?i:t.parent()}var i=".dropdown-backdrop",a="[data-toggle=dropdown]",o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.prototype.toggle=function(i){var a=e(this);if(!a.is(".disabled, :disabled")){var o=r(a),s=o.hasClass("open");if(t(),!s){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t);var n={relatedTarget:this};if(o.trigger(i=e.Event("show.bs.dropdown",n)),i.isDefaultPrevented())return;o.toggleClass("open").trigger("shown.bs.dropdown",n),a.focus()}return!1}},o.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var i=e(this);if(t.preventDefault(),t.stopPropagation(),!i.is(".disabled, :disabled")){var o=r(i),s=o.hasClass("open");if(!s||s&&27==t.keyCode)return 27==t.which&&o.find(a).focus(),i.click();var n=" li:not(.divider):visible a",c=o.find("[role=menu]"+n+", [role=listbox]"+n);if(c.length){var l=c.index(c.filter(":focus"));38==t.keyCode&&l>0&&l--,40==t.keyCode&&l<c.length-1&&l++,~l||(l=0),c.eq(l).focus()}}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("bs.dropdown");i||r.data("bs.dropdown",i=new o(this)),"string"==typeof t&&i[t].call(r)})},e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",a,o.prototype.toggle).on("keydown.bs.dropdown.data-api",a+", [role=menu], [role=listbox]",o.prototype.keydown)}(jQuery),+function(e){"use strict";var t=function(t,r){this.options=r,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var r=this,i=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var i=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(document.body),r.$element.show().scrollTop(0),i&&r.$element[0].offsetWidth,r.$element.addClass("in").attr("aria-hidden",!1),r.enforceFocus();var a=e.Event("shown.bs.modal",{relatedTarget:t});i?r.$element.find(".modal-dialog").one(e.support.transition.end,function(){r.$element.focus().trigger(a)}).emulateTransitionEnd(300):r.$element.focus().trigger(a)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;if(this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;i?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var r=e.fn.modal;e.fn.modal=function(r,i){return this.each(function(){var a=e(this),o=a.data("bs.modal"),s=e.extend({},t.DEFAULTS,a.data(),"object"==typeof r&&r);o||a.data("bs.modal",o=new t(this,s)),"string"==typeof r?o[r](i):s.show&&o.show(i)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var r=e(this),i=r.attr("href"),a=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=a.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},a.data(),r.data());r.is("a")&&t.preventDefault(),a.modal(o,this).one("hide",function(){r.is(":visible")&&r.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){"use strict";var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,r,i){this.enabled=!0,this.type=t,this.$element=e(r),this.options=this.getOptions(i);for(var a=this.options.trigger.split(" "),o=a.length;o--;){var s=a[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=s){var n="hover"==s?"mouseenter":"focusin",c="hover"==s?"mouseleave":"focusout";this.$element.on(n+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(c+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},r=this.getDefaults();return this._options&&e.each(this._options,function(e,i){r[e]!=i&&(t[e]=i)}),t},t.prototype.enter=function(t){var r=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(r.timeout),r.hoverState="in",r.options.delay&&r.options.delay.show?void(r.timeout=setTimeout(function(){"in"==r.hoverState&&r.show()},r.options.delay.show)):r.show()},t.prototype.leave=function(t){var r=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(r.timeout),r.hoverState="out",r.options.delay&&r.options.delay.hide?void(r.timeout=setTimeout(function(){"out"==r.hoverState&&r.hide()},r.options.delay.hide)):r.hide()},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(t),t.isDefaultPrevented())return;var r=this,i=this.tip();this.setContent(),this.options.animation&&i.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,o=/\s?auto?\s?/i,s=o.test(a);s&&(a=a.replace(o,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(a),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var n=this.getPosition(),c=i[0].offsetWidth,l=i[0].offsetHeight;if(s){var d=this.$element.parent(),u=a,p=document.documentElement.scrollTop||document.body.scrollTop,h="body"==this.options.container?window.innerWidth:d.outerWidth(),g="body"==this.options.container?window.innerHeight:d.outerHeight(),f="body"==this.options.container?0:d.offset().left;a="bottom"==a&&n.top+n.height+l-p>g?"top":"top"==a&&n.top-p-l<0?"bottom":"right"==a&&n.right+c>h?"left":"left"==a&&n.left-c<f?"right":a,i.removeClass(u).addClass(a)}var m=this.getCalculatedOffset(a,n,c,l);this.applyPlacement(m,a),this.hoverState=null;var I=function(){r.$element.trigger("shown.bs."+r.type)};e.support.transition&&this.$tip.hasClass("fade")?i.one(e.support.transition.end,I).emulateTransitionEnd(150):I()}},t.prototype.applyPlacement=function(t,r){var i,a=this.tip(),o=a[0].offsetWidth,s=a[0].offsetHeight,n=parseInt(a.css("margin-top"),10),c=parseInt(a.css("margin-left"),10);isNaN(n)&&(n=0),isNaN(c)&&(c=0),t.top=t.top+n,t.left=t.left+c,e.offset.setOffset(a[0],e.extend({using:function(e){a.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),a.addClass("in");var l=a[0].offsetWidth,d=a[0].offsetHeight;if("top"==r&&d!=s&&(i=!0,t.top=t.top+s-d),/bottom|top/.test(r)){var u=0;t.left<0&&(u=t.left*-2,t.left=0,a.offset(t),l=a[0].offsetWidth,d=a[0].offsetHeight),this.replaceArrow(u-o+l,l,"left")}else this.replaceArrow(d-s,d,"top");i&&a.offset(t)},t.prototype.replaceArrow=function(e,t,r){this.arrow().css(r,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function t(){"in"!=r.hoverState&&i.detach(),r.$element.trigger("hidden.bs."+r.type)}var r=this,i=this.tip(),a=e.Event("hide.bs."+this.type);if(this.$element.trigger(a),!a.isDefaultPrevented())return i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i.one(e.support.transition.end,t).emulateTransitionEnd(150):t(),this.hoverState=null,this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,r,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-r/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-r/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-r}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,r=this.options;return e=t.attr("data-original-title")||("function"==typeof r.title?r.title.call(t[0]):r.title)},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var r=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;r.tip().hasClass("in")?r.leave(r):r.enter(r)},t.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var r=e.fn.tooltip;e.fn.tooltip=function(r){return this.each(function(){var i=e(this),a=i.data("bs.tooltip"),o="object"==typeof r&&r;(a||"destroy"!=r)&&(a||i.data("bs.tooltip",a=new t(this,o)),"string"==typeof r&&a[r]())})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),r=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"string"==typeof r?"html":"append":"text"](r),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var r=e.fn.popover;e.fn.popover=function(r){return this.each(function(){var i=e(this),a=i.data("bs.popover"),o="object"==typeof r&&r;(a||"destroy"!=r)&&(a||i.data("bs.popover",a=new t(this,o)),"string"==typeof r&&a[r]())})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){"use strict";function t(r,i){var a,o=e.proxy(this.process,this);this.$element=e(e(r).is("body")?window:r),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",o),this.options=e.extend({},t.DEFAULTS,i),this.selector=(this.options.target||(a=e(r).attr("href"))&&a.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var r=this;this.$body.find(this.selector).map(function(){var i=e(this),a=i.data("target")||i.attr("href"),o=/^#./.test(a)&&e(a);return o&&o.length&&o.is(":visible")&&[[o[t]().top+(!e.isWindow(r.$scrollElement.get(0))&&r.$scrollElement.scrollTop()),a]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){r.offsets.push(this[0]),r.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,r=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,i=r-this.$scrollElement.height(),a=this.offsets,o=this.targets,s=this.activeTarget;if(t>=i)return s!=(e=o.last()[0])&&this.activate(e);if(s&&t<=a[0])return s!=(e=o[0])&&this.activate(e);for(e=a.length;e--;)s!=o[e]&&t>=a[e]&&(!a[e+1]||t<=a[e+1])&&this.activate(o[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=e(r).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")};var r=e.fn.scrollspy;e.fn.scrollspy=function(r){return this.each(function(){var i=e(this),a=i.data("bs.scrollspy"),o="object"==typeof r&&r;a||i.data("bs.scrollspy",a=new t(this,o)),"string"==typeof r&&a[r]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=r,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,r=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var a=r.find(".active:last a")[0],o=e.Event("show.bs.tab",{relatedTarget:a});if(t.trigger(o),!o.isDefaultPrevented()){var s=e(i);this.activate(t.parent("li"),r),this.activate(s,s.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:a})})}}},t.prototype.activate=function(t,r,i){function a(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),i&&i()}var o=r.find("> .active"),s=i&&e.support.transition&&o.hasClass("fade");s?o.one(e.support.transition.end,a).emulateTransitionEnd(150):a(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=function(r){return this.each(function(){var i=e(this),a=i.data("bs.tab");a||i.data("bs.tab",a=new t(this)),"string"==typeof r&&a[r]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=r,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){"use strict";var t=function(r,i){this.options=e.extend({},t.DEFAULTS,i),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(r),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(t.RESET).addClass("affix");var e=this.$window.scrollTop(),r=this.$element.offset();return this.pinnedOffset=r.top-e},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var r=e(document).height(),i=this.$window.scrollTop(),a=this.$element.offset(),o=this.options.offset,s=o.top,n=o.bottom;"top"==this.affixed&&(a.top+=i),"object"!=typeof o&&(n=s=o),"function"==typeof s&&(s=o.top(this.$element)),"function"==typeof n&&(n=o.bottom(this.$element));var c=!(null!=this.unpin&&i+this.unpin<=a.top)&&(null!=n&&a.top+this.$element.height()>=r-n?"bottom":null!=s&&i<=s&&"top");if(this.affixed!==c){this.unpin&&this.$element.css("top","");var l="affix"+(c?"-"+c:""),d=e.Event(l+".bs.affix");this.$element.trigger(d),d.isDefaultPrevented()||(this.affixed=c,this.unpin="bottom"==c?this.getPinnedOffset():null,this.$element.removeClass(t.RESET).addClass(l).trigger(e.Event(l.replace("affix","affixed"))),"bottom"==c&&this.$element.offset({top:r-n-this.$element.height()}))}}};var r=e.fn.affix;e.fn.affix=function(r){return this.each(function(){var i=e(this),a=i.data("bs.affix"),o="object"==typeof r&&r;a||i.data("bs.affix",a=new t(this,o)),"string"==typeof r&&a[r]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=r,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),r=t.data();r.offset=r.offset||{},r.offsetBottom&&(r.offset.bottom=r.offsetBottom),r.offsetTop&&(r.offset.top=r.offsetTop),t.affix(r)})})}(jQuery),define("bootstrap",["jquery"],function(){}),define("ccImageZoom",["spinner"],function(e){"use strict";function t(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}(),window.cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},this.framesPerSecond=60,this.spinner=e,this.usingSpinner=!0,this.spinnerDelay=200,this.zoomDelay=800,this.smallImageClass="ccz-small",this.magnifierClass="ccz-magnifier",this.fullImageClass="ccz-full",this.flyoutClass="ccz-flyout",this.magnifierPercent=.45,this.flyoutSpacing=0,this.element=null,this.flyout=null,this.flyoutEnabled=!0,this.flyoutScaling=.8,this.magnifierEnabled=!1,this.magnifierPercentEased=.25,this.smallImageUrl=null,this.smallImageUrls=null,this.fullImageUrl=null,this.fullImageUrls=null,this.errorImageUrl=null,this.imageMetadataDefault=null,this.imageMetadatas=[],this.fullImage=null,this.smallIamge=null,this.jqBackgroundImage=null,this.loading=!1,this.magnifierMin=.1,this.magnifierMax=.9,this.magnifierVelocity=.02,this.dampingFactor=12,this.magnifierBorderWidth=2,this.zoomCurtainClassName="ccz-zoom-curtain",this.magnifierBackgroundClassName="ccz-magnifier-background",this.lastTouchDistance=0,this.currentMx=0,this.currentMy=0,this.xp=0,this.yp=0,this.offsetMagnifier=!1,this.replaceImageAtIndex=!0;var t=this;this.handleMouseWheel=function(e){e=window.event||e,e.preventDefault&&e.preventDefault();var r=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail||e.deltaY)),i=Math.max(t.magnifierMin,Math.min(t.magnifierMax,t.magnifierPercent+t.magnifierVelocity*r));return t.magnifierPercent=i,!1},this.handleMouseMove=function(e){if(!t.loading){if(t.imageLoadFailed||t.fullImageUrl.indexOf(t.errorImageUrl)!=-1)return;if(e.preventDefault(),0===e.type.indexOf("touch")){var a=e.touches||e.originalEvent.touches;if(a.length>1){var o=Math.sqrt((a[0].pageX-a[1].pageX)*(a[0].pageX-a[1].pageX)+(a[0].pageY-a[1].pageY)*(a[0].pageY-a[1].pageY));t.lastTouchDistance=o}r=a[0].pageX,i=a[0].pageY}else r=e.pageX||r,i=e.pageY||i;t.magnify_offset||(t.magnify_offset=$(t.element).offset());var s=r-t.magnify_offset.left,n=i-t.magnify_offset.top;if(t.magnifierEnabled)t.currentMx=s,t.currentMy=n;else{var c=t.jqSmallImage.width(),l=t.jqSmallImage.height(),d=t.getMagnifierWidth(),u=t.getMagnifierHeight(),p=c-d/2,h=d/2,g=l-u/2,f=u/2;t.currentMx=t.constrainValue(h,p,s),t.currentMy=t.constrainValue(f,g,n)}(s>Math.round($(this).width())||n>Math.round($(this).height())||s<0||n<0)&&t.handleMouseLeave()}},this.handleMouseLeave=function(){var e=this;clearTimeout(e.zoomTimeout),e.cancelRedraw(e),$("."+e.zoomCurtainClassName).hide(),$("."+e.magnifierBackgroundClassName).hide(),$(e.element).css({cursor:"auto"}),e.jqMagnifier.fadeOut(100),e.flyoutEnabled&&e.jqFlyout.fadeOut(100)},this.isIE=function(){return!(!navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/Edge/))},this.handleMouseEnter=function(){var e=this;e.loading||(void 0==e.jqFlyout.find("img").attr("src")&&(e.jqFlyout.find("img").attr("src",e.fullImageUrl),$.when(e.loadImage(e.fullImageUrl)).done(function(t){e.jqFullImage.attr("src",t.src)}).fail(function(t){e.imageLoadFailed=!0,e.jqFullImage.attr("src",e.errorImageUrl)})),e.magnify_offset=$(e.element).offset(),e.fullImageUrl.indexOf(e.errorImageUrl)!=-1||e.imageLoadFailed||(e.zoomTimeout=setTimeout(function(){e.magnify_offset=$(e.element).offset(),e.isIE()?$(e.element).css({cursor:"pointer"}):$(e.element).css({cursor:"zoom-in"}),e.magnifierBackgroundImage(),e.jqZoomCurtain?e.jqZoomCurtain.fadeIn(100):e.jqZoomCurtain=e.addCurtain(e.element),e.flyoutEnabled&&e.setFlyoutSizeAndPosition(),e.jqMagnifier.fadeIn(500),e.flyoutEnabled&&e.jqFlyout.fadeIn(500),e.timeoutid=e.scheduleRedraw(e)},e.zoomDelay)))}}var r,i;return t.prototype.registerMouseWheel=function(e){var t=this,r=t.jqMagnifier[0],i="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";r.addEventListener?r.addEventListener(i,t.handleMouseWheel,!1):r.attachEvent("onmousewheel",t.handleMouseWheel)},t.prototype.getMagnifierWidth=function(){var e=this,t=e.getFlyoutDimensions(),r=t.width*e.magnifierPercentEased;return r},t.prototype.getMagnifierHeight=function(){var e=this,t=e.getFlyoutDimensions(),r=t.width*e.magnifierPercentEased,i=e.flyoutEnabled?t.height*e.magnifierPercentEased:r;return i},t.prototype.getPositionMagnifierCss=function(){var e=this,t=e.jqSmallImage.width(),r=e.jqSmallImage.height(),i=e.getMagnifierWidth(),a=e.getMagnifierHeight(),o=e.offsetMagnifier?1:2,s=e.offsetMagnifier?25:0,n=e.currentMx+2*s-i/o,c=e.currentMy-s-a/o,l=e.currentMx/t,d=e.currentMy/r;e.magnifierEnabled||(n=e.constrainValue(e.magnifierBorderWidth,t-i,n),c=e.constrainValue(e.magnifierBorderWidth,r-a,c));var u=n*-1,p=c*-1;e.magnifierEnabled&&(u=(l*e.jqBackgroundImage.width()-i/2)*-1,p=(d*e.jqBackgroundImage.height()-a/2)*-1);return{css:{width:i,height:a,left:n-e.magnifierBorderWidth,top:c-e.magnifierBorderWidth},background:{left:u,top:p}}},t.prototype.getPositionFlyoutCss=function(){var e=this,t=(e.getFlyoutDimensions(),e.jqSmallImage.width()),r=e.jqSmallImage.height(),i=t/e.magnifierPercentEased,a=r/e.magnifierPercentEased,o=e.xp/t,s=e.yp/r,n=o*i-e.jqFlyout.width()/2,c=s*a-e.jqFlyout.height()/2;return e.magnifierEnabled||(n=e.constrainValue(0,i-e.jqFlyout.width(),n),c=e.constrainValue(0,a-e.jqFlyout.height(),c)),{left:-n,top:-c,width:i,height:a}},t.prototype.positionMagnifier=function(){var e=this,t=e.getPositionMagnifierCss();e.jqMagnifier.css(t.css),$("."+e.magnifierBackgroundClassName).css(t.background)},t.prototype.positionFlyout=function(){var e=this,t=e.getPositionFlyoutCss();e.jqFullImage.css(t)},t.prototype.getFlyoutDimensions=function(){var e=this,t=e.jqSmallImage.width()*e.flyoutScaling,r=e.jqSmallImage.height()*e.flyoutScaling;return{width:t,height:r}},t.prototype.setFlyoutSizeAndPosition=function(){var e=this,t=e.getFlyoutDimensions(),r=e.jqSmallImage.width()+e.flyoutSpacing+"px";e.jqFlyout.css({width:t.width,height:t.height,top:"0px",left:r})},t.prototype.magnifierBackgroundImage=function(){var e=this,t=e.magnifierEnabled?e.fullImageUrl:e.smallImageUrl;if(null!==e.jqBackgroundImage)return e.jqBackgroundImage.attr("src")!=t&&$(e.jqBackgroundImage).attr("src",t),e.jqBackgroundImage.css({width:e.jqSmallImage.width(),height:e.jqSmallImage.height()}),void e.jqBackgroundImage.show();var r=$("<img class='"+e.magnifierBackgroundClassName+"'/>");e.magnifierEnabled?r.css({position:"absolute"}):r.css({position:"absolute","max-height":"none","max-width":"none",width:e.jqSmallImage.width(),height:e.jqSmallImage.height()}),$(r).attr("src",t),e.jqBackgroundImage=r,e.jqMagnifier.append(r)},t.prototype.addCurtain=function(e){var t=this,r=$("<div class='"+t.zoomCurtainClassName+"'></div>");return r.css({display:"block",position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgb(255,255,255)",opacity:0}),$(t.element).append(r),r.animate({opacity:.25},100),r},t.prototype.loadImage=function(e){var t=function(t){function r(){o.onload=null,o.onerror=null,o.onabort=null}function i(){r(),t.resolve(o)}function a(){r(),t.reject(o)}var o=new Image;o.src=e,o.onload=i,o.onerror=a,o.onabort=a};return $.Deferred(t).promise()},t.prototype.constrainValue=function(e,t,r){return Math.max(e,Math.min(t,r))},t.prototype.cancelRedraw=function(e){cancelAnimFrame(e.timeoutid)},t.prototype.scheduleRedraw=function(e){e.timeoutid&&e.cancelRedraw(e),function t(){e.timeoutid=requestAnimFrame(t),e.xp+=(e.currentMx-e.xp)/e.dampingFactor,e.yp+=(e.currentMy-e.yp)/e.dampingFactor,e.magnifierPercentEased+=(e.magnifierPercent-e.magnifierPercentEased)/e.dampingFactor,e.flyoutEnabled&&e.positionFlyout(),e.positionMagnifier()}()},t.prototype.presentImageAtIndex=function(e){var t,r=this;r.smallImageUrl=r.smallImageUrls()[e],r.fullImageUrl=r.fullImageUrls()[e];var i={alttext:r.smallImageUrl,title:r.smallImageUrl};i=$.extend(i,r.imageMetadataDefault,r.imageMetadatas[e]),r.imageLoadFailed=!1,r.loading=!0,r.jqSmallImage.fadeTo(200,0,function(){r.jqFlyout.find("img").removeAttr("src"),r.usingSpinner&&(t=setTimeout(function(){r.spinner.create({parent:r.element})},r.spinnerDelay)),r.replaceImageAtIndex&&(r.jqSmallImage.attr("src",r.smallImageUrl),r.jqSmallImage.attr("alt",i.altText),r.jqSmallImage.attr("title",i.titleText)),r.jqFullImage.attr("title",i.titleText),r.jqFullImage.attr("alt",i.altText),$.when(r.loadImage(r.smallImageUrl)).done(function(e){r.jqSmallImage.fadeTo(200,1)}).fail(function(e){r.imageLoadFailed=!0,r.jqSmallImage.fadeTo(200,1),r.jqSmallImage.attr("src",r.errorImageUrl)}).always(function(){r.usingSpinner&&(r.loading=!1,clearTimeout(t),r.spinner.destroyAndClearTimeout())})})},t.prototype.start=function(){var e=this,t="10px";if(e.imageLoadFailed=!1,e.jqSmallImage=$(e.element).find("."+e.smallImageClass),e.jqFullImage=$(e.element).find("."+e.fullImageClass),e.jqFlyout=$(e.element).find("."+e.flyoutClass),e.jqMagnifier=$(e.element).find("."+e.magnifierClass),e.jqMagnifier.length||(e.jqMagnifier=$("<div></div>"),e.jqMagnifier.addClass(e.magnifierClass),$(e.element).append(e.jqMagnifier)),!e.jqFlyout.length&&e.flyoutEnabled){e.jqFlyout=$("<div></div>"),e.jqFlyout.css({display:"none"}),e.jqFlyout.addClass(e.flyoutClass);var r=$("<img></img>");r.css({"max-width":"none"}),r.addClass(e.fullImageClass),r.on("error",function(){e.imageLoadFailed=!0}),e.jqFlyout.append(r),e.jqFullImage=r,$(e.element).append(e.jqFlyout)}if(e.index&&(e.subHandle=e.index.subscribe(function(t){e.presentImageAtIndex(t)}),$(e.element).on("remove",function(){e.subHandle&&e.subHandle.dispose()})),e.flyoutEnabled||(t="100%"),e.element){e.registerMouseWheel(),$(e.element).css({position:"relative",display:"inline-block"}),e.jqFullImage.css({position:"absolute"}),e.jqSmallImage.css({display:"block","-webkit-touch-callout":"none"});var i={background:"#DDD",border:"1px solid #FFF","box-shadow":"0 0 15px rgba(0,0,0,0.5)",display:"none",overflow:"hidden",position:"absolute","z-index":"99"};e.jqFlyout.css(i);var a=e.magnifierBorderWidth+"px solid rgb(125,125,125)",o={position:"absolute","border-radius":t,display:"none","z-index":"98",overflow:"hidden","background-repeat":"no-repeat",border:a};e.jqMagnifier.css(o);var s=e.element;$(s).bind("touchstart",function(t){t.preventDefault(),e.magnifierEnabled&&(e.offsetMagnifier=!0),e.handleMouseEnter(),e.handleMouseMove(t)}),$(s).bind("touchend",function(t){e.handleMouseLeave(),e.offsetMagnifier=!1}),$(s).bind("touchmove",e.handleMouseMove),$(s).mousemove(e.handleMouseMove),$(s).mouseenter(function(){e.handleMouseEnter()}),$(s).mouseleave(function(){e.handleMouseLeave()})}},t}),define("ccNumber",["CCi18n"],function(e){"use strict";function t(){}return t.prototype.formatNumber=function(t,r,i){var a="ns.ccformats:resources.numberformat",o=e.t(a);o&&o!==a||(o="000,000,000.00");for(var s="",n=-1,c="",l=0,d=o.length-1;d>=0;d--)if(isNaN(parseInt(o[d],10))&&n==-1)n=l,s=o[d];else{if(n>-1&&isNaN(parseInt(o[d],10))){c=o[d];break}l++}return isNaN(i)||(n=i),this.formatNumberFromData(t,n,s,c,r)},t.prototype.formatNumberFromData=function(e,t,r,i,a){if(""===e)return"";if(isNaN(e))return"";if(0==jQuery.trim(e).length)return"";var o="";o=parseFloat(e).toFixed(t).toString(),a||(o=parseFloat(o).toString());var s=parseFloat(o)>=0?"":"-",n="",c=parseFloat(o)>=0?Math.floor(parseFloat(o)):Math.ceil(parseFloat(o));c=Math.abs(c);var l=o.indexOf(".")>-1;return l===!0&&(n=o.substring(o.indexOf(".")+1,o.length)),o="",""!==n&&(o=r+n),o=s+c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,i)+o},new t}),define("ccLazyImages",["knockout","pubsub","ccConstants"],function(e,t,r){"use strict";function i(){var t,i,a,o=this,s=200,n=new Array,c=!1,l=!1;o.THROTTLE_TIMEOUT=100,o.throttle=function(e,t){var r=null;return function(){r||(r=setTimeout(function(){e(),r=null},t))}},o.observeLazyImage=function(e,r){e.dataset.lazyLoading=!0;var s=0===n.length;n.indexOf(e)==-1&&n.push(e),t?t.observe(e):s&&(document.addEventListener("scroll",o.checkForLazyImagesToLoad),window.addEventListener("resize",o.checkForLazyImagesToLoad),window.addEventListener("orientationchange",o.checkForLazyImagesToLoad),i&&i.observe(document,{attributes:!0,
childList:!0,characterData:!0,subtree:!0})),s&&r>0&&(a=setInterval(o.loadOutOfFocusImages,1e3*r))},o.unobserveLazyImage=function(e){e.dataset.lazyLoading=!1,n=n.filter(function(t){return t!=e}),t?t.unobserve(e):0===n.length&&(document.removeEventListener("scroll",o.checkForLazyImagesToLoad),window.removeEventListener("resize",o.checkForLazyImagesToLoad),window.removeEventListener("orientationchange",o.checkForLazyImagesToLoad),i&&i.disconnect()),0==n.length&&clearInterval(a)},o.setupLazyLoadStyling=function(t,r){var i,a,o;i=e.utils.unwrapObservable(r.lazyLoadingImageClass),i||(i="ccLazyLoad"),t.classList.add(i),t.dataset.lazyLoadingImageClass=i,a=e.utils.unwrapObservable(r.lazyLoadedImageClass),a||(a="ccLazyLoaded"),t.dataset.lazyLoadedImageClass=a,o=e.utils.unwrapObservable(r.lazyLoadingParentClass),o||(o="ccLazyLoad-background"),t.parentElement.classList.add(o),t.dataset.lazyLoadingParentClass=o},o.resetLazyLoadStyling=function(e){e.dataset.lazyLoadingParentClass&&e.parentElement.classList.remove(e.dataset.lazyLoadingParentClass),e.dataset.lazyLoadingImageClass&&e.classList.remove(e.dataset.lazyLoadingImageClass),e.dataset.lazyLoadedImageClass&&e.classList.add(e.dataset.lazyLoadedImageClass)},o.loadLazyImage=function(e){var t=e.dataset.defaultErrorSrc;t||(t=r.SITE_DEFAULT_NO_IMAGE_URL);var i=e.dataset.errorSrc,a=i;a||(a=t);var s=e.dataset.errorAlt,n=e.dataset.onerror;e.onload=function(){o.resetLazyLoadStyling(e)},e.onerror=function(){o.resetLazyLoadStyling(e),e.srcset&&e.removeAttribute("srcset"),e.sizes&&e.removeAttribute("sizes");var i=new Image;i.onload=function(){e.src=a,n&&n(e),e.onerror=""},i.onerror=function(){var i=new Image;i.onload=function(){e.src=i.src,n&&n(e),e.onerror=""},i.onerror=function(){e.src=r.SITE_DEFAULT_NO_IMAGE_URL,n&&n(e),e.onerror=""},i.src=t},i.src=a,s&&(e.alt=s)},e.dataset.alt&&(e.alt=e.dataset.alt),e.dataset.title&&(e.title=e.dataset.title),e.dataset.lazyLoading=!1,e.dataset.srcset&&(e.srcset=e.dataset.srcset),e.dataset.sizes&&(e.sizes=e.dataset.sizes),e.dataset.src&&(e.src=e.dataset.src)},o.checkForLazyImagesToLoad=function(){c===!1&&(c=!0,setTimeout(function(){n.length>0&&n.forEach(function(e){o.isImageVisible(e,e.dataset.src)?(o.loadLazyImage(e),o.unobserveLazyImage(e)):document.body.contains(e)||o.unobserveLazyImage(e)}),c=!1},s))},o.checkForIntersection=function(e){if(e.isIntersecting||e.intersectionRatio>0){var t=e.target;o.loadLazyImage(t),o.unobserveLazyImage(t)}},o.reportImageRect=function(e,t){var r=window.innerHeight||document.documentElement.clientHeight;console.debug("Window height="+r+" image: top="+t.top+" bottom="+t.bottom+" height="+t.height+" for image "+e)},o.isImageVisible=function(e,t){var r=e.getBoundingClientRect();window.innerHeight||document.documentElement.clientHeight;return r.top<=window.innerHeight&&r.bottom>0},o.loadOutOfFocusImages=function(){l===!1&&(l=!0,setTimeout(function(){n.length>0&&n.forEach(function(e){document.body.contains(e)&&e.src!==e.dataset.src?(o.unobserveLazyImage(e),o.loadLazyImage(e)):document.body.contains(e)||o.unobserveLazyImage(e)}),l=!1},s))},"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&"isIntersecting"in window.IntersectionObserverEntry.prototype&&navigator.userAgent.indexOf("Edge")===-1?t=new IntersectionObserver(function(e,t){e.forEach(function(e){o.checkForIntersection(e)})}):(c=!1,this.checkForLazyImagesToLoad=this.throttle(this.checkForLazyImagesToLoad,this.THROTTLE_TIMEOUT),"MutationObserver"in window&&(i=new MutationObserver(o.checkForLazyImagesToLoad)))}return new i}),define("koExtensions",["knockout","CCi18n","ccDate","ccImageZoom","ccNumber","ccConstants","moment","ccLazyImages","jqueryui","bootstrapDatePicker","bootstrapTimePicker","spectrumColorPicker","bootstrap","chosen"],function(e,t,r,i,a,o,s,n){"use strict";function c(){function e(e,r){for(var i=0,a=r.length;i<a;i+=1)if(t(e,r[i]))return i;return-1}function t(e,t){return e===t||void 0!==e&&void 0!==t&&(null!==e&&null!==t&&(e.constructor===String?e+""==t+"":t.constructor===String&&t+""==e+""))}window.Select2.class.multi.prototype.skipDuplicateCheck=!0,window.Select2.class.multi.prototype.updateSelection=function(t){var r=[],i=[],a=this;window.Select2.class.multi.prototype.skipDuplicateCheck||($(t).each(function(){e(a.id(this),r)<0&&(r.push(a.id(this)),i.push(this))}),t=i),this.selection.find(".select2-search-choice").remove(),$(t).each(function(){a.addSelectedChoice(this)}),a.postprocessResults()},window.Select2.class.multi.prototype.setVal=function(t){var r;this.select?this.select.val(t):(r=[],window.Select2.class.multi.prototype.skipDuplicateCheck||($(t).each(function(){e(this,r)<0&&r.push(this)}),this.opts.element.val(0===r.length?"":r.join(this.opts.separator))))}}e.bindingHandlers.select2={prependLabel:function(e){if($(e)[0].labels&&$(e)[0].labels.length>0){var t=$(" <span />").attr("class","cc-reader-text").html($(e)[0].labels[0].innerHTML);$(e).select2("container").find(".select2-chosen:first-child").prepend(t)}},init:function(r,i,a){var o,s,n,c,l=i(),d=a(),u=d.lookupKey;c=e.bindingHandlers.select2,void 0!==l.ccFormatInputTooShortKey&&null!==l.ccFormatInputTooShortKey||(l.ccFormatInputTooShortKey="ns.common:resources.select2FormatInputTooShort"),void 0!==l.ccFormatInputTooLongKey&&null!==l.ccFormatInputTooLongKey||(l.ccFormatInputTooLongKey="ns.common:resources.select2FormatInputTooLong"),void 0!==l.ccFormatSelectionTooBigKey&&null!==l.ccFormatSelectionTooBigKey||(l.ccFormatSelectionTooBigKey="ns.common:resources.select2SelectionTooBig"),void 0!==l.ccFormatNoMatches&&null!==l.ccFormatNoMatches||(l.ccFormatNoMatches=t.t("ns.common:resources.select2FormatNoMatches")),void 0!==l.ccFormatLoadMore&&null!==l.ccFormatLoadMore||(l.ccFormatLoadMore=t.t("ns.common:resources.select2LoadMore")),void 0!==l.ccFormatSearching&&null!==l.ccFormatSearching||(l.ccFormatSearching=t.t("ns.common:resources.select2Searching")),void 0!==l.ccPlaceholderAdjustWidth&&null!==l.ccPlaceholderAdjustWidth||(l.ccPlaceholderAdjustWidth=!0),l.formatInputTooShort=function(e,r){var i=r-e.length,a=t.t(l.ccFormatInputTooShortKey,{numberUnder:i});return a},l.formatInputTooLong=function(e,r){var i=e.length-r,a=t.t(l.ccFormatInputTooLongKey,{numberOver:i});return a},l.formatSelectionTooBig=function(e){var r=t.t(l.ccFormatSelectionTooBigKey,{limit:e});return r},l.formatNoMatches=function(){return l.ccFormatNoMatches},l.formatLoadMore=function(e){return l.ccFormatLoadMore},l.formatSearching=function(){return l.ccFormatSearching},$(r).select2(l),$(r).select2("container").find(".select2-search-choice-close").each(function(e,r){$(r).html('<span class="cc-reader-text">'+t.t("ns.common:resources.removeText")+"</span>").attr("tabindex",0)}),$(r).select2("container").find(".select2-choices").attr("aria-label",t.t("ns.common:resources.ariaSelectedOptionsText")),$(".select2-results").attr("aria-label",t.t("ns.common:resources.ariaAvailableOptionsText")),"undefined"!=typeof d.select2.placeholder&&$(r).attr("placeholder",d.select2.placeholder),"undefined"!=typeof d.select2.ccEnabled&&$(r).select2("enable",e.utils.unwrapObservable(d.select2.ccEnabled));var p,h,g,f=!1;u&&(p=e.utils.unwrapObservable(d.value),$(r).select2("data",e.utils.arrayFirst(l.data.results,function(e){return e[u]===p}))),e.utils.domNodeDisposal.addDisposeCallback(r,function(){$(r).select2("destroy")}),p=a().value,h=a().valueUpdated,f=a().isPreselect,g=a().selectedOptions,p&&p.isModified&&p.isModified.subscribe(function(e){e&&$(r).prop("required")&&!p.isValid()?$($(r).select2("container")).addClass("invalid"):$($(r).select2("container")).removeClass("invalid")}),p&&p.subscribe(function(e){$(r).prop("required")&&!p.isValid()?$($(r).select2("container")).addClass("invalid"):$($(r).select2("container")).removeClass("invalid")}),o=!1,h?(f&&g&&h(g),$(r).on("change",function(){o||(o=!0,h($(r).val()),o=!1)})):p&&e.isObservable(p)&&$(r).on("change",function(){o||(o=!0,p($(r).val()),o=!1)}),p&&e.isObservable(p)&&$(r).on("select2-blur",function(e){$(r).val(p()).trigger("change")}),$(r).on("select2-open select2-close",function(e){d.select2.ccHideDrop&&$(".select2-drop").toggleClass("cc-select2-hideResults")}),$(r).on("change",function(e){$(r).select2("container").find(".select2-search-choice-close").each(function(e,r){$(r).html('<span class="cc-reader-text">'+t.t("ns.common:resources.removeText")+"</span>").attr("tabindex",0)}),r.selectedOptions&&r.selectedOptions[0]&&r.selectedOptions[0].label&&$(r).select2("container").find(".select2-chosen").attr("title",r.selectedOptions[0].label),c.prependLabel(r)}),"undefined"!=typeof d.select2.placeholder&&d.select2.ccPlaceholderAdjustWidth&&(s=$("<div />").attr({id:"cc-select2-placeholder-tester"}).text(d.select2.placeholder),$("body").append(s),n=$("#cc-select2-placeholder-tester").width()+30,$("body").remove("#cc-select2-placeholder-tester"),$(r).prev(".select2-container").find(".select2-input").attr("placeholder",d.select2.placeholder).css({"min-width":n+"px","max-width":n+"px"}))},update:function(t,r,i,a){var o,s=i(),n=r(),c=s.select2.initializeDataQuery,l=n.valueUpdated;if(o=e.bindingHandlers.select2,o.prependLabel(t),c){var d=i().value,u=$(t).select2("data");d&&e.isObservable(d)&&(d()&&u&&0===u.length?c(d(),function(e){$(t).select2("data",e),d.valueHasMutated(),d.isModified(!1)},n.includeInvalidItems,u):d()?d()&&u&&u.length>0&&l&&l(u):u&&u.length>0?($(t).select2("data",[]),d.valueHasMutated(),d.isModified(!1)):l&&l([]))}t.selectedOptions&&t.selectedOptions[0]&&t.selectedOptions[0].label&&$(t).select2("container").find(".select2-chosen").attr("title",t.selectedOptions[0].label)}},e.bindingHandlers.select2Tags={init:function(e,r,i){var a,o,s=r();if(void 0!==s.ccFormatNoMatches&&null!==s.ccFormatNoMatches||(s.ccFormatNoMatches=t.t("ns.common:resources.select2FormatNoMatches")),a=s.ccTagOptions?s.ccTagOptions:null,s.formatNoMatches=function(){return s.ccFormatNoMatches},s.createSearchChoice=function(r){return o=!0,$.each($(e).select2("container").find(".select2-search-choice"),function(e,t){$.trim($(t).text().toLowerCase())==$.trim(r.toLowerCase())&&(o=!1)}),o?{id:$.trim(r),text:$.trim(r)}:void window.setTimeout(function(e){$(".select2-no-results").text(t.t("ns.common:resources.select2NoDuplicateText"))},0)},c(),$(e).select2(s).on("select2-removing",function(t){$.each($(e).select2("container").find(".cc-select2-locked"),function(e,r){$.trim($(r).text())==t.val&&t.preventDefault()})}),$(e).on("change",function(r){$(e).select2("container").find(".select2-search-choice-close").each(function(e,r){$(r).html('<span class="cc-reader-text">'+t.t("ns.common:resources.removeText")+"</span>").attr("tabindex",0)})}),window.Select2.class.multi.prototype.skipDuplicateCheck=!1,a&&(a.lockExisting&&$.each($(e).select2("container").find("ul.select2-choices li.select2-search-choice"),function(e,t){$(t).addClass("cc-select2-locked")}),a.disabled&&$(e).select2("enable",!1),a.sortable)){var n=$(e).select2("container").find("ul.select2-choices").sortable({connectWith:"ul.select2-choices",items:".sorting-initialize",containment:"parent",start:function(){$(e).select2("onSortStart")},update:function(){$(e).select2("onSortEnd")}});n.find(".select2-search-choice").one("mouseenter",function(){$(this).addClass("sorting-initialize"),n.sortable("refresh")})}},update:function(e,t,r,i,a){}},e.bindingHandlers.onRender={init:function(e,t,r,i,a){var o=t();"function"==typeof o&&o(e,i)}},function(){var e,t,r,i,a=200,o=300,s=100,n=200;i=function(e){0===$(e.target).closest(".popover").length&&t()},t=function(){e&&(e.data("bs.popover").tip().off("keydown"),e.popover("destroy"),e=null,$(document).off("click",i),$(document).off("focusin",i))},r=function(e,t){var r,i,c,l;return l=$(window),r=t.top-l.scrollTop(),i=t.left-l.scrollLeft(),r<s||r<n&&"top"===e?c="bottom":(r>l.height()-s||r>l.height()-n&&"bottom"===e)&&(c="top"),i<a||i<o&&"left"===e?c="right":(i>l.width()-a||i>l.width()-o&&"right"===e)&&(c="left"),c||e}}(),function(){var t,r,i,a=1052,s=null;e.bindingHandlers.modal={init:function(n,c,l){var d,u,p,h,g,f,m,I,E,v,y,b,T,P,S=null,C="cc-modal-focus-out-active",A=c().focusFallback?c().focusFallback.split(","):null;u=$(window),d=$(n),p=d.find(".modal-body");var _=!!u[0].chrome&&!!u[0].chrome.webstore;T=function(){$(n).on("keydown.modal.cc",":text",function(e){var t=e.which||e.charCode||e.keyCode;if(27==t)return!1})},P=function(){$(n).off("keydown.modal.cc",":text")},h=function(){var e,t=0;$("body").prepend($("<div />").attr("id","cc-modalTester"));var r=!1;d.find(".modal-content").children().each(function(){this===p[0]||r||$(this).clone().appendTo("#cc-modalTester"),$(this).hasClass("modal-footer")&&(r=!0)}),t=$("#cc-modalTester").outerHeight(),$("#cc-modalTester").remove(),e=u.width()>767?.11*u.height():11,p.css({"max-height":Math.max(128,u.height()-t-e)})},g=function(e){$(e).find(".cc-focus-target").length>0?$.inArray($(e).find(".cc-focus-target")[0],$(e).find(":tabbable"))===-1?void 0!==$(e).find(".cc-focus-target :tabbable")[0]&&$(e).find(".cc-focus-target :tabbable")[0].focus():$(e).find(".cc-focus-target")[0].focus():$(e).find(":tabbable")[0]&&$(e).find(":tabbable")[0].focus()},E=function(e){1===d.has(document.activeElement).length&&(S=!0,$(document.activeElement).addClass(C))},v=function(e){S=!1,$("."+C).removeClass(C)},y=function(e){S&&e.preventDefault(),$("."+C).focus().removeClass(C)},b=function(e){S=!1},d.on("focusin",function(e){e.stopPropagation()}),d.on("show.bs.modal",function(e){$(e.target).hasClass("modal")&&(d.data("alreadyOpen")!==!0&&(d.data("alreadyOpen",!0),setTimeout(function(){d.data("bs.modal").$backdrop.css({"z-index":a-10}),d.css({"z-index":a}),t=a,a+=20,h()},1)),u.resize(h),$("body").addClass("no-scroll"),f=!0,1===$(e.relatedTarget).length&&(m=$(e.relatedTarget),m.addClass(o.MODAL_CLOSE_FOCUS),m.attr("id")&&(I=m.attr("id"))))}),d.on("shown.bs.modal",function(e){g(d),_&&(d.on("focusout",E),d.on("focus mousedown",b),d.on("keyup.dismiss.bs.modal",v),d.find("button, a").on("click",b),d.on("hide.bs.modal",y)),T()}),d.on("hide.bs.modal",function(){d.find(".modal-body").scrollTop(0)}),d.on("hidden.bs.modal",function(e){if($(e.target).hasClass("modal")){if(a-=20,r=a-20,f=!1,i=0,s=null,d.data("alreadyOpen",!1),P(),u.off("resize",h),_&&(d.off("focusout",E),d.off("focus mousedown",b),d.off("keyup.dismiss.bs.modal",v),d.find("button, a").off("click",b),d.off("hide.bs.modal",y)),S=null,d.find(".cc-curtain")&&d.find(".cc-curtain").remove(),$(n).css("left","0px"),0===$("body .modal.in").length){setTimeout(function(){$("body").removeClass("no-scroll")},0);var t=null;null!==A&&$.each(A,function(e,r){if(0!==$(r).length)return t=r,!1}),0!==$(o.MODAL_CLOSE_FOCUS_CLASS).length?($(o.MODAL_CLOSE_FOCUS_CLASS).focus(),$(o.MODAL_CLOSE_FOCUS_CLASS).removeClass(o.MODAL_CLOSE_FOCUS)):$("#"+I).length>0?$("#"+I).focus():null!==t&&window.setTimeout(function(){$(t).focus()},10)}$.each($(".modal"),function(e,t){"block"===$(t).css("display")&&$(t).css("z-index")>i&&(i=$(t).css("z-index"),s=$(t))}),g(s)}}),e.utils.domNodeDisposal.addDisposeCallback(n,function(){d.modal("hide")})}}}(),e.bindingHandlers.datepicker={init:function(t,r,i){var a=i().dpOptions||{},o=a.language?a.language:"en",s=e.bindingHandlers.datepicker;require(["bootstrapDatePickerLocales/bootstrap-datepicker."+o],function(e){s.loadDatePicker.call(s,t,r,i,a)},function(e){var n;n=o.indexOf("-")!==-1?o.split("-")[0]:"en",require(["bootstrapDatePickerLocales/bootstrap-datepicker."+n],function(e){s.loadDatePicker.call(s,t,r,i,a)},function(e){s.loadDatePicker.call(s,t,r,i,a)})})},loadDatePicker:function(t,i,a,o){var s,n,c,l,d,u,p,h=1===$(t).parents(".modal").length;h?(s="",n=$(t).parents(".tab-pane")?$(t).parents(".tab-pane"):$(t).parents(".modal-body")):s=$(t).closest(".row")[0].nextElementSibling;var g=e.utils.unwrapObservable(a().format);!g&&o.format||(o.format=r.getDateFormat(g?g:"short").toLowerCase()),$(t).datepicker(o).on("show",function(e){$.each($("body .datepicker.dropdown-menu"),function(t,r){void 0!==$(r).attr("style")&&"none"!=$(r).css("style")&&null!==s&&$(r).css({position:"absolute",top:"35px",left:"0px"}).appendTo($(e.target).parent())}),l=$(t).parents(".form-group").position().top+$(t).parents(".form-group").outerHeight(!0),d=l+240,h?(c=n.height(),d>c&&(u=d-c,n.css({height:c+u+"px"})),p=$(t).parents(".modal-body").scrollTop()+$(t).closest(".form-group").offsetParent().position().top,-$(t).parents(".modal-body").scrollTop($(t).closest(".form-group").position().top+p)):(c=$(t).parents(".form-group").offsetParent().outerHeight(!0),d>c&&(u=d-c,$(t).parents(".form-group").offsetParent().css({})))}).on("changeDate",function(e){var r=i();r(e.date),$(t).datepicker("setValue",e.date)}).on("dphide",function(){h?n.css({height:"auto"}):$(t).parents(".form-group").offsetParent().css({height:"auto"})}),e.utils.domNodeDisposal.addDisposeCallback(t,function(){$(t).datepicker("remove")})},update:function(t,r,i){var a=e.utils.unwrapObservable(i().value);if(a){var o=new Date(a);isNaN(o)||(i().value(o),$(t).datepicker("setDate",new Date(o.getTime()+6e4*o.getTimezoneOffset())))}}},e.bindingHandlers.timepicker={init:function(t,r,i){var a,o=i().Options||{};$(t).timepicker(o).on("show.timepicker",function(e){$(t).timepicker("setDefaultTime","current")}),$(t).timepicker(o).on("focus.timepicker",function(e){$(t).timepicker("showWidget")}),a=e.utils.unwrapObservable(r()),$(t).timepicker(o).on("changeTime.timepicker",function(e){var t=r();t(e.time.value)}),e.utils.domNodeDisposal.addDisposeCallback(t,function(){$(t).timepicker("remove")})}},e.bindingHandlers.spectrum={init:function(r,i,a){var o=a().defaultSettings||{};o.cancelTextKey&&(o.cancelText=t.t("ns.common:resources."+o.cancelTextKey)),o.chooseTextKey&&(o.chooseText=t.t("ns.common:resources."+o.chooseTextKey));var s="#000000",n=function(){var e=$(r).spectrum("get");"function"==typeof e.toHex&&(s="#"+e.toHex());var t=i();s!==t()&&t(s)},c=function(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r};o.hide=n,o.clickoutFiresChange=!0;var l="spectrum-input";if(r.id)l=r.id+"-spectrum-input";else{var d=new Date;l=c(d.getFullYear(),4)+c(d.getMonth()+1,2)+c(d.getDay(),2)+c(d.getHours(),2)+c(d.getMinutes(),2)+c(d.getSeconds(),2)+c(d.getMilliseconds(),3)+"-spectrum-input"}var u="class-"+l;o.className=u,$(r).spectrum(o);var p=$("<label>Color</label>",{htmlFor:l});p.attr("for",l),p.attr("class","cc-reader-text"),p.text(t.t("ns.common:resources.colorPickerInputLabel"));var h=$("."+u),g=h.find(".sp-cancel"),f=h.find(".sp-choose"),m=h.find(".sp-input-container");m.prepend(p);var I=h.find(".sp-input");I.attr("id",l);var E=e.utils.unwrapObservable(i());$(r).spectrum("set",E),e.utils.registerEventHandler(r,"change",n);var v=$(r).next(".sp-replacer");v.removeAttr("tabindex");var y=$("<a></a>",{href:"#"});v.wrap(y),e.utils.domNodeDisposal.addDisposeCallback(r,function(){var e=$(r).spectrum("get");"function"==typeof e.toHex&&(s="#"+e.toHex()),$(r).spectrum("destroy")}),y=$(r).next("a"),g.click(function(){return y.focus(),!0}),f.click(function(){return y.focus(),!0}),y.click(function(){var e=r.disabled;if(!e){var t=$(r).spectrum("container");t.appendTo(y),$(r).spectrum("toggle")}return!1})},update:function(t,r){var i=e.utils.unwrapObservable(r());$(t).spectrum("set",i)}},e.bindingHandlers.slider={init:function(t,r,i){var a=i().sliderOptions||{},o=e.utils.unwrapObservable(r());a.value=o,a.change=function(e,t){var i=r();i(t.value)},a.liveUpdate&&(a.slide=a.change),$(t).slider(a),e.utils.domNodeDisposal.addDisposeCallback(t,function(){$(t).slider("destroy")}),e.utils.registerEventHandler(t,"slidestop",function(e,t){var i=r();i(t.value)})},update:function(t,r,i){var a=i().sliderOptions||{},o=e.utils.unwrapObservable(r());isNaN(o)&&(o=a.defaultValue||0),$(t).slider("value",o),$(t).slider("option",i().sliderOptions)}},e.bindingHandlers.chosen={truncate:function(e){var t,r,i;t=$(".chosen-container").find("span").outerWidth(!0)+5,r=$(".chosen-container").width(),t>r&&e&&(i=$(".chosen-container").find("span").html().split(e),i.length>1&&$(".chosen-container").find("span").text("... "+e+" "+i[i.length-1]))},addAccessibility:function(e){var r=e.find("a.search-choice-close");$.each(r,function(){0===$(this).find(".cc-reader-text").length&&($(this).append($("<span />").attr("class","cc-reader-text").text(t.t("ns.common:resources.removeText"))),$(this).attr("tabindex","0"),$(this).on("keyup",function(t){13===t.keyCode&&($(this).trigger("click"),$(e.find(".search-field input")).focus())}))})},init:function(r,i,a,o,s){var n,c,l,d,u,p,h,g,f=e.utils.unwrapObservable(i()),m=!!f.allSelectedMessage&&f.allSelectedMessage;e.bindingHandlers.options.init(r,function(){return f.values},a,o,s),l=e.bindingHandlers.chosen,$(r).addClass("chosen-select"),$(r).chosen(f.options).trigger("chosen:ready"),d=$(r).next(),h=$(r).attr("id")+"-search-field",g=$(r).attr("data-placeholder")?$(r).attr("data-placeholder"):t.t("ns.common:resources.chosenSearchFieldDefaultLabel"),u=d.find(".search-field"),p=$("<label />").attr("class","cc-reader-text").attr("for",h).text(g),u.find("input").attr("id",h),u.prepend(p),$(r).chosen().change(function(){l.addAccessibility(d)}),$(r).on("chosen:showing_dropdown",function(){window.setTimeout(function(){0===d.find("li.active-result").length?m?d.find(".chosen-results").append($("<li />").attr("class","cc-chosen-message").html(m)):d.find(".chosen-drop").addClass("hide"):($(".cc-chosen-message").remove(),d.find(".chosen-drop").removeClass("hide"))},0)});var I=r.id+"-search";$(".chosen-search input").attr("id",I),c=a().value,n=!1,c&&e.isObservable(c)&&$(r).on("change",function(){n||(n=!0,c($(r).val()),n=!1)}),f.truncate&&$(r).on("change",l.truncate.bind(l,f.truncate))},update:function(t,r,i,a,o){var s,n,c,l=e.utils.unwrapObservable(r());$(".chosen-results").attr("tabindex","0"),c=$(t).next(),e.bindingHandlers.options.update(t,function(){return l.values},i,a,o),n=e.bindingHandlers.chosen,i().value?$(t).val(e.utils.unwrapObservable(i().value)):i().selectedOptions&&$(t).val(e.utils.unwrapObservable(i().selectedOptions)),$(t).trigger("chosen:updated"),n.addAccessibility(c),l.truncate&&(s=$(t).parents(".modal").attr("id")?"#"+$(t).parents(".modal").attr("id"):"",s?$(s).on("shown.bs.modal",function(){n.truncate(l.truncate)}):n.truncate(l.truncate))}},e.bindingHandlers.scrollAffix={update:function(t,r){var i,a,o,s,n,c,l,d,u=e.utils.unwrapObservable(r());a=e.utils.unwrapObservable(u.scrollDistance),o=e.utils.unwrapObservable(u.affixPos),s=e.utils.unwrapObservable(u.affixWidth)?e.utils.unwrapObservable(u.affixWidth):null,n=e.utils.unwrapObservable(u.affixMatchElm),c=e.utils.unwrapObservable(u.adjust),l=e.utils.unwrapObservable(u.adjustPos)?e.utils.unwrapObservable(u.adjustPos):null,i=function(){if(d=null,$(window).width()<="992")return $(t).parent().css({"min-height":"auto"}),$(t).css({position:"",top:"",width:""}),void 0!==c&&$(c).css({"margin-top":"auto"}),!1;if(s)d=s;else{if("undefined"===n||"none"===$(n).css("display"))return!1;d=$(n).outerWidth(!0)}$(window).scrollTop()>a&&null!==d?($(t).css({position:"fixed",top:o,width:d}),$(t).addClass("cc-scrollAffix"),void 0!==c&&$(c).css({"margin-top":l})):($(t).parent().css({"min-height":"auto"}),$(t).css({position:"",top:"",width:""}),$(t).removeClass("cc-scrollAffix"),void 0!==c&&$(c).css({"margin-top":"auto"}))},$(window).scroll(i),$(window).resize(i),e.utils.domNodeDisposal.addDisposeCallback(t,function(){$(window).off("scroll",i),$(window).off("resize",i)})}},e.bindingHandlers.currency={update:function(t,r,i,o,s){var n=e.utils.unwrapObservable(r()),c=parseFloat(n.price),l=n.currencyObj.symbol,d=n.nullReplace,u=n.prependNull,p=n.prependSymbol,h=n.currencyObj.fractionalDigits,g=null;if(p&&(l=p+" "+l),!c&&0!==c||isNaN(parseFloat(c)))$(t).text((l&&u?l:"")+(d?d:""));else{l.match(/^[0-9a-zA-Z]+$/)&&(l+=" ");var f=(c+"e").split("e"),n=Math.round(f[0]+"e"+(+f[1]+h));f=(n+"e").split("e"),c=+(f[0]+"e"+(+f[1]-h)),g=a.formatNumber(c,!0,h);var m=g.charAt(0);"-"===m||"+"===m?$(t).text(m+l+g.slice(1)):$(t).text(l+g)}}},e.bindingHandlers.imageSource={init:function(t,r){var i,a,o,s=!1,n=e.utils.unwrapObservable(r());"object"==typeof n&&"IMG"===t.nodeName&&(n.cacheBust&&(s=e.utils.unwrapObservable(n.cacheBust)),i=e.utils.unwrapObservable(n.src),s&&(i=d(i)),a=e.utils.unwrapObservable(n.errorSrc),i&&a&&(o=new Image,o.src=a))},update:function(t,r,i,a,s){var c,l,u,p,h,g,f,m,I,E=!1,v=!1,y=-1,b=e.utils.unwrapObservable(r());if("object"==typeof b&&"IMG"===t.nodeName){b.cacheBust&&(E=e.utils.unwrapObservable(b.cacheBust)),p=e.utils.unwrapObservable(b.src),c=e.utils.unwrapObservable(b.imageType),c||(c="small");var T=[function(e,t){var r;return e.productImages&&e.productImages.length>0&&(r=e.productImages[0].url),r},function(e,t){return e.url},function(e,t){var r,i=p[t+"Image"];return i&&(r=i.url),r},function(e,t){var r;return p instanceof Object&&p[t]&&(r=p[t]),r},function(e,t){var r,i,a,o;return i=e.childSKUs,i&&(r=i[0],r&&(a=r[t+"Image"],a&&(o=a.url))),o},function(e,t){if("string"==typeof e)return e}];if(p)for(;!u&&T.length;)u=T.shift().call(this,p,c);else u=b.errorSrc,v=!1;E&&(u=d(u)),h=e.utils.unwrapObservable(b.errorSrc),g=e.utils.unwrapObservable(b.alt),f=e.utils.unwrapObservable(b.errorAlt),m=e.utils.unwrapObservable(b.onerror);var P=s.$masterViewModel,S=e.utils.unwrapObservable(b.disableLazyImageLoading);return S||!P||!P.storeConfiguration||P.storeConfiguration.lazilyLoadImages!==!0||"prerenderReady"in window||u===h||n.isImageVisible(t,u)||(v=!0),v&&(I=e.utils.unwrapObservable(b.initialSrc),I||(I=h?h:o.SITE_DEFAULT_NO_IMAGE_URL),P.storeConfiguration.delayBeforeLoadingOutOfFocusImages&&(y=P.storeConfiguration.delayBeforeLoadingOutOfFocusImages)),h?void(u?(l=new Image,l.onload=function(){t.alt=g?g:"",v?(m&&(t.dataset.onerror=m),f&&(t.dataset.errorAlt=f),h&&(t.dataset.errorSrc=h),t.dataset.src=u,n.setupLazyLoadStyling(t,b),n.observeLazyImage(t,y),t.src=I):t.src=u},l.onerror=function(){if(v){var e=new Image;e.onload=function(){t.dataset.errorSrc=h,m&&(t.dataset.onerror=m),f&&(t.dataset.errorAlt=f),t.dataset.src=u,n.setupLazyLoadStyling(t,b),n.observeLazyImage(t,y),t.src=h},e.onerror=function(){t.src=h,f&&(t.alt=f),m&&m(t)},e.src=h}else t.src=h,t.alt=f?f:"",m&&m(t)},l.src=v?I:u):(t.src=h,f?t.alt=f:g?t.alt=g:t.alt="",m&&m(t))):(v?(m&&(t.dataset.onerror=m),f&&(t.dataset.errorAlt=f),t.dataset.src=u,n.setupLazyLoadStyling(t,b),n.observeLazyImage(t,y),t.src=I):t.src=u,void(t.alt=g?g:""))}}};var l=0;e.bindingHandlers.makeAccess={init:function(r,i){var a,o,s,n=e.utils.unwrapObservable(i());a=$('<span class="cc-reader-text"/>'),n.readerText?a.text(e.utils.unwrapObservable(n.readerText)):n.readerResource&&a.text(t.t(e.utils.unwrapObservable(n.readerResource))),n.cssContent&&"on"==n.cssContent&&(o=$(r).text(),s="cc-make-access-"+l++,$("<style>").text("."+s+':after {content: "'+o+'"}').appendTo("head"),$(r).empty().addClass(s)),$(r).prepend(a)},update:function(r,i){var a=e.utils.unwrapObservable(i());a.readerText?$(r).children(".cc-reader-text").text(e.utils.unwrapObservable(a.readerText)):a.readerResource&&$(r).children(".cc-reader-text").text(t.t(e.utils.unwrapObservable(a.readerResource)))}},e.bindingHandlers.hover={init:function(e,t){},update:function(t,r,i,a,o){var s,n,c,l,d,u=e.utils.unwrapObservable(r());if(s=t.ko_hoverClassValue)if(Array.isArray(s))for(n=0;n<s.length;n+=1)$(t).removeClass(s[n]);else if("object"==typeof s)for(c in s)s.hasOwnProperty(c)&&$(t).removeClass(s[c]);else $(t).removeClass(s);if("object"==typeof u){if("undefined"!=typeof u.if&&!e.utils.unwrapObservable(u.if))return void $(t).hover(function(){},function(){});l=e.utils.unwrapObservable(u.start),d=e.utils.unwrapObservable(u.stop),t.ko__hoverClassValue=e.utils.unwrapObservable(u.class),$(t).hover(function(e){var t,r;if(r=this.ko_hoverClassValue)if(Array.isArray(r))for(n=0;n<r.length;n+=1)$(this).addClass(r[n]);else if("Object"==typeof r)for(t in r)r.hasOwnProperty(t)&&$(this).addClass(r[c]);else $(this).addClass(r);l&&l(a,e)},function(e){var t,r,i;if(r=this.ko_hoverClassValue){if(Array.isArray(r))for(t=0;t<r.length;t+=1)$(this).removeClass(r[t]);else if("Object"==typeof r)for(i in r)r.hasOwnProperty(i)&&$(this).removeClass(r[i]);else $(this).removeClass(r);d&&d(a,e)}})}}},e.bindingHandlers.background={init:function(e,t){},update:function(t,r){var i,a,o,s=e.utils.unwrapObservable(r());if("object"==typeof s){if(i=e.utils.unwrapObservable(s.image),!i)return void $(t).css("background-image","");a="",o=".png",s.extension&&(o=e.utils.unwrapObservable(s.extension),"."!==a.charAt(0)&&(o="."+o)),s.path&&(a=e.utils.unwrapObservable(s.path)||"",a.length>0&&"/"!==a.charAt(a.length-1)&&(a+="/")),$(t).css("background-image","url("+a+i+o+")")}else s?$(t).css("background-image","url("+s+")"):$(t).css("background-image","")}},e.bindingHandlers.draggable={init:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return;$(t).draggable(s).data("viewModel",a),"undefined"==typeof s.enabled||e.utils.unwrapObservable(s.enabled)||$(t).draggable("disable"),"undefined"!=typeof s.selectable&&e.utils.unwrapObservable(s.selectable)?$(t).enableSelection():$(t).disableSelection()}else $(t).draggable().data("viewModel",a),s?$(t).draggable("enable"):$(t).draggable("disable")},update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return void($(t).draggable&&$(t).draggable("destroy"));"undefined"!=typeof s.enabled&&(e.utils.unwrapObservable(s.enabled)?$(t).draggable("enable"):$(t).draggable("disable")),"undefined"!=typeof s.selectable&&e.utils.unwrapObservable(s.selectable)?$(t).enableSelection():$(t).disableSelection(),$(t).draggable("option",s)}else s?$(t).draggable("enable"):$(t).draggable("disable")}},e.bindingHandlers.droppable={init:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return;$(t).droppable(s).data("viewModel",a),"undefined"==typeof s.enabled||e.utils.unwrapObservable(s.enabled)||$(t).droppable("disable")}else"function"==typeof s&&$(t).droppable({drop:s}).data("viewModel",a)},update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return void($(t).droppable&&$(t).droppable("destroy"));$(t).droppable?$(t).droppable("option",s):$(t).droppable(s).data("viewModel",a),"undefined"!=typeof s.enabled&&(e.utils.unwrapObservable(s.enabled)?$(t).droppable("enable"):$(t).droppable("disable"))}else"function"==typeof s&&$(t).droppable({drop:s}).data("viewModel",a)}},e.bindingHandlers.selectable={init:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return;$(t).selectable(s).data("viewModel",a),"undefined"==typeof s.enabled||e.utils.unwrapObservable(s.enabled)||$(t).selectable("disable"),"undefined"!=typeof s.selectable&&e.utils.unwrapObservable(s.selectable)?$(t).enableSelection():$(t).disableSelection()}else $(t).selectable().data("viewModel",a),s?$(t).selectable("enable"):$(t).selectable("disable")},update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if("object"==typeof s){if("undefined"!=typeof s.destroy&&e.utils.unwrapObservable(s.destroy))return void($(t).selectable&&$(t).selectable("destroy"));"undefined"!=typeof s.enabled&&(e.utils.unwrapObservable(s.enabled)?$(t).selectable("enable"):$(t).selectable("disable")),"undefined"!=typeof s.selectable&&e.utils.unwrapObservable(s.selectable)?$(t).enableSelection():$(t).disableSelection(),$(t).selectable("option",s)}else s?$(t).selectable("enable"):$(t).selectable("disable")}},e.bindingHandlers.slide={init:function(t,r){var i=e.utils.unwrapObservable(r());$(t).toggle(i)},update:function(t,r){var i=e.utils.unwrapObservable(r());i?$(t).slideDown():$(t).slideUp()}},e.bindingHandlers.fade={
init:function(t,r){var i=e.utils.unwrapObservable(r());$(t).toggle(i)},update:function(t,r){var i=e.utils.unwrapObservable(r());i?$(t).fadeIn("slow"):$(t).fadeOut("slow")}},e.bindingHandlers.radio={init:function(t,r,i,a,o){var s,n,c,l;if(l=r(),!e.isWriteableObservable(l))throw"You must pass an observable or writeable computed";n=$(t),s=n.hasClass("btn")?n:$(".btn",n),c=i(),s.each(function(){var t,r,i;return r=this,t=$(r),i=c.radioValue||t.attr("data-value")||t.attr("value")||t.text(),t.on("click",function(){l(e.utils.unwrapObservable(i))}),e.computed({disposeWhenNodeIsRemoved:r,read:function(){t.toggleClass("active",l()===e.utils.unwrapObservable(i))}})})}},e.bindingHandlers.checkbox={init:function(t,r,i,a,o){var s,n;if(n=r(),!e.isWriteableObservable(n))throw"You must pass an observable or writeable computed";s=$(t),s.on("click",function(){n(!n())}),e.computed({disposeWhenNodeIsRemoved:t,read:function(){s.toggleClass("active",n())}})}},e.bindingHandlers.modalTabbingContraint={init:function(e,t,r,i,a){var o,s,n,c;o=function(t,r){return s=$(e).find(":tabbable"),r==$(s)[0]&&9===t.keyCode&&t.shiftKey?(t.preventDefault(),$(s[s.length-1]).focus(),!1):r!=$(s)[s.length-1]||9!==t.keyCode||t.shiftKey?void 0:(t.preventDefault(),$(s[0]).focus(),!1)},$(e).on("shown.bs.modal",function(){s=$(e).find(":tabbable"),n=$(e).find(":disabled"),c=$(e).find(":hidden"),$.each(s,function(e,t){$(t).on("keydown",function(e){o(e,t)})}),$.each(n,function(e,t){$(t).on("keydown",function(e){o(e,t)})}),$.each(c,function(e,t){$(t).on("keydown",function(e){o(e,t)})})})}},e.bindingHandlers.imageZoom={init:function(t,r){function a(t,r){if(t)for(var i=t.length-1;i>=0;i-=1){var a=e.utils.unwrapObservable(s[t[i]]);"undefined"!=typeof a&&null!==a&&(r[t[i]]=a)}}var o=new i;o.element=t;var s=e.utils.unwrapObservable(r());a(["smallImageUrl","fullImageUrl","imageMetadataDefault","fullImageClass","smallImageClass","magnifierClass","flyoutClass","magnifierPercent","flyoutEnabled","magnifierEnabled","spinnerDelay","replaceImageAtIndex","errorImageUrl"],o),o.index=s.index,o.smallImageUrls=s.smallImageUrls,o.fullImageUrls=s.fullImageUrls,o.imageMetadatas=s.imageMetadatas,o.start()},update:function(e,t,r,i,a){}};var d=function(e){var t="bust="+(new Date).getTime();return e+=e.indexOf("?")!==-1?e.indexOf("?")!==e.length-1?"&"+t:t:"?"+t};e.bindingHandlers.productImageSource={getNoImageSiteSetting:function(t){for(var r=null,i=0;i<t.$parents.length;i++)if(e.isObservable(t.$parents[i].site)){r=e.unwrap(t.$parents[i].site().noImageSrc);break}return r},init:function(t,r,i,a,o){var s,n,c,l,d,u=e.utils.unwrapObservable(r());"object"==typeof u&&"IMG"===t.nodeName&&(s=e.utils.unwrapObservable(u.src),n=e.utils.unwrapObservable(u.errorSrc),c=e.bindingHandlers.productImageSource.getNoImageSiteSetting(o),l=c&&c.length>0?c:n,s&&l&&(d=new Image,d.src=l))},update:function(t,r,i,a,s){var c,l,d,u,p,h,g,f,m,I,E,v,y,b,T="",P=!1,S=-1,C=e.utils.unwrapObservable(r());if("object"==typeof C&&"IMG"===t.nodeName){if(d=e.utils.unwrapObservable(C.src),c=e.utils.unwrapObservable(C.imageType),c||(c="medium"),d){switch(c){case"full":l=e.utils.unwrapObservable(d.primaryFullImageURL);break;case"large":l=e.utils.unwrapObservable(d.primaryLargeImageURL);break;case"medium":l=e.utils.unwrapObservable(d.primaryMediumImageURL);break;case"small":l=e.utils.unwrapObservable(d.primarySmallImageURL);break;case"thumb":l=e.utils.unwrapObservable(d.primaryThumbImageURL);break;default:l=e.utils.unwrapObservable(d.primaryMediumImageURL)}E=e.utils.unwrapObservable(C.outputFormat),v=e.utils.unwrapObservable(C.quality),y=e.utils.unwrapObservable(C.alphaChannelColor),E&&(T="&"+o.IMAGE_OUTPUT_FORMAT+"="+E),v&&(T=T+"&"+o.IMAGE_QUALITY+"="+v),y&&(T=T+"&"+o.IMAGE_ALPHA_CHANNEL_COLOR+"="+y),l&&T&&(l+=T)}else l=C.errorSrc;g=e.utils.unwrapObservable(d.primaryImageAltText),f=e.utils.unwrapObservable(d.primaryImageTitle),u=e.utils.unwrapObservable(C.errorSrc),p=e.bindingHandlers.productImageSource.getNoImageSiteSetting(s),h=p&&p.length>0?p:u;var A=s.$masterViewModel,_=e.utils.unwrapObservable(C.disableLazyImageLoading);return _||!A||!A.storeConfiguration||A.storeConfiguration.lazilyLoadImages!==!0||"prerenderReady"in window||l===h||n.isImageVisible(t,l)||(P=!0),P&&(b=e.utils.unwrapObservable(C.initialSrc),b=h?h:o.SITE_DEFAULT_NO_IMAGE_URL,A.storeConfiguration.delayBeforeLoadingOutOfFocusImages&&(S=A.storeConfiguration.delayBeforeLoadingOutOfFocusImages)),l!==u&&l!==o.SITE_DEFAULT_NO_IMAGE_URL||(l=h,P=!1),g||(g=e.utils.unwrapObservable(C.alt)),f||(f=e.utils.unwrapObservable(C.title)),m=e.utils.unwrapObservable(C.errorAlt),I=e.utils.unwrapObservable(C.onerror),h?void(l?(g&&(t.alt=g),f&&(t.title=f),t.onerror=function(){var e=new Image;e.onload=function(){t.src=h,I&&I(t),t.onerror=""},e.onerror=function(){var e=new Image;e.onload=function(){t.src=e.src,I&&I(t),t.onerror=""},e.onerror=function(){t.src="/img/no-image.jpg",I&&I(t),t.onerror=""},e.src=u},e.src=h,m&&(t.alt=m)},P?(t.dataset.errorSrc=h,t.dataset.defaultErrorSrc=u,I&&(t.dataset.onerror=I),m&&(t.dataset.errorAlt=m),t.dataset.src=l,n.setupLazyLoadStyling(t,C),n.observeLazyImage(t,S),t.src=b):t.src=l):(t.src=h,m?t.alt=m:g&&(t.alt=g),I&&I(t))):(P?(I&&(t.dataset.onerror=I),m&&(t.dataset.errorAlt=m),t.dataset.src=l,n.setupLazyLoadStyling(t,C),n.observeLazyImage(t,S),t.src=b):t.src=l,g&&(t.alt=g),void(f&&(t.title=f)))}}},e.bindingHandlers.carouselSwipe={init:function(e,t,r){var i=$(e);r().Options||{};i.unbind("swipeleft"),i.unbind("swiperight"),i.carousel.interval=!1,i.on("swipeleft",function(e){i.carousel("next"),i.carousel({interval:!1})}),i.on("swiperight",function(e){i.carousel("prev"),i.carousel({interval:!1})})}},e.bindingHandlers.tabTrap={constrain:function(e){var t,r=$(e).find(":tabbable");r.length;r.each(function(r){var i;$(this).hasClass("cc-tab-trapped")||($(this).addClass("cc-tab-trapped"),$(this).on("keydown",function(r){t=$(e).find(":tabbable"),9===r.keyCode&&(r.shiftKey?(i=parseInt(t.index($(this)),10)-1,i<0&&(r.preventDefault(),t[t.length-1].focus())):(i=parseInt(t.index($(this)),10)+1,i===t.length&&(r.preventDefault(),t[0].focus())))}))})}},e.bindingHandlers.ccForm={init:function(e,t){var r=$(e),i=t().action,a=["INPUT","SELECT"];r.on("keydown",function(e){if("13"==e.which&&a.indexOf(e.target.tagName)!==-1)return"function"==typeof i?i():"string"==typeof i&&$(i).trigger("click"),!1})}},e.bindingHandlers.ccValidation={init:function(e,t,r){},update:function(t,r,i){e.bindingHandlers.validationMessage.update(t,r,i),e.isObservable(r().error)?$("#cc-aria-announce").text(r().error()):$("#cc-aria-announce").text(r().error)}},e.bindingHandlers.image={init:function(t,r){var i,a,o,s=!1,n=e.utils.unwrapObservable(r());"object"==typeof n&&"IMG"===t.nodeName&&(n.cacheBust&&(s=e.utils.unwrapObservable(n.cacheBust)),i=e.utils.unwrapObservable(n.src),s&&(i=d(i)),a=e.utils.unwrapObservable(n.errorSrc),i&&a&&(o=new Image,o.src=a))},update:function(t,r,i,a,s){var c,l,u,p,h,g,f,m=!1,I=!1,E=-1,v=e.utils.unwrapObservable(r());if("object"==typeof v&&"IMG"===t.nodeName){l=e.utils.unwrapObservable(v.src),l||(l=v.errorSrc),v.cacheBust&&(m=e.utils.unwrapObservable(v.cacheBust)),m&&(l=d(l)),u=e.utils.unwrapObservable(v.errorSrc),p=e.utils.unwrapObservable(v.alt),h=e.utils.unwrapObservable(v.errorAlt),g=e.utils.unwrapObservable(v.onerror);var y=s.$masterViewModel,b=e.utils.unwrapObservable(v.disableLazyImageLoading);return b||!y||!y.storeConfiguration||y.storeConfiguration.lazilyLoadImages!==!0||"prerenderReady"in window||l===u||n.isImageVisible(t,l)||(I=!0),I&&(f=e.utils.unwrapObservable(v.initialSrc),f||(f=u?u:o.SITE_DEFAULT_NO_IMAGE_URL),y.storeConfiguration.delayBeforeLoadingOutOfFocusImages&&(E=y.storeConfiguration.delayBeforeLoadingOutOfFocusImages)),u?void(l?(c=new Image,c.onload=function(){t.alt=p?p:"",I?(g&&(t.dataset.onerror=g),h&&(t.dataset.errorAlt=h),u&&(t.dataset.errorSrc=u),t.dataset.src=l,n.setupLazyLoadStyling(t,v),n.observeLazyImage(t,E),t.src=f):t.src=l},c.onerror=function(){if(I){var e=new Image;e.onload=function(){t.dataset.errorSrc=u,g&&(t.dataset.onerror=g),h&&(t.dataset.errorAlt=h),t.dataset.src=l,n.setupLazyLoadStyling(t,v),n.observeLazyImage(t,E),t.src=u},e.onerror=function(){t.src=u,h&&(t.alt=h),g&&g(t)},e.src=u}else t.src=u,t.alt=h?h:"",g&&g(t)},c.src=I?f:l):(t.src=u,h?t.alt=h:p?t.alt=p:t.alt="",g&&g(t))):(I?(g&&(t.dataset.onerror=g),h&&(t.dataset.errorAlt=h),t.dataset.src=l,n.setupLazyLoadStyling(t,v),n.observeLazyImage(t,E),t.src=f):t.src=l,void(t.alt=p?p:""))}}},e.bindingHandlers.handleFocusin={init:function(t,r,i){var a=e.utils.unwrapObservable(r()),o=a.applyClass?a.applyClass:"cc-showhidden",s=a.applyTo;$(t).on("focusin mouseover",function(e){$(t).find(s).addClass(o)}).on("focusout mouseout",function(e){$.contains(t,document.activeElement)||$(t).find(s).removeClass(o)})}}}),function(){function e(e,t,r,i,a,o){return t[e]||(e=e.replace(/^zh-(Hans|Hant)-([^-]+)$/,"zh-$2")),!!t[e]&&(r.push(e),!0!==t[e]&&1!==t[e]||i.push(a+e+"/"+o),!0)}function t(e){var t=e.toLowerCase().split(/-|_/);e=[t[0]];var r,i=1;for(r=1;r<t.length;r++){var a=t[r],o=a.length;if(1==o)break;switch(i){case 1:if(i=2,4==o){e.push(a.charAt(0).toUpperCase()+a.slice(1));break}case 2:i=3,e.push(a.toUpperCase());break;default:e.push(a)}}return"zh"!=e[0]||1<e.length&&4==e[1].length||(t="Hans",i=1<e.length?e[1]:null,"TW"!==i&&"MO"!==i&&"HK"!==i||(t="Hant"),e.splice(1,0,t)),e}function r(e,t){for(var i in t)t.hasOwnProperty(i)&&(null==e[i]?e[i]=t[i]:"object"==typeof t[i]&&"object"==typeof e[i]&&r(e[i],t[i]))}var i=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("ojL10n",["module"],function(a){var o=a.config?a.config():{};return{version:"2.0.1+",load:function(a,s,n,c){c=c||{},c.locale&&(o.locale=c.locale);var l,d,u,p,h,g,f,m,I,E=i.exec(a),v=E[1],y=E[5],b=[],T={},P="";for(E[5]?(v=E[1],a=v+y,l=E[4]):(y=E[4],l=o.locale,"undefined"!=typeof document?(l||(l=c.isBuild?"root":document.documentElement.lang)||(l=void 0===navigator?"root":navigator.language||navigator.userLanguage||"root"),o.locale=l):l="root"),d=t(l),p=o.noOverlay,h=o.defaultNoOverlayLocale,(E=o.merge)&&(g=E[v+y])&&(E=i.exec(g),f=E[1],m=E[4]),I=[],u=0;u<d.length;u++)E=d[u],P+=(P?"-":"")+E,I.push(P);c.isBuild?(b.push(a),g&&b.push(g),s(b,function(){n()})):("query"==o.includeLocale&&(a=s.toUrl(a+".js"),a+=(-1===a.indexOf("?")?"?":"&")+"loc="+l),c=[a],g&&c.push(g),s(c,function(t,i){var a,o=[],c=!1,l=p||!0===t.__noOverlay,g=h||t.__defaultNoOverlayLocale;for(u=I.length-1;0<=u&&(!c||!l);u--)c=e(I[u],t,o,b,v,y);if(l&&!c&&g&&e(g,t,o,b,v,y),e("root",t,o,b,v,y),a=o.length,i){for(c=!1,l=!0===i.__noOverlay,g=i.__defaultNoOverlayLocale,u=I.length-1;0<=u&&(!c||!l);u--)c=e(I[u],i,o,b,f,m);l&&!c&&g&&e(g,i,o,b,f,m),e("root",i,o,b,f,m)}s(b,function(){var e,c,l;for(e=a;e<o.length&&o[e];e++)l=o[e],c=i[l],!0!==c&&1!==c||(c=s(f+l+"/"+m)),r(T,c);for(e=0;e<a&&o[e];e++)l=o[e],c=t[l],!0!==c&&1!==c||(c=s(v+l+"/"+y)),r(T,c);T._ojLocale_=d.join("-"),n(T)})}))}}})}(),define("ojtranslations/nls/ojtranslations",{root:{"oj-message":{fatal:"Fatal",error:"Error",warning:"Warning",info:"Info",confirmation:"Confirmation","compact-type-summary":"{0}: {1}"},"oj-converter":{summary:"Value is not in the expected format.",detail:"Enter a value in the expected format.","plural-separator":", ",hint:{summary:"Example: {exampleValue}",detail:"Enter a value in the same format as this example: '{exampleValue}'","detail-plural":"Enter a value in the same format as these examples: '{exampleValue}'"},optionHint:{detail:"An accepted value for option '{propertyName}' is '{propertyValueValid}'.","detail-plural":"Accepted values for option '{propertyName}' are '{propertyValueValid}'."},optionTypesMismatch:{summary:"A value for the option '{requiredPropertyName}' is required when the option '{propertyName}' is set to '{propertyValue}'."},optionTypeInvalid:{summary:"A value of the expected type was not provided for option '{propertyName}'."},optionOutOfRange:{summary:"Value {propertyValue} is out of range for the option '{propertyName}'."},optionValueInvalid:{summary:"An invalid value '{propertyValue}' was specified for the option '{propertyName}'."},number:{decimalFormatMismatch:{summary:"'{value}' is not in the expected number format."},decimalFormatUnsupportedParse:{summary:"decimalFormat: 'short' and 'long' are not supported for converter parsing.",detail:"Change component to readOnly. readOnly fields do not call the converter's parse function."},currencyFormatMismatch:{summary:"'{value}' is not in the expected currency format."},percentFormatMismatch:{summary:"'{value}' is not in the expected percent format."}},datetime:{datetimeOutOfRange:{summary:"Value '{value}' is out of range for the '{propertyName}'.",detail:"Enter a value between '{minValue}' and '{maxValue}'."},dateFormatMismatch:{summary:"'{value}' is not in the expected date format."},timeFormatMismatch:{summary:"'{value}' is not in the expected time format."},datetimeFormatMismatch:{summary:"'{value}' is not in the expected date and time format."},dateToWeekdayMismatch:{summary:"Day '{date}' does not fall on a '{weekday}'.",detail:"Enter a weekday that corresponds with the date."}}},"oj-validator":{length:{hint:{min:"Enter {min} or more characters.",max:"Enter {max} or fewer characters",inRange:"Enter {min} or more characters, up to a maximum of {max}.",exact:"Enter {length} characters."},messageDetail:{tooShort:"Enter {min} or more characters, not fewer.",tooLong:"Enter {max} or fewer characters, not more."},messageSummary:{tooShort:"There are too few characters.",tooLong:"There are too many characters."}},range:{number:{hint:{min:"Enter a number greater than or equal to {min}.",max:"Enter a number less than or equal to {max}.",inRange:"Enter a number between {min} and {max}."},messageDetail:{rangeUnderflow:"Number {value} must be greater than or equal to {min}.",rangeOverflow:"Number {value} must be less than or equal to {max}."},messageSummary:{rangeUnderflow:"Number is too low.",rangeOverflow:"Number is too high."}},datetime:{hint:{min:"Enter a date and time on or after {min}.",max:"Enter a date and time on or before {max}.",inRange:"Enter a date and time between {min} and {max}."},messageDetail:{rangeUnderflow:"Date and time must be on or later than {min}.",rangeOverflow:"Date and time must be on or sooner than {max}."},messageSummary:{rangeUnderflow:"Date and time is earlier than the minimum date.",rangeOverflow:"Date and time is later than the maximum date."}}},restriction:{date:{messageSummary:"Date {value} is of a disabled entry.",messageDetail:"Date {value} should not be of a disabled entry."}},regExp:{summary:"Format is incorrect.",detail:"Value '{value}' must match this pattern: '{pattern}'"},required:{summary:"Value is required.",detail:"You must enter a value."}},"oj-editableValue":{required:{hint:"",messageSummary:"",messageDetail:""}},"oj-ojInputDate":{prevText:"Prev",nextText:"Next",currentText:"Today",weekHeader:"Wk",tooltipCalendar:"Select Date",tooltipCalendarDisabled:"Select Date Disabled",weekText:"Week",datePicker:"Date Picker",inputHelp:"Press Key down or Key up for access to Calendar",inputHelpBoth:"Press Key down or Key up for access to Calendar and Shift + Key down or Shift Key up for access to time drop down",dateTimeRange:{hint:{min:"",max:"",inRange:""},messageDetail:{rangeUnderflow:"",rangeOverflow:""},messageSummary:{rangeUnderflow:"",rangeOverflow:""}},dateRestriction:{hint:"",messageSummary:"",messageDetail:""}},"oj-ojInputTime":{tooltipTime:"Select Time",tooltipTimeDisabled:"Select Time Disabled",inputHelp:"Press Key down or Key up for access to time drop down",dateTimeRange:{hint:{min:"",max:"",inRange:""},messageDetail:{rangeUnderflow:"",rangeOverflow:""},messageSummary:{rangeUnderflow:"",rangeOverflow:""}}},"oj-inputBase":{regexp:{messageSummary:"",messageDetail:""}},"oj-ojInputPassword":{regexp:{messageDetail:"Value must match this pattern: '{pattern}'"}},"oj-ojFilmStrip":{labelAccArrowNextPage:"Next Page",labelAccArrowPreviousPage:"Previous Page",tipArrowNextPage:"Next",tipArrowPreviousPage:"Previous"},"oj-ojDataGrid":{accessibleSortAscending:"{id} sorted in ascending order",accessibleSortDescending:"{id} sorted in descending order",accessibleActionableMode:"Enter actionable mode",accessibleNavigationMode:"Enter navigation mode",accessibleSummaryExact:"This is a data grid with {rownum} rows and {colnum} columns",accessibleSummaryEstimate:"This is a data grid with unknown number of rows and columns",accessibleSummaryExpanded:"There are currently {num} rows expanded",accessibleRowExpanded:"Row expanded",accessibleRowCollapsed:"Row collapsed",accessibleRowSelected:"Row {row} selected",accessibleColumnSelected:"Column {column} selected",accessibleStateSelected:"selected",accessibleMultiCellSelected:"{num} cells selected",accessibleRowContext:"Row {index}",accessibleColumnContext:"Column {index}",accessibleRowHeaderContext:"Row Header {index}",accessibleColumnHeaderContext:"Column Header {index}",accessibleLevelContext:"Level {level}",accessibleRangeSelectModeOn:"Add selected range of cells mode on",accessibleRangeSelectModeOff:"Add selected range of cells mode off",accessibleFirstRow:"You have reached the first row",accessibleLastRow:"You have reached the last row",accessibleFirstColumn:"You have reached the first column",accessibleLastColumn:"You have reached the last column",accessibleSelectionAffordanceTop:"Top selection handle",accessibleSelectionAffordanceBottom:"Bottom selection handle",msgFetchingData:"Fetching Data...",msgNoData:"No items to display.",labelResize:"Resize",labelResizeWidth:"Resize Width",labelResizeHeight:"Resize Height",labelSortRow:"Sort Row",labelSortRowAsc:"Sort Row Ascending",labelSortRowDsc:"Sort Row Descending",labelSortCol:"Sort Column",labelSortColAsc:"Sort Column Ascending",labelSortColDsc:"Sort Column Descending",labelCut:"Cut",labelPaste:"Paste",labelEnableNonContiguous:"Enable Non-Contiguous Selection",labelDisableNonContiguous:"Disable Non-Contiguous Selection",labelResizeDialogSubmit:"OK"},"oj-ojRowExpander":{accessibleLevelDescription:"Level {level}",accessibleRowDescription:"Level {level}, Row {num} of {total}",accessibleRowExpanded:"Row expanded",accessibleRowCollapsed:"Row collapsed",accessibleStateExpanded:"expanded",accessibleStateCollapsed:"collapsed"},"oj-ojListView":{msgFetchingData:"Fetching Data...",msgNoData:"No items to display.",indexerCharacters:"A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z"},"oj-_ojLabel":{tooltipHelp:"Help",tooltipRequired:"Required"},"oj-ojInputNumber":{numberRange:{hint:{min:"",max:"",inRange:""},messageDetail:{rangeUnderflow:"",rangeOverflow:""},messageSummary:{rangeUnderflow:"",rangeOverflow:""}},tooltipDecrement:"Decrement",tooltipIncrement:"Increment"},"oj-ojTable":{labelAccSelectionAffordanceTop:"Top selection handle",labelAccSelectionAffordanceBottom:"Bottom selection handle",labelEnableNonContiguousSelection:"Enable Non-Contiguous Selection",labelDisableNonContiguousSelection:"Disable Non-Contiguous Selection",labelSelectRow:"Select Row",labelSelectColumn:"Select Column",labelSort:"Sort",labelSortAsc:"Sort Ascending",labelSortDsc:"Sort Descending",msgFetchingData:"Fetching Data...",msgNoData:"No data to display."},"oj-ojTabs":{labelCut:"Cut",labelPasteBefore:"Paste Before",labelPasteAfter:"Paste After",labelRemove:"Remove",labelReorder:"Reorder",removeCueText:"Removable"},"oj-ojSelect":{seachField:"Search field",noMatchesFound:"No matches found"},"oj-ojSwitch":{SwitchON:"On",SwitchOFF:"Off"},"oj-ojCombobox":{noMatchesFound:"No matches found"},"oj-ojInputSearch":{noMatchesFound:"No matches found"},"oj-ojTree":{stateLoading:"Loading...",labelNewNode:"New Node",labelMultiSelection:"Multiple Selection",labelEdit:"Edit",labelCreate:"Create",labelCut:"Cut",labelCopy:"Copy",labelPaste:"Paste",labelRemove:"Remove",labelRename:"Rename",labelNoData:"No data"},"oj-ojPagingControl":{labelAccPaging:"Pagination",labelAccNavFirstPage:"First Page",labelAccNavLastPage:"Last Page",labelAccNavNextPage:"Next Page",labelAccNavPreviousPage:"Previous Page",labelAccNavPage:"Page",labelLoadMore:"Show More...",labelLoadMoreMaxRows:"Reached Maximum Limit of {maxRows} rows",labelNavInputPage:"Page",labelNavInputPageMax:"of {pageMax}",msgItemRangeCurrent:"{pageFrom}-{pageTo}",msgItemRangeCurrentSingle:"{pageFrom}",msgItemRangeOf:"of",msgItemRangeOfAtLeast:"of at least",msgItemRangeOfApprox:"of approx.",msgItemRangeItems:"items",tipNavInputPage:"Go To Page",tipNavPageLink:"Go To Page {pageNum}",tipNavNextPage:"Next",tipNavPreviousPage:"Previous",tipNavFirstPage:"First",tipNavLastPage:"Last",pageInvalid:{summary:"The page value entered is invalid.",detail:"Please enter a value greater than 0."},maxPageLinksInvalid:{summary:"Value for maxPageLinks is invalid.",detail:"Please enter a value greater than 4."}},"oj-ojMasonryLayout":{labelCut:"Cut",labelPasteBefore:"Paste Before",labelPasteAfter:"Paste After"},"oj-panel":{labelAccButtonExpand:"Expand",labelAccButtonCollapse:"Collapse",labelAccButtonRemove:"Remove"},"oj-ojChart":{labelDefaultGroupName:"Group {0}",labelSeries:"Series",labelGroup:"Group",labelDate:"Date",labelValue:"Value",labelTargetValue:"Target",labelX:"X",labelY:"Y",labelZ:"Z",labelPercentage:"Percentage",labelLow:"Low",labelHigh:"High",labelOpen:"Open",labelClose:"Close",labelVolume:"Volume",labelMin:"Min",labelMax:"Max",labelOther:"Other",tooltipPan:"Pan",tooltipSelect:"Marquee select",tooltipZoom:"Marquee zoom",componentName:"Chart"},"oj-dvtBaseGauge":{componentName:"Gauge"},"oj-ojDiagram":{componentName:"Diagram"},"oj-ojLegend":{componentName:"Legend"},"oj-ojNBox":{highlightedCount:"{0}/{1}",labelOther:"Other",labelGroup:"Group",labelSize:"Size",labelAdditionalData:"Additional Data",componentName:"NBox"},"oj-ojPictoChart":{componentName:"Picture Chart"},"oj-ojSparkChart":{componentName:"Chart"},"oj-ojSunburst":{labelColor:"Color",labelSize:"Size",componentName:"Sunburst"},"oj-ojTagCloud":{componentName:"Tag Cloud"},"oj-ojThematicMap":{componentName:"Thematic Map"},"oj-ojTimeline":{componentName:"Timeline",labelSeries:"Series",tooltipZoomIn:"Zoom In",tooltipZoomOut:"Zoom Out"},"oj-ojTreemap":{labelColor:"Color",labelSize:"Size",tooltipIsolate:"Isolate",tooltipRestore:"Restore",componentName:"Treemap"},"oj-dvtBaseComponent":{labelScalingSuffixThousand:"K",labelScalingSuffixMillion:"M",labelScalingSuffixBillion:"B",labelScalingSuffixTrillion:"T",labelScalingSuffixQuadrillion:"Q",labelInvalidData:"Invalid data",labelNoData:"No data to display",labelClearSelection:"Clear Selection",labelDataVisualization:"Data Visualization",stateSelected:"Selected",stateUnselected:"Unselected",stateMaximized:"Maximized",stateMinimized:"Minimized",stateExpanded:"Expanded",stateCollapsed:"Collapsed",stateIsolated:"Isolated",stateHidden:"Hidden",stateVisible:"Visible",stateDrillable:"Drillable",labelAndValue:"{0}: {1}",labelCountWithTotal:"{0} of {1}"},"oj-ojNavigationList":{defaultRootLabel:"Navigation List",hierMenuBtnLabel:"Hierarchical Menu button",selectedLabel:"selected",previousIcon:"Previous",msgFetchingData:"Fetching Data...",msgNoData:"No items to display."},"oj-ojSlider":{noValue:"ojSlider has no value",maxMin:"Max must not be less than min",valueRange:"Value must be within min to max range",optionNum:"{option} option is not a number",invalidStep:"Invalid step; step must be > 0"},"oj-ojPopup":{ariaLiveRegionInitialFocusFirstFocusable:"Entering pop-up. Press F6 to navigate between the pop-up and associated control.",ariaLiveRegionInitialFocusNone:"Pop-up opened. Press F6 to navigate between the pop-up and associated control.",ariaLiveRegionInitialFocusFirstFocusableTouch:"Entering pop-up. Pop-up can be closed by navigating to the last link within the pop-up.",ariaLiveRegionInitialFocusNoneTouch:"Pop-up opened.  Navigate to the next link to establish focus within the pop-up.",ariaFocusSkipLink:"Double tap to navigate to the open pop-up.",ariaCloseSkipLink:"Double tap to close the open pop-up."},"oj-pullToRefresh":{ariaRefreshLink:"Activate link to refresh content",ariaRefreshingLink:"Refreshing content",ariaRefreshCompleteLink:"Refresh complete"},"oj-ojIndexer":{indexerOthers:"#",ariaDisabledLabel:"No matching group header",ariaOthersLabel:"number",ariaInBetweenText:"Between {first} and {second}",ariaKeyboardInstructionText:"Press enter to select value.",ariaTouchInstructionText:"Double tap and hold to enter gesture mode, then drag up or down to adjust value."}},ro:1,"zh-Hant":1,sv:1,ko:1,th:1,"zh-Hans":1,sk:1,pl:1,nl:1,fi:1,he:1,de:1,es:1,el:1,hu:1,ru:1,it:1,da:1,tr:1,ja:1,"pt-PT":1,cs:1,fr:1,no:1,pt:1,"fr-CA":1,ar:1});var o_a=this;define("ojs/ojcore",["require","ojL10n!ojtranslations/nls/ojtranslations"],function(e,t){var r={};"undefined"!=typeof window?r=window:"undefined"!=typeof self&&(r=self);var i=r.oj,a=r.oj={version:"2.0.2",build:"1",revision:"26417",noConflict:function(){r.oj=i}};a.q={},o_("Logger",a.q,a),a.q.U6=0,o_("Logger.LEVEL_NONE",a.q.U6,a),a.q.AF=1,o_("Logger.LEVEL_ERROR",a.q.AF,a),a.q.hn=2,o_("Logger.LEVEL_WARN",a.q.hn,a),a.q.Zr=3,o_("Logger.LEVEL_INFO",a.q.Zr,a),a.q.gQ=4,o_("Logger.LEVEL_LOG",a.q.gQ,a),a.q.R8="error",a.q.U8="warn",a.q.S8="info",a.q.T8="log",a.q.UU={level:a.q.AF,writer:null},a.q.kb=a.q.UU,a.q.error=function(e){a.q.ty(a.q.AF,a.q.R8,arguments)},o_("Logger.error",a.q.error,a),a.q.info=function(e){a.q.ty(a.q.Zr,a.q.S8,arguments)},o_("Logger.info",a.q.info,a),a.q.warn=function(e){a.q.ty(a.q.hn,a.q.U8,arguments)},o_("Logger.warn",a.q.warn,a),a.q.log=function(e){a.q.ty(a.q.gQ,a.q.T8,arguments)},o_("Logger.log",a.q.log,a),a.q.option=function(e,t){var r,i={};if(0==arguments.length){for(r in a.q.kb)a.q.kb.hasOwnProperty(r)&&(i[r]=a.q.kb[r]);return i}if("string"==typeof e&&void 0===t)return void 0===a.q.kb[e]?null:a.q.kb[e];if("string"==typeof e)a.q.kb[e]=t;else for(r in e)e.hasOwnProperty(r)&&a.q.option(r,e[r])},o_("Logger.option",a.q.option,a),a.q.ty=function(e,t,r){if(!(a.q.option("level")<e)){var i=a.q.ffa();null!=i&&(1==r.length&&r[0]instanceof Function&&(r=[r[0]()]),i[t]&&i[t].apply?i[t].apply(i,r):i[t]&&(i[t]=Function.prototype.bind.call(i[t],i),a.q.ty(e,t,r)))}},a.q.ffa=function(){var e=null;return a.q.option("writer")?e=a.q.option("writer"):"undefined"!=typeof window&&void 0!==window.console&&(e=window.console),e},a.q.vsa=function(e){return void 0!==a.q.UU[e]};var o=r.__ojCheckpointManager;a.Wh={},o_("CHECKPOINT_MANAGER",a.Wh,a),a.Wh.Mqa=function(e,t){o&&o.startCheckpoint(e,t)},o_("CHECKPOINT_MANAGER.startCheckpoint",a.Wh.Mqa,a),a.Wh.toa=function(e){o&&o.endCheckpoint(e)},o_("CHECKPOINT_MANAGER.endCheckpoint",a.Wh.toa,a),a.Wh.TN=function(e){return o?o.getRecord(e):void 0},o_("CHECKPOINT_MANAGER.getRecord",a.Wh.TN,a),a.Wh.H4=function(e){return o?o.matchRecords(e):[]},o_("CHECKPOINT_MANAGER.matchRecords",a.Wh.H4,a),a.Wh.qoa=function(e){a.q.info(function(){for(var t="Checkpoint Records:",r=a.Wh.H4(e),i=0;i<r.length;i++){var o=r[i],t=t+"\n"+o.name,s=o.description;null!=s&&(t=t+" ("+s+")"),t+=":\n",t=t+"start: "+o.start+"\tduration: "+o.duration}return t})},o_("CHECKPOINT_MANAGER.dump",a.Wh.qoa,a),a.b=function(){this.Init()},o_("Object",a.b,a),a.b.r=null,a.b.FM="oj.Object",a.b.p8=/function\s+([\w\$][\w\$\d]*)\s*\(/,a.b.prototype={},a.b.prototype.constructor=a.b,a.b.g=function(e,t){var r,i=null,o=null;for(r in t)if(t.hasOwnProperty(r)){i=r,o=t[r];break}var s=e.split(".");if(r=a[s[0]],s=s[2],i!=s&&null!=i){var n=r.lL;n||(n={},r.lL=n),n[i]=s,r.prototype[s]=o}},a.b.ga=function(e,t,r){a.l.Ho(e),a.l.wu(t),a.l.bN(r),void 0===t&&(t=a.b),a.l.assert(e!==t,"Class can't extend itself");var i=a.b.qma;i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.r=e.superclass=t.prototype,r&&(e.FM=r)},o_("Object.createSubclass",a.b.ga,a),a.b.Mna=function(e,t){var r;a.l.Ho(e),a.l.assert(null!=t,"source object cannot be null");for(r in t)t.hasOwnProperty(r)&&(e.prototype[r]=t[r])},o_("Object.copyPropertiesForClass",a.b.Mna,a),a.b.qma=function(){},a.b.prototype.X2=function(e){if(void 0===e)e=this;else if(null===e)return null;return e.constructor},a.b.g("Object.prototype.getClass",{X2:a.b.prototype.X2}),a.b.prototype.clone=function(){var e=new this.constructor;return a.zc.Lf(e,this),e},a.b.g("Object.prototype.clone",{clone:a.b.prototype.clone}),a.b.prototype.toString=function(){return this.qP()},a.b.g("Object.prototype.toString",{toString:a.b.prototype.toString}),a.b.prototype.qP=function(){return this.getTypeName()+" Object"},a.b.g("Object.prototype.toDebugString",{qP:a.b.prototype.qP}),a.b.getTypeName=function(e){a.l.Ho(e);var t=e.FM;return null==t&&(t=e.toString(),t=(t=a.b.p8.exec(t))?t[1]:"anonymous",e.FM=t),t},o_("Object.getTypeName",a.b.getTypeName,a),a.b.prototype.getTypeName=function(){return a.b.getTypeName(this.constructor)},a.b.g("Object.prototype.getTypeName",{getTypeName:a.b.prototype.getTypeName}),a.b.prototype.Init=function(){a.l.iO()&&a.l.assert(this.getTypeName,"Not an oj.Object");var e=this.constructor;e.Zl||a.b.oK(e)},a.b.g("Object.prototype.Init",{Init:a.b.prototype.Init}),a.b.uoa=function(e){a.l.Ho(e),e.Zl||a.b.oK(e)},o_("Object.ensureClassInitialization",a.b.uoa,a),a.b.prototype.Mo=function(e){return this===e},a.b.g("Object.prototype.equals",{Mo:a.b.prototype.Mo}),a.b.r2=function(e,t){return a.l.Ho(t),t.bind(e)},o_("Object.createCallback",a.b.r2,a),a.b.oK=function(e){a.l.iO()&&(a.l.Ho(e),a.l.assert(!e.Zl)),e.Zl=!0;var t=e.r;t&&((t=t.constructor)&&!t.Zl&&a.b.oK(t),a.b.eaa(e)),(t=e.InitClass||null)||(t=e.InitClass),t&&t.call(e)},a.b.mh=function(e,t){if(e===t)return!0;if(typeof e!=typeof t||null===e||null===t)return!1;if(e.constructor===t.constructor){if(Array.isArray(e))return a.b.mba(e,t);if(e.constructor===Object)return a.b.Vv(e,t);if(e.valueOf&&"function"==typeof e.valueOf)return e.valueOf()===t.valueOf()}return!1},o_("Object.compareValues",a.b.mh,a),a.b.mba=function(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!a.b.mh(e[r],t[r]))return!1;return!0},a.b.oU=function(e,t){if(!e)return!t||0==t.length;if(!t)return!e||0==e.length;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r]&&(-1==e.indexOf(t[r])||-1==t.indexOf(e[r])))return!1;return!0},a.b.Vv=function(e,t){var r,i=!1;if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object)||e.constructor!==t.constructor)return!1;for(r in e)if(i||(i=!0),e.hasOwnProperty(r)&&(!t.hasOwnProperty(r)||e[r]!==t[r]&&("object"!=typeof e[r]||!a.b.Vv(e[r],t[r]))))return!1;for(r in t)if(i||(i=!0),t.hasOwnProperty(r)&&!e.hasOwnProperty(r))return!1;return!!i||JSON.stringify(e)===JSON.stringify(t)},a.b.ph=function(e){var t;if(void 0===e||null===e)return!0;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},a.b.eaa=function(e){a.b.lL&&a.b.oT(e,e.r)},a.b.oT=function(e,t){if(t){var r=t.constructor;a.b.oT(e,r.r);var i,r=r.lL;if(r)for(i in r)if(r.hasOwnProperty(i)){var o=r[i];if(i!=o){var s=e.prototype;!s.hasOwnProperty(i)&&s.hasOwnProperty(o)?s[i]=s[o]:!s.hasOwnProperty(o)&&s.hasOwnProperty(i)&&(s[o]=s[i])}}}},a.Ns=function(){return"function"==typeof define&&define.amd},a.l={},o_("Assert",a.l,a),a.l.zoa=function(){a.l.DEBUG=!0},o_("Assert.forceDebug",a.l.zoa,a),a.l.Hna=function(){a.l.DEBUG=!1},o_("Assert.clearDebug",a.l.Hna,a),a.l.iO=function(){return 1==a.l.DEBUG},o_("Assert.isDebug",a.l.iO,a),a.l.assert=function(e,t){if(a.l.DEBUG&&!e){var r,i=t||"";if(2<arguments.length){for(i+="(",r=2;r<arguments.length;r+=1)i+=arguments[r];i+=")"}a.l.Sd(i)}},o_("Assert.assert",a.l.assert,a),a.l.Yb=function(){a.l.DEBUG&&a.l.Sd("Abstract function called")},o_("Assert.failedInAbstractFunction",a.l.Yb,a),a.l.$c=function(e,t,r){var i;a.l.DEBUG&&(null!=e?(a.l.Qh(t,"function",null,0,!1),i=t.prototype,i.isPrototypeOf(e)||a.l.Sd("object '"+e+"' doesn't match prototype "+i,0,r)):a.l.Sd("null object doesn't match prototype "+i,0,r))},o_("Assert.assertPrototype",a.l.$c,a),a.l.xna=function(e,t,r){var i;a.l.DEBUG&&null!=e&&(null!=e?(a.l.Qh(t,"function",null,0,!1),i=t.prototype,i.isPrototypeOf(e)||a.l.Sd("object '"+e+"' doesn't match prototype "+i,0,r)):a.l.Sd("null object doesn't match prototype "+i,0,r))},o_("Assert.assertPrototypeOrNull",a.l.xna,a),
a.l.yna=function(e,t,r,i){a.l.DEBUG&&(t=t.prototype,r=r.prototype,t.isPrototypeOf(e)||r.isPrototypeOf(e)||a.l.Sd("object '"+e+"' doesn't match prototype "+t+" or "+r,0,i))},o_("Assert.assertPrototypes",a.l.yna,a),a.l.rna=function(e){a.l.DEBUG&&e&&void 0===e.nodeType&&a.l.Sd(e+" is not a DOM Node")},o_("Assert.assertDomNodeOrNull",a.l.rna,a),a.l.aN=function(e){a.l.DEBUG&&(e&&void 0!==e.nodeType||a.l.Sd(e+" is not a DOM Node"))},o_("Assert.assertDomNode",a.l.aN,a),a.l.$M=function(e,t){a.l.DEBUG&&(a.l.aN(e),1!==e.nodeType?a.l.Sd(e+" is not a DOM Element"):t&&e.nodeName!==t&&a.l.Sd(e+" is not a "+t+" Element"))},o_("Assert.assertDomElement",a.l.$M,a),a.l.qna=function(e,t){a.l.DEBUG&&null!=e&&(a.l.aN(e),1!==e.nodeType?a.l.Sd(e+" is not a DOM Element"):t&&e.nodeName!==t&&a.l.Sd(e+" is not a "+t+" Element"))},o_("Assert.assertDomElementOrNull",a.l.qna,a),a.l.Qh=function(e,t,r,i,o){!a.l.DEBUG||null==e&&o||typeof e===t||(e=e+" is not of type "+t,r&&(e=r+e),a.l.Sd(e))},o_("Assert.assertType",a.l.Qh,a),a.l.Kf=function(e,t){a.l.DEBUG&&a.l.Qh(e,"object",t,0,!1)},o_("Assert.assertObject",a.l.Kf,a),a.l.W1=function(e,t){a.l.DEBUG&&a.l.Qh(e,"object",t,0,!0)},o_("Assert.assertObjectOrNull",a.l.W1,a),a.l.tna=function(e,t){a.l.DEBUG&&(a.l.Qh(e,"string",t,0,!1),a.l.assert(0<e.length,"empty string"))},o_("Assert.assertNonEmptyString",a.l.tna,a),a.l.om=function(e,t){a.l.DEBUG&&a.l.Qh(e,"string",t,0,!1)},o_("Assert.assertString",a.l.om,a),a.l.bN=function(e,t){a.l.DEBUG&&a.l.Qh(e,"string",t,0,!0)},o_("Assert.assertStringOrNull",a.l.bN,a),a.l.Ho=function(e,t){a.l.DEBUG&&a.l.Qh(e,"function",t,0,!1)},o_("Assert.assertFunction",a.l.Ho,a),a.l.wu=function(e,t){a.l.DEBUG&&a.l.Qh(e,"function",t,0,!0)},o_("Assert.assertFunctionOrNull",a.l.wu,a),a.l.V1=function(e,t){a.l.DEBUG&&a.l.Qh(e,"boolean",t,0,!1)},o_("Assert.assertBoolean",a.l.V1,a),a.l.nm=function(e,t){a.l.DEBUG&&a.l.Qh(e,"number",t,0,!1)},o_("Assert.assertNumber",a.l.nm,a),a.l.vna=function(e,t){a.l.DEBUG&&a.l.Qh(e,"number",t,0,!0)},o_("Assert.assertNumberOrNull",a.l.vna,a),a.l.QD=function(e,t){a.l.DEBUG&&!Array.isArray(e)&&(void 0===t&&(t=e+" is not an array"),a.l.Sd(t))},o_("Assert.assertArray",a.l.QD,a),a.l.vy=function(e,t){a.l.DEBUG&&null!=e&&!Array.isArray(e)&&(void 0===t&&(t=e+" is not an array"),a.l.Sd(t))},o_("Assert.assertArrayOrNull",a.l.vy,a),a.l.una=function(e,t){a.l.DEBUG&&!isNaN(e)&&(void 0===t&&(t=e+" is convertible to a number"),a.l.Sd(t))},o_("Assert.assertNonNumeric",a.l.una,a),a.l.wna=function(e,t){a.l.DEBUG&&isNaN(e)&&(void 0===t&&(t=e+" is not convertible to a number"),a.l.Sd(t))},o_("Assert.assertNumeric",a.l.wna,a),a.l.sna=function(e,t,r){var i;if(null==e||void 0===t[e.toString()]){if(void 0===r){r=" is not in set: {";for(i in t)t.hasOwnProperty(i)&&(r+=i,r+=",");r=e+(r+"}")}a.l.Sd(r)}},o_("Assert.assertInSet",a.l.sna,a),a.l.Sd=function(e,t,r){throw t="Assertion",r&&(t+=" ("+r+")"),t+=" failed: ",void 0!==e&&(t+=e),Error(t)},o_("Assert.assertionFailed",a.l.Sd,a);var s=r.__oj_Assert_DEBUG;return void 0!==s&&(a.l.DEBUG=s),a.Pg=function(){this.Init()},o_("EventSource",a.Pg,a),a.b.ga(a.Pg,a.b,"oj.EventSource"),a.Pg.prototype.Init=function(){this.kd=[],a.Pg.r.Init.call(this)},a.b.g("EventSource.prototype.Init",{Init:a.Pg.prototype.Init}),a.Pg.prototype.on=function(e,t){var r,i=!1;for(r=0;r<this.kd.length;r++)if(this.kd[r].eventType==e&&this.kd[r].eventHandlerFunc==t){i=!0;break}i||this.kd.push({eventType:e,eventHandlerFunc:t})},a.b.g("EventSource.prototype.on",{on:a.Pg.prototype.on}),a.Pg.prototype.off=function(e,t){var r;for(r=this.kd.length-1;0<=r;r--)if(this.kd[r].eventType==e&&this.kd[r].eventHandlerFunc==t){this.kd.splice(r,1);break}},a.b.g("EventSource.prototype.off",{off:a.Pg.prototype.off}),a.Pg.prototype.handleEvent=function(e,t){var r,i;for(r=0;r<this.kd.length;r++)if(i=this.kd[r],i.eventType==e&&(i=i.eventHandlerFunc.apply(this,Array.prototype.slice.call(arguments).slice(1)),!1===i))return!1;return!0},a.b.g("EventSource.prototype.handleEvent",{handleEvent:a.Pg.prototype.handleEvent}),a.ba={},o_("Config",a.ba,a),a.ba.Bg=function(){var e;return a.Ns()?(a.l.assert(void 0!==t,"ojtranslations module must be defined"),e=t._ojLocale_,"root"==e?"en":e):(e=a.ba.Qt,null==e&&((e=document.documentElement.lang)||(e=void 0===navigator?"en":(navigator.language||navigator.userLanguage||"en").toLowerCase()),a.ba.Qt=e=e.toLowerCase()),e)},o_("Config.getLocale",a.ba.Bg,a),a.ba.Eqa=function(r,i){if(a.Ns()){var o=["ojL10n!ojtranslations/nls/"+r+"/ojtranslations"];a.La&&o.push("ojL10n!ojtranslations/nls/"+r+"/localeElements"),e(o,function(e,r){t=e,r&&a.La.t$(r),i&&i()})}else a.ba.Qt=r,i&&i()},o_("Config.setLocale",a.ba.Eqa,a),a.ba.lb=function(t){var r=/^\/|:/;return null==t||r.test(t)?t:(r=a.ba.Oka)?r+("/"==r.charAt(r.length-1)?"":"/")+t:a.Ns()?(r=e.toUrl("ojs/_foo_"),r.replace(/[^\/]*$/,"../"+t)):t},o_("Config.getResourceUrl",a.ba.lb,a),a.ba.Fqa=function(e){a.ba.Oka=e},o_("Config.setResourceBaseUrl",a.ba.Fqa,a),a.ba.Dqa=function(e){a.ba.laa=e},o_("Config.setAutomationMode",a.ba.Dqa,a),a.ba.GN=function(){return a.ba.laa},o_("Config.getAutomationMode",a.ba.GN,a),a.ba.O3=function(){var e="Oracle JET Version: "+a.version+"\n",e=e+("Oracle JET Revision: "+a.revision+"\n"),t="undefined"!=typeof window;return t&&window.navigator&&(e+="Browser: "+window.navigator.userAgent+"\n",e+="Browser Platform: "+window.navigator.platform+"\n"),$&&($.fn&&(e+="jQuery Version: "+$.fn.jquery+"\n"),$.ui&&$.ui.version&&(e+="jQuery UI Version: "+$.ui.version+"\n")),a.ia&&(e+="Knockout Version: "+a.ia.s$()+"\n"),t&&window.uqa&&(e+="Require Version: "+window.uqa.version+"\n"),e},o_("Config.getVersionInfo",a.ba.O3,a),a.ba.Rpa=function(){console.log(a.ba.O3())},o_("Config.logVersionInfo",a.ba.Rpa,a),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}"undefined"!=typeof window&&"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}(),a.Na=function(){},a.Na.sl={yF:"ie",OP:"firefox",uQ:"safari",v6:"chrome",zv:"unknown"},a.Na.cn={FQ:"trident",PF:"webkit",RP:"gecko",zv:"unknown"},a.Na.aj={y7:"Windows",o7:"Solaris",iQ:"Mac",zv:"Unknown",CP:"Android",zF:"IOS",V6:"Linux"},a.Na.Fy=function(){var e;a.Ea.Ni(e)&&(e=navigator.userAgent),e=e.toLowerCase();var t=a.Ea.qr(e),r=a.Na.oca;if(r&&r.hashCode===t)return{os:r.os,browser:r.browser,browserVersion:r.browserVersion,engine:r.engine,engineVersion:r.engineVersion,hashCode:r.hashCode};var r=a.Na.aj.zv,i=a.Na.sl.zv,o=0,s=a.Na.cn.zv,n=0;return-1<e.indexOf("iphone")||-1<e.indexOf("ipad")?r=a.Na.aj.zF:-1<e.indexOf("mac")?r=a.Na.aj.iQ:-1<e.indexOf("sunos")?r=a.Na.aj.o7:-1<e.indexOf("android")?r=a.Na.aj.CP:-1<e.indexOf("linux")?r=a.Na.aj.V6:-1<e.indexOf("win")&&(r=a.Na.aj.y7),-1<e.indexOf("msie")?(i=a.Na.sl.yF,o=a.Na.Ci(e,/msie (\d+[.]\d+)/),e.indexOf("trident")&&(s=a.Na.cn.FQ,n=a.Na.Ci(e,/trident\/(\d+[.]\d+)/))):-1<e.indexOf("trident")?(i=a.Na.sl.yF,o=a.Na.Ci(e,/rv:(\d+[.]\d+)/),e.indexOf("trident")&&(s=a.Na.cn.FQ,n=a.Na.Ci(e,/trident\/(\d+[.]\d+)/))):-1<e.indexOf("chrome")?(i=a.Na.sl.v6,o=a.Na.Ci(e,/chrome\/(\d+[.]\d+)/),s=a.Na.cn.PF,n=a.Na.Ci(e,/applewebkit\/(\d+[.]\d+)/)):-1<e.indexOf("safari")?(i=a.Na.sl.uQ,o=a.Na.Ci(e,/version\/(\d+[.]\d+)/),s=a.Na.cn.PF,n=a.Na.Ci(e,/applewebkit\/(\d+[.]\d+)/)):-1<e.indexOf("firefox")&&(i=a.Na.sl.OP,o=a.Na.Ci(e,/rv:(\d+[.]\d+)/),s=a.Na.cn.RP,n=a.Na.Ci(e,/gecko\/(\d+)/)),r=a.Na.oca={hashCode:t,os:r,browser:i,browserVersion:o,engine:s,engineVersion:n},{os:r.os,browser:r.browser,browserVersion:r.browserVersion,engine:r.engine,engineVersion:r.engineVersion,hashCode:r.hashCode}},a.Na.Ci=function(e,t){var r=e.match(t);return r&&(r=r[1])?parseFloat(r):0},a.Ee={},a.Ee.Z4=function(e){var t=document.getElementsByClassName(e).item(0);if(null===t&&(t=document.createElement("meta"),t.className=e,document.head.appendChild(t)),(t=window.getComputedStyle(t))&&(t=t.getPropertyValue("font-family"))&&"none"!=t&&(t=t.replace(/^['"]+|\s+|\\|(;\s?})+|['"]$/g,""))){try{t=JSON.parse(t)}catch(r){return a.q.error("Error parsing json for selector "+e+".\nString being parsed is "+t+"\n"+r),null}return t}return a.q.info("No json found for selector "+e),null},a.Ee.Yk=function(e){e=e.toLowerCase(),null==a.Ee.OO&&(a.Ee.OO={});var t=a.Ee.OO[e];return null==t&&(t=a.Ee.Z4("oj-"+e+"-option-defaults"),null==t&&(t={}),a.Ee.OO[e]=t),t},a.ResponsiveUtils={},a.ResponsiveUtils.SCREEN_RANGE={SM:"sm",MD:"md",LG:"lg",XL:"xl",XXL:"xxl"},a.ResponsiveUtils.FRAMEWORK_QUERY_KEY={SM_UP:"sm-up",MD_UP:"md-up",LG_UP:"lg-up",XL_UP:"xl-up",XXL_UP:"xxl-up",SM_ONLY:"sm-only",MD_ONLY:"md-only",LG_ONLY:"lg-only",XL_ONLY:"xl-only",MD_DOWN:"md-down",LG_DOWN:"lg-down",XL_DOWN:"xl-down",HIGH_RESOLUTION:"high-resolution"},a.ResponsiveUtils.Mp={},a.ResponsiveUtils.Mp[a.ResponsiveUtils.SCREEN_RANGE.SM]=0,a.ResponsiveUtils.Mp[a.ResponsiveUtils.SCREEN_RANGE.MD]=1,a.ResponsiveUtils.Mp[a.ResponsiveUtils.SCREEN_RANGE.LG]=2,a.ResponsiveUtils.Mp[a.ResponsiveUtils.SCREEN_RANGE.XL]=3,a.ResponsiveUtils.Mp[a.ResponsiveUtils.SCREEN_RANGE.XXL]=4,a.ResponsiveUtils.xea=function(e){var t=document.getElementsByClassName(e).item(0);return null===t&&(t=document.createElement("meta"),t.className=e,document.head.appendChild(t)),window.getComputedStyle(t).getPropertyValue("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,"")},a.ResponsiveUtils.getFrameworkQuery=function(e){return e=a.ResponsiveUtils.xea("oj-mq-"+e),"null"==e?null:e},a.ResponsiveUtils.compare=function(e,t){var r=a.ResponsiveUtils.Mp[e],i=a.ResponsiveUtils.Mp[t];if(void 0==r)throw"size1 param "+e+" illegal, please use one of the screen size constants like oj.ResponsiveUtils.SCREEN_RANGE.MD";if(void 0==i)throw"size2 param "+t+" illegal, please use one of the screen size constants like oj.ResponsiveUtils.SCREEN_RANGE.MD";return r-i},a.Ea={},o_("StringUtils",a.Ea,a),a.Ea.m$=/^\s*|\s*$/g,a.Ea.ph=function(e){return null===e||0===a.Ea.trim(e).length},o_("StringUtils.isEmpty",a.Ea.ph,a),a.Ea.Ni=function(e){return!(void 0!==e&&!a.Ea.ph(e))},o_("StringUtils.isEmptyOrUndefined",a.Ea.Ni,a),a.Ea.qd=function(e){return null!==e&&("string"==typeof e||e instanceof String)},o_("StringUtils.isString",a.Ea.qd,a),a.Ea.trim=function(e){return a.Ea.qd(e)?e.replace(a.Ea.m$,""):e},o_("StringUtils.trim",a.Ea.trim,a),a.Ea.qr=function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t},a.zc={},o_("CollectionUtils",a.zc,a),a.zc.Lf=function(e,t,r,i,o){return a.zc.vU(e,t,r,i,o,0)},o_("CollectionUtils.copyInto",a.zc.Lf,a),a.zc.isPlainObject=function(e){if("object"==typeof e)try{if(e.constructor&&e.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!0}catch(e){}return!1},o_("CollectionUtils.isPlainObject",a.zc.isPlainObject,a),a.zc.vU=function(e,t,r,i,o,s){var n,c,l;if(e&&t&&e!==t){l=Object.keys(t);for(var d=0;d<l.length;d++){n=l[d],c=r?r(n):n,n=t[n];var u=!1;if(i&&s<o){var p=e[c];a.zc.isPlainObject(p)&&a.zc.isPlainObject(n)&&(u=!0,a.zc.vU(p,n,r,!0,o,s+1))}u||(e[c]=n)}}return e},a.ha={},o_("Translations",a.ha,a),a.ha.cP=function(e){a.ha.pH=e},o_("Translations.setBundle",a.ha.cP,a),a.ha.v3=function(e){return a.ha.WW(e)},o_("Translations.getResource",a.ha.v3,a),a.ha.Mb=function(e,t){return null==e?null:a.ha.xda(e,t)},o_("Translations.applyParameters",a.ha.Mb,a),a.ha.A=function(e,t){var r=a.ha.WW(e);if(null==r)return e;var i={};return 2<arguments.length?i=Array.prototype.slice.call(arguments,1):2==arguments.length&&(i=arguments[1],"object"==typeof i||i instanceof Array||(i=[i])),a.ha.Mb(r,i)},o_("Translations.getTranslatedString",a.ha.A,a),a.ha.iE=function(e){e=a.ha.XV()[e];var t,r;if(null==e)return{};t={};for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},o_("Translations.getComponentTranslations",a.ha.iE,a),a.ha.WW=function(e){e=e?e.split("."):[];var t=a.ha.XV(),r=e.length,i=0,o=e[i];for(a.l.Kf(t);0<--r&&t;)t=t[o],i++,o=e[i];return t?t[o]||null:null},a.ha.xda=function(e,t){var r,i,a=e.length,o=[],s=null,n=!1,c=!1,l=!1,d=!1;for(i=0;i<a;i++){var u=e.charAt(i),p=!1;if(n)p=!0,n=!1;else switch(u){case"$":n=!0;break;case"{":d||(c||(r=!1,s=[]),c=!0);break;case"}":c&&0<s.length&&(c=t[s.join("")],o.push(void 0===c?"null":c)),c=!1;break;case"[":c||(l?d=!0:l=!0);break;case"]":d?d=!1:l=!1;break;default:p=!0}p&&(c?","==u||" "==u?r=!0:r||s.push(u):d||o.push(u))}return o.join("")},a.ha.XV=function(){var e=a.ha.pH;return e?e:a.Ns()?(a.l.assert(void 0!==t,"ojtranslations module must be defined"),t):{}},a}),define("numberFormatHelper",["ojs/ojcore"],function(){"use strict";function e(){}return e.prototype.formatNumber=function(e,t,r){var t,i,a,o;a=oj.Validation.converterFactory(oj.ConverterFactory.CONVERTER_TYPE_NUMBER);var s={style:r,minimumIntegerDigits:1,minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:!0};return o=a.createConverter(s),i=o.format(e)},new e}),define("currencyHelper",["knockout","ccRestClient","ccConstants","numberFormatHelper","pubsub"],function(e,t,r,i,a){"use strict";function o(){return this.currencyObject=e.observable(null),this.currencyMapObject=e.observable(null),this.setFractionalDigits=e.observable(null),this.currencies=e.observableArray([]),this.currenciesLoaded=!1,this.priceListGroups=e.observableArray([]),this.defaultPriceListGroup=null,this.priceListGroupsLoaded=!1,this.getCurrencyMapCurrenciesBinding=this.getCurrencyMapCurrencies.bind(this),$.Topic(a.topicNames.PRICE_LIST_GROUP_UPDATE).subscribe(this.getCurrencyMapCurrenciesBinding),$.Topic(a.topicNames.ADMIN_CONTENT_LANGUAGE_CHANGED).subscribe(this.getCurrencyMapCurrenciesBinding),this}return o.prototype.DECIMAL_NUMBER_FORMAT="decimal",o.prototype.getCurrency=function(e,i){var a=r.ENDPOINT_CURRENCIES_LIST_CURRENCIES,o={};null==e&&(e=this.getCurrencySuccess.bind(this)),null==i&&(i=this.getCurrencyError.bind(this)),t.request(a,o,e,i)},o.prototype.getCurrencySuccess=function(e){this.currencyObject(e.selectedCurrency),this.checkCurrencySymbol()},o.prototype.getCurrencyError=function(e){throw"Not Implemented"},o.prototype.getCurrencies=function(e){var i=r.ENDPOINT_CURRENCIES_LIST_CURRENCIES,a={sort:"currencyCode:asc"};t.request(i,a,e,this.getCurrenciesError.bind(this))},o.prototype.getCurrenciesError=function(e){throw"Not Implemented"},o.prototype.getPriceListGroups=function(e){var i=r.ENDPOINT_LIST_PRICE_LIST_GROUPS,a={includeDeleted:"true"};t.request(i,a,e,this.getPriceListGroupsError.bind(this))},o.prototype.getPriceListGroupsError=function(e){throw"Not Implemented"},o.prototype.getPLGCurrencies=function(e){this.getCurrencies(function(t){this.currencies(t.items),this.currenciesLoaded=!0,this.priceListGroupsLoaded&&this.formatCurrenciesForList(e)}.bind(this)),this.getPriceListGroups(function(t){this.priceListGroups(t.items),this.defaultPriceListGroup=t.defaultPriceListGroup,this.priceListGroupsLoaded=!0,this.currenciesLoaded&&this.formatCurrenciesForList(e)}.bind(this))},o.prototype.formatCurrenciesForList=function(e){var t,r,i=this.priceListGroups(),a=[];e:for(t=0;t<i.length;t++){var o={};for(o.repositoryId=i[t].currency.repositoryId,o.currencyCode=i[t].currency.currencyCode,r=0;r<a.length;r++)if(a[r].repositoryId===i[t].currency.repositoryId)continue e;for(o.selectListDisplayName=i[t].currency.currencyCode+" - "+i[t].currency.displayName,o.fractionalDigits=i[t].currency.fractionalDigits,o.repositoryId===this.defaultPriceListGroup.locale&&(o.isDefault=!0),r=0;r<this.currencies().length;r++)this.currencies()[r].currencyCode===i[t].currency.currencyCode&&(o.selectListDisplayName=i[t].currency.currencyCode+" - "+this.currencies()[r].displayName);a.push(o)}a.sort(function(e,t){return e.selectListDisplayName.localeCompare(t.selectListDisplayName)}),e(a)},o.prototype.checkCurrencySymbol=function(){this.currencyObject().symbol.match(/^[0-9a-zA-Z]+$/)&&(this.currencyObject().symbol=this.currencyObject().symbol+" ")},o.prototype.handleFractionalDigits=function(e,t){var r;if(r="number"==typeof t?t:this.currencyObject()?this.currencyObject().fractionalDigits:2,null===e||""===e)return e;var i=(e+"e").split("e"),a=Math.round(i[0]+"e"+(+i[1]+r));return i=(a+"e").split("e"),e=+(i[0]+"e"+(+i[1]-r)),e.toString()},o.prototype.handleFractionalDigitsAndLocale=function(e){var t;return t=null!==this.setFractionalDigits()?this.setFractionalDigits():this.currencyObject()?this.currencyObject().fractionalDigits:2,null==e||""===e?e:e=i.formatNumber(e,t,this.DECIMAL_NUMBER_FORMAT)},o.prototype.getCurrencyMapCurrencies=function(){var e={};e.defaultFirst=!0,t.request(r.ENDPOINT_LIST_PRICE_LIST_GROUPS,e,this.getCurrencyMapCurrenciesSuccess.bind(this),this.getCurrencyMapCurrenciesError.bind(this))},o.prototype.getCurrencyMapCurrenciesSuccess=function(e){e.defaultPriceListGroupId=e.defaultPriceListGroup.id,$.each(e.items,function(t){e.items[t].isDefaultPriceListGroup=e.items[t].id===e.defaultPriceListGroup.id}),this.currencyMapObject(e)},o.prototype.getCurrencyMapCurrenciesError=function(e){},new o}),define("profileHelper",["knockout","ccConstants"],function(e,t){"use strict";function r(){return this.profileData=e.observable(null),this.allowedActions=e.observableArray(null),this.pageAccesskeys={home:[t.DASHBOARD_TAB,t.DASHBOARD_MINI_TAB],catalog:[t.CATALOG_TAB],"price-groups":[t.CATALOG_TAB],"price-group":[t.CATALOG_TAB],marketing:[t.MARKETING_TAB],reporting:[t.REPORTS_TAB],media:[t.MEDIA_TAB],search:[t.SEARCH_TAB],accounts:[t.ACCOUNTS_TAB_AND_B2B_ENABLED],contacts:[t.ACCOUNTS_TAB_AND_B2B_ENABLED],design:[t.DESIGN_TAB],code:[t.DESIGN_TAB],publish:[t.PUBLISHING_TAB],settings:[t.SETTINGS_TAB,t.SETTINGS_LIMITED_TAB],inventory:[t.CATALOG_TAB],css:[t.DESIGN_TAB],theme:[t.DESIGN_TAB],layout:[t.DESIGN_TAB]},this.restrictedSubTabAccess={emailSettings:[t.SETTINGS_TAB],webAPI:[t.SETTINGS_TAB],accessControl:[t.SETTINGS_TAB],extensions:[t.SETTINGS_TAB],abandonedCartSettings:[t.SETTINGS_TAB],storeEndpointSettings:[t.SETTINGS_TAB]},this.tourNavigationData={home:{url:t.HOME_PAGE},catalog:{url:t.AGENT_CATALOG_PAGE_CONTEXT},marketing:{url:t.MARKETING_PAGE},reporting:{url:t.REPORTING_PAGE},media:{url:t.MEDIA_PAGE},search:{url:t.SEARCH_PAGE},accounts:{url:t.ACCOUNTS_PAGE,lastStop:!1},design:{url:t.DESIGN_PAGE},code:{url:t.CODE_PAGE},publish:{url:t.PUBLISH_PAGE},serviceOperations:{url:t.SERVICE_OPERATIONS_PAGE},settings:{url:t.SETTINGS_SHIPPINGMETHODS_PAGE,lastStop:!1}},this}return r.prototype.isAuthorized=function(e){var t=this;if(e){var r=[];if($.isArray(e)?r=e:r.push(e),t.allowedActions&&t.allowedActions().length>0&&$(t.allowedActions()).filter(r).length>0)return!0}return!1},r.prototype.isAuthorizedForPage=function(e){var t=this,r=t.pageAccesskeys[e];if("undefined"!=typeof r&&null!==r)return t.isAuthorized(r)},r.prototype.isAuthorizedForSubTab=function(e){if(!e)return!0;var t=this,r=t.restrictedSubTabAccess[e];return"undefined"==typeof r||null===r||t.isAuthorized(r)},r.prototype.nextAuthorizedPage=function(e){if(e){var t=this,r=e.split("/");if(r&&(e=r[0]&&r[0].length>0?r[0]:r[1]),"undefined"==typeof e||null===e)return;var i=!1;for(var a in t.pageAccesskeys)if(t.pageAccesskeys.hasOwnProperty(a)&&(a===e&&(i=!0),i)){var o=t.pageAccesskeys[a];if(t.isAuthorized(o))return t.tourNavigationData[a]}return null}},new r}),define("ccKoExtensions",["knockout","jqueryui","currencyHelper","CCi18n","ccDate","ccNumber","profileHelper","ccLogger","pubsub","ccConstants","i18next","navigation","ccLazyImages"],function(e,t,r,i,a,o,s,n,c,l,d,u,p){"use strict";var h=l.ALLOW_HASHBANG,g=!1;window.history&&window.history.pushState&&(g=!0);var f=e.utils.parseHtmlFragment("<meta name=robots content=noindex>");!function(){var t,r,i,a,o=!0,s=200,n=300,c=100,l=200;a=function(e){0===$(e.target).closest(".popover").length&&t()},o=function(e,t){var r,i,a,o;return o=$(window),r=t.top-o.scrollTop(),i=t.left-o.scrollLeft(),r<c||r<l&&"top"===e?a="bottom":(r>o.height()-c||r>o.height()-l&&"bottom"===e)&&(a="top"),i<s||i<n&&"left"===e?a="right":(i>o.width()-s||i>o.width()-n&&"right"===e)&&(a="left"),a||e},t=function(){i&&(i.data("bs.popover").tip().off("keydown"),i.popover("destroy"),i=null,$(document).off("click",a),$(document).off("focusin",a))},r=function(r,o,s,n){var c,l=$(r);l.popover(o),c=l.data("bs.popover").tip(),c.hasClass("in")?(t(),l.filter(":focusable").length>0?l.focus():l.find(":focusable").focus()):(t(),c.css("z-index",s.zIndex),c.css("min-height",s.minHeight),c.css("min-width",s.minWidth),c.children(".popover-content").attr("data-bind","template: {name: '"+s.name+"', templateUrl: '"+s.templateUrl+"', afterRender: registerCallbacks}"),c.keydown(function(e){27!==e.which&&13!==e.which||t()}),window.setTimeout(function(){$(document).click(a),$(document).focusin(a)},1),l.popover("show"),i=l,e.cleanNode(c[0]),e.applyBindingsToDescendants(n,c[0]))},e.bindingHandlers.infoPopover={init:function(a,s,n,c){var l,d,u,p,h=s(),g=h.model||c,f=e.bindingHandlers.tabTrap;i=!1,d={html:!0,trigger:h.trigger||"click",content:"<div class='"+h.class+"'></div>",container:h.container||"body",placement:h.placement||"bottom",title:h.title?"<strong>"+h.title+"</strong><a id='cc-popover-close' href='#' class='pull-right cc-close-link' data-bind='click: close'><i class='fa fa-times'></i></a>":""},p=h.focusOn||"",l=$(a),u={model:h.model||c,close:function(){return t(),l.filter(":focusable").length>0||l.find(":focusable").focus(),!1},registerCallbacks:function(e){if($(e).find(p).focus(),f.constrain($(".popover.in")),Array.isArray(h.callbacks))for(var r=0;r<h.callbacks.length;r++){var i=h.callbacks[r];$(i.elementId).on(i.eventType,function(){t(),i.callback()})}}},l.click(function(e){e.preventDefault(),d.placement=o(h.placement,l.offset()),g.hasOwnProperty("popoverCallbackFunction")?g.beforePopupRender(r.bind(self,a,d,h,u),t.bind(self)):(r(a,d,h,u),l.data("bs.popover").tip().draggable())}),"hover"==d.trigger&&(l.mouseenter(function(e){$(a).data("bs.popover",null),d.placement=o(h.placement,l.offset()),r(a,d,h,u),l.data("bs.popover").tip().css("pointer-events","none")}),l.mouseleave(function(e){t()}))}}}(),e.bindingHandlers.inTabFlow={update:function(t,r){var i=e.utils.unwrapObservable(r());"A"==$(t).prop("tagName")?$(t).attr("tabindex",i?0:-1):$(t).find(":input").attr("tabindex",i?0:-1)}},e.bindingHandlers.validatableValue={init:function(t,r,i,a,o){var s=r(),n=o.$parent.ignoreBlur;if($(t).blur(function(){return!(!n||!n())||void(s.isModified&&e.isObservable(s.isModified)&&s.isModified(!0))}),s.rules&&e.isObservable(s.rules))for(var c=s.rules().length,l=0;l<c;++l)if("required"===s.rules()[l].rule){s.rules()[l].params===!0&&$(t).attr("required","required");break}e.bindingHandlers.value.init(t,r,i,a,o)},update:function(t,r,i,a,o){e.bindingHandlers.value.update(t,r,i,a,o)}},e.bindingHandlers.validatableTarget={init:function(t,r,i,a,o){var s=r();$(t).blur(function(){s.isModified&&e.isObservable(s.isModified)&&s.isModified(!0)})}},e.bindingHandlers.ccLink={init:function(t,r,i,a,o){t.addEventListener("click",function(e){var r={usingCCLink:!0};if($(t).trigger("click.cc.unsaved",r),r.preventDefault)e.stopImmediatePropagation();else{var i=t.pathname+t.search;i&&window.location.pathname!==i&&u.goTo(i)}return e.preventDefault(),!1},!1);var s,n=e.utils.unwrapObservable(r()),c=n;if(n){if("string"==typeof n){var d=null,p=n;if(a.links)d=a;else{s=o.$parents;for(var g=0;g<s.length;g++)if(s[g].links){d=s[g];break}}d&&(c=d.links()[p])}if(c){var f="";c.url?f=c.url:c.route&&(f=c.route);var m=o.$masterViewModel;m&&m.isPreview&&!m.isPreview()&&m.storeConfiguration.allowSiteSwitchingOnProduction&&m.storeConfiguration.allowSiteSwitchingOnProduction()&&window.siteIdOnURL&&window.siteIdOnURL.length>0&&(f+=f.indexOf("?")==-1?"?"+l.URL_SITE_PARAM+"="+encodeURIComponent(window.siteIdOnURL):"&"+l.URL_SITE_PARAM+"="+encodeURIComponent(window.siteIdOnURL));var I=f;h&&(I="#!"+f);var E="";if(!window.isAgentApplication&&window.siteBaseURLPath&&"/"!==window.siteBaseURLPath?E=window.siteBaseURLPath:window.applicationContextPath&&"/"!==window.applicationContextPath&&(E=window.applicationContextPath),window.urlLocale){var v=JSON.parse(window.urlLocale)[0].name;E+="/"+v}$(t).prop("href",E+f),0===$(t).children().length&&""==$.trim($(t).text())&&(c.displayName?$(t).text(c.displayName):$(t).text(window.location.href+I))}}}},e.bindingHandlers.ccNavigation={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());$(t).on("click.cc.nav",function(e){var r=t.pathname+t.search,i={usingCCLink:!0};return $(t).trigger("click.cc.unsaved",i),"prevent"==s||i.preventDefault||u.goTo(r),e.preventDefault(),e.stopImmediatePropagation(),!1})}},e.bindingHandlers.triggerMessage={update:function(t,r){var i=r();if(i.triggerFired&&e.isObservable(i.triggerFired)){var a=function(){return i.triggerFired()?i.triggerMessage:null},o=function(){return!!i.triggerFired()};e.bindingHandlers.text.update(t,a),e.bindingHandlers.visible.update(t,o)}}},e.bindingHandlers.widgetLocaleText={update:function(e,t,r,i,a){var o,s,n=t();if(i.translate)s=i;else for(var c=a.$parents,l=0;l<c.length;l++)if(c[l].translate){s=c[l];break}"string"==typeof n?o=s.translate(n,null,!0):"object"==typeof n&&void 0!=n.value&&(o=s.translate(n.value,n.params,!0,n.custom)),o&&("string"==typeof n||"object"==typeof n&&"innerText"==n.attr?$(e).text(o):"object"==typeof n&&void 0!=n.attr&&$(e).attr(n.attr,o))}},e.bindingHandlers.disabled={update:function(t,r,i,a,o){var s,n,c=!1,l=r();if("boolean"==typeof l?c=e.utils.unwrapObservable(l):"object"==typeof l&&void 0!=l.condition&&(c=e.utils.unwrapObservable(l.condition),void 0!=l.click&&(s=e.utils.unwrapObservable(l.click)),void 0!=l.link&&(n=function(){return e.utils.unwrapObservable(l.link)})),c){$(t).off("click.handler");var d=$(t).prop("tagName");"A"==d&&$(t).attr("href","#"),$(t).on("click.handler",function(e){return e.stopImmediatePropagation(),!1}),$(t).addClass("disabled")}else $(t).removeClass("disabled"),$(t).off("click.handler"),s&&$(t).on("click.handler",function(){var e=s.bind(a);return e(),!1}),n&&e.bindingHandlers.ccLink.init(t,n,i,a,o)}},e.bindingHandlers.ccDate={update:function(t,r,i,o,s){var n=r(),c=e.utils.unwrapObservable(n),l=e.utils.unwrapObservable(c.date),d=e.utils.unwrapObservable(c.format),u=e.utils.unwrapObservable(c.returnedType),p=e.utils.unwrapObservable(c.returnedDate);p=a.formatDateAndTime(l,d,u,p),$(t).text(p)}},e.bindingHandlers.ccResizeImage={getNoImageSiteSetting:function(t){for(var r=null,i=0;i<t.$parents.length;i++)if(e.isObservable(t.$parents[i].site)){r=e.unwrap(t.$parents[i].site().noImageSrc);break}return r},init:function(t,r,i,a,o){var s,n,c,l,d,u=e.utils.unwrapObservable(r());"object"==typeof u&&"IMG"===t.nodeName&&(s=e.utils.unwrapObservable(u.src),n=e.utils.unwrapObservable(u.errorSrc),c=e.bindingHandlers.productImageSource.getNoImageSiteSetting(o),l=c&&c.length>0?c:n,s&&l&&(d=new Image,d.src=l))},update:function(t,r,i,a,o){var s,n,c,d,u,h,g,f,m,I,E,v,y,b="",T=!1,P=-1,S=e.utils.unwrapObservable(r()),C=l.DEFAULT_IMG_SIZE_FOR_VIEWPORT,A=["xsmall","small","medium","large"],_=function(e){if(e){var t=e.split(",");return 2==t.length&&(!isNaN(t[0])&&!isNaN(t[1]))}return!1},O=function(){var t=document.createElement("img"),r="srcset"in t,i="sizes"in t,a=S.isSrcSetEnabled&&e.utils.unwrapObservable(S.isSrcSetEnabled);return r&&i&&a},R=function(){var t="",r=e.utils.unwrapObservable(S.outputFormat),i=e.utils.unwrapObservable(S.quality),a=e.utils.unwrapObservable(S.alphaChannelColor);return r&&(t="&"+l.IMAGE_OUTPUT_FORMAT+"="+r),i&&(t=t+"&"+l.IMAGE_QUALITY+"="+i),a&&(t=t+"&"+l.IMAGE_ALPHA_CHANNEL_COLOR+"="+a),t},N=function(t,r,i){var a="";S[t+"_img"]?a=e.utils.unwrapObservable(S[t+"_img"]):i&&(a=M(i,r.imageHeight,r.imageWidth));var o=R();o&&(0===a.indexOf(l.ENDPOINT_IMAGES+"?source=")?a+=o:a=l.ENDPOINT_IMAGES+"?source="+a+o);C[t].width;if(a&&r.imageWidth)return a=a+" "+r.imageWidth+"w"},D=function(t){var r,i={},a=t?t:$(window)[0].innerWidth||$(window).width();"large"==a||a>=l.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?(i.imageHeight=C.large.height,i.imageWidth=C.large.width,i.minWidth=C.large.minWidth,r="large"):"medium"==a||a>l.VIEWPORT_TABLET_UPPER_WIDTH&&a<l.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?(i.imageHeight=C.medium.height,i.imageWidth=C.medium.width,i.minWidth=C.medium.minWidth,i.maxWidth=C.medium.maxWidth,r="medium"):"small"==a||a>=l.VIEWPORT_TABLET_LOWER_WIDTH&&a<=l.VIEWPORT_TABLET_UPPER_WIDTH?(i.imageHeight=C.small.height,i.imageWidth=C.small.width,i.minWidth=C.small.minWidth,i.maxWidth=C.small.maxWidth,r="small"):(i.imageHeight=C.xsmall.height,i.imageWidth=C.xsmall.width,i.maxWidth=C.xsmall.maxWidth,r="xsmall");var o=!1;switch(r){case"large":_(e.utils.unwrapObservable(S.large))&&(i.imageHeight=S.large.split(",")[0],i.imageWidth=S.large.split(",")[1],o=!0);break;case"medium":_(e.utils.unwrapObservable(S.medium))&&(i.imageHeight=S.medium.split(",")[0],i.imageWidth=S.medium.split(",")[1],o=!0);break;case"small":_(e.utils.unwrapObservable(S.small))&&(i.imageHeight=S.small.split(",")[0],i.imageWidth=S.small.split(",")[1],o=!0);break;case"xsmall":_(e.utils.unwrapObservable(S.xsmall))&&(i.imageHeight=S.xsmall.split(",")[0],i.imageWidth=S.xsmall.split(",")[1],o=!0)}if(!o)if(_(e.utils.unwrapObservable(S.size)))i.imageHeight=S.size.split(",")[0],i.imageWidth=S.size.split(",")[1];else if(e.utils.unwrapObservable(S.size))switch(e.utils.unwrapObservable(S.size)){case"large":_(e.utils.unwrapObservable(S.large))?(i.imageHeight=S.large.split(",")[0],i.imageWidth=S.large.split(",")[1],o=!0):(i.imageHeight=C.large.height,i.imageWidth=C.large.width);break;case"medium":_(e.utils.unwrapObservable(S.medium))?(i.imageHeight=S.medium.split(",")[0],i.imageWidth=S.medium.split(",")[1],o=!0):(i.imageHeight=C.medium.height,i.imageWidth=C.medium.width);break;case"small":_(e.utils.unwrapObservable(S.small))?(i.imageHeight=S.small.split(",")[0],i.imageWidth=S.small.split(",")[1],o=!0):(i.imageHeight=C.small.height,i.imageWidth=C.small.width);break;case"xsmall":_(e.utils.unwrapObservable(S.xsmall))?(i.imageHeight=S.xsmall.split(",")[0],i.imageWidth=S.xsmall.split(",")[1],o=!0):(i.imageHeight=C.xsmall.height,i.imageWidth=C.xsmall.width)}return i},L=function(e){if(e){var t=e.minWidth,r=e.maxWidth,i=e.imageWidth,a="";t&&(a="(min-width:"+t+"px)");var o="";return r&&(o="(max-width:"+r+"px)"),a&&o&&i?a+" and "+o+" "+i+"px":a&&i?a+" "+i+"px":o&&i?o+" "+i+"px":""}},M=function(e,t,r){if(e.indexOf(l.ENDPOINT_IMAGES+"?source=")>-1){var i=/height=[0-9]+/i;e.search(i)&&(e=e.replace(i,"height="+t));var a=/width=[0-9]+/i;return e.search(a)&&(e=e.replace(a,"width="+r)),e}return l.ENDPOINT_IMAGES+"?source="+e+"&height="+t+"&width="+r};if("object"==typeof S&&"IMG"===t.nodeName){var w=D();I=w.imageHeight,E=w.imageWidth;var U=!S.setMinHeightBeforeImageLoad||!e.utils.unwrapObservable(S.isSetMinHeightBeforeImageLoad)||e.utils.unwrapObservable(S.isSetMinHeightBeforeImageLoad);if(t.parentNode&&U){var k=t.parentNode;if("cc_img__resize_wrapper"!==k.getAttribute("id")){var x=document.createElement("div");t.onload=function(){if(x.style.minHeight="0px",this.src.indexOf(u)>-1&&O()&&!this.dataset.lazyLoading){for(var e="",r="",i=0;i<A.length;i++){var a=D(A[i]),o=N(A[i],a,u);o&&e.indexOf(o)<0&&(e=e?e+","+o:o);var s=L(a);s&&(r=r?r+","+s:s)}!e||void 0!==t.srcset&&t.srcset===e||(t.srcset=e),!r||void 0!==t.sizes&&t.sizes===r||(t.sizes=r)}},x.style.maxWidth="100%",x.style.minHeight=I+"px",x.style.height="100%";var G=e.utils.unwrapObservable(S.id);G?x.setAttribute("id","cc_img__resize_wrapper-"+G):x.setAttribute("id","cc_img__resize_wrapper"),k.replaceChild(x,t),x.appendChild(t)}}b=R(),n=e.utils.unwrapObservable(S.source),n?(s=O()?n:M(n,I,E),b&&(s+=b)):s=S.errorSrc,c=e.utils.unwrapObservable(S.errorSrc),null!=c&&0!=c.length||(c=l.SITE_DEFAULT_NO_IMAGE_URL),d=e.bindingHandlers.ccResizeImage.getNoImageSiteSetting(o),u=d&&d.length>0?d:c,n=encodeURI(n),0==n.indexOf(l.SITE_DEFAULT_NO_IMAGE_URL)&&(s=u,n=u),h||(h=e.utils.unwrapObservable(S.alt)),g||(g=e.utils.unwrapObservable(S.title)),f=e.utils.unwrapObservable(S.errorAlt),m=e.utils.unwrapObservable(S.onerror);var F=o.$masterViewModel,H=e.utils.unwrapObservable(S.disableLazyImageLoading);if(H||!F||!F.storeConfiguration||F.storeConfiguration.lazilyLoadImages!==!0||"prerenderReady"in window||n===u||p.isImageVisible(t,s)||(T=!0),
T&&(v=e.utils.unwrapObservable(S.initialSrc),v?(y=O()?v:M(v,I,E),b&&(y+=b)):v=S.errorSrc?S.errorSrc:u,v=encodeURI(v),0==v.indexOf(l.SITE_DEFAULT_NO_IMAGE_URL)&&(y=u,v=u),F.storeConfiguration.delayBeforeLoadingOutOfFocusImages&&(P=F.storeConfiguration.delayBeforeLoadingOutOfFocusImages)),s){if(h&&(t.alt=h),g&&(t.title=g),t.onerror=function(){var e=new Image;e.onload=function(){t.src=u,t.srcset&&t.removeAttribute("srcset"),t.sizes&&t.removeAttribute("sizes"),m&&m(t),t.onerror=""},e.onerror=function(){var e=new Image;e.onload=function(){t.src=e.src,t.srcset&&t.removeAttribute("srcset"),t.sizes&&t.removeAttribute("sizes"),m&&m(t),t.onerror=""},e.onerror=function(){t.src=l.SITE_DEFAULT_NO_IMAGE_URL,t.srcset&&t.removeAttribute("srcset"),t.sizes&&t.removeAttribute("sizes"),m&&m(t),t.onerror=""},e.src=c},s===u&&(u=u===d?c:l.SITE_DEFAULT_NO_IMAGE_URL),e.src=u,f&&(t.alt=f)},T?(t.dataset.errorSrc=u,t.dataset.defaultErrorSrc=c,m&&(t.dataset.onerror=m),f&&(t.dataset.errorAlt=f),p.setupLazyLoadStyling(t,S),t.dataset.src=s,p.observeLazyImage(t,P),t.src=y):t.src=s,O()&&s!==u){for(var V="",Y="",q=0;q<A.length;q++){var B=D(A[q]),W=N(A[q],B,n);W&&V.indexOf(W)<0&&(V=V?V+","+W:W);var j=L(B);j&&(Y=Y?Y+","+j:j)}V&&(T?t.dataset.srcset=V:t.srcset=V),Y&&(T?t.dataset.sizes=Y:t.sizes=Y)}if(T&&O()&&y!==u){for(var K="",Q="",q=0;q<A.length;q++){var B=D(A[q]),W=N(A[q],B,v);W&&K.indexOf(W)<0&&(K=K?K+","+W:W);var j=L(B);j&&(Q=Q?Q+","+j:j)}K&&(t.srcset=K),Q&&(t.sizes=Q)}}else t.src=u,f?t.alt=f:h&&(t.alt=h),m&&m(t)}}},e.bindingHandlers.ccNumber={update:function(t,r,i,a,s){var n=r(),c=e.utils.unwrapObservable(n),l=null;l=o.formatNumber(c),$(t).text(l)}},e.bindingHandlers.setContextVariable={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());o["$"+s.name]=e.utils.unwrapObservable(s.value)}},e.virtualElements.allowedBindings.setContextVariable=!0,e.bindingHandlers.element={init:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r()),c=a.jsPath()+"/";for(var l in a.elementsJs)if(s===l&&a.elementsJs.hasOwnProperty(l)){var d=a.elementsJs[l]();if(null!==d){var u="widget/",p=d.indexOf(u)+u.length;d.substring(0,p-1),d.lastIndexOf(".");require({baseUrl:c},[d],function(e){"function"==typeof e?e():e.hasOwnProperty("onLoad")&&"function"==typeof e.onLoad&&e.onLoad(a);var t=e.elementName;a.hasOwnProperty(t)?n.warn("Element name "+t+" is same as existing property"):a[t]=e,a.elements[t]=e,a.initialized()&&a.initialized.valueHasMutated()})}}return{controlsDescendantBindings:!0}},update:function(t,r,i,a,o){var s,n,c=e.utils.unwrapObservable(r());if(c){if("string"==typeof c)s=c;else{if("object"!=typeof c||void 0==c.type)return;s=c.type,void 0!=c.id&&(n=c.id)}n&&""!==n||(n=i().id&&""!==i().id?i().id:"id");var l=o.$data.id&&o.$data.id()?o.$data.id():"",d=o.$data.typeId&&o.$data.typeId()?o.$data.typeId():"",u={};u.type=s,u.fullType=d+"-"+s,u.id=n,u.textId="text."+n,u.elementId=l+"-"+s+"-"+n,u.styles="",""!==n&&o.$elementConfig&&(u.config=o.$elementConfig[n],u.config&&u.config.font&&(u.styles=u.config.font.styles||"",u.config.font.styles.display&&"block"===u.config.font.styles.display&&u.config.padding&&(u.config.padding.paddingTop>0||u.config.padding.paddingBottom>0||u.config.padding.paddingLeft>0||u.config.padding.paddingRight>0)&&(u.styles.padding=u.config.padding.paddingTop+"px "+u.config.padding.paddingRight+"px "+u.config.padding.paddingBottom+"px "+u.config.padding.paddingLeft+"px"))),$(t).attr("id",u.elementId),""!=u.styles&&$(t).css(u.styles),o.$elementInstance=u;var p={};p.name=u.fullType,p.data=a,p.url="",e.bindingHandlers.template.update(t,function(){return p},i,a,o)}}},e.bindingHandlers.addTemplate={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());"string"==typeof s&&$(s).not("text").each(function(){var e=this.id;e&&""!==e&&0==$("body").find("#"+e).length&&$("body").append(this)})}},e.virtualElements.allowedBindings.addTemplate=!0,e.bindingHandlers.previewBar={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if(s&&o.$data.previewBar){var n=o.$data.previewBar,c=n.cssPath,l=n.templateUrl,d=n.templateName;$("link[href='"+c+"']").length||$('<link href="'+c+'" rel="stylesheet">').appendTo("head");var u={};u.name=d,u.data=a,u.templateUrl=l,u.afterRender=n.attachEventHandlers,$.when(n.ojLoaded).done(function(){e.bindingHandlers.template.update(t,function(){return u},i,a,o)})}}},e.virtualElements.allowedBindings.previewBar=!0,e.bindingHandlers.noIndexMeta={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());s?e.virtualElements.setDomNodeChildren(t,f):e.virtualElements.emptyNode(t)}},e.virtualElements.allowedBindings.noIndexMeta=!0,e.bindingHandlers.embeddedAssistance={init:function(t,r,i,a,o){var s=r();s.subscribe(function(){e.bindingHandlers.embeddedAssistance.update(t,r,i,a,o)})},update:function(t,r,i,a,o){var s=r();s.extend({validatable:!0});var n=!1,c=!1;n=s.isModified()&&s().length>0,c=s.isValid();var l=function(){return n?c?null:s.embeddedAssistance:null},d=function(){return!!n&&!c};e.bindingHandlers.text.update(t,l),e.bindingHandlers.visible.update(t,d)}},e.extenders.propertyWatch=function(t){return t.initialState=e.observable(e.toJSON(t)),t.resetWatch=function(){t.initialState(e.toJSON(t))},t.hasChanged=e.computed(function(){var r=t.initialState()!==e.toJSON(t);return r&&t.resetWatch(),r}).extend({notify:"always",throttle:100}).extend({notify:"always"}),t},e.extenders.trigger=function(t,r){return t.triggerSet=!1,t.triggerValue=null,t.triggerMessage="",t.triggerFired=e.observable(!1),r&&(r.value&&(t.triggerValue=r.value,t.triggerSet=!0),r.message&&(t.triggerMessage=r.message)),t.trigger=function(e){t()===t.triggerValue?t.triggerFired(!0):t.triggerFired(!1)},t.clearTrigger=function(){t.triggerFired(!1)},t.triggerSet&&t.subscribe(t.trigger),t},e.bindingHandlers.accessControl={init:function(t,r,i){var a=i().accessControl,o=a.defaultAction?a.defaultAction:l.HIDE;s.isAuthorized(a.accessKey)?o===l.SHOW&&($(t).hide(),e.virtualElements.emptyNode(t)):o===l.SHOW||($(t).hide(),e.virtualElements.emptyNode(t))}},e.virtualElements.allowedBindings.accessControl=!0,e.showMoreArray=function(t,r){var i=e.observableArray(t);return i.limit=r,i.showAll=e.observable(!1),i.showButton=i().length>i.limit,i.toggleShowAll=function(){i.showAll(!i.showAll())},i.display=e.computed(function(){return i.showAll()||!i.showButton?i():i().slice(0,i.limit)},i),i},e.bindingHandlers.agentBar={update:function(t,r,i,a,o){var s=e.utils.unwrapObservable(r());if(s){var n=(o.$data,"/shared/css/agent-bar.css");$("link[href='"+n+"']").length||$('<link href="'+n+'" rel="stylesheet">').appendTo("head");var c={};c.name="agent-bar.template",c.data=a,c.templateUrl="/shared/templates",e.bindingHandlers.template.update(t,function(){return c},i,a,o)}}},e.virtualElements.allowedBindings.agentBar=!0,e.extenders.numeric=function(t,r){var i=e.computed({read:t,write:function(e){var i=/^-?[0-9]+([.][0-9]+)?$/,a=i.test(e);if(t(e),a){var o=t(),s=Math.pow(10,r),n=isNaN(e)?0:+e,c=Math.round(n*s)/s;c!==o?t(c):e!==o&&t.notifySubscribers(t())}}}).extend({notify:"always"});return i(t()),i},e.bindingHandlers.fireChange={update:function(e,t,r){var i=r();if(null!=i.value&&(!$(e).data("previousVal")||$(e).data("previousVal")!=i.value)){i.event.change();var a=i.value;$(e).data("previousVal",a)}}}}),define("ccKoErrorWrapper",["knockout","ccLogger","ccRestClient"],function(e,t,r){"use strict";function i(r){return function(){try{return r.apply(this,arguments)}catch(r){t.error(r);var i=arguments[0],a=e.contextFor($(i)[0]).$root;if(a&&a.isPreview&&a.isPreview()){var o=$(i).parents(".widget-container,.stack-container");o.length>0&&(o.find(".stack-template,.displayTemplate").addClass("error"),o.find("div.display-error").show(),o.find("span.error-msg").first().text(r.message));var s=$(i).prev("div.sf-display-error");0==s.length&&(s=$(i).parents().prev("div.sf-display-error")),s.length>0&&(s.show(),s.find("span.sf-error-msg").text(r.message),s.next("div").addClass("sf-error"))}}}}var a,o=["attr","css","template","text","style","value"];if(r.previewMode)for(a in o){var s=o[a];if(e.bindingHandlers[s]&&e.bindingHandlers[s].update){var n=e.bindingHandlers[s].update;e.bindingHandlers[s].update=i(n)}}}),define("shared/store-loader",["knockout","koMapping","koExternalTemplate","bootstrap","koExtensions","ccKoExtensions","ccKoValidateRules","ccKoErrorWrapper"],function(e,t){"use strict";$.uiBackCompat=!1,infuser.defaults.templateSuffix=".template",e.mapping=t,Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),r=this,i=function(){},a=function(){return r.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,a.prototype=new i,a})}),define("ccResourceLoader",["module","ccLogger"],function(e,t){function r(e){var t=e.indexOf(a),r=e.indexOf(o);if(r==-1&&(r=e.indexOf(s)),t>-1&&r>-1)return e.substring(t,r)}function i(){function a(e,t){i.moduleUrls[e]=t}function o(e){return i.moduleUrls[e]}function s(t,o,s){var n=e.config();o(n.jsUrls,function(){for(var e=arguments,o=0;o<e.length;o++){var c=e[o];c&&(i.modules.push(c),c.onLoad&&c.onLoad());var l=r(n.jsUrls[o]);a(l,n.jsUrls[o])}s(t)})}function c(e,r,i){var a=o(e);a?r([a],function(e){i(e)},function(r){t.error("Module "+e+" could not be loaded :"+r),i()}):(t.warn(" Url for Module "+e+" was not found."),i())}var l=this;i.moduleUrls={},i.modules=[],l.load=function(t,r,i,a){e.config();a.isBuild?i():t==n?s(t,r,i):c(t,r,i)},l.callAppLevelJsMethod=function(e,t){for(var r=0;r<i.modules.length;r++){var a=i.modules[r];e in a&&"function"==typeof a[e]&&a[e].apply(a,t)}}}var a="global",o=".min.js",s=".js",n="APPLICATION_JS";return new i}),function(e,t,r){"function"==typeof define&&define.amd?define("jquerymswipe",["jquery"],function(i){return r(i,e,t),i.mobile}):r(e.jQuery,e,t)}(this,document,function(e,t,r,i){!function(e,t,r,i){function a(e){for(;e&&"undefined"!=typeof e.originalEvent;)e=e.originalEvent;return e}function o(t,r){var o,s,n,c,l,d,u,p,h,g=t.type;if(t=e.Event(t),t.type=r,o=t.originalEvent,s=e.event.props,g.search(/^(mouse|click)/)>-1&&(s=N),o)for(u=s.length,c;u;)c=s[--u],t[c]=o[c];if(g.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1),g.search(/^touch/)!==-1&&(n=a(o),g=n.touches,l=n.changedTouches,d=g&&g.length?g[0]:l&&l.length?l[0]:i,d))for(p=0,h=O.length;p<h;p++)c=O[p],t[c]=d[c];return t}function s(t){for(var r,i,a={};t;){r=e.data(t,C);for(i in r)r[i]&&(a[i]=a.hasVirtualBinding=!0);t=t.parentNode}return a}function n(t,r){for(var i;t;){if(i=e.data(t,C),i&&(!r||i[r]))return t;t=t.parentNode}return null}function c(){G=!1}function l(){G=!0}function d(){Y=0,k.length=0,x=!1,l()}function u(){c()}function p(){h(),L=setTimeout(function(){L=0,d()},e.vmouse.resetTimerDuration)}function h(){L&&(clearTimeout(L),L=0)}function g(t,r,i){var a;return(i&&i[t]||!i&&n(r.target,t))&&(a=o(r,t),e(r.target).trigger(a)),a}function f(t){var r,i=e.data(t.target,A);!x&&(!Y||Y!==i)&&(r=g("v"+t.type,t),r&&(r.isDefaultPrevented()&&t.preventDefault(),r.isPropagationStopped()&&t.stopPropagation(),r.isImmediatePropagationStopped()&&t.stopImmediatePropagation()))}function m(t){var r,i,o,n=a(t).touches;n&&1===n.length&&(r=t.target,i=s(r),i.hasVirtualBinding&&(Y=V++,e.data(r,A,Y),h(),u(),U=!1,o=a(t).touches[0],M=o.pageX,w=o.pageY,g("vmouseover",t,i),g("vmousedown",t,i)))}function I(e){G||(U||g("vmousecancel",e,s(e.target)),U=!0,p())}function E(t){if(!G){var r=a(t).touches[0],i=U,o=e.vmouse.moveDistanceThreshold,n=s(t.target);U=U||Math.abs(r.pageX-M)>o||Math.abs(r.pageY-w)>o,U&&!i&&g("vmousecancel",t,n),g("vmousemove",t,n),p()}}function v(e){if(!G){l();var t,r,i=s(e.target);g("vmouseup",e,i),U||(t=g("vclick",e,i),t&&t.isDefaultPrevented()&&(r=a(e).changedTouches[0],k.push({touchID:Y,x:r.clientX,y:r.clientY}),x=!0)),g("vmouseout",e,i),U=!1,p()}}function y(t){var r,i=e.data(t,C);if(i)for(r in i)if(i[r])return!0;return!1}function b(){}function T(t){var r=t.substr(1);return{setup:function(){y(this)||e.data(this,C,{});var i=e.data(this,C);i[t]=!0,D[t]=(D[t]||0)+1,1===D[t]&&H.bind(r,f),e(this).bind(r,b),F&&(D.touchstart=(D.touchstart||0)+1,1===D.touchstart&&H.bind("touchstart",m).bind("touchend",v).bind("touchmove",E).bind("scroll",I))},teardown:function(){--D[t],D[t]||H.unbind(r,f),F&&(--D.touchstart,D.touchstart||H.unbind("touchstart",m).unbind("touchmove",E).unbind("touchend",v).unbind("scroll",I));var i=e(this),a=e.data(this,C);a&&(a[t]=!1),i.unbind(r,b),y(this)||i.removeData(C)}}}var P,S,C="virtualMouseBindings",A="virtualTouchID",_="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),O="clientX clientY pageX pageY screenX screenY".split(" "),R=e.event.mouseHooks?e.event.mouseHooks.props:[],N=e.event.props.concat(R),D={},L=0,M=0,w=0,U=!1,k=[],x=!1,G=!1,F="addEventListener"in r,H=e(r),V=1,Y=0;for(e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},S=0;S<_.length;S++)e.event.special[_[S]]=T(_[S]);F&&r.addEventListener("click",function(t){var r,i,a,o,s,n,c=k.length,l=t.target;if(c)for(r=t.clientX,i=t.clientY,P=e.vmouse.clickDistanceThreshold,a=l;a;){for(o=0;o<c;o++)if(s=k[o],n=0,a===l&&Math.abs(s.x-r)<P&&Math.abs(s.y-i)<P||e.data(a,A)===s.touchID)return t.preventDefault(),void t.stopPropagation();a=a.parentNode}},!0)}(e,t,r),function(e){e.mobile={}}(e),function(e,t){var i={touch:"ontouchend"in r};e.mobile.support=e.mobile.support||{},e.extend(e.support,i),e.extend(e.mobile.support,i)}(e),function(e,t,i){function a(t,r,a,o){var s=a.type;a.type=r,o?e.event.trigger(a,i,t):e.event.dispatch.call(t,a),a.type=s}var o=e(r),s=e.mobile.support.touch,n="touchmove scroll",c=s?"touchstart":"mousedown",l=s?"touchend":"mouseup",d=s?"touchmove":"mousemove";e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(t,r){e.fn[r]=function(e){return e?this.bind(r,e):this.trigger(r)},e.attrFn&&(e.attrFn[r]=!0)}),e.event.special.scrollstart={enabled:!0,setup:function(){function t(e,t){r=t,a(o,r?"scrollstart":"scrollstop",e)}var r,i,o=this,s=e(o);s.bind(n,function(a){e.event.special.scrollstart.enabled&&(r||t(a,!0),clearTimeout(i),i=setTimeout(function(){t(a,!1)},50))})},teardown:function(){e(this).unbind(n)}},e.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var t=this,r=e(t),i=!1;r.bind("vmousedown",function(s){function n(){clearTimeout(d)}function c(){n(),r.unbind("vclick",l).unbind("vmouseup",n),o.unbind("vmousecancel",c)}function l(e){c(),i||u!==e.target?i&&e.preventDefault():a(t,"tap",e)}if(i=!1,s.which&&1!==s.which)return!1;var d,u=s.target;r.bind("vmouseup",n).bind("vclick",l),o.bind("vmousecancel",c),d=setTimeout(function(){e.event.special.tap.emitTapOnTaphold||(i=!0),a(t,"taphold",e.Event("taphold",{target:u}))},e.event.special.tap.tapholdThreshold)})},teardown:function(){e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),o.unbind("vmousecancel")}},e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(e){var r=t.pageXOffset,i=t.pageYOffset,a=e.clientX,o=e.clientY;return 0===e.pageY&&Math.floor(o)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(a)>Math.floor(e.pageX)?(a-=r,o-=i):(o<e.pageY-i||a<e.pageX-r)&&(a=e.pageX-r,o=e.pageY-i),{x:a,y:o}},start:function(t){var r=t.originalEvent.touches?t.originalEvent.touches[0]:t,i=e.event.special.swipe.getLocation(r);return{time:(new Date).getTime(),coords:[i.x,i.y],origin:e(t.target)}},stop:function(t){var r=t.originalEvent.touches?t.originalEvent.touches[0]:t,i=e.event.special.swipe.getLocation(r);return{time:(new Date).getTime(),coords:[i.x,i.y]}},handleSwipe:function(t,r,i,o){if(r.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-r.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-r.coords[1])<e.event.special.swipe.verticalDistanceThreshold){var s=t.coords[0]>r.coords[0]?"swipeleft":"swiperight";return a(i,"swipe",e.Event("swipe",{target:o,swipestart:t,swipestop:r}),!0),a(i,s,e.Event(s,{target:o,swipestart:t,swipestop:r}),!0),!0}return!1},eventInProgress:!1,setup:function(){var t,r=this,i=e(r),a={};t=e.data(this,"mobile-events"),t||(t={length:0},e.data(this,"mobile-events",t)),t.length++,t.swipe=a,a.start=function(t){if(!e.event.special.swipe.eventInProgress){e.event.special.swipe.eventInProgress=!0;var i,s=e.event.special.swipe.start(t),n=t.target,c=!1;a.move=function(t){s&&!t.isDefaultPrevented()&&(i=e.event.special.swipe.stop(t),c||(c=e.event.special.swipe.handleSwipe(s,i,r,n),c&&(e.event.special.swipe.eventInProgress=!1)),Math.abs(s.coords[0]-i.coords[0])>e.event.special.swipe.scrollSupressionThreshold&&t.preventDefault())},a.stop=function(){c=!0,e.event.special.swipe.eventInProgress=!1,o.off(d,a.move),a.move=null},o.on(d,a.move).one(l,a.stop)}},i.on(c,a.start)},teardown:function(){var t,r;t=e.data(this,"mobile-events"),t&&(r=t.swipe,delete t.swipe,t.length--,0===t.length&&e.removeData(this,"mobile-events")),r&&(r.start&&e(this).off(c,r.start),r.move&&o.off(d,r.move),r.stop&&o.off(l,r.stop))}},e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(t,r){e.event.special[t]={setup:function(){e(this).bind(r,e.noop)},teardown:function(){e(this).unbind(r)}}})}(e,this)}),require.config({baseUrl:"js",packages:["packageAce",{name:"packageAce",location:"/shared/js/libs/ace",main:"ace"}],shim:{jqueryui:{deps:["jquery"]},jquerymobile:{deps:["jquery"]},jquery:{deps:[],exports:"$"},trafficCop:{deps:["jquery"]},infuser:{deps:["jquery","trafficCop"]},spectrumColorPicker:{deps:["jquery"]},bootstrapDatePicker:{deps:["jquery"]},bootstrapTimePicker:{deps:["jquery"]},bootstrap:{deps:["jquery"]},bstypeahead:{deps:["jquery"]},tagsInput:{deps:["jquery"]},chosen:{deps:["jquery"]},imagesloaded:{deps:["jquery"]},facebook:{exports:"FB"}},paths:{jqueryui:"/shared/js/libs/jquery-ui-1.12.1.custom.min",jquerymswipe:"/shared/js/libs/jquery.mobile.swipe-1.4.5.min",i18next:"/shared/js/libs/i18next.3.5.0.min",i18nextBackend:"/shared/js/libs/i18nextXHRBackend.1.2.1",tagsInput:"/shared/js/libs/jquery.tagsinput-1.3.5",chosen:"/shared/js/libs/chosen.jquery-1.8.7.min",koMapping:"/shared/js/libs/knockout.mapping-2.4.1.min",koValidate:"/shared/js/libs/knockout.validation-2.0.3",trafficCop:"/shared/js/libs/TrafficCop-modified",infuser:"/shared/js/libs/infuser",bootstrap:"/shared/js/libs/bootstrap.3.1.1",bootstrapDatePicker:"/shared/js/libs/bootstrap-datepicker",bootstrapDatePickerLocales:"/shared/js/libs/locales",bootstrapTimePicker:"/shared/js/libs/bootstrap-timepicker",bootstrapSlider:"/shared/js/libs/bootstrap-slider",spectrumColorPicker:"/shared/js/libs/spectrum-1.7.0",bstypeahead:"/shared/js/libs/bootstrap3-typeahead",crossroads:"/shared/js/libs/crossroads-0.12.0.min",hasher:"/shared/js/libs/hasher-1.2.0",ccURLPatterns:"/shared/js/ccLibs/cc-url-patterns",moment:"/shared/js/libs/moment-2.22.2",momentLangs:"/shared/js/libs/moment",ccStoreConfiguration:"/shared/js/ccLibs/cc-store-configuration-1.0",profiletools:"/shared/js/ccLibs/profile-tools-1.0",ccConstants:"/shared/js/ccLibs/cc-constants",koExtensions:"/shared/js/ccLibs/ko-extensions",storageApi:"/shared/js/ccLibs/cc-storage-api-1.0",ccOAuthTimeout:"/shared/js/ccLibs/cc-oauth-timeout",ccRestClientConstructor:"/shared/js/ccLibs/cc-rest-client-1.0",ccRestClient:"/shared/js/ccLibs/storefront-rest-client",addThis:"/shared/js/ccLibs/addThis",koExternalTemplate:"/shared/js/ccLibs/koExternalTemplateEngine-amd-2.0.5-modified",ccKoExtensions:"/shared/js/ccLibs/cc-ko-extensions",ccKoOjExtensions:"/shared/js/ccLibs/cc-ko-oj-extensions",ccKoErrorWrapper:"/shared/js/ccLibs/cc-ko-error-wrapper",xDomainProxy:"/shared/js/ccLibs/xdomain-proxy",pubsub:"/shared/js/ccLibs/pubsub-1.0",pubsubImpl:"/shared/js/ccLibs/pubsub-impl",routing:"/shared/js/ccLibs/routing-3.0",notifier:"/shared/js/ccLibs/notifier-1.0",notifications:"/shared/js/ccLibs/notifications-1.0",storeKoExtensions:"/shared/js/ccLibs/store-ko-extensions",ccLogger:"/shared/js/ccLibs/ccLogger-1.0",CCi18n:"/shared/js/ccLibs/cc-i18n",ccKoValidateRules:"/shared/js/ccLibs/cc-ko-validate-rules",paginated:"/shared/js/ccLibs/paginated",ccPaginated:"/shared/js/ccLibs/cc-paginated",spinner:"/shared/js/ccLibs/spinner-1.0",placeholderPatch:"/shared/js/ccLibs/cc-placeholder",imagesloaded:"/shared/js/libs/imagesloaded.pkgd-3.1.8",ccDate:"/shared/js/ccLibs/cc-date-format-1.0",ccNumber:"/shared/js/ccLibs/cc-number-format-1.0",ccPasswordValidator:"/shared/js/ccLibs/cc-password-validator",swmRestClientConstructor:"/shared/js/ccLibs/swm-rest-client-1.0",swmRestClient:"/shared/js/ccLibs/swm-storefront-rest-client",swmKoValidateRules:"/shared/js/ccLibs/swm-ko-validate-rules",ccResourceLoader:"/shared/js/ccLibs/cc-resource-loader",navigation:"/shared/js/ccLibs/cc-navigation-1.0",ccNavState:"/shared/js/ccLibs/cc-nav-state",facebook:"/shared/js/ccLibs/load-facebookjs-error-handler-1.0",facebookjs:"/shared/js/ccLibs/facebook_sdk",pinitjs:"/shared/js/ccLibs/pinit_sdk",imageZoom:"/shared/js/ccLibs/image-zoom",ccImageZoom:"/shared/js/ccLibs/cc-image-zoom-2.0",pageViewTracker:"/shared/js/ccLibs/pageViewTracker-1.0",currencyHelper:"/shared/js/ccLibs/currency-helper",profileHelper:"/shared/js/ccLibs/profile-helper",ccEETagProcessor:"/shared/js/ccLibs/cc-ee-tag-processor-1.0",viewportHelper:"/shared/js/ccLibs/viewport-helper",parentOrganisation:"/shared/js/ccLibs/parentOrganisation",ccClientErrorCodes:"/shared/js/ccLibs/cc-client-error-codes",sfExceptionHandler:"/shared/js/ccLibs/sf-exception-handler",ccStoreServerLogger:"/shared/js/ccLibs/cc-store-server-logger-1.0",ccStoreUtils:"/shared/js/ccLibs/cc-store-utils-1.0",dateTimeUtils:"/shared/js/ccLibs/date-time-utils",numberFormatHelper:"/shared/js/ccLibs/number-format-helper",ccStoreConfiguration:"/shared/js/ccLibs/cc-store-configuration-1.0",ccLazyImages:"/shared/js/ccLibs/cc-lazy-images",hammerjs:"/js/oraclejet/js/libs/hammer/hammer-2.0.4.min",jquery:"/js/oraclejet/js/libs/jquery/jquery-2.1.3.min","jqueryui-amd":"/js/oraclejet/js/libs/jquery/jqueryui-amd-1.11.4.min",knockout:"/js/oraclejet/js/libs/knockout/knockout-3.4.0",ojdnd:"/js/oraclejet/js/libs/dnd-polyfill/dnd-polyfill-1.0.0.min",ojs:"/js/oraclejet/js/libs/oj/v2.0.2/min",ojL10n:"/js/oraclejet/js/libs/oj/v2.0.2/ojL10n",ojtranslations:"/js/oraclejet/js/libs/oj/v2.0.2/resources",ojswitch:"/js/oraclejet/js/libs/oj/v2.0.2/ojswitch",promise:"/js/oraclejet/js/libs/es6-promise/promise-1.0.0.min",signals:"/js/oraclejet/js/libs/js-signals/signals.min",template:"/js/oraclejet/js/libs/require/text",customElements:"/js/oraclejet/js/libs/webcomponents/CustomElements",pageLayout:"/shared/js/pageLayout",viewModels:"/shared/js/viewModels",shared:"/shared/js"},waitSeconds:45});var paths={layoutContainer:"pageLayout/layout-container"};if("function"==typeof configurePaths&&configurePaths(paths),"undefined"==typeof container)var container;var requiredDependencies=[];window.storeLibsPath?requiredDependencies.push(window.storeLibsPath):requiredDependencies.push("shared/store-libs"),window.clientConfigData&&"true"==window.clientConfigData.loadOjDependentBindings&&(window.ccKoOjExtensionsPath?requiredDependencies.push(window.ccKoOjExtensionsPath):requiredDependencies.push("ccKoOjExtensions")),require(requiredDependencies,function(){require(["jquery","ccConstants","spinner","pubsub","profiletools","knockout","koValidate","ccKoValidateRules",paths.layoutContainer,"pageLayout/rest-adapter","storageApi","pageLayout/api-builder","routing","CCi18n","ccDate","ccEETagProcessor","ccRestClient","addThis","ccOAuthTimeout","viewportHelper","shared/store-loader","ccResourceLoader!APPLICATION_JS","jquerymswipe","ccLazyImages"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I,E,v,y,b){"use strict";function T(e,t){m.samlLogin(e,P,S,t)}function P(t){e.Topic(i.topicNames.SAML_LOGIN_SUCCESSFUL).publish()}function S(t){e.Topic(i.topicNames.SAML_LOGIN_FAILURE).publishWith(self,[t])}function C(){e.Topic(i.topicNames.CART_LOADED).unsubscribe(C),T(getSamlResponse(),getRelayState())}function A(){m.storeToken(getAgentAuthToken()),m.setStoredValue("cc-agent-redirect-url",getAgentRedirectUrl()),window.location.assign(window.location.href)}function _(){m.storeToken(getOAuthToken());var e=getAdditionalFormData();e&&m.setStoredValue("cc-additional-form-data",JSON.stringify(e)),window.location.assign("/")}if(container===t.CONTAINER_DESIGN_STUDIO){var O=!1,R=!1;e.Topic(i.topicNames.PAGE_CHANGED).subscribe(function(){O||R||(r.createWithTimeout({parent:"body",posTop:"200px"},1e4,function(){e(".modal-backdrop").remove()}),e(".cc-spinner").css("z-index","20000"),O=!0),R=!1}),e.Topic(i.topicNames.PAGE_READY).subscribe(function(){O?(r.destroyWithoutDelay("body"),O=!1,R=!1):R=!0}),f.enabled=!1}if("function"==typeof getSamlResponse&&null!=getSamlResponse()&&getSamlResponse().length>0){d.getInstance().saveToMemory(t.CC_IS_SSO_LOGIN_UNDER_PROGRESS,!0);var N=m.getSessionStoredValue("SSO_RETURN_URL");null==N&&(N="/"),window.history.replaceState(null,"",N),e.Topic(i.topicNames.CART_LOADED).subscribe(C)}"function"==typeof getAgentAuthToken&&null!=getAgentAuthToken()&&getAgentAuthToken().length>0&&m.registerInitCallback(A),"function"==typeof getOAuthToken&&null!=getOAuthToken()&&getOAuthToken().length>0&&m.registerInitCallback(_);var D=new l("/ccstore/v1/"),L="/",M=new c(D,L),w=new M.LayoutViewModel;new p,new E(m);M.masterViewModel(w),f.init(),infuser.defaults.templateSuffix="";var U={};U.errorsAsTitle=!1,U.insertMessages=!1,U.decorateElement=!0,U.errorElementClass="invalid",o.validation.init(U);var k={compatibilityJSON:"v1",compatibilityAPI:"v1",ns:{namespaces:["ns.common","ns.ccformats"],defaultNs:["ns.common"]},fallbackLng:["en"],useLocalStorage:!1,useCookie:!1,debug:!1,contextSeparator:":",resGetPath:"/ccstoreui/v1/resources/__ns__?locale=__lng__",backend:{ajax:h.ajax}};h.deferInit(k,function(){w.previewMessage(h.t("ns.common:resources.previewMessage")),w.oboShopperName(h.t("ns.common:resources.fullName",{firstName:w.data.global.user.firstName,lastName:w.data.global.user.lastName})),w.sharedWidgetMessage(h.t("ns.common:resources.sharedWidget")),w.oboShopperMessage(h.t("ns.common:resources.shoppingAsText")),w.displayErrorMessage(h.t("ns.common:resources.displayError")),""==w.pageChangeMessage()&&(w.dataForPageChangeMessage().page.category?w.pageChangeMessage(h.t("ns.common:resources.categoryPageLoadedText",{collection:w.dataForPageChangeMessage().page.category.displayName})):w.dataForPageChangeMessage().page.product?w.pageChangeMessage(h.t("ns.common:resources.productPageLoadedText",{product:w.dataForPageChangeMessage().page.product.displayName})):"userSpacesPage"===w.dataForPageChangeMessage().page.repositoryId?w.pageChangeMessage(h.t("ns.common:resources.wishlistPageLoadedText")):"searchResultsPage"!=w.dataForPageChangeMessage().repositoryId&&w.pageChangeMessage(h.t("ns.common:resources.pageLoadedText",{page:w.dataForPageChangeMessage().page.repositoryId})))});var x=window.location.protocol+"//"+window.location.host,G=function(e,t){var r;if(e.canonicalRoute){var i=e.canonicalRoute;o.isObservable(i)&&(i=o.utils.unwrapObservable(i)),r=x+i}w.canonicalRoute(r),w.agentReturnUrl=m.getStoredValue("cc-agent-redirect-url"),w.alternates(e.alternates),w.nextPageNo(null),w.prevPageNo(null),w.currPageNo(""),w.paginationDone(!1),w.isObo(null!=w.data.global.agentId)},F=function(e){w.nextPageNo(e.nextPageNo),w.prevPageNo(e.prevPageNo),w.currPageNo(e.currPageNo),w.paginationDone()!==!0?w.paginationDone(!0):w.paginationDone.valueHasMutated()},H=function(e){w.title(e.title()),w.keywords(e.keywords()),w.description(e.description()),w.metaTags(e.metaTags()),w.isPreview(e.isPreview()),w.noindex(e.noindex()),v.layoutViewports(e.viewports?e.viewports():"")};e.Topic(i.topicNames.PAGE_LAYOUT_UPDATED).subscribe(G),e.Topic(i.topicNames.PAGE_PAGINATION_CALCULATED).subscribe(F),e.Topic(i.topicNames.PAGE_METADATA_CHANGED).subscribe(H),w.name=o.observable("Master View Model"),w.itemBeforeRemove=function(t,r,i){e(t).remove()},w.itemAfterAdd=function(e,t,r){},w.afterRender=function(e,t){},u.widgetBuilder(M.WidgetViewModel,M),u.regionBuilder(M.RegionViewModel,M),M.WidgetViewModel.prototype.profileTools=new a,o.applyBindings(w,document.getElementById("oracle-cc")),"function"==typeof waitForRenderComplete&&waitForRenderComplete(o,M,w)})}),define("js/main",function(){}),define("ccStoreUtils",["knockout"],function(e){"use strict";function t(){}return t.prototype.fromJS=function(t,r,i,a,o,s){var n=[];if(i)for(var c in t)n.push(c);if(!i&&a&&a.length>0)for(var c in t)t[c]instanceof Object&&!(t[c]instanceof Array)&&n.push(c);var l={copy:n,observe:a,ignore:o,include:s};e.mapping.fromJS(t,l,r)},t.prototype.getEntityCountLimitInGetRequest=function(e,t){return e<t?e:-1},new t}),define("shared/ccLibs/cc-store-utils-1.0",function(){}),define("pageLayout/data",["knockout"],function(e){"use strict";function t(){}return t}),define("pageLayout/layout",["jquery","knockout","ccConstants","ccStoreConfiguration"],function(e,t,r,i){"use strict";function a(){var a=this;this.MAX_ROW_COLUMNS=12,this.layoutName=t.observable(),this.regions=t.observableArray([]),this.title=t.observable(),this.keywords=t.observable(),this.description=t.observable(),this.metaTags=t.observable(),this.isPreview=t.observable(),this.isObo=t.observable(!1),this.oboShopperName=t.observable(),this.previewMessage=t.observable(),this.oboShopperMessage=t.observable(),this.sharedWidgetMessage=t.observable(),this.displayErrorMessage=t.observable(),this.storeConfiguration=i.getInstance(),this.containPage=t.observable(!0),this.containHeader=t.observable(!1),this.containMain=t.observable(!1),this.containFooter=t.observable(!1),this.pageChangeMessage=t.observable(""),this.dataForPageChangeMessage=t.observable(),this.headerRows=t.observableArray().extend({deferred:!0}),this.bodyRows=t.observableArray().extend({deferred:!0}),this.footerRows=t.observableArray().extend({deferred:!0}),this.canonicalRoute=t.observable(),this.alternates=t.observableArray(),this.prevPageNo=t.observable(),this.nextPageNo=t.observable(),this.currPageNo=t.observable(""),this.supportedLocales=t.observableArray().extend({deferred:!0}),this.paginationDone=t.observable(!1),this.noindex=t.observable(!1);var o=["/checkout","/cart","/wishlist_settings","/searchresults","/nosearchresults","/confirmation","/error","/signup","/profile","/orderhistory","/orderdetails","/payment","/wishlist"];this.contentItemId=t.observable(),this.contentURL=t.observable();var s=[window.location.protocol,"//",window.location.host].join("").toLowerCase(),n=function(e){for(var t=document.head.querySelectorAll('[rel="'+e+'"]'),r=t.length,i=0;i<r;i++)document.head.removeChild(t[i])},c=function(e){var t="canonical";if(!e||0==e.toLowerCase().indexOf(s)){if(!e||o.indexOf(e.substring(s.length).toLowerCase())>=0)return void n(t);a.paginationDone()&&(e+=a.currPageNo());var r=document.head.querySelectorAll('[rel="'+t+'"]'),i=r.length;if(i>1&&n(t),1===i)r[0].href!==e&&(r[0].href=e);else{var c=document.createElement("link");c.rel=t,c.href=e,document.head.appendChild(c)}}};return this.paginationDone.subscribe(function(){a.canonicalRoute.valueHasMutated()}),this.canonicalRoute.subscribe(c),this.headerRegions=t.observableArray(),this.bodyRegions=t.observableArray(),this.footerRegions=t.observableArray(),this.buildRows=function(){var e=this.headerRegions(),i=this.bodyRegions(),a=this.footerRegions();this.headerRegions([]),this.bodyRegions([]),this.footerRegions([]);for(var o,s=0;s<this.regions().length;s++)o=this.regions()[s],t.unwrap(o.type)===r.REGION_TYPE_HEADER&&this.headerRegions.push(this.regions()[s]),t.unwrap(o.type)&&t.unwrap(o.type)!==r.REGION_TYPE_BODY||this.bodyRegions.push(this.regions()[s]),t.unwrap(o.type)===r.REGION_TYPE_FOOTER&&this.footerRegions.push(this.regions()[s]);this.calculateRows.call(this.headerRows,this.headerRegions(),e),
this.calculateRows.call(this.bodyRows,this.bodyRegions(),i),this.calculateRows.call(this.footerRows,this.footerRegions(),a)},this.calculateRows=function(e,r){var i,o=this,s={},n=0,c=[];if(e.length===r.length){for(var l=!0,d=0;d<e.length;d++)if(e[d].id()!==r[d].id()||e[d].width()!==r[d].width()){l=!1;break}if(l)return}if(t.isObservable(o)&&void 0!==o.removeAll){c=o(),c.splice(0,c.length),s.regions=t.observableArray().extend({deferred:!0});for(var d=0;d<e.length;d++)i=e[d],(n==a.MAX_ROW_COLUMNS||n+i.width()>a.MAX_ROW_COLUMNS)&&(c.push(s),s={},s.regions=t.observableArray().extend({deferred:!0}),n=0),s.regions.push(i),n+=i.width();c.push(s),o.valueHasMutated()}},this.subscribeArrayChanged=function(r,i,a){if(t.isObservable(r)){var o=r.peek();r.subscribe(function(t){var r=o;o=e.extend(!0,[],t),i.call(a,t,r)})}},this.hasWidgetType=function(e){var t;if(a.regions())for(var r=0;r<a.regions().length;r++)if(t=a.regions()[r],t.widgets().length)for(var i=0;i<a.regions().length;i++){var o=t.widgets()[i].typeId();if(o===e)return!0}return!1},this.formatHreflang=function(e){var r="";return e?(r=t.utils.unwrapObservable(e),r.replace(/_/g,"-")):r},this}return a}),define("pageLayout/region",["jquery","knockout","viewportHelper","pubsub"],function(e,t,r,i){"use strict";function a(){var a=this;return a.regions=t.observableArray(),a.widgets=t.observableArray(),a.width=t.observable(),a.offset=t.observable(),a.name=t.observable("defaultName"),a.metadata=t.observable(),a.similarRegions=new Object,a.widthClass=t.computed(function(){return r.getWidthClass(a.width(),a.offset())},a),a.globalWidgetsOnly=t.computed(function(){for(var e=0;e<a.widgets().length;e++)if(!a.widgets()[e].global())return!1;return!0},a),a.nextTab=function(){return a.validateWidgets()},a.previousTab=function(){return!0},a.validateWidgets=function(){var e=!0;for(var t in a.widgets())a.widgets()[t].checkForValidation()||(e=!1);return e},a.handleMetadata=function(){var r=a.metadata();if(r&&e.isPlainObject(r)&&!e.isEmptyObject(r)){var o=t.toJS(a.metadata);e.Topic(i.topicNames.REGION_METADATA_CHANGED).publish(o)}},this}return a}),define("notifier",["knockout","pubsub","jquery"],function(e,t,r){"use strict";function i(t,r,i,a,o,s){var n=this;n.id=e.observable(t),n.text=e.observable(r),n.type=e.observable(i),n.dismissable=e.observable(a),n.scrollToMessage=e.observable(o),n.alertClass=e.computed(function(){return"alert alert-"+n.type()}),n.messageStyle=e.observable(s)}function a(){var a=this;a.messageStyle=e.observable(""),a.types={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},a.sendMessage=function(e,o,s,n,c){var l=new i(e,o,s,n,c,a.messageStyle());r.Topic(t.topicNames.NOTIFICATION_ADD).publishWith(l,[{message:"success"}])},a.sendError=function(e,t,r){a.sendMessage(e,t,a.types.ERROR,!0,r)},a.sendWarning=function(e,t,r){a.sendMessage(e,t,a.types.WARNING,!0,r)},a.sendSuccess=function(e,t,r){a.sendMessage(e,t,a.types.SUCCESS,!0,r)},a.sendInfo=function(e,t,r){a.sendMessage(e,t,a.types.INFO,!0,r)};var o={};return a.sendMessageToPage=function(e,t,i,s,n,c){o[s]||(o[s]=r.Deferred()),o[s].done(function(){setTimeout(function(){a.sendMessage(e,t,c,n,i)},300),o[s]=null})},r.Topic(t.topicNames.PAGE_LAYOUT_UPDATED).subscribe(function(e,t){t.pageId&&o[t.pageId]&&o[t.pageId].resolve()}),a.sendErrorToPage=function(e,t,r,i,o){a.sendMessageToPage(e,t,r,i,!!o,a.types.ERROR)},a.sendWarningToPage=function(e,t,r,i,o){a.sendMessageToPage(e,t,r,i,o,a.types.WARNING)},a.sendSuccessToPage=function(e,t,r,i,o){a.sendMessageToPage(e,t,r,i,o,a.types.SUCCESS)},a.sendInfoToPage=function(e,t,r,i,o){a.sendMessageToPage(e,t,r,i,o,a.types.INFO)},a.sendTemplateMessage=function(e,a,o,s,n,c){var l=new i(e,o,s,n,c);r.Topic(t.topicNames.NOTIFICATION_TEMPLATE_ADD).publish(l,a,o)},a.sendTemplateError=function(e,t,r,i){a.sendTemplateMessage(e,t,r,a.types.ERROR,!1,i)},a.sendTemplateWarning=function(e,t,r,i){a.sendTemplateMessage(e,t,r,a.types.WARNING,!0,i)},a.sendTemplateSuccess=function(e,t,r,i){a.sendTemplateMessage(e,t,r,a.types.SUCCESS,!0,i)},a.sendTemplateInfo=function(e,t,r,i){a.sendTemplateMessage(e,t,r,a.types.INFO,!0,i)},a.clearMessage=function(e,a){var o=new i(e,"",a,!1,!1);r.Topic(t.topicNames.NOTIFICATION_DELETE).publishWith(o,[{message:"success"}])},a.clearError=function(e){a.clearMessage(e,a.types.ERROR)},a.clearWarning=function(e){a.clearMessage(e,a.types.WARNING)},a.clearSuccess=function(e){a.clearMessage(e,a.types.SUCCESS)},a.clearInfo=function(e){a.clearMessage(e,a.types.INFO)},a}return new a}),define("viewModels/messageHandler",["knockout","pubsub","notifier","notifications","jquery"],function(e,t,r,i,a){"use strict";function o(){var d=this;if(o.singleInstance)throw new Error("Cannot instantiate more than one MessageHandler, use getInstance()");return d.message=e.observable(),d.messageFlag=e.observable(),d.errorMsgs=Array(),d.warnMsgs=Array(),d.successMsgs=Array(),d.infoMsgs=Array(),d.pageId="",d.scrollIfNeccessary=function(e,t){if(e.scrollToMessage()){var r=a(t);r&&r.offset()&&a("html, body").animate({scrollTop:r.offset().top},1e3)}},d.updateMessages=function(){for(var e=this,t=0;t<e.errorMsgs.length;t++)if(e.errorMsgs[t].pageId==e.pageId)return e.message(e.errorMsgs[t]),void(e.messageFlag()||(i.notify([{style:e.message()&&"growl"===e.message().messageStyle()?"growl":"inline",status:"error",id:"#CC-messages",close:e.message().dismissable(),fade:!(!e.message()||"growl"!==e.message().messageStyle()),message:e.message().text()}]),a(".cc-notification-message").addClass("container"),e.messageFlag(!0),e.scrollIfNeccessary(e.message(),"#CC-messages")));for(var t=0;t<e.warnMsgs.length;t++)if(e.warnMsgs[t].pageId==e.pageId)return e.message(e.warnMsgs[t]),void(e.messageFlag()||(i.notify([{style:e.message()&&"growl"===e.message().messageStyle()?"growl":"inline",status:"warning",id:"#CC-messages",close:e.message().dismissable(),fade:!(!e.message()||"growl"!==e.message().messageStyle()),message:e.message().text()}]),a(".cc-notification-message").addClass("container"),e.messageFlag(!0),e.scrollIfNeccessary(e.message(),"#CC-messages")));for(var t=0;t<e.successMsgs.length;t++)if(e.successMsgs[t].pageId==e.pageId)return e.message(e.successMsgs[t]),void(e.messageFlag()||(i.notify([{style:e.message()&&"growl"===e.message().messageStyle()?"growl":"inline",status:"success",id:"#CC-messages",close:e.message().dismissable(),fade:!(!e.message()||"growl"!==e.message().messageStyle()),message:e.message().text()}]),a(".cc-notification-message").addClass("container"),e.messageFlag(!0),e.scrollIfNeccessary(e.message(),"#CC-messages")));for(var t=0;t<e.infoMsgs.length;t++)if(e.infoMsgs[t].pageId==e.pageId)return e.message(e.infoMsgs[t]),void(e.messageFlag()||(i.notify([{style:e.message()&&"growl"===e.message().messageStyle()?"growl":"inline",status:"info",id:"#CC-messages",close:e.message().dismissable(),fade:!(!e.message()||"growl"!==e.message().messageStyle()),message:e.message().text()}]),a(".cc-notification-message").addClass("container"),e.messageFlag(!0),e.scrollIfNeccessary(e.message(),"#CC-messages")));e.messageFlag(!1),i.emptyNotifications("#CC-messages"),e.message(null)},d.addMessage=function(e,r){var o=e.id();if(d.messageFlag()&&null!=d.message()){if(d.message().id()==o&&d.message().text()==e.text())return;i.emptyNotifications("#CC-messages"),a.Topic(t.topicNames.NOTIFICATION_DELETE).publishWith(d.message(),[{message:"success"}])}for(var s=0;s<r.length;s++)r[s].id()==o&&r[s].text(e.text());e.pageId=d.pageId,r.push(e),d.messageFlag(!1),d.updateMessages(),a(".close.cc-notification-close").on("click",function(){d.removeCurrentMessage(e)})},d.removeCurrentMessage=function(e){d.messageFlag()&&null!=d.message()&&d.message().id()==e.id()&&(a.Topic(t.topicNames.NOTIFICATION_DELETE).publishWith(e,[{message:"success"}]),d.messageFlag(!1),i.emptyNotifications("#CC-messages"),d.message(null))},d.removeMessage=function(e,t){for(var r=e.id(),i=0;i<t.length;i++)if(t[i].id()==r){t.splice(i,1),d.removeCurrentMessage(e);break}d.updateMessages()},d.removeAllMessages=function(){d.errorMsgs=[],d.warnMsgs=[],d.successMsgs=[],d.infoMsgs=[],d.updateMessages()},d.addMessageHandler=function(e){var t=this,i=t.type();switch(i){case r.types.ERROR:d.addMessage(t,d.errorMsgs);break;case r.types.WARNING:d.addMessage(t,d.warnMsgs);break;case r.types.SUCCESS:d.addMessage(t,d.successMsgs);break;case r.types.INFO:d.addMessage(t,d.infoMsgs)}},d.deleteMessageHandler=function(e){var t=this,i=t.type();switch(i){case r.types.ERROR:d.removeMessage(t,d.errorMsgs);break;case r.types.WARNING:d.removeMessage(t,d.warnMsgs);break;case r.types.SUCCESS:d.removeMessage(t,d.successMsgs);break;case r.types.INFO:d.removeMessage(t,d.infoMsgs)}},d.pageContextHandler=function(e){var t="";e&&e.pageId&&(t=e.pageId,e.contextId&&(t+="-"+e.contextId),d.pageId=t,d.removeAllMessages())},void 0!=s&&a.Topic(t.topicNames.NOTIFICATION_ADD).unsubscribe(s),s=d.addMessageHandler,void 0!=n&&a.Topic(t.topicNames.NOTIFICATION_DELETE).unsubscribe(n),n=d.deleteMessageHandler,void 0!=c&&a.Topic(t.topicNames.PAGE_VIEW_CHANGED).unsubscribe(c),c=d.pageContextHandler,void 0!=l&&a.Topic(t.topicNames.PAGE_VIEW_CHANGED).unsubscribe(l),l=d.removeAllMessages,a.Topic(t.topicNames.NOTIFICATION_ADD).subscribe(s),a.Topic(t.topicNames.NOTIFICATION_DELETE).subscribe(n),a.Topic(t.topicNames.PAGE_VIEW_CHANGED).subscribe(c),a.Topic(t.topicNames.USER_LOGOUT_SUCCESSFUL).subscribe(l),d.messageFlag(!1),d}var s,n,c,l;return o.getInstance=function(){return o.singleInstance||(o.singleInstance=new o,i.emptyNotifications("#CC-messages")),o.singleInstance},o}),define("pageLayout/widget",["knockout","CCi18n","ccDate","ccNumber","pubsub","ccConstants","viewModels/messageHandler","jquery","navigation"],function(e,t,r,i,a,o,s,n,c){"use strict";function l(r){function i(r){var i,a;if(s.localeResources)for(var o in s.localeResources){var c=e.toJS(s.localeResources[o].resources);s.customTranslations()&&(i=e.toJS(s.customTranslations()),a=s.mergeTextSnippetResources(c,i)),t.addResourceBundle(o,s.localeResources[o].namespace(),{resources:c});var l=t.t("ns."+s.i18nresources()+":resources",{returnObjectTrees:!0,interpolation:{prefix:"##",suffix:"##"}});n.extend(l,a),s.resources(l)}s.customTranslations()&&!s.resources()&&(i=e.toJS(s.customTranslations()),s.resources(i)),s.resources()&&s.resourcesLoaded&&s.resourcesLoaded(s)}var s=this;return this.basePath=r,this.initialized=e.observable(!1),this.occPrioritizedDisplay=e.observable(!1),this.deferredInit=n.Deferred(),this.id=e.observable(),this.typeId=e.observable(),this.rootPath=e.observable(),this.imagePath=e.observable(),this.templatePath=e.observable(),this.jsPath=e.observable(),this.i18nresources=e.observable(),this.resources=e.observable(),this.locale=e.observable(),this.customTranslations=e.observable(),this.widgetId=e.observable(),this.numberOnPage=e.observable(),this.isPreview=e.observable(),this.elements={},this.isShared=e.computed(function(){var e;return e=!!(this.numberOnPage&&this.numberOnPage()>1)||!!(this.pageIds&&this.pageIds().length>1)},this),this.contextDataLoaded=e.observable(!1),this.pageReady=function(){this.contextDataLoaded(!0),this.links&&c.isPathEqualTo(this.links().checkout.route)&&(n("#CC-headermodalpane").modal("hide"),n("body").removeClass("modal-open"),n(".modal-backdrop").remove())},n.Topic(a.topicNames.PAGE_READY).subscribe(s.pageReady.bind(s)),this.historyStack=[],this.prevHistoryLength=0,this.newHistoryLength=0,this.updateHistoryStackArray=function(e){var t;if(1===history.length)try{window.sessionStorage.removeItem(o.SESSION_STORAGE_HISTORY_STACK)}catch(e){}try{t=window.sessionStorage.getItem(o.SESSION_STORAGE_HISTORY_STACK)}catch(e){}if(t&&!s.historyStack.length&&(s.historyStack=JSON.parse(t)),s.prevHistoryLength=s.newHistoryLength,s.newHistoryLength=history.length,void 0!=e.oldHash&&s.links&&s.links().hasOwnProperty(404)){if(s.historyStack.length){var r=s.historyStack[s.historyStack.length-1];e.newHash===r.oldHash&&e.oldHash===r.newHash&&s.prevHistoryLength===s.newHistoryLength?s.historyStack.pop():s.historyStack[s.historyStack.length-1].oldHash==e.oldHash&&s.historyStack[s.historyStack.length-1].newHash==e.newHash||s.historyStack[s.historyStack.length-1].newHash!=e.oldHash||s.historyStack.push(e)}else s.historyStack.push(e);try{window.sessionStorage.setItem(o.SESSION_STORAGE_HISTORY_STACK,JSON.stringify(s.historyStack))}catch(e){}}},n.Topic(a.topicNames.UPDATE_HASH_CHANGES).subscribe(s.updateHistoryStackArray),this.mergeTextSnippetResources=function(e,t){var r={};if(e&&"object"==typeof e&&t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(i.indexOf(".")===-1?e[i]=t[i]:r[i]=t[i]);return r},this.localeSubscription=this.locale.subscribe(function(e){var r=this;t.setLocaleOnce(e.replace("_","-"),function(){r.localeSubscription.dispose(),r.deferUntilAllPropertiesSet(r,function(){i(r.i18nresources())})})},this),this.typeId.subscribe(function(e){this.rootPath(this.basePath+"widget/"+e),this.imagePath(this.rootPath()+"/images"),this.jsPath(this.rootPath()+"/js"),this.widgetId(e)},this),this.absoluteUrl=function(e){var t=e;return this.assetMappings&&(t=this.assetMappings[e]),t},this.templateAbsoluteUrl=function(e){var t=e;return this.assetMappings&&(t=this.assetMappings[e]()),t},this.notificationTemplateUrl=function(e){var t="/templates/";return t+=e+".template",this.absoluteUrl(t)()},this.redirectToLocalizedURL=function(e,t){var r=c.getLocaleBasedUrl(e);window.location.assign(r)},this.translate=function(e,r,i,a){var o="",n=e,c="";if(s.resources()){if(a&&null!=s.resources()[a]&&"null"!=s.resources()[a])return s.resources()[a];if(s.resources()[e]&&(o=s.resources()[e],o.indexOf("__")===-1))return o}return r?r.defaultValue&&(n=r.defaultValue,r.defaultValue=void 0):r={},void 0===i&&(i=!0),o="",s.i18nresources()&&""!==s.i18nresources()&&(c="ns."+s.i18nresources()+":resources."+e,o=t.t(c,r)),o===c&&(i?(r.defaultValue=n,o=t.t("ns.common:resources."+e,r)):o=n),o},this}return l.prototype.allPropertiesSet=function(e){e.deferredInit.resolveWith(e)},l.prototype.deferUntilAllPropertiesSet=function(e,t){e.deferredInit.done(t)},l.prototype.requiresRefresh=function(e){return!(!this.pageIds()||!e.pageIds()||this.pageIds().length===e.pageIds().length)},l.prototype.isActiveOnPage=function(e){return!(!this.global||!this.global())||!(!e||this.pageIds().indexOf(e.pageRepositoryId)==-1)},l.prototype.maybeFireBeforeAppearExtJSDeferred=function(e){return function(t,r){this.maybeFireBeforeAppear(t,r,e)}},l.prototype.maybeFireBeforeAppear=function(e,t,r){if(t||(t=this),t.isActiveOnPage(e)){var i=n.Deferred();if(i.done(function(e){t.hasBeforeAppear()&&t.beforeAppear(e),r&&r.done(function(){t.callExtJSBeforeAppear(t)})}),t.initialized())i.resolveWith(t,[e]);else var a=t.initialized.subscribe(function(r){r&&(i.resolveWith(t,[e]),a.dispose())})}},l.prototype.callExtJSBeforeAppear=function(e){e.__cc__extjs&&e.__cc__extjs.beforeAppear&&"function"==typeof e.__cc__extjs.beforeAppear&&e.__cc__extjs.beforeAppear.call(e)},l.prototype.hasBeforeAppear=function(){var e=!1;return"beforeAppear"in this&&"function"==typeof this.beforeAppear&&(e=!0),e},l.prototype.ccDate=function(e,t,i,a){return r.formatDateAndTime(e,t,i,a)},l.prototype.ccNumber=function(e){return i.formatNumber(e)},l.prototype.formatPrice=function(e,t){e=e.toFixed(t);var r=e.split("."),a=i.formatNumber(r[0],!0);return 0===t?a=a.substring(0,a.length-3):(a=a.substring(0,a.length-2),a+=r[1]),a},l.prototype.messageBox=s.getInstance(),l.prototype.checkForValidation=function(){return!this.validate||this.validate()},l}),define("storeKoExtensions",["knockout","jqueryui","notifier","ccLogger","ccLazyImages","ccConstants","koValidate"],function(e,t,r,i,a,o,s){"use strict";e.extenders.notify=function(t,a){if(t.isValid&&e.isObservable(t.isValid)&&t.isModified&&e.isObservable(t.isModified)){var o="",s="An error has occurred.";if(a&&(a.id?(o=a.id,a.message&&(s=a.message)):""!==a.toString()&&(o=a.toString())),""===o)throw i.error("Notify ID not set"),new Error("Notify ID not set.");t.notify=function(e){t.isValid()||!t.isModified()?r.clearError(o):r.sendError(o,s)},t.clearError=function(){r.clearError(o)},t.isModified.subscribe(t.notify),t.isValid.subscribe(t.notify)}return t},e.bindingHandlers.productVariantImageSource={getNoImageSiteSetting:function(t){for(var r=null,i=0;i<t.$parents.length;i++)if(e.isObservable(t.$parents[i].site)){r=e.unwrap(t.$parents[i].site().noImageSrc);break}return r},init:function(t,r,i,a,o){var s,n,c,l,d,u=e.utils.unwrapObservable(r());"object"==typeof u&&"IMG"===t.nodeName&&(s=e.utils.unwrapObservable(u.src),n=e.utils.unwrapObservable(u.errorSrc),c=e.bindingHandlers.productVariantImageSource.getNoImageSiteSetting(o),l=c&&c.length>0?c:n,s&&l&&(d=new Image,d.src=l))},update:function(t,r,i,s,n){var c,l,d,u,p,h,g,f,m,I,E,v,y=!1,b=-1,T=e.utils.unwrapObservable(r());if("object"==typeof T&&"IMG"===t.nodeName){if(u=e.utils.unwrapObservable(T.src),c=e.utils.unwrapObservable(T.imageType),c||(c="medium"),u)switch(c){case"full":d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primaryFullImageURL?u.childSKUs[0].primaryFullImageURL:u.primaryFullImageURL);break;case"large":d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primaryLargeImageURL?u.childSKUs[0].primaryLargeImageURL:u.primaryLargeImageURL);break;case"medium":d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primaryMediumImageURL?u.childSKUs[0].primaryMediumImageURL:u.primaryMediumImageURL);break;case"small":d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primarySmallImageURL?u.childSKUs[0].primarySmallImageURL:u.primarySmallImageURL);break;case"thumb":d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primaryThumbImageURL?u.childSKUs[0].primaryThumbImageURL:u.primaryThumbImageURL);break;default:d=e.utils.unwrapObservable(u.childSKUs&&u.childSKUs.length>0&&u.childSKUs[0].primaryMediumImageURL?u.childSKUs[0].primaryMediumImageURL:u.primaryMediumImageURL)}else d=T.errorSrc;f=e.utils.unwrapObservable(u.primaryImageAltText),m=e.utils.unwrapObservable(u.primaryImageTitle),p=e.utils.unwrapObservable(T.errorSrc),h=e.bindingHandlers.productImageSource.getNoImageSiteSetting(n),g=h&&h.length>0?h:p;var P=n.$masterViewModel,S=e.utils.unwrapObservable(T.disableLazyImageLoading);if(S||!P||!P.storeConfiguration||P.storeConfiguration.lazilyLoadImages!==!0||"prerenderReady"in window||d===g||a.isImageVisible(t,d)||(y=!0),y&&(v=e.utils.unwrapObservable(T.initialSrc),v||(v=g?g:o.SITE_DEFAULT_NO_IMAGE_URL),P.storeConfiguration.delayBeforeLoadingOutOfFocusImages&&(b=P.storeConfiguration.delayBeforeLoadingOutOfFocusImages)),d!==p&&d!==o.SITE_DEFAULT_NO_IMAGE_URL||(d=g,y=!1),h&&h.length>0){var C=new Image;C.onerror=function(){g=p},C.src=h}return f||(f=e.utils.unwrapObservable(T.alt)),m||(m=e.utils.unwrapObservable(T.title)),I=e.utils.unwrapObservable(T.errorAlt),E=e.utils.unwrapObservable(T.onerror),g?void(d?(l=new Image,l.onload=function(){y?(t.dataset.errorSrc=g,t.dataset.defaultErrorSrc=p,E&&(t.dataset.onerror=E),I&&(t.dataset.errorAlt=I),t.dataset.src=d,a.setupLazyLoadStyling(t,T),a.observeLazyImage(t,b),t.src=v):t.src=d,f&&(t.alt=f),m&&(t.title=m)},l.onerror=function(){if(y){var e=new Image;e.onload=function(){t.dataset.errorSrc=g,t.dataset.defaultErrorSrc=p,E&&(t.dataset.onerror=E),I&&(t.dataset.errorAlt=I),t.dataset.src=d,a.setupLazyLoadStyling(t,T),a.observeLazyImage(t,b),t.src=g},e.onerror=function(){t.src=g,I&&(t.alt=I),E&&E(t)},e.src=g}else t.src=g,I&&(t.alt=I),E&&E(t);E&&E(t)},l.src=v&&y?v:d):(t.src=g,I?t.alt=I:f&&(t.alt=f),E&&E(t))):(t.alt=f?f:"",y?(E&&(t.dataset.onerror=E),I&&(t.dataset.errorAlt=I),t.dataset.src=d,a.setupLazyLoadStyling(t,T),a.observeLazyImage(t,b),t.src=v):t.src=d,void(f&&(t.alt=f)))}}}}),define("pageViewTracker",["knockout","ccRestClient","ccConstants","storageApi"],function(e,t,r,i){"use strict";function a(t){var r=this;r.pageViews=e.observable(t)}function o(){var o=this;return this.tenantId=e.observable(),this.visitId=e.observable(),this.visitorId=e.observable(),this.visitDetailsChanged=e.observable(!1),o.createPageViewEvent=function(e){var t=new a(e);return t},o.getVisitorId=function(){return i.getInstance().getItem(r.VISITOR_ID)},o.getVisitId=function(){return i.getInstance().getItem(r.VISIT_ID)},o.handleVisitDetails=function(){var e=this;if(e.visitorId||e.visitId){var t=e.getVisitorId(),r=e.getVisitId();t&&t==e.visitorId()||(e.visitorId(t),e.visitDetailsChanged(!0)),r&&r==e.visitId()||(e.visitId(r),e.visitDetailsChanged(!0)),e.visitDetailsChanged()&&(e.persistVisitDetails(e.visitorId(),e.visitId()),e.visitDetailsChanged(!1))}},o.persistVisitDetails=function(e,i){var a={};a[r.VISITOR_ID]=e,a[r.VISIT_ID]=i;var o=r.ENDPOINT_SAVE_VISIT_DETAILS,s=function(e){},n=function(e){};t.request(o,a,s,n)},o.recordPageChange=function(e){var i={pageViews:e.pageViews()},a=r.ENDPOINT_RECORD_PAGEVIEWS_COUNT,o=function(e){},s=function(e){};t.request(a,i,o,s)},o}return new o}),define("pageLayout/currency",["jquery","ccConstants","ccRestClient"],function(e,t,r){"use strict";function i(){if(i.singleInstance)throw new Error("Cannot instantiate more than one CurrencyViewModel, use getInstance()");var a=this;return a.siteCurrenciesLoaded=e.Deferred(),a.availableCurrencies=[],a.currencyMap={},a.setAvailableCurrencies=function(){a.availableCurrencies.forEach(function(e){a.currencyMap[e.currencyCode]=e}),a.siteCurrenciesLoaded.resolve()},a.fetchCurrenciesSuccess=function(e){e?a.availableCurrencies=e.items:a.availableCurrencies=[],a.setAvailableCurrencies()},a.fetchCurrenciesFailure=function(){console.log("currencies loading failed")},a.getCurrency=function(e){return a.currencyMap[e]},a.fetchCurrencies=function(){var e=t.ENDPOINT_CURRENCIES_LIST_CURRENCIES,i={};r.request(e,i,a.fetchCurrenciesSuccess,a.fetchCurrenciesFailure)}(),this}return i.getInstance=function(){return i.singleInstance||(i.singleInstance=new i),i.singleInstance},i}),define("pageLayout/site",["knockout","ccRestClient","ccConstants","jquery","storageApi","pageViewTracker","pageLayout/currency"],function(e,t,r,i,a,o,s){"use strict";function n(a,o,c){if(n.singleInstance)throw new Error("Cannot instantiate more than one SiteViewModel, use getInstance(pAdapter, data, pParams)");var l=this;l.currencyViewModel=s.getInstance(),l.selectedPriceListGroup=e.observable(o?o.priceListGroup.defaultPriceListGroup:null),l.activePriceListGroups=e.observableArray([]),l.siteSecondaryCurrency=e.observable(null),l.siteSecondaryCurrencyCode=null,l.priceListGroupDeferred=i.Deferred(),l.selectedPriceListGroup()&&l.priceListGroupDeferred.resolve(),l.exchangeRate=e.observable(null),l.payShippingInSecondaryCurrency=e.observable(!1),l.payTaxInSecondaryCurrency=e.observable(!1),l.siteLoadedDeferred=i.Deferred(),l.siteSecondaryInfoLoaded=i.Deferred();var d="/img/no-image.jpg";return o&&o.siteInfo&&o.siteInfo.noimage&&(d=o.siteInfo.noimage),l.getCurrency=function(e){return l.currencyViewModel.currencyMap[e]},l.setSiteSecondaryCurrency=function(){l.siteSecondaryCurrency(l.getCurrency(l.siteSecondaryCurrencyCode))},i.when(l.currencyViewModel.siteCurrenciesLoaded,l.siteSecondaryInfoLoaded).done(function(){l.setSiteSecondaryCurrency(),l.siteLoadedDeferred.resolve()}),l.noImageSrc=e.observable(d),null!=o&&t.request(r.ENDPOINT_SITES_GET_SITE,{},function(e){l.siteSecondaryCurrencyCode=e.secondaryCurrency,l.exchangeRate(e.exchangeRate?e.exchangeRate:null),l.payShippingInSecondaryCurrency(!!e.payShippingInSecondaryCurrency&&e.payShippingInSecondaryCurrency),l.payTaxInSecondaryCurrency(!!e.payTaxInSecondaryCurrency&&e.payTaxInSecondaryCurrency),l.siteSecondaryInfoLoaded.resolve()},function(e){console.log("site failed")},o.siteInfo.id),l.updateSiteSecondaryCurrencyCode=function(e){e&&e!=l.siteSecondaryCurrencyCode&&(l.siteSecondaryCurrencyCode=e,l.setSiteSecondaryCurrency())},l}return n.prototype.getCurrentLocale=function(){var e=t.getStoredValue(r.LOCAL_STORAGE_USER_CONTENT_LOCALE);return null!=e?JSON.parse(e)[0].name:i(":root").attr("lang")},n.prototype.setContextData=function(e){var i=this;for(var a in e)i[a]=e[a];if(i.selectedPriceListGroup()||e.priceListGroup){for(var o=!1,s=JSON.parse(t.getStoredValue(r.LOCAL_STORAGE_PRICELISTGROUP_ID)),n=0;n<i.priceListGroup.activePriceListGroups.length;n++)if(s&&s==i.priceListGroup.activePriceListGroups[n].id){i.selectedPriceListGroup(i.priceListGroup.activePriceListGroups[n]),o=!0;break}e.priceListGroup&&!o&&i.selectedPriceListGroup(e.priceListGroup.defaultPriceListGroup),"pending"===i.priceListGroupDeferred.state()&&i.priceListGroupDeferred.resolve()}e.priceListGroup&&i.activePriceListGroups(e.priceListGroup.activePriceListGroups),e&&e.hasOwnProperty("siteInfo")&&e.siteInfo.hasOwnProperty("noimage")&&i.noImageSrc(e.siteInfo.noimage?e.siteInfo.noimage:"/img/no-image.jpg")},n.initializeVisitorService=function(e){e&&e.visitorServiceHost&&e.tenantId&&e.oracleUnifiedVisitHost&&(window.OracleUnifiedVisit={accountId:e.tenantId+"_"+e.siteInfo.id,host:e.visitorServiceHost,handle:function(){window.ATGSvcs&&ATGSvcs.visitIDsLoaded&&ATGSvcs.visitIDsLoaded(),a.getInstance().setItem(r.VISITOR_ID,window.OracleUnifiedVisit.visitorId()),a.getInstance().setItem(r.VISIT_ID,window.OracleUnifiedVisit.visitId()),o.handleVisitDetails()}},require([e.oracleUnifiedVisitHost]))},n.getInstance=function(e,t,r){return n.singleInstance||(n.singleInstance=new n(e,t,r),n.initializeVisitorService(t)),t&&n.singleInstance.setContextData(t),n.singleInstance},n}),define("viewModels/dynamicProperty",["knockout","koValidate","ccKoValidateRules","storeKoExtensions","CCi18n","ccDate","ccConstants","ccRestClient"],function(e,t,r,i,a,o,s,n){"use strict";function c(){var t=this;t.id=e.observable(),t.label=e.observable(),t.type=e.observable(),t.uiEditorType=e.observable(),t.default=e.observable(null),t.required=e.observable(!1),t.length=e.observable(),t.name=e.observable(),t.promptText=e.observable(),t.internalOnly=e.observable(!1),t.externalShopperContext=e.observable("false"),t.values=[],t.value=e.observable(),t.value.extend({required:!1}),t.isValid=function(){return void 0===t.value()||null===t.value()?!t.required():void 0===t.value.isValid||t.value.isValid()},t.validateNow=function(){return void 0!==t.value.isModified&&t.value.isModified(!0),t.isValid()},t.reset=function(){t.value(null),t.value.isModified(!1)},t.initializeMetadata=function(e,r){t.id(e.id),t.label(e.label),t.name(e.name),null!=e.promptText&&t.promptText(e.promptText),t.type(e.type),t.uiEditorType(e.uiEditorType),null!=e.default&&t.default(e.default),null!=e.internalOnly&&t.internalOnly(e.internalOnly),null!=e.externalShopperContext&&t.externalShopperContext(e.externalShopperContext),t.required(e.required),e.length&&t.length(e.length);var i={required:t.required()},o=a.t("ns.common:resources.dynamicPropertyRequired",{fieldName:t.label()});if(o&&(i.required={params:t.required(),message:o}),t.length()>0&&"checkbox"!==t.type()&&"number"!==t.type()&&"date"!=t.type()){var c=a.t("ns.common:resources.maxlengthValidationMsg",{maxLength:t.length(),fieldName:t.label()});c?i.maxLength={params:t.length(),message:c}:i.maxLength=t.length()}"float"!==t.type()&&"number"!=t.uiEditorType()||(i.number=!0,i.min=-99999999,i.max=99999999),"timestamp"!==t.type()&&"date"!=t.uiEditorType()||(i.date=!0),t.value.rules.remove(function(e){return"required"==e.rule}),t.value.extend(i),void 0!==t.value()&&null!==t.value()||null==t.default()||""===t.default()||t.value(t.default()),n.profileType!=s.PROFILE_TYPE_AGENT&&t.formatDate(),"checkbox"===t.type()&&t.value()!==!0&&t.value(!1),"enumerated"===t.type()&&(t.values=e.values)},t.formatDate=function(){if(!t.value())return t;if("date"===t.type()||"date"==t.uiEditorType()){var e=new Date(t.value());isNaN(e)||t.value(e.toISOString())}return t},t.getMetadata=function(){var e=new Object;return e.id=t.id(),e.label=t.label(),e.type=t.type(),e.uiEditorType=t.uiEditorType(),e.default=t.default(),e.required=t.required(),e.length=t.length(),e.name=t.name(),e.internalOnly=t.internalOnly(),e.externalShopperContext=t.externalShopperContext(),e.promptText=t.promptText(),e.values=t.values,e}}return c}),define("viewModels/dynamicPropertyMetaContainer",["knockout","viewModels/dynamicProperty","ccConstants"],function(e,t,r){"use strict";function i(){if(i.singleInstance)throw new Error("Cannot instantiate more than one DynamicPropertyMetaContainer view model, use getInstance()");var e=this;e.dynamicPropertyMetaCache={}}return i.prototype.intializeDynamicProperties=function(e,r){for(var i=this,a=[],o=0;o<e.length;o++){var s=new t;s.initializeMetadata(e[o],!0),a.push(s)}i.dynamicPropertyMetaCache[r]=a},i.prototype.createDynamicProperties=function(e,i){var a=[];if(e&&i==r.ADDRESS_TEXT)for(var o=0;o<e.length;o++){var s=new t;s.initializeMetadata(e[o].getMetadata(),!0),a.push(s)}return a},i.getInstance=function(){return i.singleInstance||(i.singleInstance=new i),i.singleInstance},i}),define("viewModels/address",["knockout","ccConstants","koValidate","ccKoValidateRules","storeKoExtensions","ccLogger","ccRestClient","viewModels/dynamicPropertyMetaContainer","ccStoreConfiguration","viewModels/dynamicProperty"],function(e,t,r,i,a,o,s,n,c,l){"use strict";function d(r,i,a,l,d){function u(e){var t=this,r=t.countriesList();t.country(e),t.selectedCountry(e);for(var i=r.length,a=0;a<i;a++)if(r[a].countryCode===e){if(!(r[a].regions.length>0))return t.computedState([]),t.stateList([]);t.computedState([]),t.stateList(r[a].regions);break}}var p=this;if(!r||""===r)throw o.error("Address ID not set"),new Error("Address ID not set");return p.alias=e.observable(""),p.prefix=e.observable(""),p.firstName=e.observable(""),p.middleName=e.observable(""),p.lastName=e.observable(""),p.suffix=e.observable(""),p.country=e.observable(""),p.postalCode=e.observable(""),p.address1=e.observable(""),p.address2=e.observable(""),p.address3=e.observable(""),p.city=e.observable(""),p.state=e.observable(""),p.county=e.observable(""),p.phoneNumber=e.observable(""),p.email=e.observable(),p.jobTitle=e.observable(""),p.companyName=e.observable(""),p.faxNumber=e.observable(""),p.type=e.observable(""),p.repositoryId="",p.dynamicPropertyMetaInfo=n.getInstance(),p.isDefaultBillingAddress=e.observable(!1),p.isDefaultShippingAddress=e.observable(!1),p.computedDefaultBilling=e.computed(function(){return p.isDefaultBillingAddress()&&p.saveAddressTo()===t.ORDER_ACCOUNT},p),p.computedDefaultShipping=e.computed(function(){return p.isDefaultShippingAddress()&&p.saveAddressTo()===t.ORDER_ACCOUNT},p),p.postalCodePattern=e.observable(""),p.US_POSTAL_CODE_PATTERN="^[0-9]{5}([ -][0-9]{4})?$",p.CANADA_POSTAL_CODE_PATTERN="^[abceghjklmnprstvxyABCEGHJKLMNPRSTVXY]{1}[0-9]{1}[a-zA-Z]{1} *[0-9]{1}[a-zA-Z]{1}[0-9]{1}$",p.DEFAULT_POSTAL_CODE_PATTERN="^[0-9a-zA-Z]{1,}([ -][0-9a-zA-Z]{1,})?$",p.stateList=e.observableArray(),p.selectedCountry=e.observable(),p.selectedState=e.observable(),p.state_ISOCode=e.observable(),p.countriesList=e.observableArray(),p.countriesList(l),p.defaultCountryCode=e.observable(d),p.isDefaultAddress=e.observable(!1),p.saveToAccount=e.observable(!1),p.saveAddressTo=e.observable(t.PROFILE),p.invalidTracker=e.observable(),p.alias.extend({maxLength:{params:c.ADDRESS_ALIAS_MAXIMUM_LENGTH?c.ADDRESS_ALIAS_MAXIMUM_LENGTH:t.CYBERSOURCE_ALIAS_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("aliasText"),maxLength:c.ADDRESS_ALIAS_MAXIMUM_LENGTH?c.ADDRESS_ALIAS_MAXIMUM_LENGTH:t.CYBERSOURCE_ALIAS_MAXIMUM_LENGTH})}}),p.prefix.extend({required:!1}),p.firstName.extend({required:{params:!0,onlyIf:function(){return!p.saveToAccount()},message:a.translate("firstNameRequired")},maxLength:{params:c.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH?c.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH:t.CYBERSOURCE_FIRSTNAME_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("firstNameText"),maxLength:c.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH?c.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH:t.CYBERSOURCE_FIRSTNAME_MAXIMUM_LENGTH})}}),p.middleName.extend({required:!1}),p.lastName.extend({
required:{params:!0,onlyIf:function(){return!p.saveToAccount()},message:a.translate("lastNameRequired")},maxLength:{params:c.ADDRESS_LASTNAME_MAXIMUM_LENGTH?c.ADDRESS_LASTNAME_MAXIMUM_LENGTH:t.CYBERSOURCE_LASTNAME_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("lastNameText"),maxLength:c.ADDRESS_LASTNAME_MAXIMUM_LENGTH?c.ADDRESS_LASTNAME_MAXIMUM_LENGTH:t.CYBERSOURCE_LASTNAME_MAXIMUM_LENGTH})}}),p.suffix.extend({required:!1}),p.country.extend({required:{params:!0,message:a.translate("countryRequired")}}),p.address1.extend({required:{params:!0,message:a.translate("addressLine1Required")},maxLength:{params:c.ADDRESS_ADDRESS1_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS1_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("addressLine1Text"),maxLength:c.ADDRESS_ADDRESS1_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS1_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH})}}),p.address2.extend({required:!1,maxLength:{params:c.ADDRESS_ADDRESS2_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS2_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("addressLine2Text"),maxLength:c.ADDRESS_ADDRESS2_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS2_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH})}}),p.address3.extend({required:!1,maxLength:{params:c.ADDRESS_ADDRESS3_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS3_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("addressLine3Text"),maxLength:c.ADDRESS_ADDRESS3_MAXIMUM_LENGTH?c.ADDRESS_ADDRESS3_MAXIMUM_LENGTH:t.CYBERSOURCE_ADDRESS_MAXIMUM_LENGTH})}}),p.city.extend({required:{params:!0,message:a.translate("cityRequired")},maxLength:{params:c.ADDRESS_CITY_MAXIMUM_LENGTH?c.ADDRESS_CITY_MAXIMUM_LENGTH:t.CYBERSOURCE_CITY_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("cityText"),maxLength:c.ADDRESS_CITY_MAXIMUM_LENGTH?c.ADDRESS_CITY_MAXIMUM_LENGTH:t.CYBERSOURCE_CITY_MAXIMUM_LENGTH})}}),p.state.extend({required:{params:!0,onlyIf:function(){return p.stateList().length>0},message:a.translate("stateRequired")}}),p.county.extend({required:!1,maxLength:{params:c.ADDRESS_CITY_MAXIMUM_LENGTH?c.ADDRESS_CITY_MAXIMUM_LENGTH:t.CYBERSOURCE_CITY_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("countyText"),maxLength:c.ADDRESS_CITY_MAXIMUM_LENGTH?c.ADDRESS_CITY_MAXIMUM_LENGTH:t.CYBERSOURCE_CITY_MAXIMUM_LENGTH})}}),p.type.extend({required:{params:!0,onlyIf:function(){return p.saveToAccount()},message:a.translate("nickNameRequiredText")},maxLength:{params:t.ACCOUNT_NICKNAME_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("nickNamePlaceHolderText"),maxLength:t.ACCOUNT_NICKNAME_MAXIMUM_LENGTH})}}),p.postalCode.extend({required:{params:!0,message:a.translate("zipCodeRequired")},maxLength:{params:t.CYBERSOURCE_POSTAL_CODE_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("zipCodeText"),maxLength:t.CYBERSOURCE_POSTAL_CODE_MAXIMUM_LENGTH})},observablePattern:{params:p.postalCodePattern,onlyIf:function(){return""!=p.postalCodePattern()},message:a.translate("zipCodeInvalid")}}),p.phoneNumber.extend({required:{params:!0,onlyIf:function(){return p.saveToAccount()},message:a.translate("phoneNumberRequiredText")},pattern:{params:"^[0-9()+ -]+$",message:a.translate("phoneNumberInvalid")},maxLength:{params:t.CYBERSOURCE_PHONE_NUMBER_MAXIMUM_LENGTH,message:a.translate("maxlengthValidationMsg",{fieldName:a.translate("phoneNumberText"),maxLength:t.CYBERSOURCE_PHONE_NUMBER_MAXIMUM_LENGTH})}}),p.jobTitle.extend({required:!1}),p.companyName.extend({required:{params:!0,onlyIf:function(){return p.saveToAccount()},message:a.translate("companyNameRequiredText")}}),p.faxNumber.extend({required:!1}),p.isDefaultAddress.extend({required:!0}),p.isDefaultBillingAddress.extend({required:!0}),p.isDefaultShippingAddress.extend({required:!0}),p.dynamicProperties=e.observableArray([]),p.alias.isData=!0,p.prefix.isData=!0,p.firstName.isData=!0,p.middleName.isData=!0,p.lastName.isData=!0,p.suffix.isData=!0,p.country.isData=!0,p.postalCode.isData=!0,p.address1.isData=!0,p.address2.isData=!0,p.address3.isData=!0,p.city.isData=!0,p.state.isData=!0,p.county.isData=!0,p.phoneNumber.isData=!0,p.jobTitle.isData=!0,p.companyName.isData=!0,p.faxNumber.isData=!0,p.stateIsDropDown=e.computed(function(){return p.stateList().length>0},p),p.selectedCountry.subscribe(function(e){if(void 0===p.selectedCountry()||""===p.selectedCountry())p.country(""),p.postalCodePattern("");else if(p.countriesList()&&0!=p.countriesList().length)for(var r=0;r<p.countriesList().length;r++)p.countriesList()[r].countryCode==p.selectedCountry()&&p.country(p.countriesList()[r].displayName);else p.country(e);if(void 0!==p.selectedState()&&""!==p.selectedState()&&p.selectedState(null),p.stateList([]),p.countriesList())for(var r=0;r<p.countriesList().length;r++)p.countriesList()[r].countryCode===p.selectedCountry()&&(p.stateList(p.countriesList()[r].regions),p.selectedCountry()===t.UNITED_STATES?p.postalCodePattern(p.US_POSTAL_CODE_PATTERN):p.selectedCountry()===t.CANADA?p.postalCodePattern(p.CANADA_POSTAL_CODE_PATTERN):p.postalCodePattern(p.DEFAULT_POSTAL_CODE_PATTERN))}),p.computedCountry=e.computed({read:function(){var e=this.selectedCountry();return e?[e]:[]},write:function(e){1===e.length?(this.selectedCountry(e[0]),u.call(this,e[0])):this.selectedCountry(null)},owner:this}),p.computedState=e.computed({read:function(){var e=this.selectedState();return e?[e]:[]},write:function(e){1===e.length?(this.selectedState(e[0]),this.state(this.selectedState())):this.selectedState(null)},owner:this}),p.selectedState.subscribe(function(e){if(p.selectedState())if(p.stateList()&&0!=p.stateList().length){for(var t=0;t<p.stateList().length;t++)if(p.stateList()[t].abbreviation===p.selectedState()){p.state(p.stateList()[t].displayName),p.state_ISOCode(p.stateList()[t].regionCode);break}}else p.state(e);else p.state(""),p.state_ISOCode(""),p.selectedState("")}),p.postalCode.subscribe(function(e){}),p.compare=function(e){return p.alias()===e.alias()&&p.prefix()===e.prefix()&&p.firstName()===e.firstName()&&p.middleName()===e.middleName()&&p.lastName()===e.lastName()&&p.suffix()===e.suffix()&&p.address1()===e.address1()&&p.address2()===e.address2()&&p.address3()===e.address3()&&p.city()===e.city()&&p.state()===e.state()&&p.postalCode()===e.postalCode()&&p.country()===e.country()&&p.county()===e.county()&&p.phoneNumber()===e.phoneNumber()&&p.jobTitle()===e.jobTitle()&&p.companyName()===e.companyName()&&p.faxNumber()===e.faxNumber()},p.compareTo=function(e){return p.alias()===e.alias()&&p.address1()===e.address1()&&p.address2()===e.address2()&&p.address3()===e.address3()&&p.city()===e.city()&&p.state()===e.state()&&p.postalCode()===e.postalCode()&&p.country()===e.country()&&p.county()===e.county()&&p.phoneNumber()===e.phoneNumber()&&p.jobTitle()===e.jobTitle()&&p.companyName()===e.companyName()&&p.faxNumber()===e.faxNumber()},p.isModified=function(){return p.alias.isModified()||p.firstName.isModified()||p.lastName.isModified()||p.address1.isModified()||p.address2.isModified()||p.address3.isModified()||p.county.isModified()||p.city.isModified()||p.state.isModified()||p.postalCode.isModified()||p.phoneNumber.isModified()||p.country.isModified()||p.isDefaultAddress.isModified()||p.isDefaultBillingAddress.isModified()||p.isDefaultShippingAddress.isModified()||p.companyName.isModified()},p.isEmpty=function(){return""==p.alias()&&""==p.firstName()&&""==p.lastName()&&""==p.address1()&&""==p.address2()&&""==p.city()&&""==p.state()&&""==p.postalCode()},p.isValidForSelfRegistration=function(){return p.address1.isValid()&&p.address2.isValid()&&p.address3.isValid()&&p.city.isValid()&&p.state.isValid()&&p.postalCode.isValid()&&p.country.isValid()&&p.phoneNumber.isValid()&&p.companyName.isValid()},p.isValid=function(){var t=this;return t.alias.isValid()&&t.prefix.isValid()&&t.firstName.isValid()&&t.middleName.isValid()&&t.lastName.isValid()&&t.suffix.isValid()&&t.address1.isValid()&&t.address2.isValid()&&t.address3.isValid()&&t.city.isValid()&&t.state.isValid()&&t.postalCode.isValid()&&t.country.isValid()&&t.phoneNumber.isValid()&&t.jobTitle.isValid()&&t.companyName.isValid()&&t.faxNumber.isValid()&&(!e.isObservable(t.type)||t.type.isValid())},p.validateForShippingMethod=function(){return p.country.isValid()&&p.state.isValid()&&p.postalCode.isValid()},p.validateNow=function(){return p.alias.isModified(!0),p.prefix.isModified(!0),p.firstName.isModified(!0),p.middleName.isModified(!0),p.lastName.isModified(!0),p.suffix.isModified(!0),p.address1.isModified(!0),p.address2.isModified(!0),p.address3.isModified(!0),p.city.isModified(!0),p.state.isModified(!0),p.postalCode.isModified(!0),p.country.isModified(!0),p.county.isModified(!0),p.phoneNumber.isModified(!0),p.jobTitle.isModified(!0),p.companyName.isModified(!0),p.faxNumber.isModified(!0),e.isObservable(p.type)&&p.type.isModified(!0),p.isValid()},p.reset=function(){p.repositoryId="",p.alias(""),p.firstName(""),p.lastName(""),p.address1(""),p.address2(""),p.address3(""),p.city(""),p.county(""),p.selectedState(""),p.state(""),p.postalCode(""),p.selectedCountry(""),p.country(""),p.phoneNumber(""),p.companyName(""),p.type(""),p.email(null),p.isDefaultAddress(!1),p.isDefaultBillingAddress(!1),p.isDefaultShippingAddress(!1),p.alias.isModified(!1),p.companyName.isModified(!1),p.firstName.isModified(!1),p.lastName.isModified(!1),p.address1.isModified(!1),p.address2.isModified(!1),p.address3.isModified(!1),p.county.isModified(!1),p.city.isModified(!1),p.state.isModified(!1),p.postalCode.isModified(!1),p.country.isModified(!1),p.phoneNumber.isModified(!1),p.isDefaultAddress.isModified(!1),p.selectedCountry(p.defaultCountry()),e.isObservable(p.type)&&p.type.isModified(!1),p.resetDynamicProperties()},p.copyTo=function(t){var r={ignore:["invalidTracker","saveToAccount","saveAddressTo"]},i=e.mapping.toJS(p,r),a=JSON.stringify(i);return e.mapping.fromJS(JSON.parse(a),p.listOfCopyToIgnoreProperties(),t),t.alias(p.alias()||""),t.prefix(p.prefix()||""),t.firstName(p.firstName()||""),t.middleName(p.middleName()||""),t.lastName(p.lastName()||""),t.suffix(p.suffix()||""),t.address1(p.address1()||""),t.address2(p.address2()||""),t.address3(p.address3()||""),t.city(p.city()||""),t.postalCode(p.postalCode()||""),t.county(p.county()||""),t.email(e.utils.unwrapObservable(p.email)),t.selectedCountry(p.selectedCountry()),t.selectedState(p.selectedState()),t.phoneNumber(p.phoneNumber()||""),t.jobTitle(p.jobTitle()||""),t.companyName(p.companyName()||""),t.faxNumber(p.faxNumber()||""),t.repositoryId=p.repositoryId,t.isDefaultAddress(p.isDefaultAddress()||!1),t.isDefaultBillingAddress(p.isDefaultBillingAddress()||!1),t.isDefaultShippingAddress(p.isDefaultShippingAddress()||!1),t.type(p.type()||""),t.__ko_mapping__.ignore=[],t},p.toJSON=function(){var t={ignore:["invalidTracker","saveToAccount","saveAddressTo","dynamicPropertyMetaInfo"],include:["address1","address2","address3","alias","city","companyName","country","countryName","county","faxNumber","firstName","isDefaultAddress","jobTitle","lastName","middleName","phoneNumber","postalCode","prefix","suffix","regionName","repositoryId","state","selectedState","selectedCountry","isDefaultBillingAddress","isDefaultShippingAddress","isDefaultAddress","toJSON","state_ISOCode","type"]},r=e.mapping.toJS(this,t);return r.email||(r.email=null),delete r.countryList,delete r.stateList,delete r.stateIsDropDown,delete r.postalCodePattern,delete r.US_POSTAL_CODE_PATTERN,delete r.CANADA_POSTAL_CODE_PATTERN,delete r.DEFAULT_POSTAL_CODE_PATTERN,delete r.countriesList,r},p.listOfCopyToIgnoreProperties=function(){var e={ignore:["alias","prefix","firstName","lastName","middleName","suffix","address1","address2","address3","city","postalCode","county","email","selectedState","selectedCountry","phoneNumber","jobTitle","companyName","faxNumber","repositoryId","isDefaultAddress","isDefaultBillingAddress","isDefaultShippingAddress","type","computedCountry","computedState","dynamicProperties"]};return e},p.listOfCopyFromIgnoreProperties=function(){var e={ignore:["address1","address2","address3","alias","city","companyName","country","countryName","county","faxNumber","firstName","isDefaultAddress","jobTitle","lastName","middleName","phoneNumber","postalCode","prefix","suffix","regionName","repositoryId","state","invalidTracker","computedCountry","computedState","dynamicProperties"]};return e},p.copyFrom=function(t,r){p=this;var i,a=!1;e.mapping.fromJS(JSON.parse(JSON.stringify(t)),p.listOfCopyFromIgnoreProperties(),p),p.alias(t.alias||""),p.firstName(t.firstName||""),p.middleName(t.middleName||""),p.lastName(t.lastName||""),p.address1(t.address1||""),p.address2(t.address2||""),p.address3(t.address3||""),p.city(t.city||""),p.county(t.county||""),p.postalCode(t.postalCode||""),p.phoneNumber(t.phoneNumber||""),p.prefix(t.prefix||""),p.suffix(t.suffix||""),e.isObservable(p.email)&&p.email(t.email),p.repositoryId=t.repositoryId,t.selectedCountry?p.selectedCountry(t.selectedCountry):r&&0!=r.length?($.each(r,function(e,r){if(r.countryCode===t.country)return a=!0,p.selectedCountry(r.countryCode),i=r.regions,!1}),a===!1&&p.selectedCountry("")):p.selectedCountry(t.country),t.selectedState?p.selectedState(t.selectedState):i&&0!=i.length?$.each(i,function(e,r){if(r.abbreviation===t.state)return p.selectedState(r.abbreviation),p.state(r.displayName),p.state_ISOCode(r.regionCode),!1}):p.selectedState(t.state),p.jobTitle(t.jobTitle||""),p.companyName(t.companyName||""),p.faxNumber(t.faxNumber||""),p.isDefaultAddress(t.isDefaultAddress||!1),p.isDefaultBillingAddress(t.isDefaultBillingAddress||!1),p.isDefaultShippingAddress(t.isDefaultShippingAddress||!1),p.type(t.type||""),p.__ko_mapping__.ignore=[]},p.resetModified=function(){p.alias.isModified(!1),p.companyName.isModified(!1),p.firstName.isModified(!1),p.lastName.isModified(!1),p.address1.isModified(!1),p.address2.isModified(!1),p.city.isModified(!1),p.state.isModified(!1),p.postalCode.isModified(!1),p.country.isModified(!1),p.phoneNumber.isModified(!1),p.isDefaultAddress.isModified(!1),p.isDefaultBillingAddress.isModified(!1),p.isDefaultShippingAddress.isModified(!1),e.isObservable(p.type)&&p.type.isModified(!1)},p.defaultCountry=function(){if(p.countriesList()&&p.countriesList().length>0){if(null!==p.defaultCountryCode())for(var e in p.countriesList())if(p.defaultCountryCode()===p.countriesList()[e].countryCode)return p.defaultCountryCode();return p.countriesList()[0].countryCode}},p.selectedCountry(p.defaultCountry()),p.populateDynamicPropertiesMetaData=function(){var e=this,r={};r[t.PARENT]=t.ENDPOINT_CONTACT_INFO_TYPE,e.dynamicPropertyMetaInfo&&e.dynamicPropertyMetaInfo.dynamicPropertyMetaCache&&!e.dynamicPropertyMetaInfo.dynamicPropertyMetaCache.hasOwnProperty(t.ENDPOINT_CONTACT_INFO_TYPE)&&s.request(t.ENDPOINT_GET_ITEM_TYPE,r,function(r){e.dynamicPropertyMetaInfo.intializeDynamicProperties(r.specifications,t.ENDPOINT_CONTACT_INFO_TYPE)},function(e){},t.ENDPOINT_CONTACT_INFO_TYPE)},p.resetDynamicProperties=function(){var t=this;e.utils.arrayForEach(t.dynamicProperties(),function(e){e.reset(),void 0!==e.value()&&null!==e.value()||!e.default()||e.value(e.default())})},p.createAndInitialiseDynamicProperties=function(){var e=p.dynamicPropertyMetaInfo.dynamicPropertyMetaCache[t.ENDPOINT_CONTACT_INFO_TYPE];p.dynamicProperties.removeAll();var r=p.dynamicPropertyMetaInfo.createDynamicProperties(e,t.ADDRESS_TEXT);if(p.dynamicProperties(r),p.dynamicProperties().length>0)for(var i in p.dynamicProperties())p[p.dynamicProperties()[i].id()]=p.dynamicProperties()[i].value},p.createAndInitialiseDynamicProperties(),p}return d}),define("viewModels/shipping-group-relationship",["require","knockout","ccConstants","CCi18n","ccStoreConfiguration","ccRestClient","ccDate","viewModels/address"],function(e){"use strict";function t(e,t){var c=this;t=t||0,c.catRefId=e.catRefId,c.productId=e.productId,c.childItems=e.childItems,c.quantity=r.observable(t),c.updatableQuantity=r.observable(t),c.stockStatus=r.observable(!0),e.availabilityDate&&r.isObservable(e.availabilityDate)?c.availabilityDate=r.observable(e.availabilityDate()):e.availabilityDate?c.availabilityDate=r.observable(e.availabilityDate):c.availabilityDate=r.observable(),c.stockState=r.observable(),e.stockState&&(r.isObservable(e.stockState)&&""!==e.stockState()?c.stockState(e.stockState()):r.isObservable(e.stockState)||""===e.stockState||c.stockState(e.stockState)),c.orderableQuantityMessage=r.observable(),c.shippingOptions=r.observableArray(),c.shippingAddress=r.observable(),c.shippingMethod=r.observable(),c.isPickupInStore=r.observable(),c.selectedStore=r.observable(),c.shippingGroupId=r.pureComputed(function(){var e=c.productId+c.catRefId+c.quantity();return c.shippingAddress&&null!=c.shippingAddress()&&(e+=c.shippingAddress()),c.shippingMethod&&null!=c.shippingMethod()&&(e+=c.shippingMethod()),c.selectedStore&&null!=c.selectedStore()?e+c.selectedStore().locationId:e},c).extend({deferred:!0}),c.detailedItemPriceInfo=e.detailedItemPriceInfo,e.price&&r.isObservable(e.price)?c.price=r.observable(e.price()):c.price=r.observable(e.price),c.unitPrice=r.observable(e.unitPrice),c.availablePickupDate=r.observable(),c.preferredPickupDate=r.observable(),e.availablePickupDate&&(c.availablePickupDate=r.observable(e.availablePickupDate)),e.preferredPickupDate&&(c.preferredPickupDate=r.observable(e.preferredPickupDate)),c.firstName=r.observable(),c.middleName=r.observable(),c.lastName=r.observable(),c.phoneNumber=r.observable(),c.updatableQuantity.extend({required:{params:!0,message:a.t("ns.common:resources.quantityRequireMsg")},digit:{params:!0,message:a.t("ns.common:resources.quantityNumericMsg")},trigger:{value:"0",message:a.t("ns.common:resources.removeItemMsg")}}),c.firstName.extend({maxLength:{params:o.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH?o.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH:i.CYBERSOURCE_FIRSTNAME_MAXIMUM_LENGTH,message:a.t("ns.common:resources.maxlengthValidationMsg",{fieldName:a.t("ns.common:resources.firstNameText"),maxLength:o.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH?o.ADDRESS_FIRSTNAME_MAXIMUM_LENGTH:i.CYBERSOURCE_FIRSTNAME_MAXIMUM_LENGTH})}}),c.lastName.extend({maxLength:{params:o.ADDRESS_LASTNAME_MAXIMUM_LENGTH?o.ADDRESS_LASTNAME_MAXIMUM_LENGTH:i.CYBERSOURCE_LASTNAME_MAXIMUM_LENGTH,message:a.t("ns.common:resources.maxlengthValidationMsg",{fieldName:a.t("ns.common:resources.lastNameText"),maxLength:o.ADDRESS_LASTNAME_MAXIMUM_LENGTH?o.ADDRESS_LASTNAME_MAXIMUM_LENGTH:i.CYBERSOURCE_LASTNAME_MAXIMUM_LENGTH})}}),c.phoneNumber.extend({pattern:{params:"^[0-9()+ -]+$",message:a.t("ns.common:resources.phoneNumberInvalid")},maxLength:{params:i.CYBERSOURCE_PHONE_NUMBER_MAXIMUM_LENGTH,message:a.t("ns.common:resources.maxlengthValidationMsg",{fieldName:a.t("ns.common:resources.phoneNumberText"),maxLength:i.CYBERSOURCE_PHONE_NUMBER_MAXIMUM_LENGTH})}}),c.addLimitsValidation=function(e,t,r,o,n,l){for(var d,u=c.quantity(),p=null,h=0;h<t.length;h++)c.productId===t[h].productId&&c.catRefId===t[h].catRefId&&(p=t[h]);if(null!==p){e.productData()&&e.productData().notForIndividualSale&&e.isThisGWPCommerceItemAndValid()&&p&&(p.orderLimit=c.quantity());var g="IN_STOCK"===p.stockStatus||"PREORDERABLE"===p.stockStatus||"BACKORDERABLE"===p.stockStatus;if(c.stockStatus(g),p&&(u=p.orderLimit,c.availabilityDate(p.availabilityDate)),c.updatableQuantity.rules.remove(function(e){return"max"==e.rule}),c.updatableQuantity.rules.remove(function(e){return"maxItemQuantity"==e.rule}),d=o?n:p.orderableQuantity,null!==d&&!isNaN(d)&&d>0){var f=a.t("ns.common:resources.insufficientStockMsg",{stockLimit:u&&u<d?u:d});c.updatableQuantity.extend({maxItemQuantity:{params:{orderableQuantity:d,totalQuantity:c.getItemQuantityInCart,orderLimit:u},message:f}})}else{var m=a.t("ns.common:resources.outOfStockMsg");c.updatableQuantity.extend({max:{params:0,message:m}})}var I="";s.profileType===i.PROFILE_TYPE_AGENT?I=c.getOrderableQuantityMessageForAgent(e,p,r,o,l):(r&&p&&null!==p&&p.inStockQuantity>0&&c.updatableQuantity()>p.inStockQuantity&&(p.backOrderableQuantity>0?I=a.t("ns.common:resources.partialBackOrderMsg",{stockLimit:p.inStockQuantity}):p.preOrderableQuantity>0&&(I=a.t("ns.common:resources.partialPreOrderMsg",{stockLimit:p.inStockQuantity}))),t&&c.stockState(p.stockStatus)),c.orderableQuantityMessage(I),c.updatableQuantity.isModified(!0)}},c.getOrderableQuantityMessageForAgent=function(e,t,r,o,s,c){var l,d=this,u="",p="IN_STOCK",h=t.inStockQuantity,g=t.backOrderableQuantity,f=t.preOrderableQuantity;l=c?e.quantity*c:e.updatableQuantity();var m=l<t.orderableQuantity?l:t.orderableQuantity,I=e.productId+":"+e.catRefId;if(o&&s[I]){g+=s[I].backOrderQuantity,f+=s[I].preOrderQuantity,h+=s[I].inStockQuantity;var E=m-h;E>0?E-g>0?(u=a.t("ns.common:resources.AgentPreorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}),p=i.PREORDERABLE):(u=a.t("ns.common:resources.AgentBackorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}),p=i.BACKORDERABLE):p="IN_STOCK"}else t.stockStatus&&m-h>0?g>0?(u=a.t("ns.common:resources.AgentBackorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}),p=i.BACKORDERABLE):f>0&&(u=a.t("ns.common:resources.AgentPreorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}),p=i.PREORDERABLE):t.stockStatus&&"BACKORDERABLE"===t.stockStatus?u=a.t("ns.common:resources.AgentBackorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}):t.stockStatus&&"PREORDERABLE"===t.stockStatus&&(u=a.t("ns.common:resources.AgentPreorderableText",{stockLimit:a.t("ns.common:resources.asteriskSymbol")}));return d.stockState(p),d.availabilityDate(t.availabilityDate?n.dateTimeFormatter(t.availabilityDate,null,"medium"):""),u.trim()},c.addConfigurableStockValidation=function(e,t,o,n,l){for(var d,u=0,p=0,h=!1,g=null,f=null,m=0;m<e.length;m++)if(c.productId===e[m].productId&&c.catRefId===e[m].catRefId){if(d=o&&n[e[m].productId+":"+e[m].catRefId]?n[e[m].productId+":"+e[m].catRefId]:e[m].orderableQuantity,"IN_STOCK"===e[m].stockStatus||t&&("BACKORDERABLE"===e[m].stockStatus||"PREORDERABLE"===e[m].stockStatus)||s.profileType===i.PROFILE_TYPE_AGENT&&d>0)if(null!==d&&!isNaN(d)&&d>0){var I="";h=!0,g=e[m].availabilityDate,f=e[m].stockStatus,u=d,p=e[m].orderLimit,s.profileType===i.PROFILE_TYPE_AGENT?I=c.getOrderableQuantityMessageForAgent(c,e[m],t,o,l):t&&e[m].inStockQuantity>0&&c.updatableQuantity()>e[m].inStockQuantity&&(e[m].backOrderableQuantity>0?I=a.t("ns.common:resources.partialBackOrderMsg",{stockLimit:e[m].inStockQuantity}):e[m].preOrderableQuantity>0&&(I=a.t("ns.common:resources.partialPreOrderMsg",{stockLimit:e[m].inStockQuantity})))}else h=!1;else h=!1;break}if(c.childItems&&h)for(var m=0;m<c.childItems.length;m++){for(var E=c.childItems[m].productId,v=c.childItems[m].catRefId,y=r.utils.unwrapObservable(c.childItems[m].quantity),b=0,T=0;T<e.length;T++)if(E===e[T].productId&&v===e[T].catRefId){if(b=o&&n[E+":"+v]?n[E+":"+v]:e[T].orderableQuantity,"IN_STOCK"===e[T].stockStatus||t&&("BACKORDERABLE"===e[T].stockStatus||"PREORDERABLE"===e[T].stockStatus)||s.profileType===i.PROFILE_TYPE_AGENT&&b>0)if(null!==b&&!isNaN(b)&&b>0){var P=Math.floor(b/y);if(u=u>P?P:u,p=p>e[T].orderLimit?e[T].orderLimit:p,h=!0,s.profileType===i.PROFILE_TYPE_AGENT){var S=c.updatableQuantity();I=c.getOrderableQuantityMessageForAgent(c.childItems[m],e[T],t,o,l,S)}}else h=!1;else h=!1;break}if(!h)break}if(s.profileType!==i.PROFILE_TYPE_AGENT&&(c.availabilityDate(g),c.stockState(f)),c.stockStatus(h),c.orderableQuantityMessage(I),c.updatableQuantity.rules.remove(function(e){return"max"==e.rule}),c.updatableQuantity.rules.remove(function(e){return"maxItemQuantity"==e.rule}),h&&u>0){var C=a.t("ns.common:resources.insufficientStockMsg",{stockLimit:u>p?p:u});c.updatableQuantity.extend({maxItemQuantity:{params:{orderableQuantity:u,totalQuantity:c.getItemQuantityInCart,orderLimit:p,childItems:c.childItems},message:C}})}else{var A=a.t("ns.common:resources.configurableProductOutOfStockMsg");c.updatableQuantity.extend({max:{params:0,message:A}})}c.updatableQuantity.isModified(!0)}}var r=e("knockout"),i=e("ccConstants"),a=e("CCi18n"),o=e("ccStoreConfiguration"),s=e("ccRestClient"),n=e("ccDate"),c=e("viewModels/address");return t.prototype.update=function(e,t){var i=e.quantity();if(t&&(i+=this.quantity(),this.updatableQuantity(i)),this.quantity(i),this.price(e.price()),this.unitPrice(e.unitPrice()),this.detailedItemPriceInfo=e.detailedItemPriceInfo,this.shippingAddress()&&null!==this.shippingAddress().postalCode&&void 0!==this.shippingAddress().postalCode&&!r.isObservable(this.shippingAddress().postalCode)){var a=this.createAddress(this.shippingAddress());a&&a.isValid&&a.isValid()&&e.shippingAddress()&&e.shippingAddress().isValid&&e.shippingAddress().isValid()&&(this.shippingAddress().country=e.shippingAddress().country(),this.shippingAddress().state=e.shippingAddress().state())}else this.shippingAddress()&&this.shippingAddress().isValid&&this.shippingAddress().isValid()&&e.shippingAddress()&&e.shippingAddress().isValid&&e.shippingAddress().isValid()&&(this.shippingAddress().country(e.shippingAddress().country()),this.shippingAddress().state(e.shippingAddress().state()))},t.prototype.populateUserDetails=function(e){e&&e.loggedIn()&&(this.firstName()||this.firstName(e.firstName()),this.lastName()||this.lastName(e.lastName()),!this.phoneNumber()&&e.contactShippingAddress&&this.phoneNumber(e.contactShippingAddress.phoneNumber))},t.prototype.hashCode=function(e){var t,i,a=0,o=this.productId+this.catRefId;if(e&&null!==e&&""!==e&&(o+=e),this.isPickupInStore()&&this.selectedStore()&&this.selectedStore().store)o+=this.selectedStore().store.locationId,this.availablePickupDate()&&(o+=this.availablePickupDate());else if(this.shippingAddress()&&this.shippingMethod()){if(null===this.shippingAddress().postalCode||void 0===this.shippingAddress().postalCode||r.isObservable(this.shippingAddress().postalCode))this.shippingAddress().isValid&&this.shippingAddress().isValid()&&(o+=this.shippingAddress().firstName()+this.shippingAddress().lastName()+this.shippingAddress().address1()+this.shippingAddress().city()+this.shippingAddress().selectedState()+this.shippingAddress().selectedCountry()+this.shippingAddress().postalCode());else{var s=this.createAddress(this.shippingAddress());s.isValid&&s.isValid()&&(o+=s.firstName()+s.lastName()+s.address1()+s.city()+s.selectedState()+s.selectedCountry()+s.postalCode())}o+=this.shippingMethod().value||this.shippingMethod().id||this.shippingMethod().repositoryId}if(0===o.length)return a;for(t=0;t<o.length;t++)i=o.charCodeAt(t),a=(a<<5)-a+i,a|=0;return a},t.prototype.createAddress=function(e){var t={translate:function(e,t){return a.t("ns.common:resources."+e,t)}},r=new c("split-shipping-address","",t,"","");return r.copyFrom(e,[]),r},t.prototype.generateKey=function(){var e=this.shippingAddress(),t=this.shippingMethod(),i=this.selectedStore(),a="";if(this.isPickupInStore())return a+=i.locationId,this.availablePickupDate&&null!==this.availablePickupDate&&r.isObservable(this.availablePickupDate)&&this.availablePickupDate()&&(a+=this.availablePickupDate()),a;if(e){var o;if(e.hasOwnProperty("toJSON"))o=e.toJSON();else{var s={ignore:["invalidTracker"]};o=r.mapping.toJSON(e,s)}var n=o.email;delete o.email,o.email=n,a+=JSON.stringify(o)}return t&&(t.repositoryId&&(a+=t.repositoryId),t.value&&(a+=t.value)),a},t.prototype.asMap=function(e){var t={},a=this.generateKey(),o={};if(this.commerceItemId)var s=this.catRefId+"_"+this.commerceItemId;else var s=this.catRefId;var n;if(this.shippingAddress())if(this.shippingAddress().hasOwnProperty("toJSON"))n=this.shippingAddress().toJSON();else{var c={ignore:["invalidTracker"]};n=r.mapping.toJS(this.shippingAddress(),c)}!e||!n||n.email&&n.email==e||(n.email=e);var l;this.shippingMethod()&&this.shippingMethod().repositoryId?l={value:this.shippingMethod().repositoryId}:this.shippingMethod()&&this.shippingMethod().value&&(l={value:this.shippingMethod().value});var d=this.selectedStore()?this.selectedStore().locationId:null;if(this.commerceItemId?o[s]={productId:this.productId,catRefId:this.catRefId,quantity:parseFloat(this.quantity(),10),childItems:this.childItems,commerceItemId:this.commerceItemId}:o[s]={productId:this.productId,catRefId:this.catRefId,childItems:this.childItems,quantity:parseFloat(this.quantity(),10)},this.isPickupInStore()){o[s].availablePickupDate=this.availablePickupDate(),o[s].preferredPickupDate=this.preferredPickupDate();var u=this.firstName(),p=this.lastName(),h=this.phoneNumber();t[a]={items:o,type:i.INSTORE_PICKUP,locationId:d,firstName:u,lastName:p,phoneNumber:h}}else t[a]={items:o,type:i.HARDGOOD_SHIPPING_GROUP_TYPE,shippingAddress:n,shippingMethod:l};return t},t.prototype.addQuantity=function(e){this.quantity(parseFloat(this.quantity())+parseFloat(e)),this.updatableQuantity(this.quantity())},t}),define("viewModels/cart-item-external-data",["knockout"],function(e){"use strict";function t(t){t=t||{},this.name=e.observable(t.name),this.actionCode=e.observable(t.actionCode),this.values=e.observable(t.values)}return t.prototype.toJSON=function(){var t=e.toJS(this);return t},t}),define("viewModels/cart-item",["require","knockout","pubsub","CCi18n","jquery","ccConstants","pageLayout/site","currencyHelper","koMapping","viewModels/shipping-group-relationship","viewModels/cart-item-external-data","ccStoreConfiguration","viewModels/address","ccRestClient","ccDate"],function(e){"use strict";function t(){return{productId:arguments[0],productData:arguments[1],quantity:arguments[2],catRefId:arguments[3],selectedOptions:arguments[4],currency:arguments[5],discountInfo:arguments[6],rawTotalPrice:arguments[7],externalPrice:arguments[8],externalPriceQuantity:arguments[9],configuratorId:arguments[10],childItems:arguments[11],commerceItemId:arguments[12],unpricedExternalMessage:arguments[13],externalData:arguments[14],actionCode:arguments[15],lineAttributes:arguments[16],backOrderQuantity:arguments[17],preOrderQuantity:arguments[18],externalRecurringCharge:arguments[19],externalRecurringChargeFrequency:arguments[20],externalRecurringChargeDuration:arguments[21],addOnItem:arguments[22],shopperInput:arguments[23],configurablePropertyId:arguments[24],configurationOptionId:arguments[25],selectedStore:arguments[26],shippingGroupRelationships:arguments[27]}}function r(e){var g=this;if(arguments.length>1&&"object"!=typeof arguments[0])return r.call(this,t.apply(void 0,arguments));e=e||{};var E=e.externalData||[],v=e.productData||{};if(g.productId=e.productId,g.productData=i.observable(e.productData),g.quantity=i.observable(e.quantity),g.repositoryId="",g.availabilityDate=i.observable(v.availabilityDate||null),g.catRefId=e.catRefId,g.itemTotal=i.observable(0),g.expanded=i.observable(!1),g.stockStatus=i.observable(!0),g.stockState=i.observable(v.stockState||""),g.orderableQuantityMessage=i.observable(),g.updatableQuantity=i.observable(e.quantity),g.commerceItemQuantity=i.observable(e.quantity),g.orderableQuantity=i.observable(),g.backOrderableQuantity=i.observable(e.backOrderQuantity),g.preOrderableQuantity=i.observable(e.preOrderQuantity),g.selectedOptions=e.selectedOptions,g.selectedSkuProperties=[],g.discountInfo=i.observable(e.discountInfo),g.rawTotalPrice=i.observable(e.rawTotalPrice),g.detailedItemPriceInfo=i.observableArray(),g.detailedRecurringChargeInfo=i.observableArray(),g.overriddenPrice=i.observable(),g.priceOverrideReason=i.observable(),g.discountAmount=i.observable(0),g.isPriceOverridden=i.observable(),g.isUpdate=i.observable(!1),g.externalPrice=i.observable(e.externalPrice),g.externalPriceQuantity=i.observable(e.externalPriceQuantity),g.processed=!1,g.externalData=i.observableArray(E.map(function(e){return new p(e)})),g.addOnItem=!1,e.addOnItem&&(g.addOnItem=e.addOnItem),g.shopperInput=void 0,e.shopperInput&&(g.shopperInput=e.shopperInput),g.configurablePropertyId=void 0,
e.configurablePropertyId&&(g.configurablePropertyId=e.configurablePropertyId),g.configurationOptionId=void 0,e.configurationOptionId&&(g.configurationOptionId=e.configurationOptionId),g.actionCode=i.observable(e.actionCode),g.externalRecurringCharge=i.observable(e.externalRecurringCharge),g.externalRecurringChargeFrequency=i.observable(e.externalRecurringChargeFrequency),g.externalRecurringChargeDuration=i.observable(e.externalRecurringChargeDuration),g.assetKey=i.observable(e.assetKey),g.rootAssetKey=i.observable(e.rootAssetKey),g.parentAssetKey=i.observable(e.parentAssetKey),g.serviceId=i.observable(e.serviceId),g.customerAccountId=i.observable(e.customerAccountId),g.billingAccountId=i.observable(e.billingAccountId),g.serviceAccountId=i.observable(e.serviceAccountId),g.billingProfileId=i.observable(e.billingProfileId),g.activationDate=i.observable(e.activationDate),g.deactivationDate=i.observable(e.deactivationDate),g.transactionDate=i.observable(e.transactionDate),g.isPersonalized=i.observable(!1),g.asset=i.observable(e.asset),e.shippingGroupRelationships&&e.shippingGroupRelationships.length>0)e.shippingGroupRelationships=s.map(e.shippingGroupRelationships,function(e,t){var r;if(e&&i.isObservable(e.quantity))return e.sgID=e.productId+e.catRefId+t,e;e.shippingAddress&&(r=g.getAddressObject(e.shippingAddress));var a=new u(e,e.quantity);if(a.sgID=a.productId+a.catRefId+t,e.selectedStore){if(a.selectedStore(e.selectedStore),a.isPickupInStore(!(!e.selectedStore||!e.selectedStore.store.locationId)),e.firstName&&a.firstName(e.firstName),e.lastName&&a.lastName(e.lastName),e.phoneNumber&&a.phoneNumber(e.phoneNumber),e.selectedStore.inventoryDetails&&e.selectedStore.inventoryDetails.length>0)for(var t=0;t<e.selectedStore.inventoryDetails.length;t++){var o=e.selectedStore.inventoryDetails[t];o.locationId===e.selectedStore.store.locationId&&a.availabilityDate(o.availabilityDate)}}else a.shippingAddress(r),a.shippingMethod(e.shippingMethod),a.isPickupInStore(!1),a.availabilityDate(g.availabilityDate());return a.price(e.price),a.unitPrice(e.unitPrice),a});else{e.shippingGroupRelationships=[];var y=new u(g,e.quantity);if(y.sgID=y.productId+y.catRefId+"0",e.selectedStore&&(y.selectedStore(e.selectedStore),e.hasOwnProperty("availablePickupDateTime")&&e.availablePickupDateTime&&y.availablePickupDate(e.availablePickupDateTime()),y.isPickupInStore(!(!e.selectedStore||!e.selectedStore.store.locationId)),e.selectedStore.inventoryDetails&&e.selectedStore.inventoryDetails.length>0))for(var b=0;b<e.selectedStore.inventoryDetails.length;b++){var T=e.selectedStore.inventoryDetails[b];T.locationId===e.selectedStore.store.locationId&&y.availabilityDate(T.availabilityDate)}e.shippingGroupRelationships.push(y)}if(g.shippingGroupRelationships=i.observableArray(e.shippingGroupRelationships),e.lineAttributes)for(var P=0;P<e.lineAttributes().length;P++)void 0===e.lineAttributes()[P].value()?g[e.lineAttributes()[P].id()]=i.observable(e.lineAttributes()[P].default()):g[e.lineAttributes()[P].id()]=i.observable(e.lineAttributes()[P].value());g.displayName=i.observable(v.displayName||""),e.configuratorId&&(g.configuratorId=e.configuratorId),g.childItems=e.childItems,g.invalid=!1,g.isGWPChoicesAvaliable=i.observable(!1),v.giftProductData&&(g.giftWithPurchaseSelections=[{giftWithPurchaseIdentifier:v.giftProductData.giftWithPurchaseIdentifier,promotionId:v.giftProductData.promotionId,giftWithPurchaseQuantity:v.giftProductData.giftWithPurchaseQuantity}]),g.commerceItemId=e.commerceItemId,g.updatableQuantity.extend({required:{params:!0,message:o.t("ns.common:resources.quantityRequireMsg")},digit:{params:!0,message:o.t("ns.common:resources.quantityNumericMsg")},trigger:{value:"0",message:o.t("ns.common:resources.removeItemMsg")}}),g.originalPrice=i.observable(0),g.currentPrice=i.observable(0),g.priceListGroupId=i.observable(c.getInstance().selectedPriceListGroup().id),g.priceChangedMessage=i.pureComputed(function(){return o.t("ns.common:resources.productPriceChanged",{originalPrice:l.handleFractionalDigits(g.externalPrice()?g.externalPrice():g.originalPrice(),e.currency?"":e.currency.fractionalDigits),currency:void 0===e.currency?"":e.currency.symbol})}),g.unpricedExternalMessage=i.observable(e.unpricedExternalMessage||""),g.isUnpricedError=i.observable(g.unpricedExternalMessage().length>0),g.unpricedErrorMessage=i.computed(function(){var e="";return e=g.childItems&&g.childItems.length>0?o.t("ns.common:resources.configurableProductNoPrice",{message:g.unpricedExternalMessage()}):o.t("ns.common:resources.noPrice")}),g.productPriceChanged=i.observable(!1),g.productPriceChanged.extend({trigger:{value:!0,message:g.priceChangedMessage}}),null==f&&h.getInstance().resetShippingGroupRelationships!==!1&&(f=s.Topic(a.topicNames.CART_UPDATE_QUANTITY_SUCCESS).subscribe(g.resetShippingGroupRelationships.bind(g))),g.setUnpricedError=function(e){g.isUnpricedError(!0),g.unpricedExternalMessage(e?e:"")},g.clearUnpricedError=function(){g.isUnpricedError(!1),g.unpricedExternalMessage("")},g.revertQuantity=function(){g.updatableQuantity(g.quantity())},g.removeSpaces=function(e){return e?e.replace(/\s+/g,"-"):""},g.optionText=function(e){for(var t=g.selectedOptions[e],r=e+1;r<g.selectedOptions.length;r++){var i=g.selectedOptions[r];if(i.optionValue)return o.t("ns.common:resources.optionHasNext",{optionName:t.optionName,optionValue:t.optionValue})}return o.t("ns.common:resources.optionLast",{optionName:t.optionName,optionValue:t.optionValue})},g.toJSON=function(){var e=d.defaultOptions().ignore;d.defaultOptions().ignore=["productData","itemTotal","updatableQuantity","productPriceChanged","originalPrice","priceChangedMessage","isGWPChoicesAvaliable","giftData","unpricedErrorMessage","unpricedExternalMessage","isUnpricedError","isPersonalized","currentPrice","shippingGroupRelationships","discountAmount","isPriceOverridden","isUpdate","processed"];var t=d.toJS(g);return d.defaultOptions().ignore=e,t},g.isThisGWPCommerceItemAndValid=function(){var e=g.giftWithPurchaseCommerceItemMarkers;return!!(e&&e.length>0)},g.addLimitsValidation=function(e,t,r,i,a,s,c){var l;if(g.productData()&&g.productData().notForIndividualSale&&g.isThisGWPCommerceItemAndValid()&&(r?r.orderLimit=g.quantity():l=g.quantity()),g.orderableQuantity=t,g.stockStatus(e),r&&(l=r.orderLimit,g.availabilityDate(r.availabilityDate)),g.updatableQuantity.rules.remove(function(e){return"max"==e.rule}),g.updatableQuantity.rules.remove(function(e){return"maxItemQuantity"==e.rule}),null!==t&&!isNaN(t)&&t>0){var d=o.t("ns.common:resources.insufficientStockMsg",{stockLimit:l&&l<t?l:t});g.updatableQuantity.extend({maxItemQuantity:{params:{orderableQuantity:t,totalQuantity:g.getItemQuantityInCart,orderLimit:l},message:d}})}else{var u=o.t("ns.common:resources.outOfStockMsg");g.updatableQuantity.extend({max:{params:0,message:u}})}var p="";m.profileType===n.PROFILE_TYPE_AGENT?p=g.getOrderableQuantityMessageForAgent(g,r,i,s,c):(i&&r&&r.inStockQuantity>0&&g.updatableQuantity()>r.inStockQuantity&&(r.backOrderableQuantity>0?p=o.t("ns.common:resources.partialBackOrderMsg",{stockLimit:r.inStockQuantity}):r.preOrderableQuantity>0&&(p=o.t("ns.common:resources.partialPreOrderMsg",{stockLimit:r.inStockQuantity}))),r&&g.stockState(r.stockStatus)),g.orderableQuantityMessage(p),g.updatableQuantity.isModified(!0),g.shippingGroupRelationships.extend({validation:[{validator:function(e){if(e)return!0},message:d}]}).isModified(!0)},g.getOrderableQuantityMessageForAgent=function(e,t,r,i,a,s){var c=this,l="",d="IN_STOCK",u=t.inStockQuantity,p=t.backOrderableQuantity,h=t.preOrderableQuantity,g=e.updatableQuantity()<t.orderableQuantity?e.updatableQuantity():t.orderableQuantity;s&&(g*=s);var f=e.productId+":"+e.catRefId;if(i&&a[f]){p+=a[f].backOrderQuantity,h+=a[f].preOrderQuantity,u+=a[f].inStockQuantity;var m=g-u;m>0?p>0?(l=o.t("ns.common:resources.AgentBackorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}),d=n.BACKORDERABLE):h>0&&(l=o.t("ns.common:resources.AgentPreorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}),d=n.PREORDERABLE):d="IN_STOCK"}else t.stockStatus&&g-u>0?p>0?(l=o.t("ns.common:resources.AgentBackorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}),d=n.BACKORDERABLE):h>0&&(l=o.t("ns.common:resources.AgentPreorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}),d=n.PREORDERABLE):t.stockStatus&&"BACKORDERABLE"===t.stockStatus?l=o.t("ns.common:resources.AgentBackorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}):t.stockStatus&&"PREORDERABLE"===t.stockStatus&&(l=o.t("ns.common:resources.AgentPreorderableText",{stockLimit:o.t("ns.common:resources.asteriskSymbol")}));return c.stockState(d),c.availabilityDate(t.availabilityDate?I.dateTimeFormatter(t.availabilityDate,null,"medium"):""),l.trim()},g.addConfigurableStockValidation=function(e,t,r,a,s){for(var c=0,l=0,d=!1,u=null,p=null,h=0,f=0;f<e.length;f++)if(g.productId===e[f].productId&&g.catRefId===e[f].catRefId){if(h=r&&a&&a[e[f].productId+":"+e[f].catRefId]?a[e[f].productId+":"+e[f].catRefId]:e[f].orderableQuantity,"IN_STOCK"===e[f].stockStatus||t&&("BACKORDERABLE"===e[f].stockStatus||"PREORDERABLE"===e[f].stockStatus)||m.profileType===n.PROFILE_TYPE_AGENT&&h>0)if(null!==h&&!isNaN(h)&&h>0){var I="";d=!0,u=e[f].availabilityDate,p=e[f].stockStatus,c=h,l=e[f].orderLimit,m.profileType===n.PROFILE_TYPE_AGENT?I=g.getOrderableQuantityMessageForAgent(g,e[f],t,r,s):t&&e[f].inStockQuantity>0&&g.updatableQuantity()>e[f].inStockQuantity&&(e[f].backOrderableQuantity>0?I=o.t("ns.common:resources.partialBackOrderMsg",{stockLimit:e[f].inStockQuantity}):e[f].preOrderableQuantity>0&&(I=o.t("ns.common:resources.partialPreOrderMsg",{stockLimit:e[f].inStockQuantity})))}else d=!1;else d=!1;break}if(g.childItems&&d)for(var f=0;f<g.childItems.length;f++){for(var E=g.childItems[f].productId,v=g.childItems[f].catRefId,y=i.utils.unwrapObservable(g.childItems[f].quantity),b=0,T=0;T<e.length;T++)if(E===e[T].productId&&v===e[T].catRefId){if(b=r&&a&&a[E+":"+v]?a[E+":"+v]:e[T].orderableQuantity,"IN_STOCK"===e[T].stockStatus||t&&("BACKORDERABLE"===e[T].stockStatus||"PREORDERABLE"===e[T].stockStatus)||m.profileType===n.PROFILE_TYPE_AGENT&&b>0)if(null!==b&&!isNaN(b)&&b>0){var P=Math.floor(b/y);if(c=c>P?P:c,l=l>e[T].orderLimit?e[T].orderLimit:l,d=!0,m.profileType===n.PROFILE_TYPE_AGENT){var S=g.updatableQuantity();I=g.getOrderableQuantityMessageForAgent(g.childItems[f],e[T],t,r,s,S)}}else d=!1;else d=!1;break}if(!d)break}if(m.profileType!==n.PROFILE_TYPE_AGENT&&(g.availabilityDate(u),g.stockState(p)),g.stockStatus(d),g.orderableQuantityMessage(I),g.updatableQuantity.rules.remove(function(e){return"max"==e.rule}),g.updatableQuantity.rules.remove(function(e){return"maxItemQuantity"==e.rule}),d&&c>0){var C=o.t("ns.common:resources.insufficientStockMsg",{stockLimit:c>l?l:c});g.updatableQuantity.extend({maxItemQuantity:{params:{orderableQuantity:c,totalQuantity:g.getItemQuantityInCart,orderLimit:l,childItems:g.childItems},message:C}})}else{var A=o.t("ns.common:resources.configurableProductOutOfStockMsg");g.updatableQuantity.extend({max:{params:0,message:A}})}g.updatableQuantity.isModified(!0)},g.populateItemDynamicProperties=function(e){for(var t in e)g[t](e[t]())}}var i=e("knockout"),a=e("pubsub"),o=e("CCi18n"),s=e("jquery"),n=e("ccConstants"),c=e("pageLayout/site"),l=e("currencyHelper"),d=e("koMapping"),u=e("viewModels/shipping-group-relationship"),p=e("viewModels/cart-item-external-data"),h=e("ccStoreConfiguration"),g=e("viewModels/address"),f=null,m=e("ccRestClient"),I=e("ccDate");return r.prototype.canAddShippingGroupRelationship=function(e){var t=this.quantity()>this.shippingGroupRelationships().length;return e?t&&e.quantity()>1:t},r.prototype.getAddressObject=function(e){var t={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},r=new g("split-shipping-address","",t,[],"");return r.copyFrom(e),r},r.prototype.addShippingGroupRelationship=function(e,t){if(this.canAddShippingGroupRelationship()){var r=new u(this,1);if(r.sgID=r.productId+r.catRefId+this.shippingGroupRelationships().length+"",this.detailedItemPriceInfo()[0]&&r.unitPrice(this.detailedItemPriceInfo()[0].detailedUnitPrice),e){var a=e.updatableQuantity.rules().filter(function(e){return"maxItemQuantity"==e.rule})[0];r.updatableQuantity.extend({maxItemQuantity:a})}if(t&&null!==t&&(r.getItemQuantityInCart=t.getUpdatableItemQuantityInCart.bind(t,t.items(),r.productId,r.catRefId,r),this.childItems?r.addConfigurableStockValidation(e.inventoryDetails?e.inventoryDetails:[],t.isPreOrderBackOrderEnabled):r.addLimitsValidation(this,e.inventoryDetails?e.inventoryDetails:[],t.isPreOrderBackOrderEnabled)),this.shippingGroupRelationships.push(r),e)e.addQuantity(-1);else{var o=i.utils.arrayFirst(this.shippingGroupRelationships(),function(e){return e.quantity()>1});o.addQuantity(-1)}}},r.prototype.removeShippingGroupRelationShip=function(e){this.shippingGroupRelationships().length>=1&&(this.shippingGroupRelationships.remove(e),this.updatableQuantity(this.quantity()-e.quantity()),this.itemTotal(this.itemTotal()-e.price()),s.Topic(a.topicNames.CART_UPDATE_QUANTITY).publishWith(this.productData(),[{message:"success",commerceItemId:this.commerceItemId,shippingGroup:e}]),s.Topic(a.topicNames.SHIPPING_GROUP_REMOVE_SUCCESS).publishWith(function(){}))},r.prototype.resetShippingGroupRelationships=function(e){var t=!!e&&e.createNewSGR,r=e?e.cartItem:void 0,a=e?e.prodData:void 0,o=e?e.shippingGroup:void 0;if(t&&r&&a){var s=new u(r,a.orderQuantity);if(i.isObservable(a.selectedStore)&&a.selectedStore()&&a.selectedStore().store.locationId){if(s.isPickupInStore(!0),s.selectedStore(a.selectedStore()),a.hasOwnProperty("availablePickupDateTime")&&a.availablePickupDateTime&&s.availablePickupDate(a.availablePickupDateTime()),a.selectedStore().inventoryDetails&&a.selectedStore().inventoryDetails.length>0)for(var n=0;n<a.selectedStore().inventoryDetails.length;n++){var c=a.selectedStore().inventoryDetails[n];c.locationId===a.selectedStore().store.locationId&&s.availabilityDate(c.availabilityDate)}s.stockState(a.stockState)}else s.isPickupInStore(!1);r.shippingGroupRelationships.push(s)}else if(o)parseInt(o.updatableQuantity())?o.quantity(o.updatableQuantity()):this.shippingGroupRelationships.remove(o);else if(e&&e.data&&e.data.shippingGroupRelationships&&e.data.shippingGroupRelationships().length>1){a=e.prodData;for(var l=0,d=e.data.updatableQuantity(),n=0;n<e.data.shippingGroupRelationships().length;n++)l+=parseInt(e.data.shippingGroupRelationships()[n].quantity());var p=d-l;if(p>0){var s=new u(e.data,p);if(i.isObservable(a.selectedStore)&&a.selectedStore()&&a.selectedStore().store.locationId){if(s.isPickupInStore(!0),s.selectedStore(a.selectedStore()),a.hasOwnProperty("availablePickupDateTime")&&a.availablePickupDateTime&&s.availablePickupDate(a.availablePickupDateTime()),a.selectedStore().inventoryDetails&&a.selectedStore().inventoryDetails.length>0)for(var n=0;n<a.selectedStore().inventoryDetails.length;n++){var c=a.selectedStore().inventoryDetails[n];c.locationId===a.selectedStore().store.locationId&&s.availabilityDate(c.availabilityDate)}s.stockState(a.stockState)}else s.isPickupInStore(!1);e.data.shippingGroupRelationships.push(s)}else if(p<0){p=Math.abs(p);for(var n=e.data.shippingGroupRelationships().length-1;n>=0&&p>0;n--)p>=e.data.shippingGroupRelationships()[n].quantity()?(p-=e.data.shippingGroupRelationships()[n].quantity(),e.data.shippingGroupRelationships().splice(n,1)):(l=e.data.shippingGroupRelationships()[n].quantity()-p,e.data.shippingGroupRelationships()[n].quantity(l),e.data.shippingGroupRelationships()[n].updatableQuantity(l),p=0)}}},r.prototype.isOnlineOnly=function(){var e=this;if(e.productData&&e.productData()&&null!==e.productData&&e.productData().childSKUs&&null!==e.productData().childSKUs&&e.productData().childSKUs.length>0){for(var t=0;t<e.productData().childSKUs.length;t++)if(e.productData().childSKUs[t].repositoryId===e.catRefId&&null!==e.productData().childSKUs[t].derivedOnlineOnly)return e.productData().childSKUs[t].derivedOnlineOnly;if(e.productData().onlineOnly)return e.productData().onlineOnly}return!1},r}),define("viewModels/promotionUpsellContainer",["knockout","ccRestClient","ccConstants"],function(e,t,r){"use strict";function i(){var t=this;if(i.singleInstance)throw new Error("Cannot instantiate more than one PromotionUpsellContainer. Use getInstance() method");return t.promotionUpsellMessages=e.observableArray(),t.isNonQualifiedMessagesRetrievalInProgress=!1,t.isNonQualifiedMessagesSubscribedToQuantity=!1,t}return i.getInstance=function(){return i.singleInstance||(i.singleInstance=new i),i.singleInstance},i.prototype.successFunc=function(e){var t=this;e&&e.promotionUpsellMessages&&t.populatePromotionUpsellMessages(e.promotionUpsellMessages),t.isNonQualifiedMessagesRetrievalInProgress=!1},i.prototype.errorFunc=function(e){var t=this;console.error("Unable to retrieve non-qualifier messages."),t.isNonQualifiedMessagesRetrievalInProgress=!1},i.prototype.clearPromotionUpsellMessages=function(){var e=this;null!=e.promotionUpsellMessages&&e.promotionUpsellMessages().length>0&&e.promotionUpsellMessages.removeAll()},i.prototype.getNonQualifiedMessages=function(){var e=this;if(!e.isNonQualifiedMessagesRetrievalInProgress){e.clearPromotionUpsellMessages();var i=r.GET_UPSELL_MESSAGES;e.isNonQualifiedMessagesRetrievalInProgress=!0;var a=new Object;t.request(i,a,e.successFunc.bind(this),e.errorFunc.bind(this))}},i.prototype.populatePromotionUpsellMessages=function(e){var t=this;if(t.clearPromotionUpsellMessages(),null!=e&&e.constructor===Array)for(var r=0;r<e.length;r++)t.promotionUpsellMessages.push(e[r])},i}),define("pageLayout/cart",["knockout","pubsub","notifier","notifications","storeKoExtensions","CCi18n","ccNumber","jquery","ccConstants","navigation","storageApi","pageLayout/site","viewModels/dynamicProperty","ccRestClient","viewModels/address","koMapping","ccStoreConfiguration","viewModels/cart-item","viewModels/shipping-group-relationship","viewModels/cart-item-external-data","currencyHelper","viewModels/promotionUpsellContainer","ccDate","ccStoreUtils"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I,E,v,y,b,T,P){"use strict";function S(r,a,s,d){if(S.singleInstance)throw new Error("Cannot instantiate more than one CartViewModel, use getInstance(pAdapter, pShoppingCartData)");var p=this;p.originalOrderPrice=e.observable(),p.cancelOrder=e.observable();var g=u.getInstance();p.currency=null,n.when(g.priceListGroupDeferred).done(function(){p.currency=g.selectedPriceListGroup().currency}),p.exchangeRate=e.observable(null),p.payShippingInSecondaryCurrency=e.observable(!1),p.payTaxInSecondaryCurrency=e.observable(!1),p.secondaryCurrency=e.observable(null),p.showSecondaryShippingData=e.pureComputed(function(){return null!=p.secondaryCurrency()&&p.payShippingInSecondaryCurrency()}),p.showSecondaryTaxData=e.pureComputed(function(){return null!=p.secondaryCurrency()&&p.payTaxInSecondaryCurrency()}),p.isChargeTaxShippingInSecondaryCurrency=e.pureComputed(function(){return p.payShippingInSecondaryCurrency()||p.payTaxInSecondaryCurrency()}),p.setSecondaryCurrencyData=function(e,r,i,a){p.exchangeRate(r),p.payTaxInSecondaryCurrency(a),p.secondaryCurrency(e),p.payShippingInSecondaryCurrency(i),n.Topic(t.topicNames.ORDER_SECONDARY_INFO_LOADED).publish(p)},p.user=s,p.promotionUpsellContainer=b.getInstance(),p.deferLoadCart=n.Deferred(),p.deferLoadCartForUser=function(){p.user()&&(p.deferLoadCart.resolve(),f.dispose())};var f=null;if(p.user)var f=p.user.subscribe(p.deferLoadCartForUser);p.userActionPending=e.observable(!1),p.hardPricing=!1,p.isDirty=e.observable(!1),p.callPriceBeforeShippingMethods=!1,p.updatedFromRepository=!1,p.adapter=r,p.errors=e.observableArray([]),p.items=e.observableArray([]),p.allItems=e.observableArray([]),p.coupons=e.observableArray([]),p.orderItems=e.observableArray([]),p.orderCreationDate=e.observable(),p.orderCurrency={},p.couponMultiPromotions=e.observableArray([]),p.claimedCouponMultiPromotions=e.observableArray([]),p.numberOfItems=e.observable(0),p.total=e.observable(0),p.totalWithoutTax=e.observable(0),p.subTotal=e.observable(0),p.amount=e.observable(0),p.tax=e.observable(0),p.secondaryCurrencyTaxAmount=e.observable(0),p.secondaryCurrencyTotal=e.observable(0),p.primaryCurrencyTotal=e.observable(0),p.shipping=e.observable(0),p.secondaryCurrencyShippingAmount=e.observable(0),p.taxExclusiveAmount=e.observable(0),p.shippingDiscount=e.observable(0),p.secondaryCurrencyShippingDiscount=e.observable(0),p.currencyCode=e.observable(""),p.shippingMethod=e.observable(""),p.catalogId=e.observable(""),p.priceListGroupId=e.observable(""),p.shippingAddress=e.observable(""),p.currentCountry=e.observable(""),p.currentState=e.observable(""),p.selectedCountry=e.observable(""),p.selectedState=e.observable(""),p.shippingSurcharge=e.observable(0),p.secondaryCurrencyShippingSurcharge=e.observable(0),p.updatedProduct=e.observable(""),p.validateAndRedirectCart=e.observable(!1),p.orderDiscount=e.observable(0),p.orderDiscountDescList=e.observableArray([]),p.couponErrorMessage=e.observable(),p.skipPriceChange=e.observable(!1),p.isPricingRequired=e.observable(!1),p.invalidProductNames=[],p.isPreOrderBackOrderEnabled=!1,p.checkoutWithPaypalClicked=e.observable(!1),p.isMatchingCookieData=e.observable(!1),p.giftCards=e.observableArray([]),p.IINDetails=e.observableArray([]),p.dynamicProperties=e.observableArray([]),p.lineAttributes=e.observableArray([]),p.cartPriceListGroupId=e.observable(),p.showSelectedOptions=e.observable(!1),p.isSplitShipping=e.observable(!1),p.orderShippingGroups=e.observableArray(),p.mergeCart=e.observable(!1),p.storeConfiguration=m.getInstance(),p.usingImprovedShippingWidgets=e.observable(!1),p.shippingMethodsLoadedAndPriced=e.observable(!1),p.createNewCart=e.observable(!!h.getStoredValue(c.LOCAL_STORAGE_CREATE_NEW_CART)),p.cartName=e.observable(""),p.orderedQuantityMap={},d&&d.global&&d.global.site&&d.global.site.extensionSiteSettings&&d.global.site.extensionSiteSettings.storeEndpointSettings&&d.global.site.extensionSiteSettings.storeEndpointSettings.cartFields&&(p.fields=d.global.site.extensionSiteSettings.storeEndpointSettings.cartFields),p.callbacks={},p.combineLineItems=c.COMBINE_YES,p.giftWithPurchaseOrderMarkers=[],p.gwpQualified=!1,p.placeHolderItems=e.observableArray([]),p.skipGWPMessage=!1,p.currentOrderId=e.observable(null),p.currentOrderState=e.observable(null),p.recurringChargeAmount=e.observable(0),p.recurringChargeCurrencyCode=e.observable(""),p.recurringChargeShipping=e.observable(0),p.recurringChargeSubTotal=e.observable(0),p.recurringChargeSubTotalByFrequency=e.observableArray([]),p.recurringChargeTax=e.observable(0),p.recurringChargeTaxByFrequency=e.observableArray([]),p.recurringChargeTotal=e.observable(0),p.isOrderSubmissionInProgress=!1,p.isCurrentCallInProgress=!1,p.markDirty=function(){l.isPathEqualTo(p.checkoutLink)&&(p.hardPricing=!0),p.isDirty()||p.isOrderSubmissionInProgress||1==p.storeConfiguration.isLargeCart()&&p.hardPricing!==!0||p.isDirty(!0),p.storeConfiguration.isLargeCart()===!0&&p.userActionPending(!0)},p.isItemPriceOverrideAllowed=e.observable(!1),p.hasPriceOverriddenItem=e.observable(!1),p.hasExternalPriceItem=e.observable(!1),p.quoteInfo=e.observable(null),p.registerSplitPaymentCallbacks=function(e,t){p.populateGiftCardsHandler=e,p.updateGiftCardDetailsHandler=t},p.emailAddressForGuestUser=null,p.cartUpdated=function(){p.isDirty()&&p.isDirty(!1),p.saveCartCookie(),p.updateAllItemsArray(),n.Topic(t.topicNames.CART_UPDATED).publish(p),p.validateAndRedirectCart()&&p.handleValidateCart()},p.isDirty.subscribe(p.priceCartIfNeccessary.bind(p)),p.handleValidateCart=function(){p.validatePrice=!0,n.Topic(t.topicNames.LOAD_CHECKOUT).publishWith(p,[{message:"success"}])},p.registerMultiShippingMethodsCallback=function(e){p.loadMultipleShippingMethods=e},p.updateCartItems=function(){if(p.events.length>0){var e,t=p.events.pop();switch(p.events.push(t),t.type){case k:e=t.product,p.addItem(e);break;case x:e=t.product,p.updateItemQuantity(e);break;case G:e=t.product,p.removeItemsByProduct(e.id),p.removeItem(e);break;case H:e=t.coupon,p.removeCouponFromCart(e);break;case F:e=t.coupon,p.addCouponToCart(e);break;case z:e=t.coupons,p.addMultipleCouponsToCart(e);break;case $:e=t.product,p.addItem(e);case J:e=t.coupons,p.removeMultipleCouponFromCart(e);break;case ee:e=t.href,window.location.assign(e)}}},p.addItem=function(e){if(e&&e.childSKUs){var r,i,a=!1;if(p.isConfigurableItem(e)&&(i=[],i=p.getChildItemsDataAsCartItems(e)),e.selectedAddOnProducts&&e.selectedAddOnProducts.length>0){var o=p.getAddonDataAsCartItems(e);i&&i.length>0?i=i.concat(o):(i=[],i=o)}var s=null;if(!e.commerceItemId&&p.isConfigurableItem(e)?s=p.getConfigurableCartItem(e.id,e.childSKUs[0].repositoryId,e.commerceItemId):(s=e.selectedSku?p.getCartItem(e.id,e.selectedSku.repositoryId,e.commerceItemId):p.getCartItem(e.id,e.childSKUs[0].repositoryId,e.commerceItemId),p.combineLineItems==c.COMBINE_YES||s&&s.isUpdate()||(s=null)),p.isProductWithAddons(e)&&s&&!s.isUpdate()&&(s=null),null!==s){if(s.isUpdate()){if(s.shippingGroupRelationships().length>1)s.productData(e),s.updatableQuantity(e.orderQuantity),n.Topic(t.topicNames.CART_UPDATE_QUANTITY_SUCCESS).publishWith(null,[{message:"success",createNewSGR:!1,data:s,prodData:e}]),s.quantity(e.orderQuantity);else{var l=0;s.productData(e),s.shippingGroupRelationships()[0].quantity(e.orderQuantity),s.shippingGroupRelationships()[0].updatableQuantity(e.orderQuantity),s.updatableQuantity(e.orderQuantity);for(var d=0;d<s.shippingGroupRelationships().length;d++)l+=parseFloat(s.shippingGroupRelationships()[d].quantity()),s.shippingGroupRelationships()[d].catRefId=e.childSKUs[0].id;s.quantity(l),s.catRefId=e.childSKUs[0].id}if(e.selectedAddOnProducts&&e.selectedAddOnProducts.length>0){var o=p.getAddonDataAsCartItems(e);s.childItems&&s.childItems.length>0&&(s.childItems=s.childItems.filter(function(e){return!e.addOnItem})),s.childItems&&s.childItems.length>0?s.childItems=s.childItems.concat(o):(s.childItems=[],s.childItems=o)}}else r=s.quantity()+e.orderQuantity,s.quantity(r),s.updatableQuantity(s.quantity()),e.giftProductData&&(s.giftWithPurchaseSelections=[{giftWithPurchaseIdentifier:e.giftProductData.giftWithPurchaseIdentifier,promotionId:e.giftProductData.promotionId,giftWithPurchaseQuantity:e.giftProductData.giftWithPurchaseQuantity}]),n.Topic(t.topicNames.CART_UPDATE_QUANTITY_SUCCESS).publishWith(null,[{message:"success",cartItem:s,prodData:e,createNewSGR:!0}]),this.storeConfiguration.isLargeCart()===!0&&(p.updateItemPriceForLargeCart(e,s),p.updateItemShippingGroupRelationShipForLargeCart(e,s));a=!0}if(null==e.commerceItemId&&p.isConfigurableItem(e)&&(s=p.getCartItemForReconfiguration(e.id,e.childSKUs[0].repositoryId,e.configuratorId),null!==s)){for(var u=[],d=0;d<s.childItems.length;d++)s.childItems[d].addOnItem&&u.push(s.childItems[d]);u.length>0&&(i=i.concat(u)),s.childItems=i,s.externalPrice(e.price),s.externalData((e.externalData||[]).map(function(e){return new v(e)})),s.actionCode(e.actionCode),s.externalRecurringCharge(e.externalRecurringCharge),s.externalRecurringChargeFrequency(e.externalRecurringChargeFrequency),s.externalRecurringChargeDuration(e.externalRecurringChargeDuration),s.assetKey(e.assetKey),s.rootAssetKey(e.rootAssetKey),s.parentAssetKey(e.parentAssetKey),s.serviceId(e.serviceId),s.customerAccountId(e.customerAccountId),s.billingAccountId(e.billingAccountId),s.serviceAccountId(e.serviceAccountId),s.billingProfileId(e.billingProfileId),s.activationDate(e.activationDate),s.deactivationDate(e.deactivationDate),s.transactionDate(e.transactionDate),s.asset(e.asset),s.clearUnpricedError(),s.updatableQuantity.rules.remove(function(e){return"max"==e.rule}),p.getCartAvailability(),e.giftProductData&&(s.giftWithPurchaseSelections=[{giftWithPurchaseIdentifier:e.giftProductData.giftWithPurchaseIdentifier,promotionId:e.giftProductData.promotionId,giftWithPurchaseQuantity:e.giftProductData.giftWithPurchaseQuantity}]),a=!0}if(!a){r=e.orderQuantity;var h={productId:e.id,productData:e,quantity:r,catRefId:e.childSKUs[0].repositoryId,selectedOptions:e.selectedOptions,currency:p.currency,externalData:e.externalData,actionCode:e.actionCode,lineAttributes:p.lineAttributes,externalRecurringCharge:e.externalRecurringCharge,externalRecurringChargeFrequency:e.externalRecurringChargeFrequency,externalRecurringChargeDuration:e.externalRecurringChargeDuration,assetKey:e.assetKey,rootAssetKey:e.rootAssetKey,parentAssetKey:e.parentAssetKey,serviceId:e.serviceId,customerAccountId:e.customerAccountId,billingAccountId:e.billingAccountId,serviceAccountId:e.serviceAccountId,billingProfileId:e.billingProfileId,activationDate:e.activationDate,deactivationDate:e.deactivationDate,transactionDate:e.transactionDate,asset:e.asset,addOnItem:e.addOnItem,shopperInput:e.shopperInput,selectedStore:"function"==typeof e.selectedStore?e.selectedStore():e.selectedStore,availablePickupDateTime:e.availablePickupDateTime};if(p.isConfigurableItem(e))n.extend(h,{configuratorId:e.configuratorId,childItems:i,externalPrice:e.price,externalPriceQuantity:-1});else if(p.isProductWithAddons(e)){n.extend(h,{childItems:i});for(var g=e.externalPriceQuantity,f=0;f<i.length;f++)if(i[f].externalPrice){g=-1;break}e.externalPrice&&n.extend(h,{externalPrice:e.externalPrice,externalPriceQuantity:g})}else e.externalPrice&&e.externalPriceQuantity&&n.extend(h,{externalPrice:e.externalPrice,externalPriceQuantity:e.externalPriceQuantity});var m=new I(h);this.storeConfiguration.isLargeCart()===!0&&(p.updateItemPriceForLargeCart(e,m),p.updateItemShippingGroupRelationShipForLargeCart(e,m)),m.skuProperties=e.skuProperties,m.selectedSkuProperties=e.selectedSkuProperties,p.items.push(m)}p.isDirty(!1),this.storeConfiguration.isLargeCart()===!0&&(p.updateCartItemDataForLargeCart(e),p.updateAllItemsArray()),p.markDirty()}},p.addItems=function(e){for(var r,i=e.length,a=0;a<i;a++)if(r=e[a],r&&r.childSKUs){var o,s,l=!1;if(r.childItems){s=[];for(var d=0;d<r.childItems.length;d++){var u,h=r.childItems[d];u=h.catalogRefId?h.catalogRefId:h.catRefId;var g={productId:h.productId,quantity:h.quantity,catRefId:u,selectedOptions:h.selectedOptions,currency:p.currency,addOnItem:h.addOnItem,shopperInput:h.shopperInput,configurablePropertyId:h.configurablePropertyId,configurationOptionId:h.configurationOptionId};s[d]=new I(g)}}var f=p.getCartItem(r.id,r.childSKUs[0].repositoryId,r.commerceItemId);if(r.childItems&&r.childItems.length>0&&(f=null),p.combineLineItems==c.COMBINE_YES||f&&f.isUpdate()||(f=null),null!==f){if(o=f.quantity()+r.orderQuantity,f.quantity(o),f.shippingGroupRelationships()&&f.shippingGroupRelationships().length>0){var m=f.shippingGroupRelationships()[0].quantity()+r.orderQuantity,E=f.shippingGroupRelationships()[0];E.quantity(m),E.updatableQuantity&&E.updatableQuantity(m)}r.giftProductData&&(f.giftWithPurchaseSelections=[{giftWithPurchaseIdentifier:r.giftProductData.giftWithPurchaseIdentifier,promotionId:r.giftProductData.promotionId,giftWithPurchaseQuantity:r.giftProductData.giftWithPurchaseQuantity}]),l=!0,n.Topic(t.topicNames.CART_UPDATE_QUANTITY_SUCCESS).publishWith(function(){}),this.storeConfiguration.isLargeCart()===!0&&(p.updateItemPriceForLargeCart(r,f),p.updateItemShippingGroupRelationShipForLargeCart(r,f))}if(!l){o=r.orderQuantity;var v,y={productId:r.id,productData:r,quantity:o,catRefId:r.childSKUs[0].repositoryId,selectedOptions:r.selectedOptions,currency:p.currency,shopperInput:r.shopperInput};r.commerceItemId&&(y.commerceItemId=r.commerceItemId),r.childItems?n.extend(y,{configuratorId:r.configuratorId,childItems:s}):r.externalPrice&&r.externalPriceQuantity&&n.extend(y,{externalPrice:r.externalPrice,externalPriceQuantity:r.externalPriceQuantity}),v=new I(y),this.storeConfiguration.isLargeCart()===!0&&(p.updateItemPriceForLargeCart(r,v),p.updateItemShippingGroupRelationShipForLargeCart(r,v)),v.skuProperties=r.skuProperties,v.selectedSkuProperties=r.selectedSkuProperties,
p.updateItemDynamicProperties(v,r),p.items.push(v)}}p.isDirty(!1),this.storeConfiguration.isLargeCart()===!0&&(p.updateCartItemsDataForLargeCart(e),p.updateAllItemsArray()),p.markDirty()},p.addToCart=function(){if(p.storeConfiguration.isLargeCart()===!0)return void p.addItem(this);var e=p.getCookieDataAndCompare();p.events.push(new M(k,1,this)),p.mergeCart()||!e||p.isMatchingCookieData()?p.addItem(this):(p.getLocalData(e),0==e.items.length&&p.addItem(this))},n.Topic(t.topicNames.CART_PRICE_COMPLETE).subscribe(p.updateCartItems),h.profileType==c.PROFILE_TYPE_AGENT&&n.Topic(t.topicNames.ORDER_PRICING_SUCCESS).subscribe(p.populateShippingMethodsDeferred.bind(p)),p.removeFromCart=function(e){if(!p.isDirty()){p.events.push(new M(G,0,this));var t=p.getCookieDataAndCompare();if(t&&t.items.length>0&&!p.isMatchingCookieData())p.getLocalData(t);else{if(e)var r=p.getCartItem(this.id,this.childSKUs[0].repositoryId,e.commerceItemId);else var r=p.getCartItem(this.id,this.childSKUs[0].repositoryId);null!==r&&(r.updatableQuantity(0),p.removeItem(r))}}},p.removeChildItemFromCart=function(e,t,r){var i=p.items();r&&(i=r);for(var a=0;a<i.length;a++){if(i[a].commerceItemId==e.commerceItemId)return void i.splice(a,1);i[a].childItems&&i[a].childItems.length>0&&(p.removeChildItemFromCart(e,t,i[a].childItems),i[a].childItems&&0==i[a].childItems.length&&delete i[a].childItems)}!r&&t&&p.markDirty()},p.removeChildItemFromLargeCart=function(e,t,r){var i=p.items();r&&(i=r);for(var a=0;a<i.length;a++){if(i[a].commerceItemId==e.commerceItemId)return void(i.invalid=!0);i[a].childItems&&i[a].childItems.length>0&&(p.removeChildItemFromCartLargeCart(e,t,i[a].childItems),i[a].childItems&&0==i[a].childItems.length&&delete i[a].childItems)}},p.editChildItemFromCart=function(e,t){var r=p.items();t&&(r=t);for(var i=0;i<r.length;i++){if(r[i].commerceItemId==e.commerceItemId){r[i]=e,p.markDirty();break}r[i].childItems&&r[i].childItems.length>0&&p.editChildItemFromCart(e,r[i].childItems)}},p.addAddOnChildItemsToCartItem=function(e,t){var r=e,i=p.getAddonDataAsCartItems(t),a=r.childItems;r.childItems?(a=a.concat(i),r.childItems=a):r.childItems=i,p.markDirty()},p.getCookieDataAndCompare=function(){var e=p.getCookieData();return e&&p.isMatchingCookieData(p.compareItems(e.items)),e},p.removeItem=function(e){if(void 0!==e){p.items.remove(e),p.allItems.remove(e);var r=p.events.pop();r&&r.type==W||p.markDirty(),n.Topic(t.topicNames.CART_REMOVE_SUCCESS).publishWith([{message:"success",commerceItemId:e.commerceItemId}])}},p.emptyCart=function(){p.items.removeAll(),p.allItems.removeAll(),p.shippingMethod(""),n.Topic(t.topicNames.CHECKOUT_RESET_SHIPPING_METHOD).publish(),p.numberOfItems(0),p.total(0),p.totalWithoutTax(0),p.subTotal(0),p.amount(0),p.shipping(0),p.secondaryCurrencyShippingAmount(0),p.taxExclusiveAmount(0),p.shippingDiscount(0),p.secondaryCurrencyShippingDiscount(0),p.shippingSurcharge(0),p.secondaryCurrencyShippingSurcharge(0),p.tax(0),p.secondaryCurrencyTaxAmount(0),p.secondaryCurrencyTotal(0),p.primaryCurrencyTotal(0),p.currencyCode(""),p.orderDiscount(0),p.orderCreationDate(null),p.giftCards([]),p.IINDetails([]),p.giftWithPurchaseOrderMarkers=[],p.cartName(""),p.placeHolderItems.removeAll(),p.hasPriceOverriddenItem(!1),p.hasExternalPriceItem(!1),p.quoteInfo(null),p.orderDiscountDescList()&&p.orderDiscountDescList.removeAll(),p.coupons()&&p.coupons().length>0&&p.coupons.removeAll(),p.couponMultiPromotions()&&p.couponMultiPromotions().length>0&&(p.couponMultiPromotions.removeAll(),p.claimedCouponMultiPromotions.removeAll()),p.dynamicProperties()&&p.dynamicProperties().length>0&&p.dynamicProperties.removeAll(),p.cartUpdated()},p.handleOrderSubmit=function(){p.emptyCart(),p.user().loggedIn()&&p.user().orderId()&&""!=p.user().orderId()&&(p.user().orderId(""),p.user().persistedOrder(null),p.user().setLocalData("orderId"),p.user().updateLocalData(!1,!1))},p.updateShippingMethod=function(){this&&this.repositoryId&&""!==p.shippingAddress()?(p.shippingMethod(this.repositoryId),p.shipping(this.shippingCost),p.secondaryCurrencyShippingAmount(this.secondaryCurrencyShippingCost()),p.items().length&&p.priceCartForCheckout()):(p.shippingMethod(""),p.shippingDiscount(0),p.secondaryCurrencyShippingDiscount(0),p.shippingSurcharge(0),p.secondaryCurrencyShippingSurcharge(0),0==p.shipping()||window.isAgentApplication||p.markDirty())},p.shippingMethodsLoaded=function(){var e,r=!1;if(this.shippingOptions()){for(var i=0;i<this.shippingOptions().length;i++)if(p.shippingMethod()&&p.shippingMethod()===this.shippingOptions()[i].repositoryId){e=this.shippingOptions()[i],r=!0;break}if(!r)for(var i=0;i<this.shippingOptions().length;i++)if(this.defaultShipping()===this.shippingOptions()[i].repositoryId){e=this.shippingOptions()[i];break}}n.Topic(t.topicNames.CHECKOUT_SHIPPING_METHOD).publishWith(e,[{message:"success"}])},p.updateShippingAddress=function(){if(this&&this.shippingAddress&&this.shippingAddress.validateForShippingMethod()){var e=p.shippingAddress();p.shippingAddress(this.shippingAddress.toJSON()),!p.isShippingAddressChanged(p.shippingAddress(),e)&&p.shippingMethod()||n.Topic(t.topicNames.RELOAD_SHIPPING_METHODS).publishWith(this,[{message:"success"}])}else p.shippingAddress("")},p.updateShippingAddressAndReloadMethod=function(){if(this&&this.shippingAddress&&this.shippingAddress().validateForShippingMethod()){var e=p.shippingAddress();p.shippingAddress(this.shippingAddress.toJSON()),!p.isShippingAddressChanged(p.shippingAddress(),e)&&p.shippingMethod()||n.Topic(t.topicNames.RELOAD_SHIPPING_METHODS).publishWith(this,[{message:"success"}])}else p.shippingAddress("")},p.resetShippingAddress=function(){p.shippingAddress("")},p.updateQuantity=function(e){e&&e.commerceItemId&&(this.commerceItemId=e.commerceItemId),p.events.push(new M(x,0,this));var t=p.getCookieDataAndCompare();p.mergeCart()||!t||p.isMatchingCookieData()?p.updateItemQuantity(this,e.shippingGroup,e.cartItem):p.getLocalData(t)},p.updateItemQuantity=function(e,r,i){var a;if(a=e.childSKUs?p.getCartItem(e.id,e.childSKUs[0].repositoryId,e.commerceItemId):p.getCartItem(e.productId,e.catRefId,e.commerceItemId),null!==a){var o=a;if(o.productPriceChanged()&&o.productPriceChanged(!1),r&&null!==r){var s=parseInt(r.updatableQuantity());r.quantity(s);for(var c=0,l=0;l<o.shippingGroupRelationships().length;l++)c+=parseInt(o.shippingGroupRelationships()[l].quantity());c?(o.quantity(c),p.validateProduct(o,r),n.Topic(t.topicNames.CART_UPDATE_QUANTITY_SUCCESS).publishWith(null,[{message:"success",createNewSGR:!1,shippingGroup:r}])):p.removeItem(o)}else if(o.updatableQuantity.isValid()){var s=parseInt(o.updatableQuantity());s?(o.quantity(parseFloat(o.updatableQuantity())),1==o.shippingGroupRelationships().length&&(o.shippingGroupRelationships()[0].updatableQuantity(o.updatableQuantity()),o.shippingGroupRelationships()[0].quantity(o.updatableQuantity())),p.validateProduct(o),n.Topic(t.topicNames.CART_UPDATE_QUANTITY_SUCCESS).publishWith(null,[{message:"success",createNewSGR:!1,data:i,prodData:e}])):p.removeItem(o)}}},p.validateProduct=function(e,t){var r,i,a,o=this;if(h.profileType===c.PROFILE_TYPE_AGENT&&e.childItems&&e.childItems.length)r="0",i=new D(o),a="getStockStatuses";else{var s=this.catalogId();o.user().catalogId&&(s=o.user().catalogId());var r=new Array(e.catRefId,e.productId,s),i={},n={};n[c.ENDPOINT_KEY]=c.ENDPOINT_GET_PRODUCT_AVAILABILITY,n[c.IDENTIFIER_KEY]="stockStatusForProdValidation";var l=o.storeConfiguration.getFilterToUse(n);l&&(i[c.FILTER_KEY]=l),t&&null!==t&&(r=new Array(t.catRefId,t.productId,s),t.isPickupInStore&&t.isPickupInStore()&&(i[c.LOCATION_ID]=t.selectedStore().locationId)),a="getStockStatus"}o.adapter.loadJSON(a,r,i,function(r){Array.isArray(r)?o.validateProductForPricingForChildItems(r,e.productId,t):o.validateProductForPricing(r,t)},function(e){o.reloadCart()})},p.validateProductForPricing=function(e,r){for(var i=null,a=null,s=0,l=0;l<p.items().length;l++)if(p.items()[l].productId===e.productId&&p.items()[l].catRefId===e.catRefId){i=p.items()[l],a=p.items()[l],s=p.user().clonedOrderId()&&p.validOrderQuantityMap&&p.validOrderQuantityMap[i.productId+":"+i.catRefId]?p.validOrderQuantityMap[i.productId+":"+i.catRefId]:e.orderableQuantity;break}if(r&&null!==r&&(i=r),c.IN_STOCK===e.stockStatus||c.PREORDERABLE===e.stockStatus||c.BACKORDERABLE===e.stockStatus||h.profileType===c.PROFILE_TYPE_AGENT&&s>0){if(i.updatableQuantity()<=s){i.stockStatus(!0);var d="";if(h.profileType===c.PROFILE_TYPE_AGENT){var u=!!p.user().clonedOrderId();d=i.getOrderableQuantityMessageForAgent(i,e,p.isPreOrderBackOrderEnabled,u,p.orderedQuantityMap)}else p.isPreOrderBackOrderEnabled&&e.inStockQuantity>0&&i.updatableQuantity()>e.inStockQuantity&&(e.backOrderableQuantity>0?d=o.t("ns.common:resources.partialBackOrderMsg",{stockLimit:e.inStockQuantity}):e.preOrderableQuantity>0&&(d=o.t("ns.common:resources.partialPreOrderMsg",{stockLimit:e.inStockQuantity}))),i.stockState(e.stockStatus);i.orderableQuantityMessage(d),p.updatedProduct(i.catRefId),p.markDirty()}else if(i.updatableQuantity()>s){i.stockStatus(!1);var g=o.t("ns.common:resources.insufficientStockMsg",{stockLimit:e.inStockQuantity});i.orderableQuantityMessage(g),i.stockState(e.stockStatus),p.updatedProduct(i.catRefId),n.Topic(t.topicNames.DESTROY_SHOPPING_CART_SPINNER).publish()}else p.reloadCart();return p.reApplyLimitsValidations(e,a,r),void p.reApplyLimitsValidations(e,a,r,!0)}if(c.OUT_OF_STOCK===e.stockStatus){i.stockStatus(!1);var f=o.t("ns.common:resources.outOfStockMsg");return i.orderableQuantityMessage(f),i.stockState(e.stockStatus),p.updatedProduct(i.catRefId),p.reApplyLimitsValidations(e,a,r),void p.reApplyLimitsValidations(e,a,r,!1)}p.reloadCart()},p.reApplyLimitsValidations=function(e,t,r,i){if(t.productId===e.productId&&t.catRefId===e.catRefId)if(r&&null!==r)if(r.isPickupInStore())r.getItemQuantityInCart=p.getUpdatableItemQuantityInCart.bind(p,p.items(),t.productId,t.catRefId),r.addLimitsValidation(t,[e],p.isPreOrderBackOrderEnabled);else for(var a=0;a<t.shippingGroupRelationships().length;a++){var o=t.shippingGroupRelationships()[a];o.isPickupInStore()||(o.getItemQuantityInCart=p.getUpdatableItemQuantityInCart.bind(p,p.items(),o.productId,o.catRefId),o.addLimitsValidation(t,[e],p.isPreOrderBackOrderEnabled))}else t.getItemQuantityInCart=p.getUpdatableItemQuantityInCart.bind(p,p.items(),t.productId,t.catRefId),t.addLimitsValidation(i,e.orderableQuantity,e,p.isPreOrderBackOrderEnabled)},p.validateProductForPricingForChildItems=function(e,r,i){for(var a,s,l,d,u,g,f=0,m=0;m<p.items().length;m++){for(var I=0;I<e.length;I++)if(s=p.items()[m],i&&null!==i&&(s=i),s.productId===e[I].productId&&s.catRefId===e[I].catRefId&&e[I].productId===r){u=e[I],p.user().clonedOrderId()&&p.validOrderQuantityMap&&p.validOrderQuantityMap[s.productId+":"+s.catRefId]?(f=p.validOrderQuantityMap[s.productId+":"+s.catRefId],l=!0):(f=e[I].orderableQuantity,l=!1);break}if(I!=e.length)break}if(c.IN_STOCK===u.stockStatus||c.PREORDERABLE===u.stockStatus||c.BACKORDERABLE===u.stockStatus||h.profileType===c.PROFILE_TYPE_AGENT&&f>0){if(s.updatableQuantity()<=f){a=s.getOrderableQuantityMessageForAgent(s,e[I],p.isPreOrderBackOrderEnabled,l,p.orderedQuantityMap);for(var I=0;s.childItems&&I<s.childItems.length;I++){s.availabilityDate(""),s.stockStatus(""),s.availabilityDate(p.getMaxAvailabilityDate(s,e));for(var E=0;E<e.length;E++)s.childItems[I].productId===e[E].productId&&s.childItems[I].catRefId===e[E].catRefId&&(g=e[E]);var v;if(p.user().clonedOrderId()&&p.validOrderQuantityMap&&p.validOrderQuantityMap[s.childItems[I].productId+":"+s.childItems[I].catRefId]?(v=p.validOrderQuantityMap[s.childItems[I].productId+":"+s.childItems[I].catRefId],l=!0):(v=g.orderableQuantity,l=!1),c.IN_STOCK===g.stockStatus||c.PREORDERABLE===g.stockStatus||c.BACKORDERABLE===g.stockStatus||v>0){if(s.childItems[I].updatableQuantity()<=v)return d=s.quantity(),a=s.childItems[I].getOrderableQuantityMessageForAgent(s.childItems[I],g,p.isPreOrderBackOrderEnabled,l,p.orderedQuantityMap,d),s.stockStatus(s.childItems[I].stockStatus()),s.stockState(s.childItems[I].stockState()),s.orderableQuantityMessage(a),p.updatedProduct(s.catRefId),void p.markDirty();if(s.childItems[I].updatableQuantity()>v){item.stockStatus(!1);var y=o.t("ns.common:resources.insufficientStockMsg",{stockLimit:g.inStockQuantity});return s.childItems[I].orderableQuantityMessage(y),s.childItems[I].stockState(g.stockStatus),p.updatedProduct(s.childItems[I].catRefId),void n.Topic(t.topicNames.DESTROY_SHOPPING_CART_SPINNER).publish()}if(c.OUT_OF_STOCK===g.stockStatus){item.stockStatus(!1);var b=o.t("ns.common:resources.outOfStockMsg");return s.childItems[I].orderableQuantityMessage(b),s.childItems[I].stockState(g.stockStatus),void p.updatedProduct(s.childItems[I].catRefId)}p.reloadCart()}}return s.orderableQuantityMessage(a),p.updatedProduct(s.catRefId),void p.markDirty()}if(item.updatableQuantity()>f){s.stockStatus(!1);var y=o.t("ns.common:resources.insufficientStockMsg",{stockLimit:e.inStockQuantity});return s.orderableQuantityMessage(y),s.stockState(u.stockStatus),p.updatedProduct(s.catRefId),void n.Topic(t.topicNames.DESTROY_SHOPPING_CART_SPINNER).publish()}return void p.reloadCart()}if(c.OUT_OF_STOCK===u.stockStatus){s.stockStatus(!1);var b=o.t("ns.common:resources.outOfStockMsg");return s.orderableQuantityMessage(b),s.stockState(u.stockStatus),void p.updatedProduct(s.catRefId)}p.reloadCart()},p.getMaxAvailabilityDate=function(e,t,r){for(var i,a=this,o=0;t&&o<t.length;o++)if(e.catRefId===t[o].catRefId){var s=t[o].availabilityDate?T.dateTimeFormatter(t[o].availabilityDate,null,"medium"):"";i=r&&new Date(r)>new Date(s)?r:s;break}if(void 0!==e.childItems&&e.childItems.length>0)for(var n=0;n<e.childItems.length;n++)i=a.getMaxAvailabilityDate(e.childItems[n],t,i);return i};var E=function(){i.emptyGrowlMessages();for(var e=0;e<p.items().length;e++)p.items()[e].revertQuantity()};return p.getCartItem=function(e,t,r){for(var i=0;i<p.items().length;i++)if(p.items()[i].productId===e&&p.items()[i].catRefId===t&&(null==r&&!p.isConfigurableItem(p.items()[i])||r&&r==p.items()[i].commerceItemId))return p.items()[i];return null},p.getConfigurableCartItem=function(e,t,r){for(var i=0;i<p.items().length;i++)if(p.items()[i].productId===e&&p.items()[i].catRefId===t&&p.isConfigurableItem(p.items()[i])&&(!r&&!p.isConfigurableItem(p.items()[i])||r&&p.isConfigurableItem(p.items()[i])&&r==p.items()[i].commerceItemId))return p.items()[i];return null},p.getCartItemForReconfiguration=function(e,t,r){for(var i=0;i<p.items().length;i++)if(p.items()[i].productId===e&&p.items()[i].catRefId===t&&r&&p.isConfigurableItem(p.items()[i])&&r==p.items()[i].configuratorId)return p.items()[i];return null},p.addSkuIdFromConfigurableProduct=function(e,t){for(var r=0;t.childItems&&r<t.childItems.length;r++)e.indexOf(t.childItems[r].catalogRefId)===-1&&e.push(t.childItems[r].catalogRefId),t.childItems[r].childItems&&t.childItems[r].childItems.length>0&&p.addSkuIdFromConfigurableProduct(e,t.childItems[r])},p.addProductIdFromConfigurableProduct=function(e,t){for(var r=0;t.childItems&&r<t.childItems.length;r++)e.indexOf(t.childItems[r].productId)===-1&&e.push(t.childItems[r].productId),t.childItems[r].childItems&&t.childItems[r].childItems.length>0&&p.addProductIdFromConfigurableProduct(e,t.childItems[r])},p.createChildItemTree=function(e,t){for(var r=[],i=0;t.childItems&&i<t.childItems.length;i++)for(var a=0;a<e.length;a++){var o=n.extend(!0,{},e[a]);if(o.repositoryId==t.childItems[i].catalogRefId){var s=o.parentProducts[0],l=o;delete l[c.PARENT_PRODUCTS],s.childSKUs=[l],o.productVariantOptions&&o.productVariantOptions.length>0&&(s.selectedOptions=o.productVariantOptions[0]),s.orderQuantity=parseInt(t.childItems[i].quantity),s.catalogRefId=t.childItems[i].catalogRefId,s.externalData=t.childItems[i].externalData,s.actionCode=t.childItems[i].actionCode,s.price=t.childItems[i].externalPrice,s.externalRecurringCharge=t.childItems[i].externalRecurringCharge,s.externalRecurringChargeFrequency=t.childItems[i].externalRecurringChargeFrequency,s.externalRecurringChargeDuration=t.childItems[i].externalRecurringChargeDuration,s.assetKey=t.childItems[i].assetKey,s.rootAssetKey=t.childItems[i].rootAssetKey,s.parentAssetKey=t.childItems[i].parentAssetKey,s.serviceId=t.childItems[i].serviceId,s.customerAccountId=t.childItems[i].customerAccountId,s.billingAccountId=t.childItems[i].billingAccountId,s.serviceAccountId=t.childItems[i].serviceAccountId,s.billingProfileId=t.childItems[i].billingProfileId,s.activationDate=t.childItems[i].activationDate,s.deactivationDate=t.childItems[i].deactivationDate,s.transactionDate=t.childItems[i].transactionDate,s.asset=t.childItems[i].asset,t.childItems[i].childItems&&t.childItems[i].childItems.length>0&&(s.childItems=p.createChildItemTree(e,t.childItems[i])),r.push(s);break}}return r},p.updateChildTreeProductDataForLargeCart=function(e,t){for(var r=0;e.childItems&&r<e.childItems.length;r++){if(t.id==e.childItems[r].productId&&0==e.childItems[r].processed)for(var i=0;i<t.childSKUs.length;i++)t.childSKUs[i].repositoryId==e.childItems[r].catRefId&&(e.childItems[r].processed=!0,e.childItems[r].productData(jQuery.extend(!0,{},t)));e.childItems[r].childItems&&e.childItems[r].childItems.length>0&&p.updateChildTreeProductDataForLargeCart(e.childItems[r],t)}},p.updateChildTreeProductData=function(e,t){for(var r=0;e.childItems&&r<e.childItems.length;r++){if(t.id==e.childItems[r].productId)for(var i=0;i<t.childSKUs.length;i++)t.childSKUs[i].repositoryId==e.childItems[r].catRefId&&e.childItems[r].productData(jQuery.extend(!0,{},t));e.childItems[r].childItems&&e.childItems[r].childItems.length>0&&p.updateChildTreeProductData(e.childItems[r],t)}},p.getChildItemsDataAsCartItems=function(e){var t=[];return e.childItems&&(t=e.childItems.map(function(e){var t={productId:e.id,productData:e,quantity:e.orderQuantity,catRefId:e.catalogRefId,selectedOptions:e.selectedOptions,currency:p.currency,externalPrice:e.price,externalPriceQuantity:-1,externalData:e.externalData,actionCode:e.actionCode,lineAttributes:p.lineAttributes,externalRecurringCharge:e.externalRecurringCharge,externalRecurringChargeFrequency:e.externalRecurringChargeFrequency,externalRecurringChargeDuration:e.externalRecurringChargeDuration,assetKey:e.assetKey,rootAssetKey:e.rootAssetKey,parentAssetKey:e.parentAssetKey,serviceId:e.serviceId,customerAccountId:e.customerAccountId,billingAccountId:e.billingAccountId,serviceAccountId:e.serviceAccountId,billingProfileId:e.billingProfileId,activationDate:e.activationDate,deactivationDate:e.deactivationDate,transactionDate:e.transactionDate,asset:e.asset,addOnItem:e.addOnItem,shopperInput:e.shopperInput};return e.childItems&&e.childItems.length>0&&n.extend(t,{childItems:p.getChildItemsDataAsCartItems(e)}),new I(t)})),t},p.getAddonDataAsCartItems=function(e){var t=[];e.selectedAddOnProducts&&(t=e.selectedAddOnProducts.map(function(e){for(var t=[],r=0;r<e.addOnOptions.length;r++){var i=e.addOnOptions[r];if(i){var a={productId:i.product.id,productData:i.product,quantity:i.quantity,catRefId:i.sku.repositoryId,selectedOptions:i.selectedOptions,currency:p.currency,externalData:i.externalData,actionCode:i.actionCode,lineAttributes:p.lineAttributes,externalRecurringCharge:i.externalRecurringCharge,externalRecurringChargeFrequency:i.externalRecurringChargeFrequency,externalRecurringChargeDuration:i.externalRecurringChargeDuration,assetKey:i.assetKey,rootAssetKey:i.rootAssetKey,parentAssetKey:i.parentAssetKey,serviceId:i.serviceId,customerAccountId:i.customerAccountId,billingAccountId:i.billingAccountId,serviceAccountId:i.serviceAccountId,billingProfileId:i.billingProfileId,activationDate:i.activationDate,deactivationDate:i.deactivationDate,transactionDate:i.transactionDate,asset:i.asset,addOnItem:!0,shopperInput:i.shopperInput,configurablePropertyId:e.repositoryId,configurationOptionId:i.repositoryId};i.externalPrice&&n.extend(a,{externalPrice:i.externalPrice,externalPriceQuantity:-1})}p.isProductWithAddons(i.product)&&n.extend(a,{childItems:p.getAddonDataAsCartItems(i.product)}),t.push(new I(a))}if(t.length>0)return t}));for(var r=[],i=0;i<t.length;i++)r=r.concat(t[i]);return r},p.updateChildItemPrices=function(e,t){for(var r=0;r<e.length;r++)for(var i=0;i<t.length;i++)if(e[r].productId==t[i].productId&&e[r].catRefId==t[i].catRefId){t[i].detailedItemPriceInfo(e[r].detailedItemPriceInfo),t[i].detailedRecurringChargeInfo(e[r].detailedRecurringChargeInfo),e[r].amount&&t[i].itemTotal(e[r].amount),e[r].rawTotalPrice&&t[i].rawTotalPrice(e[r].rawTotalPrice),e[r].id&&(t[i].repositoryId=e[r].id,p.currentOrderState()!=c.QUOTED_STATES&&p.currentOrderState()!=c.PENDING_PAYMENTS&&p.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE&&(e[r].commerceItemId?t[i].commerceItemId=e[r].commerceItemId:t[i].commerceItemId=e[r].id)),e[r].rootAssetKey&&t[i].rootAssetKey(e[r].rootAssetKey),e[r].parentAssetKey&&t[i].parentAssetKey(e[r].parentAssetKey),t[i].childItems&&e[r].childItems&&p.updateChildItemPrices(e[r].childItems,t[i].childItems);break}},p.getChildItemsAsCartItems=function(t){var r=[];return t.childItems&&(r=t.childItems.map(function(t){var r={productId:t.productId,quantity:t.quantity,catRefId:t.catRefId,selectedOptions:t.selectedOptions,currency:p.currency,externalPrice:t.externalPrice,externalPriceQuantity:t.externalPriceQuantity,externalData:t.externalData,actionCode:t.actionCode,lineAttributes:S.singleInstance.lineAttributes,externalRecurringCharge:t.externalRecurringCharge,externalRecurringChargeFrequency:t.externalRecurringChargeFrequency,externalRecurringChargeDuration:t.externalRecurringChargeDuration,assetKey:t.assetKey,rootAssetKey:t.rootAssetKey,parentAssetKey:t.parentAssetKey,serviceId:t.serviceId,customerAccountId:t.customerAccountId,billingAccountId:t.billingAccountId,serviceAccountId:t.serviceAccountId,billingProfileId:t.billingProfileId,activationDate:t.activationDate,deactivationDate:t.deactivationDate,transactionDate:t.transactionDate,asset:t.asset,rawTotalPrice:t.rawTotalPrice,commerceItemId:t.commerceItemId,addOnItem:t.addOnItem,shopperInput:t.shopperInput,configurablePropertyId:t.configurablePropertyId,configurationOptionId:t.configurationOptionId};t.childItems&&t.childItems.length>0?n.extend(r,{childItems:p.getChildItemsAsCartItems(t)}):n.extend(r,{backOrderQuantity:t.backOrderQuantity,preOrderQuantity:t.preOrderQuantity});var i=new I(r);return i.displayName=e.observable(t.displayName),i.detailedItemPriceInfo(t.detailedItemPriceInfo),i.itemTotal(t.amount),i.detailedRecurringChargeInfo(t.detailedRecurringChargeInfo),i.repositoryId=t.id,i})),r},p.checkCpqItemValidity=function(e,t,r,i,a){for(var o=0;t.childItems&&o<t.childItems.length;o++){if(e.id==t.childItems[o].productId)if(e.active&&e.childSKUs&&0!=e.childSKUs.length){var s=0,n=!1;for(s=0;e.childSKUs&&s<e.childSKUs.length;s++)if(e.childSKUs[s].repositoryId==t.childItems[o].catRefId){n=!0;break}e.childSKUs[s]&&!e.childSKUs[s].active?t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&a.push(t.childItems[o]):i.indexOf(t.childItems[o].catRefId)==-1&&i.push(t.childItems[o].catRefId):e.childSKUs[s]&&null==e.childSKUs[s].listPrice&&t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&a.push(t.childItems[o]):!n&&t.childItems[o].addOnItem&&a.indexOf(t.childItems[o])==-1&&a.push(t.childItems[o])}else t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&a.push(t.childItems[o]):r.indexOf(e.displayName)==-1&&r.push(e.displayName);t.childItems[o].childItems&&t.childItems[o].childItems.length>0&&p.checkCpqItemValidity(e,t.childItems[o],r,i,a)}},p.checkCpqItemValidityForLargeCart=function(e,t,r,i,a){for(var o=0;t.childItems&&o<t.childItems.length;o++){if(e.id==t.childItems[o].productId&&0==t.childItems[o].processed)if(e.active&&e.childSKUs&&0!=e.childSKUs.length){var s=0,n=!1;for(s=0;e.childSKUs&&s<e.childSKUs.length;s++)if(e.childSKUs[s].repositoryId==t.childItems[o].catRefId){n=!0;break}e.childSKUs[s]&&!e.childSKUs[s].active?t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&(t.childItems[o].invalid=!0,a.push(t.childItems[o])):i.indexOf(t.childItems[o].catRefId)==-1&&(t.childItems[o].invalid=!0,i.push(t.childItems[o].catRefId)):e.childSKUs[s]&&null==e.childSKUs[s].listPrice&&t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&(t.childItems[o].invalid=!0,a.push(t.childItems[o])):!n&&t.childItems[o].addOnItem&&a.indexOf(t.childItems[o])==-1&&(t.childItems[o].invalid=!0,a.push(t.childItems[o]))}else t.childItems[o].addOnItem?a.indexOf(t.childItems[o])==-1&&(t.childItems[o].invalid=!0,a.push(t.childItems[o])):(r.indexOf(e.displayName)==-1&&(t.childItems[o].invalid=!0),r.push(e.displayName));t.childItems[o].childItems&&t.childItems[o].childItems.length>0&&p.checkCpqItemValidityForLargeCart(e,t.childItems[o],r,i,a)}},p.getChildItemsCookie=function(e){for(var t=[],r=0;e.childItems&&r<e.childItems.length;r++){var i=e.childItems[r];t[r]={productId:i.productId,quantity:i.quantity(),catRefId:i.catRefId,amount:i.itemTotal(),id:i.repositoryId,rawTotalPrice:i.rawTotalPrice(),stockStatus:i.stockStatus(),displayName:i.displayName(),selectedOptions:i.selectedOptions,selectedSkuProperties:i.selectedSkuProperties,discountInfo:i.discountInfo(),detailedItemPriceInfo:i.detailedItemPriceInfo(),externalPrice:i.externalPrice(),externalPriceQuantity:i.externalPriceQuantity(),configuratorId:i.configuratorId,externalData:i.externalData(),actionCode:i.actionCode(),commerceItemId:i.commerceItemId,unpricedExternalMessage:i.unpricedExternalMessage(),isGWPChoicesAvaliable:i.isGWPChoicesAvaliable(),giftData:i.giftData?i.giftData:null,giftWithPurchaseCommerceItemMarkers:i.giftWithPurchaseCommerceItemMarkers,priceListGroupId:i.priceListGroupId(),invalid:i.invalid,isPersonalized:i.isPersonalized(),detailedRecurringChargeInfo:i.detailedRecurringChargeInfo(),externalRecurringCharge:i.externalRecurringCharge(),externalRecurringChargeFrequency:i.externalRecurringChargeFrequency(),externalRecurringChargeDuration:i.externalRecurringChargeDuration(),assetKey:i.assetKey(),rootAssetKey:i.rootAssetKey(),parentAssetKey:i.parentAssetKey(),serviceId:i.serviceId(),customerAccountId:i.customerAccountId(),billingAccountId:i.billingAccountId(),serviceAccountId:i.serviceAccountId(),billingProfileId:i.billingProfileId(),activationDate:i.activationDate(),deactivationDate:i.deactivationDate(),transactionDate:i.transactionDate(),asset:i.asset(),addOnItem:i.addOnItem,shopperInput:i.shopperInput,configurablePropertyId:i.configurablePropertyId,configurationOptionId:i.configurationOptionId},i.childItems&&i.childItems.length>0&&(t[r].childItems=p.getChildItemsCookie(i))}return t},p.getRemoveCouponReadText=function(){return o.t("ns.common:resources.removeCouponLinkReadText")},p.populateGiftCards=function(e,t){if(p.populateGiftCardsHandler&&n.isFunction(p.populateGiftCardsHandler))p.populateGiftCardsHandler(e,t);else if(p.giftCards().length>0)for(var r=0;r<p.giftCards().length;r++){var i={},a=p.giftCards()[r];i.type=c.GIFT_CARD_PAYMENT_TYPE,i.giftCardNumber=a.giftCardNumber(),i.giftCardPin=a.giftCardPin(),a.amountInGiftCard()&&(t&&t.type===q&&t.product.giftCardNumber()===a.giftCardNumber()||(i.amount=a.amountInGiftCard())),e.payments.push(i)}},p.populateIINs=function(e,t){if(p.IINDetails().length>0)for(var r=0;r<p.IINDetails().length;r++){var i=p.IINDetails()[r];i.IIN=i.IIN;var a=c.IIN_PAYMENT_TYPE;i.type&&(a=i.type),i.type=a,e.payments.push(i)}},p.applyIINsToCart=function(e){p.IINDetails([]);for(var t=0;t<e.length;t++)p.IINDetails.push(e[t]);p.events.push(new M(j,0,e)),p.markDirty()},p.validateGiftCards=function(){for(var e=0;e<p.giftCards().length;e++){var t=p.giftCards()[e];if(!t.validateNow())return!1}return!0},p.updateAllItemsArray=function(){p.allItems.removeAll(),e.utils.arrayForEach(p.items(),function(e){p.allItems.push(e)}),e.utils.arrayForEach(p.placeHolderItems(),function(e){p.allItems.push(e)})},p.isConfigurableItem=function(e){return void 0!=e.configuratorId&&null!=e.configuratorId&&""!=e.configuratorId||void 0!=e.childItems&&null!=e.childItems&&""!=e.childItems},p.cpqConfigMap=new Map,p.isProductWithAddons=function(e){return!!(e.selectedAddOnProducts&&e.selectedAddOnProducts.length>0)},p.getDerivedTotal=function(e,t){var r=this.isChargeTaxShippingInSecondaryCurrency()?e:t;return r},p.buildErrorInfo=function(e){var t={},r=!!e.hasOwnProperty("errorCode");if(e.errors&&e.errors.length>0||r)if(e.errors&&e.errors.length>0)t.errors=e.errors;else if(r){var i=[],a={};a.errorCode=e.errorCode,a.message=e.message,a.status=e.status,a.moreInfo=e.moreInfo,a.devMessage=e.moreInfo,i.push(a),t.errors=i}return t},n.Topic(t.topicNames.CART_ADD).subscribe(p.addToCart),n.Topic(t.topicNames.CART_REMOVE).subscribe(p.removeFromCart),n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).subscribe(p.handleOrderSubmit),n.Topic(t.topicNames.SCHEDULED_ORDER_SUBMISSION_SUCCESS).subscribe(p.handleOrderSubmit),n.Topic(t.topicNames.CART_UPDATE_QUANTITY).subscribe(p.updateQuantity),n.Topic(t.topicNames.CHECKOUT_SHIPPING_METHOD).subscribe(p.updateShippingMethod),n.Topic(t.topicNames.PAGE_CONTEXT_CHANGED).subscribe(i.emptyGrowlMessages),n.Topic(t.topicNames.PAGE_VIEW_CHANGED).subscribe(E),n.Topic(t.topicNames.PAGE_LAYOUT_UPDATED).subscribe(p.initCatalog.bind(p)),n.Topic(t.topicNames.LOAD_CHECKOUT).subscribe(p.checkPriceDataAndRedirect),n.Topic(t.topicNames.POPULATE_SHIPPING_METHODS).subscribe(p.updateShippingAddress),n.Topic(t.topicNames.CHECKOUT_SHIPPING_ADDRESS_INVALID).subscribe(p.resetShippingAddress),n.Topic(t.topicNames.USER_PROFILE_ADDRESSES_REMOVED).subscribe(p.resetShippingAddress),n.Topic(t.topicNames.USER_AUTO_LOGIN_SUCCESSFUL).subscribe(p.loadCartForProfile.bind(p)),n.Topic(t.topicNames.USER_LOAD_CART).subscribe(p.loadCartForProfile.bind(p)),n.Topic(t.topicNames.USER_CLEAR_CART).subscribe(p.clearCartForProfile.bind(p)),n.Topic(t.topicNames.REFRESH_USER_CART).subscribe(p.refreshUserCart.bind(p)),n.Topic(t.topicNames.REMOVE_INVALID_ITEMS).subscribe(p.handleInvalidItems.bind(p)),n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).subscribe(p.clearPins.bind(p)),n.Topic(t.topicNames.PAGE_CHANGED).subscribe(function(e){p.clearLoadedOrder(e),p.clearPins()}),n.Topic(t.topicNames.USER_LOGOUT_SUBMIT).subscribe(p.clearPins.bind(p)),n.Topic(t.topicNames.USER_SESSION_RESET).subscribe(p.clearPins.bind(p)),n.Topic(t.topicNames.GIFTCARD_REAPPLY_PINS).subscribe(p.reApplyGiftCardPins.bind(p)),n.Topic(t.topicNames.PLACE_HOLDER_REMOVE).subscribe(function(e){p.removePlaceHolderFromCart(e)}),n.Topic(t.topicNames.USER_LOAD_SHIPPING).subscribe(function(e){p.user()&&!p.user().loggedIn()&&p.resetShippingAddress()}),p}function C(e){var t=null;if(e.variant&&e.variant.length>0){var r=e.variant;t=[];for(var i=0;i<r.length;i++)t.push({optionName:r[i].optionName,optionValue:r[i].optionValue})}return t}function A(t,r,i,a,o,s,n,c){var l=this;return l.code=e.observable(t),l.description=e.observable(r),l.status=e.observable(i),l.level=e.observable(a),l.id=e.observable(o),l.totalAdjustment=e.observable(s),l.name=e.observable(n),l.longDescription=e.observable(c),l.toJSON=function(){var t=e.toJS(l);return t},l}function _(t,r,i,a){var o=this;return o.code=e.observable(t),o.couponStatus=e.observable(i?i:""),o.promotions=e.observableArray([]),o.newPromotionInfo=function(t,r,i,a,o,s,n){var c={};return c.promotionId=e.observable(t?t:""),c.promotionDesc=e.observable(r?r:""),c.promotionApplied=e.observable(!!i&&i),c.promotionLevel=e.observable(a?a:""),c.totalAdjustment=e.observable(o?o:"0"),c.promotionName=e.observable(s?s:""),c.promotionLongDesc=e.observable(n?n:""),c.toJSON=function(){var t=e.toJS(c);return t},c},o.populatePromotionData=function(e,t,r){t.promotionDesc(e.promotionDesc),t.promotionApplied(r?r:e.promotionApplied),t.promotionLevel(e.promotionLevel),t.totalAdjustment(e.totalAdjustment),t.promotionName(e.promotionName),t.promotionLongDesc(e.promotionLongDesc)},o.populateCouponData=function(t,r){var i=this,a=e.observableArray([]),o=!1;if(t&&t.length>0)for(var s=0;s<t.length;s++){o=!1;for(var n=0;n<i.promotions().length;n++)if(t[s].promotionId==i.promotions()[n].promotionId()){
i.populatePromotionData(t[s],i.promotions()[n],r),o=!0;break}o||a.push(i.newPromotionInfo(t[s].promotionId,t[s].promotionDesc,r?r:t[s].promotionApplied,t[s].promotionLevel,t[s].totalAdjustment,t[s].promotionName,t[s].promotionLongDesc))}for(var s=0;s<a().length;s++)i.promotions.push(a()[s])},o.toJSON=function(){var t=e.toJS(o);return t},r&&r.length>0&&o.populateCouponData(r,a),o}function O(e,t,r,i,a,o,s){var n=!1;i.hasExternalPriceItem(!1);for(var l=0;l<e.length;l++){for(var d=!1,u=0;t&&u<t().length;u++)if(e[l].productId==t()[u].productId&&e[l].catRefId==t()[u].catRefId&&(!i.isConfigurableItem(e[l])&&!i.isConfigurableItem(t()[u])&&null!=e[l].commerceItemId&&e[l].commerceItemId==t()[u].commerceItemId||i.isConfigurableItem(e[l])&&i.isConfigurableItem(t()[u])&&null!=e[l].commerceItemId&&e[l].commerceItemId==t()[u].commerceItemId)){t()[u].quantity(e[l].quantity),t()[u].discountInfo(e[l].discountInfo),t()[u].rawTotalPrice(e[l].rawTotalPrice),t()[u].selectedOptions=e[l].variant,(r||t()[u].giftWithPurchaseCommerceItemMarkers&&t()[u].giftWithPurchaseCommerceItemMarkers.length||e[l].giftWithPurchaseCommerceItemMarkers&&e[l].giftWithPurchaseCommerceItemMarkers.length)&&t()[u].updatableQuantity(e[l].quantity),t()[u].itemTotal(e[l].price),t()[u].originalPrice(e[l].unitPrice),t()[u].detailedItemPriceInfo(e[l].detailedItemPriceInfo),t()[u].repositoryId=e[l].id,i.isConfigurableItem(t()[u])&&i.isConfigurableItem(e[l])&&i.updateChildItemPrices(e[l].childItems,t()[u].childItems),t()[u].detailedRecurringChargeInfo(e[l].detailedRecurringChargeInfo),t()[u].repositoryId=e[l].id,t()[u].childItems&&t()[u].childItems.length>0&&e[l].childItems&&e[l].childItems.length>0&&i.updateChildItemPrices(e[l].childItems,t()[u].childItems),t()[u].giftWithPurchaseCommerceItemMarkers=e[l].giftWithPurchaseCommerceItemMarkers,t()[u].isGWPChoicesAvaliable(!1),e[l].externalPrice&&t()[u].externalPrice()&&(e[l].externalPrice!=t()[u].externalPrice()?t()[u].productPriceChanged(!0):t()[u].productPriceChanged(!1)),i.addGiftDataToItem(t()[u],a),delete t()[u].giftWithPurchaseSelections,i.updateItemDynamicProperties(t()[u],e[l]),i.updateItemPriceOverrideFields(t()[u],e[l]),d=!0;break}if(i.currentOrderState()!=c.QUOTED_STATES&&i.currentOrderState()!=c.PENDING_PAYMENTS&&i.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE){if(!d)for(var u=0;t&&u<t().length;u++)if(!t()[u].commerceItemId){t()[u].quantity(e[l].quantity),t()[u].discountInfo(e[l].discountInfo),t()[u].rawTotalPrice(e[l].rawTotalPrice),(r||t()[u].giftWithPurchaseCommerceItemMarkers&&t()[u].giftWithPurchaseCommerceItemMarkers.length||e[l].giftWithPurchaseCommerceItemMarkers&&e[l].giftWithPurchaseCommerceItemMarkers.length)&&t()[u].updatableQuantity(e[l].quantity),t()[u].itemTotal(e[l].price),t()[u].detailedItemPriceInfo(e[l].detailedItemPriceInfo),t()[u].repositoryId=e[l].id,i.isConfigurableItem(t()[u])&&i.isConfigurableItem(e[l])&&i.updateChildItemPrices(e[l].childItems,t()[u].childItems),t()[u].detailedRecurringChargeInfo(e[l].detailedRecurringChargeInfo),t()[u].repositoryId=e[l].id,t()[u].childItems&&t()[u].childItems.length>0&&e[l].childItems&&e[l].childItems.length>0&&i.updateChildItemPrices(e[l].childItems,t()[u].childItems),t()[u].giftWithPurchaseCommerceItemMarkers=e[l].giftWithPurchaseCommerceItemMarkers,t()[u].isGWPChoicesAvaliable(!1),i.addGiftDataToItem(t()[u],a),delete t()[u].giftWithPurchaseSelections,i.updateItemDynamicProperties(t()[u],e[l]),i.updateItemPriceOverrideFields(t()[u],e[l]),t()[u].commerceItemId=e[l].id,d=!0;break}if((r||R(e[l].discountInfo))&&!d){var p=C(e[l]),h=null;i.isConfigurableItem(e[l])&&(h=[],h=i.getChildItemsAsCartItems(e[l]));var g={productId:e[l].productId,quantity:e[l].quantity,catRefId:e[l].catRefId,selectedOptions:p,currency:S.singleInstance.currency,discountInfo:e[l].discountInfo,rawTotalPrice:e[l].rawTotalPrice,externalPrice:e[l].externalPrice,externalPriceQuantity:e[l].externalPriceQuantity,configuratorId:e[l].configuratorId,childItems:h,commerceItemId:e[l].commerceItemId,unpricedExternalMessage:e[l].unpricedExternalMessage,externalData:e[l].externalData,actionCode:e[l].actionCode,lineAttributes:S.singleInstance.lineAttributes,externalRecurringCharge:e[l].externalRecurringCharge,externalRecurringChargeFrequency:e[l].externalRecurringChargeFrequency,externalRecurringChargeDuration:e[l].externalRecurringChargeDuration,assetKey:e[l].assetKey,rootAssetKey:e[l].rootAssetKey,parentAssetKey:e[l].parentAssetKey,serviceId:e[l].serviceId,customerAccountId:e[l].customerAccountId,billingAccountId:e[l].billingAccountId,serviceAccountId:e[l].serviceAccountId,billingProfileId:e[l].billingProfileId,activationDate:e[l].activationDate,deactivationDate:e[l].deactivationDate,transactionDate:e[l].transactionDate,asset:e[l].asset,addOnItem:e[l].addOnItem,shopperInput:e[l].shopperInput,shippingGroupRelationships:e[l].shippingGroupRelationships},f=new I(g);f.itemTotal(e[l].price),f.detailedItemPriceInfo(e[l].detailedItemPriceInfo),f.detailedRecurringChargeInfo(e[l].detailedRecurringChargeInfo),f.repositoryId=e[l].id,i.updateItemDynamicProperties(f,e[l]),a.priceListGroup&&a.priceListGroup.repositoryId==i.priceListGroupId()&&i.updateItemPriceOverrideFields(f,e[l]),f.giftWithPurchaseCommerceItemMarkers=e[l].giftWithPurchaseCommerceItemMarkers,i.addGiftDataToItem(f,a),t.push(f),n=!0}}}a.shippingGroups&&a.shippingGroups[0].items&&i.associateShippingGroupsToItems(a.shippingGroups,r,s);for(var u=0;t&&u<t().length;u++){for(var d=!1,l=0;l<e.length;l++)if(e[l].productId==t()[u].productId&&e[l].catRefId==t()[u].catRefId){d=!0;break}d||(t.remove(t()[u]),u--)}return n}function R(e){if(e&&e.length)for(var t=0;t<e.length;t++)if(e[t].giftWithPurchaseDiscountInfo&&e[t].giftWithPurchaseDiscountInfo.length)return!0;return!1}function N(e){for(var t={},r=0;r<e.childSKUs.length;r++)e.childSKUs[r].primaryThumbImageURL&&(t[e.childSKUs[r].repositoryId]=e.childSKUs[r].primaryThumbImageURL);return t}function D(e){this.operation="availability",this.products=new Array,this.locationIds=new Array,this.catalogId=e.catalogId();for(var t=0;t<e.items().length;t++){var r=e.items()[t].productId,i=e.items()[t].catRefId;i&&(r=r+":"+i),this.products.push(r),this.getProductSkuFromChild=function(e){for(var t=0;t<e.childItems.length;t++){var r=e.childItems[t].productId,i=e.childItems[t].catRefId;i&&(r=r+":"+i),this.products.push(r),e.childItems[t].childItems&&e.childItems[t].childItems.length>0&&this.getProductSkuFromChild(e.childItems[t])}};var a=e.items()[t];if(a.shippingGroupRelationships&&a.shippingGroupRelationships()&&a.shippingGroupRelationships().length>0)for(var o=0;o<a.shippingGroupRelationships().length;o++){var s=a.shippingGroupRelationships()[o];s&&s.isPickupInStore&&s.isPickupInStore()&&this.locationIds.push(s.selectedStore().locationId)}e.isConfigurableItem(e.items()[t])&&e.items()[t].childItems&&e.items()[t].childItems.length>0&&this.getProductSkuFromChild(e.items()[t])}n.unique(this.products),n.unique(this.locationIds),this.products=this.products.join(","),this.locationIds&&this.locationIds.length>0&&(this.locationIds.push(e.contextData.global.site.siteInfo.inventoryLocationId),this.locationIds=this.locationIds.join(","))}function L(e){this.shoppingCart=new Object,this.shoppingCart.items=e.items(),this.shoppingCart.coupons=e.coupons(),!e.mergeCart()&&e.currentOrderId()&&(this.id=e.currentOrderId()),e.giftWithPurchaseOrderMarkers&&e.giftWithPurchaseOrderMarkers.length&&(this.giftWithPurchaseOrderMarkers=e.giftWithPurchaseOrderMarkers),this.combineLineItems=e.combineLineItems,this.payments=[],e.user().isPunchout()&&(this.requestChannel=c.PUNCHOUT_TEXT,e.user().orderId()&&""!=e.user().orderId()&&(this.id=e.user().orderId())),!(e.user()&&e.user().loggedIn()&&e.user().orderId()&&""!=e.user().orderId())||e.user().loggedinAtCheckout()||e.createNewCart()||e.user().clonedOrderId()&&""!=e.user().clonedOrderId()||(this.id=e.user().orderId()),e.cartName()&&(this.cartName=e.cartName()),e.populateDynamicProperties(this),void 0!=e.storeConfiguration.isLargeCart()&&(this.largeCart=e.storeConfiguration.isLargeCart())}function M(e,t,r){this.type=e,this.quantity=t,e==F||e==H?this.coupon=r:e===z||e===J?this.coupons=r:e===Q?this.products=r:e==ee?this.href=r:this.product=r}function w(e,t){this.operation="availability",this.products=new Array,this.catalogId=t,this.products.push(e.id+":"+e.catalogRefId),this.getProductSkuFromChild=function(e){for(var t=0;t<e.childItems.length;t++){var r=e.childItems[t].id,i=e.childItems[t].catalogRefId;i&&(r=r+":"+i),this.products.push(r),e.childItems[t].childItems&&e.childItems[t].childItems.length>0&&this.getProductSkuFromChild(e.childItems[t])}},e.configuratorId&&e.childItems&&e.childItems.length>0&&this.getProductSkuFromChild(e),this.getProductSkuFromAddons=function(e){for(var t=0;t<e.selectedAddOnProducts.length;t++)for(var r=0;r<e.selectedAddOnProducts[t].addOnOptions.length;r++){var i=e.selectedAddOnProducts[t].addOnOptions[r],a=i.product.repositoryId+":"+i.sku.repositoryId;this.products.push(a),i.product.selectedAddOnProducts&&i.product.selectedAddOnProducts.length>0&&this.getProductSkuFromAddons(i.product)}},e.selectedAddOnProducts&&e.selectedAddOnProducts.length>0&&this.getProductSkuFromAddons(e),n.unique(this.products),this.products=this.products.join(",")}function U(e,t){this.operation="availability",this.products=new Array,this.catalogId=t;for(var r,i=0;i<e.length;i++)if(r=e[i],this.products.push(r.id+":"+r.catalogRefId),r.childItems)for(var a=0;a<r.childItems.length;a++){var o=r.childItems[a].productId,s=r.childItems[a].catRefId;s&&(o=o+":"+s),this.products.push(o)}this.products=this.products.join(",")}var k=1,x=2,G=3,F=4,H=5,V=6,Y=7,q=8,B=9,$=10,W=11,j=12,K=13,Q=14,z=15,X=16,J=17,Z=18,ee=21,te="CartViewModel",re="GiftWithPurchase",ie=c.APPLICATION_STOREFRONT;return S.prototype.loadCartForProfile=function(i){if(void 0==i.isAutoLogin||!i.isAutoLogin){var a=this;r.clearError(te);if(a.isCurrentCallInProgress)n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish();else if(a.events.push(new M(X,0,l)),a.user()&&!a.user().loggedinAtCheckout()){if(i&&i.catalog){var s=i.catalog.repositoryId;this.catalogId()!=s&&this.catalogId(s)}if(i&&i.priceListGroup&&i.priceListGroup.id&&this.priceListGroupId(e.utils.unwrapObservable(i.priceListGroup.id)),1==a.user().isPunchout()){if(a.emptyCart(),a.user().orderId()&&""!=a.user().orderId()){var l={},d={};d[c.ENDPOINT_KEY]=c.ENDPOINT_GET_ORDER,d[c.IDENTIFIER_KEY]="loadCartForProfilebyOrderId";var u=a.storeConfiguration.getFilterToUse(d);u&&(l[c.FILTER_KEY]=u),a.isCurrentCallInProgress=!0,h.request(c.ENDPOINT_GET_ORDER,l,function(r){if(void 0===r&&(a.shippingAddress()&&e.utils.unwrapObservable(a.shippingAddress().email)&&(a.shippingAddress().email=null),n.Topic(t.topicNames.CART_READY).publish(a),a.events.pop(),n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish()),r&&r.orderId){a.user().orderId(r.orderId),a.user().persistedOrder(r),a.user().setLocalData("orderId"),a.cartName(r.cartName);a.removeItems(r);a.mergeItems(r),a.isPricingRequired(!0),a.validateServerCart(),a.getProductData(),a.getDynamicPropertiesMetadata(!0),a.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),a.updateDynamicProperties(r),r.discountInfo.orderImplicitDiscountList&&a.orderDiscountDescList(r.discountInfo.orderImplicitDiscountList),r.discountInfo.unclaimedCouponsMap&&a.populateCoupons(r.discountInfo.unclaimedCouponsMap,c.COUPON_STATUS_UNCLAIMED),r.discountInfo.orderCouponsMap&&a.populateCoupons(r.discountInfo.orderCouponsMap,c.COUPON_STATUS_CLAIMED),a.couponMultiPromotions.splice(0),r.discountInfo.unclaimedCouponMultiPromotions&&a.populateCouponMultiPromotions(r.discountInfo.unclaimedCouponMultiPromotions,c.COUPON_STATUS_UNCLAIMED,c.PROMOTION_NOT_APPLIED),r.discountInfo.claimedCouponMultiPromotions&&a.populateCouponMultiPromotions(r.discountInfo.claimedCouponMultiPromotions,c.COUPON_STATUS_CLAIMED,c.PROMOTION_APPLIED),a.populateClaimedCouponMultiPromotions(a.couponMultiPromotions());for(var i=a.coupons().length-1;i>=0;i--)r.discountInfo.orderCouponsMap.hasOwnProperty(a.coupons()[i].code())||r.discountInfo.unclaimedCouponsMap.hasOwnProperty(a.coupons()[i].code())||a.coupons.splice(i,0);if(r.shippingGroups&&1==r.shippingGroups.length&&a.shippingAddress&&""==a.shippingAddress()&&r.shippingGroups[0].shippingAddress&&!(a.user()&&a.user().shippingAddressBook()&&a.user().shippingAddressBook.length>0)){var s={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},l=new g("cart-shipping-address","",s,a.contextData.page.shippingCountriesPriceListGroup,a.contextData.page.defaultShippingCountry);l.copyFrom(r.shippingGroups[0].shippingAddress,a.contextData.page.shippingCountriesPriceListGroup),l.resetModified(),l.validateForShippingMethod()&&(a.shippingAddress(l),a.shippingMethod(r.shippingGroups[0].shippingMethod.value),n.Topic(t.topicNames.CART_SHIPPING_ADDRESS_UPDATED).publishWith())}}},function(e){a.user().orderId(""),a.user().persistedOrder(null),a.user().setLocalData("orderId"),a.loadCart()},a.user().orderId())}}else{var p={},d={};d[c.ENDPOINT_KEY]=c.ENDPOINT_GET_PROFILE_ORDER,d[c.IDENTIFIER_KEY]="loadCartForProfile";var u=a.storeConfiguration.getFilterToUse(d);u&&(p[c.FILTER_KEY]=u),a.isCurrentCallInProgress=!0,a.adapter.loadJSON("getCurrentProfileOrder","0",p,function(r){if(a.isCurrentCallInProgress=!1,void 0===r&&(a.shippingAddress()&&e.utils.unwrapObservable(a.shippingAddress().email)&&(a.shippingAddress().email=null),n.Topic(t.topicNames.CART_READY).publish(a),a.events.pop(),n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish()),r&&r.orderId){a.user().orderId(r.orderId),a.user().persistedOrder(r),a.user().setLocalData("orderId"),a.cartName(r.cartName);a.removeItems(r);a.mergeItems(r),a.isPricingRequired(!0),a.validateServerCart(),a.getProductData(),a.storeConfiguration.isLargeCart()===!0&&a.updateCartAfterLoginForLargeCart(r),a.getDynamicPropertiesMetadata(!0),a.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),a.updateDynamicProperties(r),r.discountInfo.orderImplicitDiscountList&&a.orderDiscountDescList(r.discountInfo.orderImplicitDiscountList),r.discountInfo.unclaimedCouponsMap&&a.populateCoupons(r.discountInfo.unclaimedCouponsMap,c.COUPON_STATUS_UNCLAIMED),r.discountInfo.orderCouponsMap&&a.populateCoupons(r.discountInfo.orderCouponsMap,c.COUPON_STATUS_CLAIMED),a.couponMultiPromotions.splice(0),r.discountInfo.unclaimedCouponMultiPromotions&&a.populateCouponMultiPromotions(r.discountInfo.unclaimedCouponMultiPromotions,c.COUPON_STATUS_UNCLAIMED,c.PROMOTION_NOT_APPLIED),r.discountInfo.claimedCouponMultiPromotions&&a.populateCouponMultiPromotions(r.discountInfo.claimedCouponMultiPromotions,c.COUPON_STATUS_CLAIMED,c.PROMOTION_APPLIED),a.populateClaimedCouponMultiPromotions(a.couponMultiPromotions());for(var i=a.coupons().length-1;i>=0;i--)r.discountInfo.orderCouponsMap.hasOwnProperty(a.coupons()[i].code())||r.discountInfo.unclaimedCouponsMap.hasOwnProperty(a.coupons()[i].code())||a.coupons.splice(i,0);if(r.shippingGroups&&1==r.shippingGroups.length&&a.shippingAddress&&""==a.shippingAddress()&&r.shippingGroups[0].shippingAddress&&!(a.user()&&a.user().shippingAddressBook()&&a.user().shippingAddressBook.length>0)){var s={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},l=new g("cart-shipping-address","",s,a.contextData.page.shippingCountriesPriceListGroup,a.contextData.page.defaultShippingCountry);l.copyFrom(r.shippingGroups[0].shippingAddress,a.contextData.page.shippingCountriesPriceListGroup),l.resetModified(),l.validateForShippingMethod()&&(a.shippingAddress(l),a.shippingMethod(r.shippingGroups[0].shippingMethod.value),n.Topic(t.topicNames.CART_SHIPPING_ADDRESS_UPDATED).publishWith())}}else a.items()&&a.items().length>0&&(a.validateServerCart(),a.storeConfiguration.isLargeCart()||a.getProductData(),a.createCurrentProfileOrder())},function(e){a.isCurrentCallInProgress=!1,a.loadCart()})}}else a.events.pop(),n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish()}},S.prototype.loadOrderForProfile=function(e,t){var r=this;r.user()||(r.user=t),r.user().persistedOrder(null),r.emptyCart(),r.orderCurrency=e.priceListGroup.currency,r.orderItems(e.order?e.order.items:e.shoppingCart.items),r.mergeItems(e),r.user().clonedOrderId()?r.updateCartData(e,!1,!0,!0):r.updateCartData(e,!1,!0),r.cartUpdated()},S.prototype.clearLoadedOrder=function(e){var r=this;!r.mergeCart()&&r.currentOrderId()&&(e.pageId==c.PAGE_TYPE_CHECKOUT||e.pageId==c.PAGE_TYPE_AGENT_MULTISHIP_CHECKOUT||e.pageId==c.PAGE_TYPE_AGENT_CHECKOUT||e.pageId==c.PAGE_TYPE_PAYMENT||r.currentOrderState()!=c.QUOTED_STATES&&r.currentOrderState()!=c.PENDING_PAYMENTS&&r.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE||(r.currentOrderId(null),r.currentOrderState(null),r.orderItems([]),r.orderCurrency={},r.emptyCart(),r.loadCartForProfile(r.user()),n.Topic(t.topicNames.LOAD_ORDER_RESET_ADDRESS).publish()))},S.prototype.isShippingAddressChanged=function(e,t){return e.state&&e.state!=t.state||e.postalCode&&e.postalCode!=t.postalCode||e.country&&e.country!=t.country},S.prototype.removeItems=function(e){for(var t=this,r=!1,i=e.shoppingCart.items,a=0;a<i.length;a++)i[a].hasOwnProperty("isItemValid")&&!i[a].isItemValid&&(i[a].displayName&&t.invalidProductNames.indexOf(i[a].displayName)==-1&&t.invalidProductNames.push(i[a].displayName),i.splice(a,1),a--,r=!0);return r},S.prototype.compareItems=function(e){var t,r=this,i=e;if(i.length!=r.items().length||0==i.length)return!1;if(0==i.length)return!0;var a=r.events.pop();a&&r.events.push(a);for(var o=0;o<r.items().length;o++){t=!1;for(var s=0;s<i.length;s++)if(i[s].productId==r.items()[o].productId&&i[s].catRefId==r.items()[o].catRefId&&(!r.isConfigurableItem(i[s])&&!r.isConfigurableItem(r.items()[o])&&null!=i[s].commerceItemId&&i[s].commerceItemId==r.items()[o].commerceItemId||r.isConfigurableItem(i[s])&&r.isConfigurableItem(r.items()[o])&&i[s].commerceItemId==r.items()[o].commerceItemId)){(!a||2!=a.type&&3!=a.type||a.product.id!=i[s].productId)&&i[s].quantity!=r.items()[o].quantity()&&(r.items()[o].quantity(i[s].quantity),r.items()[o].updatableQuantity(i[s].quantity)),t=!0;break}if(!t)return!1}return!0},S.prototype.compareItemsAndQuantity=function(e){var t,r=this,i=e;if(i.length!=r.items().length||0==i.length)return!1;if(0==i.length)return!0;var a=r.events.pop();a&&r.events.push(a);for(var o=0;o<r.items().length;o++){t=!1;for(var s=0;s<i.length;s++)if(!r.isConfigurableItem(r.items()[s])&&i[s].productId==r.items()[o].productId&&i[s].catRefId==r.items()[o].catRefId&&(!r.isConfigurableItem(i[s])&&!r.isConfigurableItem(r.items()[o])&&null!=i[s].commerceItemId&&i[s].commerceItemId==r.items()[o].commerceItemId||r.isConfigurableItem(i[s])&&r.isConfigurableItem(r.items()[o])&&i[s].commerceItemId==r.items()[o].commerceItemId)){if((!a||2!=a.type||a.product.id!=i[s].productId)&&i[s].quantity!=r.items()[o].quantity())break;t=!0;break}if(!t)return!1}return!0},S.prototype.compareCoupons=function(e){var t,r=this;if(e.length!=r.coupons().length)return!1;if(0==e.length)return!0;for(var i=0;i<r.coupons().length;i++){t=!1;for(var a=0;a<e.length;a++)e[a].code==r.coupons()[i].code()&&(t=!0);if(!t)return!1}return!0},S.prototype.mergeItems=function(t){var r,i=this;r=t.order&&(i.currentOrderId()||i.mergeCart())?t.order.items:t.commerceItems&&i.mergeCart()?t.commerceItems:t.shoppingCart.items;for(var a=[],o=0;o<r.length;o++){var s=!1;r[o].catalogRefId&&(r[o].catRefId=r[o].catalogRefId),i.combineLineItems=1==(i.shouldCombineLineItems(i.items())&&i.shouldCombineLineItems(r))?c.COMBINE_YES:c.COMBINE_NO;var n=null;if(n=i.isConfigurableItem(r[o])?i.getConfigurableCartItem(r[o].productId,r[o].catRefId,r[o].commerceItemId):i.combineLineItems==c.COMBINE_YES?i.getCartItem(r[o].productId,r[o].catRefId):i.getCartItem(r[o].productId,r[o].catRefId,r[o].commerceItemId),null!==n){var l=r[o].quantity+n.quantity();n.quantity(l),n.updatableQuantity(l),n.discountInfo(r[o].discountInfo),n.rawTotalPrice(r[o].rawTotalPrice),n.detailedItemPriceInfo(r[o].detailedItemPriceInfo),n.detailedRecurringChargeInfo(r[o].detailedRecurringChargeInfo),s=!0}s||a.push(r[o])}for(var d=i.associateShippingGroupsToItems(t.shippingGroups,!0),o=0;o<a.length;o++){if(i.isConfigurableItem(a[o])||i.lineAttributes&&e.isObservable(i.lineAttributes)&&i.lineAttributes().length>0){var u=[];for(var p in d){var h=d[p];h.commerceItemId===a[o].commerceItemId&&u.push(h)}a[o].shippingGroupRelationships=u}else{var g=Object.keys(d).reduce(function(e,t){var r=!1;if(d[t].childItems&&d[t].childItems.length>0)for(var s=0;s<d[t].childItems.length;s++)if(d[t].childItems[s].addOnItem){r=!0;break}return d[t].productId==a[o].productId&&d[t].catRefId==a[o].catRefId&&(!r&&i.combineLineItems===c.COMBINE_YES||!r&&i.combineLineItems===c.COMBINE_NO&&d[t].commerceItemId===a[o].commerceItemId||r&&d[t].commerceItemId==a[o].commerceItemId)&&(e.push(d[t]),delete d[t]),e},[]);a[o].shippingGroupRelationships=g}var f=C(a[o]),m=null;i.isConfigurableItem(a[o])&&a[o].childItems&&a[o].childItems.length>0&&(m=[],m=i.getChildItemsAsCartItems(a[o]));var E={productId:a[o].productId,quantity:a[o].quantity,catRefId:a[o].catRefId,selectedOptions:f,currency:i.currency,discountInfo:a[o].discountInfo,rawTotalPrice:a[o].rawTotalPrice,externalPrice:a[o].externalPrice,externalPriceQuantity:a[o].externalPriceQuantity,configuratorId:a[o].configuratorId,childItems:m,commerceItemId:a[o].commerceItemId,externalData:a[o].externalData,actionCode:a[o].actionCode,externalRecurringCharge:a[o].externalRecurringCharge,externalRecurringChargeFrequency:a[o].externalRecurringChargeFrequency,externalRecurringChargeDuration:a[o].externalRecurringChargeDuration,assetKey:a[o].assetKey,rootAssetKey:a[o].rootAssetKey,parentAssetKey:a[o].parentAssetKey,serviceId:a[o].serviceId,customerAccountId:a[o].customerAccountId,billingAccountId:a[o].billingAccountId,serviceAccountId:a[o].serviceAccountId,billingProfileId:a[o].billingProfileId,activationDate:a[o].activationDate,deactivationDate:a[o].deactivationDate,transactionDate:a[o].transactionDate,asset:a[o].asset,addOnItem:a[o].addOnItem,shopperInput:a[o].shopperInput,shippingGroupRelationships:a[o].shippingGroupRelationships},v=new I(E);v.itemTotal(a[o].price),a[o].id?v.repositoryId=a[o].id:v.repositoryId=a[o].commerceItemId,v.originalPrice(a[o].unitPrice),v.updatableQuantity(a[o].quantity),v.detailedItemPriceInfo(a[o].detailedItemPriceInfo),v.giftWithPurchaseCommerceItemMarkers=a[o].giftWithPurchaseCommerceItemMarkers,i.updateItemDynamicProperties(v,a[o]),t.priceListGroup&&null!=t.priceListGroup.repositoryId&&v.priceListGroupId(t.priceListGroup.repositoryId),v.detailedRecurringChargeInfo(a[o].detailedRecurringChargeInfo),i.items.push(v)}},S.prototype.validateServerCart=function(){var e=this;e.user().pageToRedirect()&&e.user().pageToRedirect()==e.checkoutLink?e.validateAndRedirectCart(!0):e.validateAndRedirectCart(!1)},S.prototype.clearCartForProfile=function(e){var t=this;t.user()||t.user(e),t.user()&&(t.user().persistedOrder(null),t.user().loggedinAtCheckout()||t.user().loggedoutAtCheckout()||""==t.user().orderId()||t.emptyCart(),t.user().orderId(""),t.user().setLocalData("orderId"),t.cartName(""),t.createNewCart(!1),h.clearStoredValue(c.LOCAL_STORAGE_CREATE_NEW_CART))},S.prototype.refreshUserCart=function(e){var r=this;r.user()||r.user(e);var i=!!r.user().clonedOrderId();if(!i){if(h.profileType==c.PROFILE_TYPE_AGENT){var a=r.currentOrderState();if("QUOTED"==a)return}if(!r.isCurrentCallInProgress&&!r.updatedFromRepository&&r.currentOrderState()!=c.PENDING_PAYMENTS&&r.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE&&r.user()&&r.user().loggedIn()&&!r.user().loggedinAtCheckout()&&!l.isPathEqualTo(r.checkoutLink)&&!r.createNewCart())if(1==r.user().isPunchout()){if(r.user().orderId()&&""!=r.user().orderId()){var s={},d={};d[c.ENDPOINT_KEY]=c.ENDPOINT_GET_ORDER,d[c.IDENTIFIER_KEY]="refreshCartForProfilebyOrderId";var u=r.storeConfiguration.getFilterToUse(d);u&&(s[c.FILTER_KEY]=u),h.request(c.ENDPOINT_GET_ORDER,s,function(e){if(null!=e&&e.orderId){r.user().orderId(e.orderId),r.user().persistedOrder(e),r.user().setLocalData("orderId"),r.cartName(e.cartName);var t=r.removeItems(e);if(r.isPricingRequired(t),r.compareItemsAndQuantity(e.shoppingCart.items)||(r.updateCartData(e,!0,!0,!0),r.isPricingRequired(!0)),r.getProductData(),r.getDynamicPropertiesMetadata(!0),r.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),r.updateDynamicProperties(e),1==e.shippingGroups.length&&r.shippingAddress&&""==r.shippingAddress()&&e.shippingGroups[0].shippingAddress){var i={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},a=new g("cart-shipping-address","",i,r.contextData.page.shippingCountriesPriceListGroup,r.contextData.page.defaultShippingCountry);a.copyFrom(e.shippingGroups[0].shippingAddress,r.contextData.page.shippingCountriesPriceListGroup),a.resetModified(),a.validateForShippingMethod()&&r.shippingAddress(a)}r.cartUpdated()}},function(e){r.user().orderId(""),r.user().persistedOrder(null),r.user().setLocalData("orderId"),r.loadCart()},r.user().orderId())}}else if(h.profileType==c.PROFILE_TYPE_AGENT&&r.currentOrderState()==c.QUOTED_STATES){var p={};p[c.INCLUDE_RESULT]=c.INCLUDE_RESULT_FULL,h.request(c.ENDPOINT_GET_ORDER,p,function(e){if(e&&(e.orderId=e.orderId?e.orderId:e.id),null!=e&&e.orderId){r.user().orderId(e.orderId),r.user().persistedOrder(e),r.user().setLocalData("orderId"),r.cartName(e.cartName),r.orderCreationDate(e.creationDate);var t=r.removeItems(e);if(r.isPricingRequired(t),r.compareItemsAndQuantity(e.shoppingCart.items)?r.getProductData():(r.updateCartData(e,!0,!0,!0),r.isPricingRequired(!0)),r.getDynamicPropertiesMetadata(!0),r.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),r.updateDynamicProperties(e),e.shippingGroups&&1==e.shippingGroups.length&&r.shippingAddress&&""==r.shippingAddress()&&e.shippingGroups[0].shippingAddress){var i={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},a=new g("cart-shipping-address","",i,r.contextData.page.shippingCountriesPriceListGroup,r.contextData.page.defaultShippingCountry);a.copyFrom(e.shippingGroups[0].shippingAddress,r.contextData.page.shippingCountriesPriceListGroup),a.resetModified(),a.validateForShippingMethod()&&(r.shippingAddress(a),r.shippingMethod(e.shippingGroups[0].shippingMethod.value),r.populateShipppingMethods())}r.cartUpdated()}},function(e){r.loadCart()},r.currentOrderId())}else{var f={},d={};d[c.ENDPOINT_KEY]=c.ENDPOINT_GET_PROFILE_ORDER,d[c.IDENTIFIER_KEY]="refreshCart";var u=r.storeConfiguration.getFilterToUse(d);u&&(f[c.FILTER_KEY]=u);var m,p;h.profileType==c.PROFILE_TYPE_AGENT?(m=c.ENDPOINT_ORDERS_SEARCH,r.contextManager=require("agentViewModels/agent-context-manager").getInstance(),p={profileId:r.user().id().length>0?r.user().id():r.contextManager.getShopperProfileId(),status:"incomplete"}):(m="getCurrentProfileOrder",p=f),r.adapter.loadJSON(m,"0",p,function(e){if(e&&(e.orderId=e.orderId?e.orderId:e.id),null!=e&&e.orderId){r.user().orderId(e.orderId),r.user().persistedOrder(e),r.user().setLocalData("orderId"),r.cartName(e.cartName),r.orderCreationDate(e.creationDate);var i=r.removeItems(e);if(r.isPricingRequired(i),r.compareItemsAndQuantity(e.shoppingCart.items)?r.getProductData():(r.updateCartData(e,!0,!0,!0),r.isPricingRequired(!0)),r.getDynamicPropertiesMetadata(!0),r.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),r.updateDynamicProperties(e),e.shippingGroups&&1==e.shippingGroups.length&&r.shippingAddress&&""==r.shippingAddress()&&e.shippingGroups[0].shippingAddress){var a={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},s=new g("cart-shipping-address","",a,r.contextData.page.shippingCountriesPriceListGroup,r.contextData.page.defaultShippingCountry);s.copyFrom(e.shippingGroups[0].shippingAddress,r.contextData.page.shippingCountriesPriceListGroup),s.resetModified(),s.validateForShippingMethod()&&(r.shippingAddress(s),r.shippingMethod(e.shippingGroups[0].shippingMethod.value),h.profileType==c.PROFILE_TYPE_AGENT&&n.Topic(t.topicNames.USER_SELECTED_SHIPPING_ADDRESS_UPDATED).publishWith())}var l=r.events.length>0?r.events[r.events.length-1]:void 0;l&&Z===l.type?(r.events.pop(),r.markDirty()):r.cartUpdated()}else r.user().orderId(""),r.user().persistedOrder(null),r.user().setLocalData("orderId")},function(e){r.loadCart()})}}},S.prototype.handleInvalidItems=function(e){var t=this;if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND){t.removeItemsByProduct(e.moreInfo);t.markDirty()}if(e.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND){var r=JSON.parse(e.moreInfo);t.removeItemsByProductCatRef(r.productId,r.catRefId);t.markDirty()}},S.prototype.initCatalog=function(e,r){var i=this;if(!r||!r.onLogin){if(arguments[0].data.global.user&&arguments[0].data.global.user.catalog){var a=arguments[0].data.global.user.catalog.repositoryId;this.catalogId()!=a&&this.catalogId(a)}if(arguments[0].data.global.user&&arguments[0].data.global.user.priceListGroup){var o=arguments[0].data.global.user.priceListGroup.id;this.priceListGroupId(o)}var s=d.getInstance().getItem(c.REDIRECTED_TO_WEB_PAYMENT),u=d.getInstance().getItem(c.SKIP_LOADING_LOCAL_CART),p=!1;"true"==u?(p=!0,n.Topic(t.topicNames.DEFERRED_CART_LOAD).publish()):p=!("true"!=s||!(arguments[1].token&&arguments[1].paymentId||arguments[1].authorizationCode)),d.getInstance().setItem(c.REDIRECTED_TO_WEB_PAYMENT,"false"),l.isPathEqualTo(arguments[0].data.global.links.checkout.route)&&i.checkoutLink||p!==!1||i.deferLoadCart.done(function(){i.loadCart()})}},S.prototype.shouldCombineLineItems=function(e){var t=this;if(e&&1===e.length)return t.combineLineItems===c.COMBINE_YES;for(var r=0;r<e.length;r++)for(var i=r+1;i<e.length;i++)if(!t.isConfigurableItem(e[r])&&!t.isConfigurableItem(e[i])&&e[r].productId==e[i].productId&&e[r].catRefId==e[i].catRefId&&e[r].commerceItemId!=e[i].commerceItemId)return!1;return!0},S.prototype.loadCart=function(){var e=this;if(e.isDirty(!1),d.getInstance().setItem(c.REDIRECTED_TO_WEB_PAYMENT,"false"),!e.updatedFromRepository&&(l.isPathEqualTo(e.checkoutLink)||!e.user()||!e.user().loggedIn()||e.user().loggedinAtCheckout()||!e.user().orderId()||e.storeConfiguration.isLargeCart()===!0&&e.storeConfiguration.isFreshPageLoad===!0&&e.user()&&e.user().loggedIn())){if(e.storeConfiguration.isLargeCart()===!0&&e.storeConfiguration.isFreshPageLoad===!1)return;var r=e.getCookieData();null!=r&&e.getLocalData(r)}e.cartPriceListGroupId()||d.getInstance().getItem("shoppingCart")&&e.cartPriceListGroupId(JSON.parse(d.getInstance().getItem("shoppingCart")).cartPriceListGroupId),e.combineLineItems=1==e.shouldCombineLineItems(e.items())?c.COMBINE_YES:c.COMBINE_NO,n.Topic(t.topicNames.CART_LOADED).publish(e)},S.prototype.reloadCart=function(){var e=this;e.user()&&e.user().loggedIn()&&!e.user().loggedinAtCheckout()?(e.isDirty(!1),e.refreshUserCart(e.user())):e.loadCart()},S.prototype.getItemPrice=function(e){var t=0;if(null!=e.productData()){if(e.productData().childSKUs){for(var r=(e.productData().childSKUs,e.productData().childSKUs.length),i=0;i<r;i++)if(e.productData().childSKUs[i].repositoryId==e.catRefId){var a=e.productData().childSKUs[i];t=null!=a.salePrice?a.salePrice:null!=e.productData().salePrice?e.productData().salePrice:null!=a.listPrice?a.listPrice:e.productData().listPrice}}else t=null!=e.productData().salePrice?e.productData().salePrice:e.productData().listPrice;return t}},S.prototype.saveCartCookie=function(){if(!window.isAgentApplication){var t=this,r=!1,i=new Object;i.numberOfItems=t.numberOfItems(),i.total=t.total(),i.totalWithoutTax=t.totalWithoutTax(),i.subTotal=t.subTotal(),i.amount=t.amount(),i.tax=t.tax(),i.currencyCode=t.currencyCode(),i.shipping=t.shipping(),i.shippingDiscount=t.shippingDiscount(),i.shippingSurcharge=t.shippingSurcharge(),i.orderDiscount=t.orderDiscount(),i.orderDiscountDescList=t.orderDiscountDescList(),i.coupons=t.coupons(),i.cartPriceListGroupId=u.getInstance().selectedPriceListGroup().id,i.giftWithPurchaseOrderMarkers=t.giftWithPurchaseOrderMarkers,i.recurringChargeAmount=t.recurringChargeAmount(),
i.recurringChargeCurrencyCode=t.recurringChargeCurrencyCode(),i.recurringChargeShipping=t.recurringChargeShipping(),i.recurringChargeSubTotal=t.recurringChargeSubTotal(),i.recurringChargeSubTotalByFrequency=t.recurringChargeSubTotalByFrequency(),i.recurringChargeTax=t.recurringChargeTax(),i.recurringChargeTaxByFrequency=t.recurringChargeTaxByFrequency(),i.recurringChargeTotal=t.recurringChargeTotal(),i.userActionPending=t.userActionPending(),i.items=new Array;var a=t.getCookieData();"string"==typeof a&&(a=JSON.parse(a));var o={};if(null!=a)for(var s=0;s<a.items.length;s++)void 0===o[a.items[s].catRefId]&&(o[a.items[s].catRefId]=a.items[s].originalPrice);var n=t.user().persistedOrder();if(n&&n.shoppingCart.items)for(var l=n.shoppingCart,p=l.items.length,s=0;s<p;s++)void 0===o[l.items[s].catRefId]&&(o[l.items[s].catRefId]=l.items[s].unitPrice);if(t.lineAttributes){i.lineAttributes=new Array;for(var s=0;s<t.lineAttributes().length;s++){var h=t.lineAttributes()[s],g=h.id(),f=null;null!=h.value()&&(f=h.value()),i.lineAttributes.push({id:g,value:f})}}for(var s=0;s<t.items().length;s++){var m=0,I=t.getItemPrice(t.items()[s]);void 0==o[t.items()[s].catRefId]?m=I:""!=t.updatedProduct()&&t.updatedProduct()===t.items()[s].catRefId?(m=I,t.updatedProduct("")):m=o[t.items()[s].catRefId],t.cartPriceListGroupId()!=u.getInstance().selectedPriceListGroup().id&&void 0!=I&&(t.items()[s].priceListGroupId(u.getInstance().selectedPriceListGroup().id),m=I,r=!0),t.items()[s].originalPrice(m);var E=void 0;t.isConfigurableItem(t.items()[s])&&(E=[],E=t.getChildItemsCookie(t.items()[s]));for(var v=t.items()[s].shippingGroupRelationships,y=0;y<v().length;y++)v()[y].childItems&&(v()[y].childItems=null);var b={productId:t.items()[s].productId,quantity:t.items()[s].quantity(),catRefId:t.items()[s].catRefId,itemTotal:t.items()[s].itemTotal(),id:t.items()[s].repositoryId,rawTotalPrice:t.items()[s].rawTotalPrice(),originalPrice:m,selectedOptions:t.items()[s].selectedOptions,selectedSkuProperties:t.items()[s].selectedSkuProperties,discountInfo:t.items()[s].discountInfo(),detailedItemPriceInfo:t.items()[s].detailedItemPriceInfo(),externalPrice:t.items()[s].externalPrice(),externalPriceQuantity:t.items()[s].externalPriceQuantity(),configuratorId:t.items()[s].configuratorId,childItems:E,externalData:t.items()[s].externalData(),actionCode:t.items()[s].actionCode(),externalRecurringCharge:t.items()[s].externalRecurringCharge(),externalRecurringChargeFrequency:t.items()[s].externalRecurringChargeFrequency(),externalRecurringChargeDuration:t.items()[s].externalRecurringChargeDuration(),commerceItemId:t.items()[s].commerceItemId,unpricedExternalMessage:t.items()[s].unpricedExternalMessage(),isGWPChoicesAvaliable:t.items()[s].isGWPChoicesAvaliable(),giftData:t.items()[s].giftData?t.items()[s].giftData:null,giftWithPurchaseCommerceItemMarkers:t.items()[s].giftWithPurchaseCommerceItemMarkers,detailedRecurringChargeInfo:t.items()[s].detailedRecurringChargeInfo(),isPersonalized:t.items()[s].isPersonalized(),assetKey:t.items()[s].assetKey(),rootAssetKey:t.items()[s].rootAssetKey(),parentAssetKey:t.items()[s].parentAssetKey(),serviceId:t.items()[s].serviceId(),customerAccountId:t.items()[s].customerAccountId(),billingAccountId:t.items()[s].billingAccountId(),serviceAccountId:t.items()[s].serviceAccountId(),billingProfileId:t.items()[s].billingProfileId(),activationDate:t.items()[s].activationDate(),deactivationDate:t.items()[s].deactivationDate(),transactionDate:t.items()[s].transactionDate(),asset:t.items()[s].asset(),addOnItem:t.items()[s].addOnItem,shopperInput:t.items()[s].shopperInput,shippingGroupRelationships:e.toJSON(v)};for(var T in t.lineAttributes())b[t.lineAttributes()[T].id()]=t.items()[s][t.lineAttributes()[T].id()]();i.items.push(b)}if(r&&t.cartPriceListGroupId(u.getInstance().selectedPriceListGroup().id),t.dynamicProperties){t.getDynamicPropertiesMetadata(!0),i.dynamicProperties=new Array;for(var s=0;s<t.dynamicProperties().length;s++){var h=t.dynamicProperties()[s],g=h.id(),f=null;null!=h.value()&&(f=h.value()),i.dynamicProperties.push({id:g,value:f})}}try{t.currentOrderState()!=c.PENDING_PAYMENT&&d.getInstance().setItem("shoppingCart",JSON.stringify(i))}catch(e){}}},S.prototype.getLocalData=function(t){var r=this;if("string"==typeof t&&(t=JSON.parse(t)),t){if(r.numberOfItems(t.numberOfItems),r.total(t.total),r.totalWithoutTax(t.totalWithoutTax),r.subTotal(t.subTotal),r.amount(t.amount),r.tax(t.tax),r.currencyCode(t.currencyCode),r.shipping(t.shipping),r.shippingDiscount(t.shippingDiscount),r.shippingSurcharge(t.shippingSurcharge),r.orderDiscount(t.orderDiscount),r.orderDiscountDescList(t.orderDiscountDescList),r.cartPriceListGroupId(t.cartPriceListGroupId),r.giftWithPurchaseOrderMarkers=t.giftWithPurchaseOrderMarkers,r.coupons.splice(0),t.hasOwnProperty("coupons"))for(var i=0;i<t.coupons.length;i++){var a=new A(t.coupons[i].code,t.coupons[i].description,t.coupons[i].status,t.coupons[i].level,t.coupons[i].id,t.coupons[i].totalAdjustment,t.coupons[i].name,t.coupons[i].longDescription);r.coupons.push(a)}r.populateClaimedCouponMultiPromotions(r.couponMultiPromotions()),r.items.splice(0);for(var i=0;i<t.items.length;i++){var o=void 0;r.isConfigurableItem(t.items[i])&&(o=[],o=r.getChildItemsAsCartItems(t.items[i]));var s={productId:t.items[i].productId,quantity:t.items[i].quantity,catRefId:t.items[i].catRefId,selectedOptions:t.items[i].selectedOptions,currency:r.currency,discountInfo:t.items[i].discountInfo,rawTotalPrice:t.items[i].rawTotalPrice,externalPrice:t.items[i].externalPrice,externalPriceQuantity:t.items[i].externalPriceQuantity,configuratorId:t.items[i].configuratorId,childItems:o,commerceItemId:t.items[i].commerceItemId,unpricedExternalMessage:t.items[i].unpricedExternalMessage,externalData:t.items[i].externalData,actionCode:t.items[i].actionCode,backOrderQuantity:t.items[i].backOrderQuantity,preOrderQuantity:t.items[i].preOrderQuantity,externalRecurringCharge:t.items[i].externalRecurringCharge,externalRecurringChargeFrequency:t.items[i].externalRecurringChargeFrequency,externalRecurringChargeDuration:t.items[i].externalRecurringChargeDuration,assetKey:t.items[i].assetKey,rootAssetKey:t.items[i].rootAssetKey,parentAssetKey:t.items[i].parentAssetKey,serviceId:t.items[i].serviceId,customerAccountId:t.items[i].customerAccountId,billingAccountId:t.items[i].billingAccountId,serviceAccountId:t.items[i].serviceAccountId,billingProfileId:t.items[i].billingProfileId,activationDate:t.items[i].activationDate,deactivationDate:t.items[i].deactivationDate,transactionDate:t.items[i].transactionDate,asset:t.items[i].asset,addOnItem:t.items[i].addOnItem,shopperInput:t.items[i].shopperInput,shippingGroupRelationships:t.items[i].shippingGroupRelationships?JSON.parse(t.items[i].shippingGroupRelationships):void 0},n=new I(s);n.itemTotal(t.items[i].itemTotal),n.originalPrice(t.items[i].originalPrice),n.productPriceChanged(!1),n.detailedItemPriceInfo(t.items[i].detailedItemPriceInfo),n.priceListGroupId(t.cartPriceListGroupId),n.isGWPChoicesAvaliable(t.items[i].isGWPChoicesAvaliable),n.skuProperties=t.items[i].skuProperties,n.isPersonalized=e.observable(t.items[i].isPersonalized),t.items[i].giftWithPurchaseCommerceItemMarkers&&(n.giftWithPurchaseCommerceItemMarkers=t.items[i].giftWithPurchaseCommerceItemMarkers),t.items[i].giftData&&(n.giftData=t.items[i].giftData);for(var c in t.lineAttributes)n[t.lineAttributes[c].id]=e.observable(t.items[i][t.lineAttributes[c].id]);n.detailedRecurringChargeInfo(t.items[i].detailedRecurringChargeInfo),r.items.push(n)}}if(r.items().length>0){if(r.storeConfiguration.isLargeCart()===!0&&1!=r.storeConfiguration.isFreshPageLoad)return;r.getProductData()}r.getDynamicPropertiesMetadata(!0),t.hasOwnProperty("dynamicProperties")&&r.updateDynamicProperties(t)},S.prototype.processCartDataForLargeCart=function(e,t){var r=this,i=!1,a=0,o=0;if(null==t)for(var t=new Object,o=0;o<r.items().length;o++)r.addIndexForTheProducts(r.items()[o],t,o);for(var s=0;s<e.length;s++){var n=[];if(null!=t[e[s].id]){n=t[e[s].id].split(","),a=n.length;for(var c=0;c<a;c++){o=parseInt(n[c]);var l=e[s];if(l.id==r.items()[o].productId&&0==r.items()[o].processed)for(var d=N(l),p=0;p<l.childSKUs.length;p++)if(l.childSKUs[p].repositoryId==r.items()[o].catRefId){r.items()[o].processed=!0;var h=l.childSKUs[p],g=jQuery.extend(!0,{},l);if(g.childSKUs=[h],r.items()[o].currentPrice(r.getItemPrice(r.items()[o])),!g.childSKUs[0].primaryThumbImageURL&&g.childSKUs[0].listingSKUId&&(g.childSKUs[0].primaryThumbImageURL=d[g.childSKUs[0].listingSKUId]),r.items()[o].productData(g),!R(r.items()[o].discountInfo())){var f=r.getItemPrice(r.items()[o]);if(h=h||{},h.saleVolumePrice||h.listVolumePrice||g.saleVolumePrice||g.listVolumePrice?r.items()[o].productPriceChanged(!1):r.items()[o].originalPrice()!=f&&r.items()[o].priceListGroupId()==u.getInstance().selectedPriceListGroup().id&&u.getInstance().selectedPriceListGroup().id==r.cartPriceListGroupId()?(r.skipPriceChange()&&r.items()[o].productPriceChanged()&&r.items()[o].currentPrice()==f||r.items()[o].invalid||(i=!0),null!=f&&r.items()[o].productPriceChanged(!0)):(r.items()[o].productPriceChanged(!1),r.items()[o].currentPrice()&&f&&r.items()[o].currentPrice()!=f&&!r.items()[o].invalid&&r.isPricingRequired(!0)),l.productVariantOptions)for(var m=0;m<l.productVariantOptions.length;m++)r.updateItemOptionDetails(l.productVariantOptions[m],r.items()[o].catRefId);break}}r.isConfigurableItem(r.items()[o])&&r.items()[o].childItems&&r.items()[o].childItems.length>0&&r.updateChildTreeProductDataForLargeCart(r.items()[o],l)}}}return r.skipPriceChange(!1),r.showSelectedOptions(!0),i},S.prototype.processCartData=function(e){for(var t=this,r=!1,i=0;i<t.items().length;i++)for(var a=0;a<e.length;a++){var o=e[a];if(o.id==t.items()[i].productId)for(var s=N(o),n=0;n<o.childSKUs.length;n++)if(o.childSKUs[n].repositoryId==t.items()[i].catRefId){var c=o.childSKUs[n],l=jQuery.extend(!0,{},o);if(l.childSKUs=[c],t.items()[i].currentPrice(t.getItemPrice(t.items()[i])),!l.childSKUs[0].primaryThumbImageURL&&l.childSKUs[0].listingSKUId&&(l.childSKUs[0].primaryThumbImageURL=s[l.childSKUs[0].listingSKUId]),t.items()[i].productData(l),!R(t.items()[i].discountInfo())){var d=t.getItemPrice(t.items()[i]);if(c=c||{},c.saleVolumePrice||c.listVolumePrice||l.saleVolumePrice||l.listVolumePrice||window.isAgentApplication?t.items()[i].productPriceChanged(!1):t.items()[i].externalPrice()||t.items()[i].originalPrice()==d||t.items()[a].priceListGroupId()!=u.getInstance().selectedPriceListGroup().id||u.getInstance().selectedPriceListGroup().id!=t.cartPriceListGroupId()?(t.items()[i].productPriceChanged(!1),t.items()[i].currentPrice()&&d&&t.items()[i].currentPrice()!=d&&!t.items()[i].invalid&&t.isPricingRequired(!0)):(t.skipPriceChange()&&t.items()[i].productPriceChanged()&&t.items()[i].currentPrice()==d||t.items()[i].invalid||(r=!0),null!=d&&t.items()[i].productPriceChanged(!0)),o.productVariantOptions)for(var p=0;p<o.productVariantOptions.length;p++)t.updateItemOptionDetails(o.productVariantOptions[p],t.items()[i].catRefId);break}}t.isConfigurableItem(t.items()[i])&&t.items()[i].childItems&&t.items()[i].childItems.length>0&&t.updateChildTreeProductData(t.items()[i],o)}return t.skipPriceChange(!1),t.showSelectedOptions(!0),r},S.prototype.applyAddLimitsValidationPostDataAndStockLoading=function(e){var t=this,r=!1,i=0;if(e)for(var a=0;a<t.items().length;a++){var o=t.items()[a];if(!o.childItems){if(o.shippingGroupRelationships&&o.shippingGroupRelationships()&&o.shippingGroupRelationships().length>0)for(var s=0;s<o.shippingGroupRelationships().length;s++){var n=o.shippingGroupRelationships()[s],c=null;if(n.isPickupInStore&&n.isPickupInStore()?c=e[n.selectedStore().locationId]:n.isPickupInStore&&!n.isPickupInStore()&&(c=t.contextData.global.site.siteInfo&&t.contextData.global.site.siteInfo.inventoryLocationId?e[t.contextData.global.site.siteInfo.inventoryLocationId]:e[null]),c){if(c.length>=1)for(var l=0;l<c.length;l++)if(n.productId===c[l].productId&&n.catRefId===c[l].catRefId){i=c[l].orderableQuantity;break}t.user().clonedOrderId()&&t.validOrderQuantityMap&&t.validOrderQuantityMap[n.productId+":"+n.catRefId]&&(r=!0,i=t.validOrderQuantityMap[n.productId+":"+n.catRefId]),n.addLimitsValidation(o,c,t.isPreOrderBackOrderEnabled,r,i,t.orderedQuantityMap)}}var c={};if(c=t.contextData.global.site.siteInfo&&t.contextData.global.site.siteInfo.inventoryLocationId?e[t.contextData.global.site.siteInfo.inventoryLocationId]:e[null],c&&c.length>0)for(var d=0;d<c.length;d++)if(t.items()[a].productId===c[d].productId&&t.items()[a].catRefId===c[d].catRefId){i=t.user().clonedOrderId()&&t.validOrderQuantityMap&&null!=t.validOrderQuantityMap[c[d].productId+":"+c[d].catRefId]?t.validOrderQuantityMap[c[d].productId+":"+c[d].catRefId]:c[d].orderableQuantity;var u=!1;t.user().clonedOrderId()&&i>0&&(u=!0);var p="IN_STOCK"===c[d].stockStatus||"PREORDERABLE"===c[d].stockStatus||"BACKORDERABLE"===c[d].stockStatus||u;o.addLimitsValidation(p,i,c[d],t.isPreOrderBackOrderEnabled,null,r,t.orderedQuantityMap);break}}}},S.prototype.getProductData=function(){var e=this,r=e.getAllProductIdsForItemsInCart(),i=e.getBatchSizeForProdAndSkuData(r)<0?e.getProductDataForCart:e.getProductDataForLargeCart;n.when(i.bind(e,r)(),e.getAvailabilityOfCart()).done(function(r,i){e.applyAddLimitsValidationPostDataAndStockLoading(i),n.Topic(t.topicNames.CART_READY).publish(e)})},S.prototype.filterInactiveAddons=function(e){if(e.addOnProducts&&e.addOnProducts.length>0)for(var t=e.addOnProducts.length,r=t-1;r>=0;r--)if(e.addOnProducts[r].addOnOptions&&0!=e.addOnProducts[r].addOnOptions.length&&e.addOnProducts[r].addOnOptions[0].product.active)for(var i=e.addOnProducts[r].addOnOptions.length-1;i>=0;i--)e.addOnProducts[r].addOnOptions[i].sku.active||e.addOnProducts[r].addOnOptions.splice(i,1);else e.addOnProducts.splice(r,1)},S.prototype.processEachBatchBeforeCheckout=function(e,t){var r=this;if(null==t)for(var t=new Object,i=0;i<r.items().length;i++)r.addIndexForTheProducts(r.items()[i],t,i);r.markInvalidItemsForLargeCart(e,r.invalidProductNames,t);var a=!1;return r.items().length>0&&(a=r.processCartData(e,t)),{productPriceChanged:a}},S.prototype.processEachBatch=function(e,t){var r=this;if(null==t)for(var t=new Object,i=0;i<r.items().length;i++)r.addIndexForTheProducts(r.items()[i],t,i);for(var a=0;a<e.length;a++)r.filterInactiveAddons(e[a]);if(r.mergeCart())for(var o=0;o<e.length;o++)e[o].active||e[o].displayName&&r.invalidProductNames.indexOf(e[o].displayName)==-1&&r.invalidProductNames.push(e[o].displayName);var s=r.removeInvalidItemsForLargeCart(e,r.invalidProductNames,t),n=r.removeUnlinkedAddonItemsForLargeCart(e,r.invalidProductNames,t);s||(s=n);var c=r.processCartDataForLargeCart(e,t);return{productPriceChanged:c,itemsRemovedFromCart:s}},S.prototype.getBatchedProductDataForLargeCart=function(e,t,r){var i=this,a=n.Deferred();if(null==r)for(var r=new Object,o=0;o<i.items().length;o++)i.addIndexForTheProducts(i.items()[o],r,o);return i.adapter.loadJSON("cart",t,e,function(e){var t=i.processEachBatch(e,r);a.resolve({pResult:e,productPriceChanged:t.productPriceChanged,itemsRemovedFromCart:t.itemsRemovedFromCart})},function(o){a.reject(o),o.errors&&o.errors.length>0&&(i.handleListProductsFailure({pResult:o}),i.getBatchedProductDataForLargeCart(e,t,r))}),a},S.prototype.removeItemsMarkedAsInvalid=function(e){var t=this;if(t.currentOrderState()!=c.PENDING_PAYMENTS&&t.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE)for(var r=0;r<e.length;r++)0==e[r].processed||1==e[r].invalid?(e.splice(r,1),r--):e[r].childItems&&e[r].childItems.length>0&&t.removeItemsMarkedAsInvalid(t.childItems)},S.prototype.addIndexForTheProducts=function(e,t,r){var i=this;if(e.invalid=!1,e.processed=!1,null==t[e.productId]?t[e.productId]=r.toString():t[e.productId]=t[e.productId]+","+r.toString(),i.isConfigurableItem(e))for(var a=0;a<e.childItems.length;a++)i.addIndexForTheProducts(e.childItems[a],t,r)},S.prototype.getProductDataForCart=function(e){var r=this,i=n.Deferred();null==e&&(e=r.getAllProductIdsForItemsInCart());var a=new Array(r.catalogId(),e,!0,r.priceListGroupId(),r.fields,!0),o={},s={};s[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_PRODUCTS,s[c.IDENTIFIER_KEY]="getProductData";var d=r.storeConfiguration.getFilterToUse(s);return d&&(o[c.FILTER_KEY]=d),r.adapter.loadJSON("cart",a,o,function(e){for(var a=0;a<e.length;a++)r.filterInactiveAddons(e[a]);if(r.mergeCart())for(var o=0;o<e.length;o++)e[o].active||e[o].displayName&&r.invalidProductNames.indexOf(e[o].displayName)==-1&&r.invalidProductNames.push(e[o].displayName);var s=r.removeInvalidItems(e,r.invalidProductNames),c=r.removeUnlinkedAddonItems(e,r.invalidProductNames);s||(s=c);var d=r.processCartData(e);1==s||d===!0||r.isPricingRequired()?(r.events.push(new M(B,0,e)),l.isPathEqualTo(r.checkoutLink)&&""!=r.shippingMethod()?r.priceCartForCheckout():r.markDirty(),r.isPricingRequired(!1)):r.cartPriceListGroupId()&&r.cartPriceListGroupId()!=u.getInstance().selectedPriceListGroup().id?(r.events.push(new M(B,0,e)),r.markDirty()):n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish(),r.mergeCart()?(r.notifyInvalidProducts("cart"),r.isDirty()||r.markDirty(),r.mergeCart(!1)):r.notifyInvalidProducts(),r.updateAllItemsArray(),i.resolve(e)},function(e){i.reject(e);var t=r.buildErrorInfo(e);t.errors&&t.errors.length>0&&(r.handleListProductsFailure(t),r.getProductData())}),i},S.prototype.getProductDataForLargeCart=function(e){for(var r=this,i=n.Deferred(),a=new Object,o=0;o<r.items().length;o++)r.addIndexForTheProducts(r.items()[o],a,o);null==e&&(e=r.getAllProductIdsForItemsInCart());var s=!1,d={},p={};p[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_PRODUCTS,p[c.IDENTIFIER_KEY]="getProductDataForLargeCart";var h=r.storeConfiguration.getFilterToUse(p);h&&(d[c.FILTER_KEY]=h);var g=new Array,f=r.getBatchSizeForProdAndSkuData(e);f<0&&(f=e.length);for(var m=0;m<e.length;m){for(var I=[],o=0;o<f&&m<e.length;o++,m++)I.push(e[m]);var E=new Array(r.catalogId(),I,!0,r.priceListGroupId(),r.fields,!0);g.push(r.getBatchedProductDataForLargeCart(d,E,a))}return n.when.apply(null,g).done(function(){for(var e=new Array,o=!1,c=0;c<arguments.length;c++){var d=arguments[c].pResult;o=1==arguments[c].productPriceChanged||o,s=1==arguments[c].itemsRemovedFromCart||s;for(var p=0;p<d.length;p++)e.push(d[p])}var h=r.processEachBatch(e,a);o=1==h.productPriceChanged||o,s=1==h.itemsRemovedFromCart||s,r.removeItemsMarkedAsInvalid(r.items()),1==s||o===!0||r.isPricingRequired()?(r.events.push(new M(B,0,e)),(l.isPathEqualTo(r.checkoutLink)||l.isPathEqualTo("occs-agent-new/agentCheckout")||l.isPathEqualTo("occs-agent/agentMultiShipCheckout"))&&(r.isSplitShipping()||""!=r.shippingMethod())?r.priceCartForCheckout():r.markDirty(),r.isPricingRequired(!1)):r.cartPriceListGroupId()&&r.cartPriceListGroupId()!=u.getInstance().selectedPriceListGroup().id?(r.events.push(new M(B,0,e)),r.markDirty()):n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish(),r.mergeCart()?(r.notifyInvalidProducts("cart"),r.isDirty()||r.markDirty(),r.mergeCart(!1)):r.notifyInvalidProducts(),r.updateAllItemsArray(),i.resolve(e)}),i},S.prototype.notifyInvalidProducts=function(e){var t=this,i="";if(t.invalidProductNames.length>0){for(var a="",s=t.invalidProductNames.length-1,n=0;n<s;n++)a+=o.t("ns.common:resources.productNameHasNext",{productName:t.invalidProductNames[n]});a+=t.invalidProductNames[s],i=o.t("ns.common:resources.invalidCartItemsError",{productNames:a})}i&&(e?r.sendWarningToPage(te,i,!0,e,!0):(t.user().redirectNotificationMessage(i),r.sendWarning(te,i,!0))),t.invalidProductNames=[]},S.prototype.removeItemsByProduct=function(e){for(var t=this,r=!1,i=0;i<t.items().length;i++)t.items()[i].productId===e?(t.items.remove(t.items()[i]),i--,r=!0,t.isPricingRequired(!0)):r=t.removeChildItemsByProduct(e);return r},S.prototype.removeChildItemsByProduct=function(e,t){var r=this,i=r.items();t&&(i=t);for(var a=!1,o=0;o<i.length;o++)i[o].productId===e?(i.splice(o,1),o--,a=!0,r.isPricingRequired(!0)):i[o].childItems&&i[o].childItems.length>0&&(a=r.removeChildItemsByProduct(e,i[o].childItems),i[o].childItems&&0==i[o].childItems.length&&delete i[o].childItems);return a},S.prototype.removeItemsByProductCatRef=function(e,t){for(var r=this,i=!1,a=0;a<r.items().length;a++)r.items()[a].productId===e&&r.items()[a].catRefId===t&&(r.items.remove(r.items()[a]),a--,i=!0,r.isPricingRequired(!0));return i},S.prototype.markInvalidItems=function(e,t){for(var r=this,i=0;i<r.items().length;i++)for(var a=r.items()[i],o=!1,s=0;s<e.length;s++)if(e[s].id==a.productId){if(!e[s].active||!e[s].childSKUs||0==e[s].childSKUs.length){a.invalid=!0;break}for(var n=0;e[s].childSKUs&&n<e[s].childSKUs.length;n++)if(e[s].childSKUs[n].repositoryId==a.catRefId&&e[s].childSKUs[n].active){o=!0;break}if(o)break;a.invalid=!0}return!1},S.prototype.markInvalidItemsForLargeCart=function(e,t,r){var i=this,a=!1,o=0,s=[];if(null==r)for(var r=new Object,n=0;n<i.items().length;n++)i.addIndexForTheProducts(i.items()[n],r,n);for(var n=0;n<e.length;n++)if(a=!1,null!=r[e[n].id]){s=r[e[n].id].split(","),o=s.length;for(var c=0;c<o;c++){d=parseInt(s[c]);var l=i.items()[d];if(e[n].id==l.productId){if(l.productId!=e[n].id||1==l.processed)continue;if(!e[n].active||!e[n].childSKUs||0==e[n].childSKUs.length){l.invalid=!0;break}for(var d=0;e[n].childSKUs&&d<e[n].childSKUs.length;d++)if(e[n].childSKUs[d].repositoryId==l.catRefId&&e[n].childSKUs[d].active){a=!0;break}if(a)break;l.invalid=!0}}}return!1},S.prototype.removeUnlinkedAddonItemsForLargeCart=function(e,t,r){var i=this,a=0,o=0,s=[];if(null==r)for(var r=new Object,n=0;n<i.items().length;n++)i.addIndexForTheProducts(i.items()[n],r,n);for(var n=0;n<e.length;n++){var c=[];if(null!=r[e[n].id]){c=r[e[n].id].split(","),a=c.length;for(var l=0;l<a;l++){o=parseInt(c[l]);var d=i.items()[o];if(d.productId==e[n].id&&1!=d.processed){i.items()[o].childItems&&i.items()[o].childItems.length>0&&i.processInvalidAddonItemsForLargeCart(i.items()[o],e[n],e,s);break}}}}if(s.length>0){for(var l=0;l<s.length;l++)t.push(s[l]);return!0}return!1},S.prototype.removeUnlinkedAddonItems=function(e,t){for(var r=this,i=[],a=0;a<r.items().length;a++)for(var o=0;o<e.length;o++)if(r.items()[a].productId==e[o].id){r.items()[a].childItems&&r.items()[a].childItems.length>0&&r.processInvalidAddonItems(r.items()[a],e[o],e,i);break}if(i.length>0){for(var a=0;a<i.length;a++)t.push(i[a]);return!0}return!1},S.prototype.processInvalidAddonItems=function(e,t,r,i){for(var a=this,o=!1,s=[],n=0;e.childItems&&n<e.childItems.length;n++)if(o=!1,e.childItems[n].addOnItem){for(var c=0;c<t.addOnProducts.length;c++){for(var l=0;l<t.addOnProducts[c].addOnOptions.length;l++)if(t.addOnProducts[c].addOnOptions[l].product&&t.addOnProducts[c].addOnOptions[l].product.repositoryId==e.childItems[n].productId&&t.addOnProducts[c].addOnOptions[l].sku&&t.addOnProducts[c].addOnOptions[l].sku.repositoryId==e.childItems[n].catRefId){o=!0;break}if(o)break}if(o){if(e.childItems[n].childItems&&e.childItems[n].childItems.length>0)for(var d=0;d<r.length;d++)if(r[d].id==e.childItems[n].productId){a.processInvalidAddonItems(e.childItems[n],r[d],r,i);break}}else i.push(e.childItems[n].displayName()),s.push(e.childItems[n])}for(var n=0;n<s.length;n++)a.removeChildItemFromCart(s[n],!1)},S.prototype.processInvalidAddonItemsForLargeCart=function(e,t,r,i){for(var a=this,o=!1,s=[],n=0;e.childItems&&n<e.childItems.length;n++)if(o=!1,e.childItems[n].addOnItem){for(var c=0;c<t.addOnProducts.length;c++){for(var l=0;l<t.addOnProducts[c].addOnOptions.length;l++)if(t.addOnProducts[c].addOnOptions[l].product&&t.addOnProducts[c].addOnOptions[l].product.repositoryId==e.childItems[n].productId&&t.addOnProducts[c].addOnOptions[l].sku&&t.addOnProducts[c].addOnOptions[l].sku.repositoryId==e.childItems[n].catRefId){o=!0;break}if(o)break}if(o){if(e.childItems[n].childItems&&e.childItems[n].childItems.length>0)for(var d=0;d<r.length;d++)if(r[d].id==e.childItems[n].productId){a.processInvalidAddonItems(e.childItems[n],r[d],r,i);break}}else i.push(e.childItems[n].displayName()),e.childItems[n].invalid=!0}for(var n=0;n<s.length;n++)a.removeChildItemFromCart(s[n],!1)},S.prototype.removeInvalidItemsForLargeCart=function(e,t,r){var i=this,a=!1,o="",s=!1,c=!1,l=0,d=[];if(null==r)for(var r=new Object,u=0;u<i.items().length;u++)i.addIndexForTheProducts(i.items()[u],r,u);for(var u=0;u<e.length;u++){s=!1;var p=[];if(null!=r[e[u].id]){p=r[e[u].id].split(","),l=p.length;for(var h=0;h<l;h++){f=parseInt(p[h]);var g=i.items()[f];if(g.productId==e[u].id&&1!=g.processed){if(!e[u].active||!e[u].childSKUs||0==e[u].childSKUs.length||e[u].notForIndividualSale){g.invalid=!0,o=e[u].displayName;break}for(var f=0;e[u].childSKUs&&f<e[u].childSKUs.length;f++)if(e[u].childSKUs[f].repositoryId==g.catRefId&&e[u].childSKUs[f].active&&null!=e[u].childSKUs[f].listPrice){s=!0;break}if(s||(g.invalid=!0,o=e[u].displayName),i.isConfigurableItem(g)){var m=[],I=[],E=[];if(i.checkCpqItemValidityForLargeCart(e[u],g,I,m,E),I.length>0&&(g.invalid=!0,t=t.concat(I),n.unique(t)),m.length>0){g.invalid=!0;for(var v=0;v<e.length;v++)if(e[v].id==g.productId){o=e[v].displayName;break}break}E.length>0&&(c=!0,d=E)}}}if(o&&t&&t.indexOf(o)==-1)t.push(o);else if(c)for(var y=0;y<d.length;y++)t&&t.indexOf(d[y].displayName())==-1&&t.push(d[y].displayName())}}return a},S.prototype.removeInvalidItems=function(e,t){for(var r=this,i=!1,a=0;a<r.items().length;a++){for(var o=r.items()[a],s="",l=!1,d=!1,u=!1,p=[],h=0;h<e.length;h++){if(e[h].id==o.productId){if(!e[h].active||!e[h].childSKUs||0==e[h].childSKUs.length||!o.isThisGWPCommerceItemAndValid()&&e[h].notForIndividualSale){d=!0,s=e[h].displayName;break}for(var g=0;e[h].childSKUs&&g<e[h].childSKUs.length;g++)if(e[h].childSKUs[g].repositoryId==o.catRefId&&e[h].childSKUs[g].active&&null!=e[h].childSKUs[g].listPrice){l=!0;break}l||(d=!0,s=e[h].displayName)}if(r.isConfigurableItem(o)){var f=[],m=[],I=[];if(r.checkCpqItemValidity(e[h],o,m,f,I),m.length>0&&(d=!0,t=t.concat(m),n.unique(t)),f.length>0){d=!0;for(var E=0;E<e.length;E++)if(e[E].id==o.productId){s=e[E].displayName;break}break}I.length>0&&(u=!0,p=I)}}if(r.currentOrderState()!=c.PENDING_PAYMENTS&&r.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE)if(!l||d)r.items.remove(o),t&&s&&t.indexOf(s)==-1&&t.push(s),i=!0,a--;else if(u)for(var v=0;v<p.length;v++)r.removeChildItemFromCart(p[v],!1),t&&t.indexOf(p[v].displayName())==-1&&t.push(p[v].displayName()),i=!0}return i},S.prototype.updateItemOptionDetails=function(e,t){for(var r=0;r<this.items().length;r++)if(this.items()[r].catRefId===t&&this.items()[r].selectedOptions)for(var i=0;i<this.items()[r].selectedOptions.length;i++)if(this.items()[r].selectedOptions[i].optionId===e.optionId){this.items()[r].selectedOptions[i].optionName=e.optionName;var a=e.optionValueMap;for(var o in a)if(a[o]===this.items()[r].selectedOptions[i].optionValueId){this.items()[r].selectedOptions[i].optionValue=o;break}break}var s=this.getCookieData();if(s){for(var n=s.items,c=0;c<this.items().length;c++)for(var l=0;l<n.length;l++)if(this.items()[c].catRefId===n[l].catRefId){n[l].selectedOptions=this.items()[c].selectedOptions;break}s.items=n;try{d.getInstance().setItem("shoppingCart",JSON.stringify(s))}catch(e){}}},S.prototype.getCookieData=function(){if(window.isAgentApplication)return null;var e=null;try{e=d.getInstance().getItem("shoppingCart"),e&&"string"==typeof e&&(e=JSON.parse(e))}catch(e){}return e},S.prototype.getCookieUserData=function(){if(window.isAgentApplication)return null;var e=null;try{e=d.getInstance().getItem("user"),e&&"string"==typeof e&&(e=JSON.parse(e))}catch(e){}return e},S.prototype.checkPriceDataAndRedirect=function(){var e=this,t=e.getProductIdsForItemsInCart(),r=e.getBatchSizeForProdAndSkuData(t)<0?e.checkPriceDataBeforeCheckout:e.checkPriceDataBeforeCheckoutForLargeCart;n.when(r.bind(e,t)(),e.validateCartAvailability()).done(function(t,r){t===!0||0==r?(e.redirect(e.cartLink),e.notifyInvalidProducts("cart")):e.checkoutWithPaypalClicked()?e.redirect(c.PAYPAL_CHECKOUT_TYPE):(e.redirect(e.checkoutLink),e.notifyInvalidProducts("checkout"))})},S.prototype.checkPriceDataBeforeCheckout=function(e){var t=this,r=n.Deferred();null==e&&(e=t.getProductIdsForItemsInCart());var i=t.catalogId();t.user().catalogId()&&(i=t.user().catalogId());var a=new Array(i,e,!0,u.getInstance().selectedPriceListGroup().id,t.fields,!0),o={},s={};s[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_PRODUCTS,s[c.IDENTIFIER_KEY]="getProductDataAndRedirect";var d=t.storeConfiguration.getFilterToUse(s);return d&&(o[c.FILTER_KEY]=d),t.adapter.loadJSON("cart",a,o,function(e){t.markInvalidItems(e,t.invalidProductNames);var i=!1;t.items().length>0?(i=t.processCartData(e),(i===!0||t.isPricingRequired())&&(l.isPathEqualTo(t.checkoutLink)&&""!=t.shippingMethod()?t.priceCartForCheckout():t.markDirty(),t.isPricingRequired(!1))):(i=null,t.isPricingRequired()&&(t.markDirty(),t.isPricingRequired(!1)),t.notifyInvalidProducts()),r.resolve(i)},function(e){r.reject(e);var i=t.buildErrorInfo(e);i.errors&&i.errors.length>0&&(t.handleListProductsFailure(i),t.checkPriceDataAndRedirect()),t.checkoutWithPaypalClicked(!1)}),r},S.prototype.checkPriceDataBeforeCheckoutForLargeCart=function(e){var t=this,r=n.Deferred();null==e&&(e=t.getProductIdsForItemsInCart());for(var i=[],a=0;a<t.items().length;a++)t.addIndexForTheProducts(t.items()[a],i,a);var o={},s={};s[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_PRODUCTS,s[c.IDENTIFIER_KEY]="getProductDataAndRedirectForLargeCart";var d=t.storeConfiguration.getFilterToUse(s);d&&(o[c.FILTER_KEY]=d);var u=t.catalogId();t.user().catalogId()&&(u=t.user().catalogId());var p=new Array,h=t.getBatchSizeForProdAndSkuData(e);h<0&&(h=e.length);for(var g=0;g<e.length;g){for(var f=[],a=0;a<h&&g<e.length;a++,g++)f.push(e[g]);var m=new Array(u,f,!0,t.priceListGroupId(),t.fields,!0);p.push(t.getBatchedProductDataForLargeCartBeforeCheckout(o,m,i))}return n.when.apply(null,p).done(function(){for(var e=new Array,a=!1,o=0;o<arguments.length;o++){var s=arguments[o].pResult;a=1==arguments[o].productPriceChanged||a;for(var n=0;n<s.length;n++)e.push(s[n])}var c=t.processEachBatchBeforeCheckout(e,i);a=1==c.productPriceChanged||a,a===!0||t.isPricingRequired()?(l.isPathEqualTo(t.checkoutLink)&&""!=t.shippingMethod()?t.priceCartForCheckout():t.markDirty(),t.isPricingRequired(!1)):(t.isPricingRequired()&&(t.markDirty(),t.isPricingRequired(!1)),t.notifyInvalidProducts()),r.resolve(e)}),r},S.prototype.getBatchedProductDataForLargeCartBeforeCheckout=function(e,t,r){var i=this,a=n.Deferred();if(null==r)for(var r=new Object,o=0;o<i.items().length;o++)i.addIndexForTheProducts(i.items()[o],r,o);return i.adapter.loadJSON("cart",t,e,function(e){var t=i.processEachBatchBeforeCheckout(e,r);a.resolve({pResult:e,productPriceChanged:t.productPriceChanged})},function(o){a.reject(o),o.errors&&o.errors.length>0&&(i.handleListProductsFailure({pResult:o}),i.getBatchedProductDataForLargeCartBeforeCheckout(e,t,r)),i.checkoutWithPaypalClicked(!1)}),a},S.prototype.getProductIdsForItemsInCart=function(){for(var e=this,t=[],r=0;r<e.items().length;r++)t.indexOf(e.items()[r].productId)===-1&&t.push(e.items()[r].productId);return t},S.prototype.getAllProductIdsForItemsInCart=function(){for(var e=this,t=[],r=0;r<e.items().length;r++)t.indexOf(e.items()[r].productId)===-1&&t.push(e.items()[r].productId),e.isConfigurableItem(e.items()[r])&&e.addProductIdFromConfigurableProduct(t,e.items()[r]);return t},S.prototype.handleListProductsFailure=function(e){for(var t=this,r=0;r<e.errors.length;r++){var i=e.errors[r];i.errorCode==c.GET_PRODUCT_NO_PRODUCT_FOUND&&(i.devMessage&&t.invalidProductNames.indexOf(i.devMessage)==-1&&t.invalidProductNames.push(i.devMessage),t.removeItemsByProduct(i.moreInfo),t.isPricingRequired(!0))}},S.prototype.getCartAvailability=function(){var e=this,t=new D(e),r={},i={};r[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_AVAILABILITY,r[c.IDENTIFIER_KEY]="stockStatusesForCart";var a=e.storeConfiguration.getFilterToUse(r);a&&!e.storeConfiguration.isLargeCart()&&(i[c.FILTER_KEY]=a),i[c.PRODUCTS_PARAM]=t.products,
i[c.CATALOG]=t.catalogId,i[c.LOCATION_IDS_PARAM]=t.locationIds;var o=e.getThreshholdSizeForStockStatusData(t.products)<0?c.ENDPOINT_PRODUCTS_AVAILABILITY:c.ENDPOINT_LIST_STOCK_STATUS_LARGE_CART;h.request(o,i,function(t){for(var r=0;r<e.items().length;r++)if(e.isConfigurableItem(e.items()[r])){e.items()[r].getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[r].productId,e.items()[r].catRefId,null);var i=!1;e.user().clonedOrderId()&&(i=!0),e.items()[r].addConfigurableStockValidation(t,e.isPreOrderBackOrderEnabled,i,e.validOrderQuantityMap,e.orderedQuantityMap)}else for(var a=0;a<t.length;a++)if(e.items()[r].productId===t[a].productId&&e.items()[r].catRefId===t[a].catRefId){var o=e.user().clonedOrderId()&&e.validOrderQuantityMap&&null!=e.validOrderQuantityMap[t[a].productId+":"+t[a].catRefId]?e.validOrderQuantityMap[t[a].productId+":"+t[a].catRefId]:t[a].orderableQuantity;"IN_STOCK"===t[a].stockStatus||"PREORDERABLE"===t[a].stockStatus||"BACKORDERABLE"===t[a].stockStatus?(e.items()[r].getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[r].productId,e.items()[r].catRefId,null),e.items()[r].addLimitsValidation(!0,o,t[a],e.isPreOrderBackOrderEnabled)):o?e.items()[r].addLimitsValidation(!0,o,t[a],e.isPreOrderBackOrderEnabled):e.items()[r].addLimitsValidation(!1,t[a].orderableQuantity,t[a],e.isPreOrderBackOrderEnabled);break}},function(t){t.orderableQuantity=0;for(var r=0;r<e.items().length;r++)e.items()[r].addLimitsValidation(!1,0,t,e.isPreOrderBackOrderEnabled)})},S.prototype.getAvailabilityOfCart=function(){var e=this,t=n.Deferred();if(e.currentOrderState()!=c.PENDING_PAYMENTS&&e.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE){var r=new D(e),i={},a={};a[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_AVAILABILITY,a[c.IDENTIFIER_KEY]="stockStatusesForCart";var o=e.storeConfiguration.getFilterToUse(a);o&&!e.storeConfiguration.isLargeCart()&&(i[c.FILTER_KEY]=o);var s=e.getThreshholdSizeForStockStatusData(r.products)<0?c.ENDPOINT_PRODUCTS_AVAILABILITY:c.ENDPOINT_LIST_STOCK_STATUS_LARGE_CART;i[c.PRODUCTS_PARAM]=r.products,i[c.CATALOG]=r.catalogId,i[c.LOCATION_IDS_PARAM]=r.locationIds,h.request(s,i,function(r){for(var i=r.reduce(function(e,t){if(e[t.locationId]&&null!==e[t.locationId]){var r=e[t.locationId];r.push(t)}else{var r=new Array;r.push(t),e[t.locationId]=r}return e},{}),a=0;a<e.items().length;a++)if(e.items()[a].childItems){var o,s=e.items()[a];if(s.shippingGroupRelationships&&s.shippingGroupRelationships()&&s.shippingGroupRelationships().length>0)for(var n=0;n<s.shippingGroupRelationships().length;n++){var c=s.shippingGroupRelationships()[n],l=[],d=null;if(c.isPickupInStore&&c.isPickupInStore()?(l=i[c.selectedStore().locationId],d=c.selectedStore().locationId):c.isPickupInStore&&!c.isPickupInStore()&&(l=e.contextData.global.site.siteInfo&&e.contextData.global.site.siteInfo.inventoryLocationId?i[e.contextData.global.site.siteInfo.inventoryLocationId]:i[null]),c.getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[a].productId,e.items()[a].catRefId,c),o=!!e.user().clonedOrderId(),c.inventoryDetails=[],l&&l.length>0)for(var u=0;u<l.length;u++)if(c.productId===l[u].productId&&c.catRefId===l[u].catRefId){c.inventoryDetails.push(l[u]);break}for(var p=0;p<s.childItems.length;p++){var h=s.childItems[p].productId,g=s.childItems[p].catRefId;if(l)for(u=0;u<l.length;u++)if(h===l[u].productId&&g===l[u].catRefId){c.inventoryDetails.push(l[u]);break}}c.addConfigurableStockValidation(l,e.isPreOrderBackOrderEnabled,o,e.validOrderQuantityMap,e.orderedQuantityMap)}e.items()[a].getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[a].productId,e.items()[a].catRefId,null),e.items()[a].addConfigurableStockValidation(r,e.isPreOrderBackOrderEnabled,o,e.validOrderQuantityMap,e.orderedQuantityMap)}else{var s=e.items()[a];if(s.shippingGroupRelationships&&s.shippingGroupRelationships()&&s.shippingGroupRelationships().length>0)for(var n=0;n<s.shippingGroupRelationships().length;n++){var c=s.shippingGroupRelationships()[n],l=null;if(c.isPickupInStore&&c.isPickupInStore()?l=i[c.selectedStore().locationId]:c.isPickupInStore&&!c.isPickupInStore()&&(l=e.contextData.global.site.siteInfo&&e.contextData.global.site.siteInfo.inventoryLocationId?i[e.contextData.global.site.siteInfo.inventoryLocationId]:i[null]),l&&l.length>0)for(var u=0;u<l.length;u++)if(c.productId===l[u].productId&&c.catRefId===l[u].catRefId){"IN_STOCK"!==l[u].stockStatus&&"PREORDERABLE"!==l[u].stockStatus&&"BACKORDERABLE"!==l[u].stockStatus||(c.stockState(l[u].stockStatus),c.getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[a].productId,e.items()[a].catRefId,c));break}}for(var f=0;f<r.length;f++)if(e.items()[a].productId===r[f].productId&&e.items()[a].catRefId===r[f].catRefId){"IN_STOCK"!==r[f].stockStatus&&"PREORDERABLE"!==r[f].stockStatus&&"BACKORDERABLE"!==r[f].stockStatus||(e.items()[a].getItemQuantityInCart=e.getUpdatableItemQuantityInCart.bind(e,e.items(),e.items()[a].productId,e.items()[a].catRefId,null));break}}t.resolve(i)},function(r){for(var i=0;i<e.items().length;i++)e.items()[i].addLimitsValidation(!1,0,r,e.isPreOrderBackOrderEnabled);t.reject(r)})}return t},S.prototype.getUpdatableItemQuantityInCart=function(t,r,i,a,o,s){for(var n=this,c=0,l=0;l<t.length;l++)if(s||t[l].productId!==r){if(s){if(t[l].productId===s){if(o&&i&&t[l].catRefId!=i)continue;c+=parseInt(t[l].updatableQuantity(),10)}else if(t[l].childItems&&t[l].childItems.length>0)for(var d=t[l].childItems,u=0;u<d.length;u++)d[u].productId===s&&(c+=n.getUpdatableItemQuantityInCart([d[u]],d[u].productId)*parseInt(t[l].updatableQuantity(),10))}else if(t[l].childItems&&t[l].childItems.length>0)for(var d=t[l].childItems,u=0;u<d.length;u++)d[u].productId===r&&(c+=n.getUpdatableItemQuantityInCart([d[u]],d[u].productId)*parseInt(t[l].updatableQuantity(),10))}else{if(o&&i&&t[l].catRefId!=i)continue;var p=t[l];if(a&&null!==a&&p.shippingGroupRelationships&&p.shippingGroupRelationships()&&p.shippingGroupRelationships().length>0)for(var h=0;h<p.shippingGroupRelationships().length;h++){var g=p.shippingGroupRelationships()[h];g.isPickupInStore&&g.isPickupInStore()&&e.isObservable(a.selectedStore)&&a.selectedStore()&&g.selectedStore()&&a.selectedStore().locationId===g.selectedStore().locationId?c+=parseInt(g.updatableQuantity(),10):g.isPickupInStore()||a&&null!==a&&e.isObservable(a.isPickupInStore)&&a.isPickupInStore()||(c+=parseInt(g.updatableQuantity(),10))}else c+=parseInt(t[l].updatableQuantity(),10)}return c},S.prototype.getItemQuantityInCart=function(t,r,i,a,o,s){for(var n=this,c=0,l=0;l<t.length;l++)if(o||t[l].productId!==r){if(o){if(t[l].productId===o){if(a&&i&&t[l].catRefId!=i)continue;c+=parseInt(t[l].quantity(),10)}else if(t[l].childItems&&t[l].childItems.length>0)for(var d=t[l].childItems,u=0;u<d.length;u++)d[u].productId===o&&(c+=n.getItemQuantityInCart([d[u]],d[u].productId)*parseInt(t[l].quantity(),10))}else if(t[l].childItems&&t[l].childItems.length>0)for(var d=t[l].childItems,u=0;u<d.length;u++)d[u].productId===r&&(c+=n.getItemQuantityInCart([d[u]],d[u].productId)*parseInt(t[l].quantity(),10))}else{if(a&&i&&t[l].catRefId!=i)continue;var p=t[l];if(s&&null!==s&&p.shippingGroupRelationships&&p.shippingGroupRelationships()&&p.shippingGroupRelationships().length>0)for(var h=0;h<p.shippingGroupRelationships().length;h++){var g=p.shippingGroupRelationships()[h];g.isPickupInStore&&g.isPickupInStore()&&s&&e.isObservable(s)&&null!==s()&&s().locationId===g.selectedStore().locationId?c+=parseInt(g.quantity(),10):g.isPickupInStore()||s&&null!==s&&e.isObservable(s)&&null!==s()&&null!==s().locationId||(c+=parseInt(g.quantity(),10))}else c+=parseInt(t[l].quantity(),10)}return c},S.prototype.priceCartIfNeccessary=function(e){var r=this;if(e){var i=!!r.user().clonedOrderId();if(h.profileType==c.PROFILE_TYPE_AGENT&&i)r.callbacks&&r.callbacks.hasOwnProperty(c.PREPRICINGFORAMENDMENT)&&"function"==typeof r.callbacks[c.PREPRICINGFORAMENDMENT]&&r.callbacks[c.PREPRICINGFORAMENDMENT](),r.priceCartForCheckout();else if(r.callbacks&&r.callbacks.hasOwnProperty(c.PREPRICING)&&"function"==typeof r.callbacks[c.PREPRICING]&&r.callbacks[c.PREPRICING](),r.items().length>0)!l.isPathEqualTo(r.checkoutLink)&&!l.isPathEqualTo(r.agentCheckout)&&r.user()&&r.user().loggedIn()&&!r.user().loggedinAtCheckout()||r.user()&&r.user().loggedIn()&&!r.user().loggedinAtCheckout()&&!r.hasShippingInformation()?r.priceItemsAndPersist():r.callPriceBeforeShippingMethods||!r.shippingMethod()&&!r.hasShippingInformation()?r.priceItems():r.usingImprovedShippingWidgets()?r.priceCartForCheckout():r.populateShipppingMethods();else{r.emptyCart(),r.events.pop();var a=r.getCookieUserData();a&&r.user().orderId(a.orderId),h.profileType==c.PROFILE_TYPE_AGENT&&r.user().clonedOrderId()?n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish():0==r.items().length&&r.user().loggedIn()&&!r.user().loggedinAtCheckout()&&r.user().orderId()&&""!=r.user().orderId()&&r.removeCurrentProfileOrder()}}},S.prototype.populateShippingMethodsDeferred=function(){var e=this;0==e.shippingMethodsLoadedAndPriced()&&e.populateShipppingMethods()},S.prototype.populateShipppingMethods=function(){var e=this;if(e.shippingMethodsLoadedAndPriced(!0),e.hasSplitShippingInformation()||e.shippingAddress().afterValidation&&e.shippingMethod())e.priceCartForCheckout();else{var r={};r[c.SHIPPING_ADDRESS_FOR_METHODS]=e.shippingAddress()?{toJSON:function(){return e.shippingAddress()}}:e.shippingAddress(),r[c.PRODUCT_IDS_FOR_SHIPPING]=this.getProductIdsForItemsInCart(),n.Topic(t.topicNames.RELOAD_SHIPPING_METHODS).publishWith(r,[{message:"success"}])}},S.prototype.priceItemsAndPersist=function(){var e=this,t=!1,r=e.getCookieUserData();r&&e.user().orderId(r.orderId),e.user().loggedIn()&&e.user().orderId()&&""!=e.user().orderId()?e.updateCurrentProfileOrder(!1,t):e.createCurrentProfileOrder()},S.prototype.createCartPricingModel=function(){var e=this,t=new L(e);return t},S.prototype.updateCurrentProfileOrder=function(e,i){var a=this,s=a.events.pop();if(1==this.storeConfiguration.isLargeCart()&&s&&s.type==ee){var d=s;s=a.events.pop(),a.events.push(d)}if(a.isOrderSubmissionInProgress)console.warn(o.t("ns.common:resources.priceOrderBlockedText"));else{var u=new L(a);a.populateGiftCards(u,s),a.populateIINs(u,s),a.populateDynamicProperties(u),u.merge=e,u.clearCoupons=i,u.op=c.UPDATE_OP;var p=c.ENDPOINT_UPDATE_PROFILE_ORDER,g=!1;h.profileType!=c.PROFILE_TYPE_AGENT&&(!l.isPathEqualTo(a.checkoutLink)||l.isPathEqualTo(a.checkoutLink)&&a.hasShippingInformation())&&(u.shippingGroups=a.createShippingGroups(!0),g=!0),this.currentOrderState()!=c.PENDING_PAYMENTS&&a.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE&&(h.profileType==c.PROFILE_TYPE_AGENT&&((!l.isPathEqualTo(a.agentMultiShipCheckout)||l.isPathEqualTo(a.agentMultiShipCheckout)&&a.hasShippingInformation())&&(u.shippingGroups=a.createShippingGroups(!0),g=!0),p=c.ENDPOINT_ORDERS_CREATE_ORDER,u.op="priceOrder",u.orderId=a.user().orderId()),a.isCurrentCallInProgress=!0,h.request(p,u,function(r){if(a.hardPricing=!1,a.userActionPending(!1),a.isCurrentCallInProgress=!1,a.isPricingRequired(!1),a.updateCart(r,s,e),a.shippingMethod()&&(a.skipGWPMessage=!0,a.usingImprovedShippingWidgets()?a.priceCartForCheckout():a.populateShipppingMethods()),n.Topic(t.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),a.callbacks&&a.callbacks.hasOwnProperty(c.PRICING_SUCCESS_CB)&&"function"==typeof a.callbacks[c.PRICING_SUCCESS_CB]&&a.callbacks[c.PRICING_SUCCESS_CB](r),n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(r),a.events.length>0){var i=a.events.pop();16==i.type?n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish():a.events.push(i)}},function(e){if(a.isCurrentCallInProgress=!1,e.status==c.HTTP_UNAUTHORIZED_ERROR)a.handleSessionExpiry(s);else if(e.errorCode==c.COUPON_APPLY_ERROR)a.handleCouponPricingError(e,s);else if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND||e.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND||e.errorCode==c.PRODUCT_NOT_FOR_INDIVIDUAL_SALE)a.isDirty(!1),a.handleInvalidAddItem(e,s),a.notifyInvalidProducts(),a.handleInvalidItems(e),a.tax(0),a.secondaryCurrencyTaxAmount(0);else if(e.errorCode==c.GIFTCARD_APPLY_ERROR||e.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR||e.errorCode==c.INVALID_GIFTCARD_DATA_ERROR||e.errorCode==c.GIFTCARD_ORDER_PROCESSING_ERROR)a.handleGiftCardError(e,s);else if(e.errorCode==c.UNLINKED_ADD_ON_PRODUCT)a.reloadCart();else if(e.errorCode==c.ADDON_VOLUME_PRICE_ERROR){var i=e.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(te,i,!0),a.isDirty(!1)}else if(e.errorCode==c.INVALID_SHOPPER_INPUT){var l=JSON.parse(e.moreInfo),d=l.productId,u=a.findCartProductById(d);u&&(d=u.displayName);var i=o.t("ns.common:resources.invalidShopperInputError",{productName:d});r.sendError(te,i,!0),a.isDirty(!1)}else if(a.isSplitShipping()&&e.errorCode==c.INVALID_SHIPPING_ADDRESS)a.tax(0),a.secondaryCurrencyTaxAmount(0);else{a.shippingMethod(""),a.reloadCart(),a.tax(0),a.secondaryCurrencyTaxAmount(0);var i=e.message;h.profileType==c.PROFILE_TYPE_AGENT?(e.errors&&e.errors.length>0?r.sendError(te,e.errors[0].message,!0):r.sendError(te,i,!0),n.Topic(t.topicNames.DESTROY_SHOPPING_CART_SPINNER).publish()):r.sendError(te,i,!0)}if(n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(e),a.callbacks&&a.callbacks.hasOwnProperty(c.PRICING_FAILURE_CB)&&"function"==typeof a.callbacks[c.PRICING_FAILURE_CB]&&a.callbacks[c.PRICING_FAILURE_CB](e),a.events.length>0){var p=a.events.pop();16==p.type?n.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).publish():a.events.push(p)}},void 0,void 0,void 0,void 0,void 0,{includeShippingGroups:g}))}},S.prototype.handleInvalidAddItem=function(e,t){var r=this;if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND&&t&&t.type===k&&t.product.id==e.moreInfo&&t.product.displayName&&r.invalidProductNames.indexOf(t.product.displayName)==-1)r.invalidProductNames.push(t.product.displayName);else if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND&&t&&t.type===x&&t.product.displayName&&r.invalidProductNames.indexOf(t.product.displayName)==-1)r.invalidProductNames.push(e.moreInfo);else if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND&&t&&t.type===k&&t.product.selectedAddOnProducts&&t.product.selectedAddOnProducts.length>0)r.handleInvalidAddonItem(t.product.selectedAddOnProducts,e.moreInfo);else if(e.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND){var i=JSON.parse(e.moreInfo);t&&t.type===k&&t.product.id==i.productId&&t.product.childSKUs[0].repositoryId==i.catRefId&&t.product.displayName&&r.invalidProductNames.indexOf(t.product.displayName)==-1?r.invalidProductNames.push(t.product.displayName):t&&t.type===k&&t.product.selectedAddOnProducts&&t.product.selectedAddOnProducts.length>0&&r.handleInvalidAddonItem(t.product.selectedAddOnProducts,i.productId,i.catRefId)}else e.errorCode==c.PRODUCT_NOT_FOR_INDIVIDUAL_SALE&&t&&t.type===k&&t.product.displayName&&r.invalidProductNames.indexOf(t.product.displayName)==-1&&r.invalidProductNames.push(t.product.displayName)},S.prototype.handleInvalidAddonItem=function(e,t,r){var i=this;if(e&&e.length>0)for(var a=0;a<e.length;a++)for(var o=0;o<e[a].addOnOptions.length;o++)r&&e[a].addOnOptions[o].sku.repositoryId==r&&e[a].addOnOptions[o].product.id==t&&i.invalidProductNames.indexOf(e[a].addOnOptions[o].product.displayName)==-1?i.invalidProductNames.push(e[a].addOnOptions[o].product.displayName):e[a].addOnOptions[o].product.id==t&&i.invalidProductNames.indexOf(e[a].addOnOptions[o].product.displayName)==-1&&i.invalidProductNames.push(e[a].addOnOptions[o].product.displayName),e[a].addOnOptions[o].product.selectedAddOnProducts&&e[a].addOnOptions[o].product.selectedAddOnProducts.length>0&&i.handleInvalidAddonItem(e[a].addOnOptions[o].product.selectedAddOnProducts,t,r)},S.prototype.findCartProductById=function(e,t){var r=this,i=r.items();t&&(i=t);for(var a=0;a<i.length;a++){if(i[a].productId==e)return i[a].productData();if(i[a].childItems&&i[a].childItems.length>0){var o=r.findCartProductById(e,i[a].childItems);if(o)return o}}},S.prototype.createCurrentProfileOrder=function(){var e=this;({incomplete:!0,allowMultipleCart:e.user().isPunchout()||e.createNewCart()});if(e.items()&&e.items().length>0&&!e.isOrderSubmissionInProgress){var i=e.events.pop();if(1==this.storeConfiguration.isLargeCart()&&i&&i.type==ee){var a=i;i=e.events.pop(),e.events.push(a)}var s=new L(e);e.populateGiftCards(s,i),e.populateIINs(s,i),s.shippingGroups=e.createShippingGroups(!0),delete s.id,e.user().isPunchout()||e.createNewCart()?s.op=c.CREATE_NEW_OP:s.op=c.CREATE_OP,h.profileType==c.PROFILE_TYPE_AGENT&&(s.op=c.CREATE_OP,s.profileId=e.user().id?e.user().id():e.user().customerId()),e.isCurrentCallInProgress=!0,h.request(c.ENDPOINT_UPDATE_PROFILE_ORDER,s,function(r){e.isCurrentCallInProgress=!1,r.orderId&&e.user().orderId(r.orderId),e.hardPricing=!1,e.userActionPending(!1),e.isPricingRequired(!1),e.shippingMethod()?(e.updateCart(r,i,!1),e.skipGWPMessage=!0,e.populateShipppingMethods()):e.updateCart(r,i,!1,!0),n.Topic(t.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),e.callbacks&&e.callbacks.hasOwnProperty(c.PRICING_SUCCESS_CB)&&"function"==typeof e.callbacks[c.PRICING_SUCCESS_CB]&&e.callbacks[c.PRICING_SUCCESS_CB](r),e.createNewCart(!1),h.clearStoredValue(c.LOCAL_STORAGE_CREATE_NEW_CART),e.callbacks&&e.callbacks.hasOwnProperty(c.FIRST_ITEM_ADDED_CB)&&"function"==typeof e.callbacks[c.FIRST_ITEM_ADDED_CB]&&e.callbacks[c.FIRST_ITEM_ADDED_CB](e.user().orderId())},function(t){if(t.status==c.HTTP_UNAUTHORIZED_ERROR)e.handleSessionExpiry(i);else{if(t.errorCode==c.COUPON_APPLY_ERROR)e.handleCouponPricingError(t,i);else if(t.errorCode==c.GIFTCARD_APPLY_ERROR||t.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR||t.errorCode==c.INVALID_GIFTCARD_DATA_ERROR||t.errorCode==c.GIFTCARD_ORDER_PROCESSING_ERROR)e.handleGiftCardError(t,i);else if(t.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND||t.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND||t.errorCode==c.PRODUCT_NOT_FOR_INDIVIDUAL_SALE)e.handleInvalidAddItem(t,i),e.notifyInvalidProducts();else if(t.errorCode==c.UNLINKED_ADD_ON_PRODUCT){if(i&&i.type==k&&i.product.selectedAddOnProducts){var a=JSON.parse(t.moreInfo);e.handleInvalidAddonItem(i.product.selectedAddOnProducts,a.productId,a.catRefId),e.notifyInvalidProducts()}}else if(t.errorCode==c.ADDON_VOLUME_PRICE_ERROR){var s=t.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(te,s,!0),e.isDirty(!1)}else if(t.errorCode==c.INVALID_SHOPPER_INPUT){var a=JSON.parse(t.moreInfo),n=a.productId,l=e.findCartProductById(n);l&&(n=l.displayName);var s=o.t("ns.common:resources.invalidShopperInputError",{productName:n});r.sendError(te,s,!0),e.isDirty(!1)}else{var s=t.message;r.sendError(te,s,!0),e.isDirty(!1)}e.loadCart()}e.callbacks&&e.callbacks.hasOwnProperty(c.PRICING_FAILURE_CB)&&"function"==typeof e.callbacks[c.PRICING_FAILURE_CB]&&e.callbacks[c.PRICING_FAILURE_CB](t)},void 0,void 0,void 0,void 0,void 0,{includeShippingGroups:!0})}else e.isOrderSubmissionInProgress&&console.warn(o.t("ns.common:resources.priceOrderBlockedText"))},S.prototype.removeCurrentProfileOrder=function(){var e=this;if(1==e.user().isPunchout()){var r={},i={};i[c.ENDPOINT_KEY]=c.ENDPOINT_REMOVE_PROFILE_INCOMPLETE_ORDER_BY_ID,i[c.IDENTIFIER_KEY]="removeProfileIncompleteOrderById";var a=e.storeConfiguration.getFilterToUse(i);a&&(r[c.FILTER_KEY]=a),h.request(c.ENDPOINT_REMOVE_PROFILE_INCOMPLETE_ORDER_BY_ID,r,function(t){e.user().orderId(""),e.user().persistedOrder(null),e.user().setLocalData("orderId"),e.cartName("")},function(t){e.loadCart()},e.user().orderId())}else{var r={};r.profileId=e.user().id?e.user().id():e.user().customerId(),h.request(c.ENDPOINT_REMOVE_PROFILE_INCOMPLETE_ORDER,r,function(r){e.hardPricing=!1,e.userActionPending(!1),e.user().orderId(""),e.user().persistedOrder(null),e.user().setLocalData("orderId"),e.cartName(""),n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish()},function(t){e.loadCart()})}},S.prototype.addCoupon=function(e){var t=this;if(e){var r=t.getCookieDataAndCompare(),i=new A(e,"","","","");t.events.push(new M(F,1,i)),r&&!t.isMatchingCookieData()?t.getLocalData(r):t.addCouponToCart(i)}},S.prototype.addMultipleCoupons=function(e){var t,r=this,i=e.length;if(i>0){for(var a=r.getCookieDataAndCompare(),o=0;o<i;o++){t=e[o];var s=new A(t,"","","","");e[o]=s}r.events.push(new M(z,1,e)),a&&!r.isMatchingCookieData()?r.getLocalData(a):r.addMultipleCouponsToCart(e)}},S.prototype.addMultipleCoupons=function(e){var t,r=this,i=e.length;if(i>0){for(var a=r.getCookieDataAndCompare(),o=0;o<i;o++){t=e[o];var s=new A(t,"","","","");e[o]=s}r.events.push(new M(z,1,e)),a&&!r.isMatchingCookieData()?r.getLocalData(a):r.addMultipleCouponsToCart(e)}},S.prototype.addGiftCard=function(e){var t=this;e.giftCardNumber&&e.giftCardPin&&(t.giftCards.push(e),t.currentOrderState()==c.PENDING_PAYMENTS||t.currentOrderState()==c.PENDING_PAYMENT_TEMPLATE?t.pendingPaymentGiftCardCheck(e):(t.events.push(new M(V,0,e)),t.markDirty()))},S.prototype.addMultipleGiftCards=function(e){var t,r=this,i=e.length;if(i>0){for(var a=0;a<i;a++)t=e[a],t.giftCardNumber&&t.giftCardPin&&r.giftCards.push(t);r.currentOrderState()==c.PENDING_PAYMENTS||r.currentOrderState()==c.PENDING_PAYMENT_TEMPLATE?r.pendingPaymentGiftCardCheck(e):(r.events.push(new M(K,0,e)),r.markDirty())}},S.prototype.pendingPaymentGiftCardCheck=function(e){for(var t=this,r="inquireBalance",i=[],a={},o=0;o<t.giftCards().length;o++){var s=t.giftCards()[o],a={};a.paymentMethodType=c.GIFT_CARD_PAYMENT_TYPE,a.giftCardNumber=s.giftCardNumber(),a.giftCardPin=s.giftCardPin(),null!=a.giftCardPin&&void 0!=a.giftCardPin&&""!=a.giftCardPin&&i.push(a)}var n={};n.orderId=t.currentOrderId(),n.op=r;var l=t.user().id?t.user().id():t.user().customerId();h.profileType!=c.PROFILE_TYPE_AGENT?n.profileId=l:l&&(n.profileId=l),n.payments=i;var d="addPayments";h.request(d,n,function(e){t.updateGiftCardDetailsForPendingPayment(e)},function(r){t.handleGiftCardErrorPendingPayment(r,e)})},S.prototype.updateGiftCardDetailsForPendingPayment=function(e){var r=this;if(e.paymentResponses&&r.giftCards().length>0)for(var i=0;i<r.giftCards().length;i++){for(var a=!1,o=r.giftCards()[i],s=0;s<e.paymentResponses.length;s++){var c=e.paymentResponses[s];if(o.giftCardNumber()==c.giftCardNumber){o.amountInGiftCard(c.balance);var l=r.isChargeTaxShippingInSecondaryCurrency()&&e.amountsRemaining?e.amountsRemaining.secondaryCurrencyRemainingAmount:e.amountRemaining;l>=parseFloat(c.balance)?(o.amountUsed(parseFloat(c.balance)),o.isAmountRemaining(!1),l=parseFloat(l)-parseFloat(c.balance)):(o.amountUsed(parseFloat(l)),o.isAmountRemaining(!0),l=0),o.maskedGiftCardNumber(c.maskedCardNumber),o.isApplyGiftCardClicked(!1),a=!0;break}}0==a?o.isPinCleared(!0):o.isPinCleared(!1)}n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(r.giftCards()),n.Topic(t.topicNames.UPDATE_AMOUNT_REMAINING).publish(l),n.Topic(t.topicNames.CART_UPDATED_PENDING_PAYMENT).publish(r)},S.prototype.pendingPaymentRemoveGiftCard=function(e){var r=this;n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(r.giftCards()),n.Topic(t.topicNames.UPDATE_AMOUNT_REMAINING_PENDING_PAYMENT).publish(e.amountUsed()),n.Topic(t.topicNames.CART_UPDATED_PENDING_PAYMENT).publish(r)},S.prototype.handleGiftCardErrorPendingPayment=function(e,r){var i=this;i.giftCards.remove(function(e){return e.giftCardNumber()==r.giftCardNumber()}),n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(i.giftCards()),n.Topic(t.topicNames.GIFTCARD_PRICING_FAILED).publish(e,r),i.isDirty(!1)},S.prototype.clearPins=function(){for(var e=this,r=0;r<e.giftCards().length;r++){var i=e.giftCards()[r];i.giftCardPin(""),i.isPinCleared(!0),i.isApplyGiftCardClicked(!1)}n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(e.giftCards())},S.prototype.reApplyGiftCardPins=function(e){var t=this;t.currentOrderState()==c.PENDING_PAYMENTS||t.currentOrderState()==c.PENDING_PAYMENT_TEMPLATE?t.pendingPaymentGiftCardCheck(e):(t.events.push(new M(q,0,e)),t.markDirty())},S.prototype.removeGiftCard=function(e){var t=this;t.giftCards.remove(function(t){return t.giftCardNumber()==e.giftCardNumber()}),t.currentOrderState()==c.PENDING_PAYMENTS||t.currentOrderState()==c.PENDING_PAYMENT_TEMPLATE?t.pendingPaymentRemoveGiftCard(e):(t.events.push(new M(Y,0,e)),t.markDirty())},S.prototype.addCouponToCart=function(e){var t=this;t.coupons.push(e),t.couponMultiPromotions.push(new _(e.code())),t.markDirty()},S.prototype.addMultipleCouponsToCart=function(e){for(var t,r=this,i=e.length,a=0;a<i;a++)t=e[a],r.coupons.push(t),r.couponMultiPromotions.push(new _(t.code()));r.markDirty()},S.prototype.addMultipleCouponsToCart=function(e){for(var t,r=this,i=e.length,a=0;a<i;a++)t=e[a],r.coupons.push(t),r.couponMultiPromotions.push(new _(t.code()));r.markDirty()},S.prototype.removeCoupon=function(e){var t=this;if(e.code){var r=t.getCookieDataAndCompare();t.events.push(new M(H,0,e)),r&&!t.isMatchingCookieData()?t.getLocalData(r):t.removeCouponFromCart(e)}},S.prototype.removeCouponFromCart=function(e){var t=this;t.coupons.remove(function(t){return t.code()==e.code()}),t.couponMultiPromotions.remove(function(t){return t.code()==e.code()}),t.markDirty()},S.prototype.removeMultipleCoupons=function(e){var t=this;if(e.length>0){var r=e.filter(function(e){return null!=e.code}),i=t.getCookieDataAndCompare();t.events.push(new M(J,0,r)),i&&!t.isMatchingCookieData()?t.getLocalData(i):t.removeMultipleCouponFromCart(r)}},S.prototype.removeMultipleCouponFromCart=function(e){for(var t,r=this,i=e.length,a=0;a<i;a++)t=e[a],r.coupons.remove(function(e){return e.code()==t.code()}),r.couponMultiPromotions.remove(function(e){return e.code()==t.code()});r.markDirty()},S.prototype.handleSessionExpiry=function(e){var t=this;if(e&&e.type===k){var i=e.product,a=t.addToCart.bind(i);a()}else e&&(e.type===x||e.type===G||e.type===F||e.type===z||e.type===H||e.type===J)&&l.isPathEqualTo(t.cartLink)?(r.sendError(te,o.t("ns.common:resources.cartSessionExpired"),!0),t.user().clearUserData()):e&&(e.type===F||e.type===z||e.type===H||e.type===J)&&l.isPathEqualTo(t.checkoutLink)&&(t.isDirty(!1),t.markDirty())},S.prototype.handleCouponPricingError=function(e,t){var i=this;e.message&&t&&(t.type===F||t.type===z)&&i.coupons()[i.coupons().length-1].code()==e.moreInfo?i.couponErrorMessage(e.message):!e.message||t&&t.type==F&&t.type==z||r.sendError(te,o.t("ns.common:resources.orderPricingPromotionError"),!0),e.moreInfo&&(i.isDirty(!1),i.coupons.remove(function(t){return t.code()==e.moreInfo}),i.couponMultiPromotions.remove(function(t){return t.code()==e.moreInfo}),i.markDirty())},S.prototype.handleCurrencyPricingError=function(){var t=this;t.cartPriceListGroupId(u.getInstance().selectedPriceListGroup().id),h.setStoredValue(c.LOCAL_STORAGE_PRICELISTGROUP_ID,e.toJSON(u.getInstance().selectedPriceListGroup().id)),t.isDirty(!1),t.markDirty()},S.prototype.priceItems=function(){var e=this,i=e.events.pop();if(1==this.storeConfiguration.isLargeCart()&&i&&i.type==ee){var a=i;i=e.events.pop(),e.events.push(a)}var s=new L(e);delete s.id,e.populateGiftCards(s,i),e.populateIINs(s,i);var d=!1;h.profileType!=c.PROFILE_TYPE_AGENT&&(!l.isPathEqualTo(e.checkoutLink)||l.isPathEqualTo(e.checkoutLink)&&e.hasShippingInformation())&&(s.shippingGroups=e.createShippingGroups(!0),d=!0);var u=c.ENDPOINT_ORDERS_PRICE_ORDER;h.profileType==c.PROFILE_TYPE_AGENT&&(l.isPathEqualTo(e.agentMultiShipCheckout)&&e.hasShippingInformation()&&(s.shippingGroups=e.createShippingGroups(!0),d=!0),u=c.ENDPOINT_ORDERS_CREATE_ORDER,s.op="priceOrder"),h.request(u,s,function(r){r.isTransientOrder=!0,e.hardPricing=!1,e.userActionPending(!1),e.isPricingRequired(!1),e.updateCart(r,i,!1),e.callPriceBeforeShippingMethods&&e.populateShipppingMethods(),n.Topic(t.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),e.callbacks&&e.callbacks.hasOwnProperty(c.PRICING_SUCCESS_CB)&&"function"==typeof e.callbacks[c.PRICING_SUCCESS_CB]&&e.callbacks[c.PRICING_SUCCESS_CB](r),n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(r)},function(a){if(a.errorCode==c.SELECTED_CURRENCY_NOT_FOUND)e.handleCurrencyPricingError();else if(a.errorCode==c.COUPON_APPLY_ERROR)e.handleCouponPricingError(a,i);else if(a.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND||a.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND||a.errorCode==c.PRODUCT_NOT_FOR_INDIVIDUAL_SALE)e.handleInvalidAddItem(a,i),e.notifyInvalidProducts(),e.loadCart(),e.tax(0),e.secondaryCurrencyTaxAmount(0);else if(a.errorCode==c.GIFTCARD_APPLY_ERROR||a.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR||a.errorCode==c.INVALID_GIFTCARD_DATA_ERROR||a.errorCode==c.GIFTCARD_ORDER_PROCESSING_ERROR)e.handleGiftCardError(a,i);else if(a.errorCode==c.ANONYMOUS_USER_ACCESS_CONTROL_ERROR)r.sendError("UserNotAuthorized",o.t("ns.common:resources.anonymousAccessControlError"),!0);else if(a.errorCode==c.UNLINKED_ADD_ON_PRODUCT){if(i&&i.type==k&&i.product.selectedAddOnProducts){var s=JSON.parse(a.moreInfo);e.handleInvalidAddonItem(i.product.selectedAddOnProducts,s.productId,s.catRefId),e.notifyInvalidProducts(),e.loadCart()}}else if(a.errorCode==c.ADDON_VOLUME_PRICE_ERROR){var l=a.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(te,l,!0),e.isDirty(!1)}else if(a.errorCode==c.INVALID_SHOPPER_INPUT){var s=JSON.parse(a.moreInfo),d=s.productId,u=e.findCartProductById(d);u&&(d=u.displayName);var l=o.t("ns.common:resources.invalidShopperInputError",{productName:d});r.sendError(te,l,!0),e.isDirty(!1)}else e.isDirty(!1),e.tax(0),e.secondaryCurrencyTaxAmount(0);n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(a),e.callbacks&&e.callbacks.hasOwnProperty(c.PRICING_FAILURE_CB)&&"function"==typeof e.callbacks[c.PRICING_FAILURE_CB]&&e.callbacks[c.PRICING_FAILURE_CB](a)},void 0,void 0,void 0,void 0,void 0,{includeShippingGroups:d})},S.prototype.hasSingleShippingInformation=function(){var e=!1;return this.isSplitShipping()||(e=""!==this.shippingAddress()&&""!==this.shippingMethod()),e},S.prototype.hasSplitShippingInformation=function(){var e=!1;return this.isSplitShipping()&&(e=0!=this.items().length&&this.items().every(function(e){return e.shippingGroupRelationships().every(function(e){return e.updatableQuantity.isValid()&&(e.shippingAddress()&&e.shippingAddress().isValid&&e.shippingAddress().isValid()&&e.shippingMethod()||e.selectedStore())})})),e},S.prototype.hasShippingInformation=function(){var e=this.hasSplitShippingInformation()||this.hasSingleShippingInformation();return e},S.prototype.setUnpricedErrorAndSaveCart=function(t,r){var i=this;e.utils.arrayForEach(i.items(),function(e){e.commerceItemId==t&&i.isConfigurableItem(e)&&e.childItems&&e.childItems.length>0&&e.setUnpricedError(r)}),i.saveCartCookie()},S.prototype.clearAllUnpricedErrorsAndSaveCart=function(){var t=this;e.utils.arrayForEach(t.items(),function(e){e.clearUnpricedError()}),t.saveCartCookie()},S.prototype.setExternalPricesForItems=function(t){var r=this;e.utils.arrayForEach(r.items(),function(e){t.commerceItemId==e.commerceItemId&&e.externalPrice(t.externalPrice)})},S.prototype.priceCartForCheckout=function(){var i=this,a=i.events.pop();if(1==this.storeConfiguration.isLargeCart()&&a&&a.type==ee){var s=a;a=i.events.pop(),i.events.push(s)}if((h.profileType==c.PROFILE_TYPE_AGENT&&i.user().clonedOrderId()||i.hasShippingInformation())&&!i.isOrderSubmissionInProgress){var d=new L(i);if(i.hasShippingInformation()){if(this.isSplitShipping())d.shippingGroups=this.createShippingGroups();else if(h.profileType==c.PROFILE_TYPE_AGENT&&this.orderShippingGroups()&&this.orderShippingGroups().length>1)d.shippingGroups=this.createShippingGroups(!0);else{if(d.shippingMethod={value:this.shippingMethod()},d.shippingAddress=this.shippingAddress(),c.PROFILE_TYPE_AGENT===h.profileType&&i.user().clonedOrderId())for(var u=d.shoppingCart.items.length,p=0;p<u;p++)d.shoppingCart.items[p].commerceItemId||(d.shoppingCart.items[p].commerceItemId=this.generateCommerceItemId());this.user().emailAddress()&&!e.utils.unwrapObservable(d.shippingAddress.email)?d.shippingAddress.email=this.user().emailAddress():this.user().loggedIn()||!this.emailAddressForGuestUser||e.utils.unwrapObservable(d.shippingAddress.email)&&d.shippingAddress.email==this.emailAddressForGuestUser||(d.shippingAddress.email=this.emailAddressForGuestUser);
}d.populateShippingMethods=!0}if(i.populateGiftCards(d,a),i.populateIINs(d,a),i.items().length>0){if(i.currentOrderState()!=c.PENDING_PAYMENTS&&this.currentOrderState()!=c.PENDING_PAYMENT_TEMPLATE)if(i.user()&&i.user().loggedIn()&&!i.user().loggedinAtCheckout()||h.profileType==c.PROFILE_TYPE_AGENT){d.checkout=!0,d.clearCoupons=!1,d.merge=!1;var g;if(h.profileType==c.PROFILE_TYPE_AGENT){var f=!!i.user().clonedOrderId();f?(d.orderId=i.user().orderId(),d[c.OP]=c.PRICE_ORDER_AMENDMENT_OP,d.shoppingCart.coupons=e.toJS(i.coupons())):(g=c.ENDPOINT_ORDERS_CREATE_ORDER,d.op="priceOrder",i.user().orderId()&&(d.orderId=i.user().orderId()))}else g="order";var m=i.user().orderId(),I={includeShippingGroups:!1};i.user().clonedOrderId()&&((!l.isPathEqualTo(i.agentMultiShipCheckout)||l.isPathEqualTo(i.agentMultiShipCheckout)&&i.hasShippingInformation())&&(I.includeShippingGroups=!0),m=i.user().clonedOrderId(),g="handleOrderAmendment",d.op="priceOrderAmendment"),i.adapter.persistUpdate(g,m,d,I,function(e){i.hardPricing=!1,i.userActionPending(!1),i.isPricingRequired(!1),i.updateCart(e,a,!1),n.Topic(t.topicNames.ORDER_PRICING_SUCCESS).publish([{message:"success"}]),n.Topic(t.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(e)},function(e){if(e.errorCode==c.SELECTED_CURRENCY_NOT_FOUND)i.handleCurrencyPricingError();else if(e.errorCode==c.COUPON_APPLY_ERROR)i.handleCouponPricingError(e,a);else if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND||e.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND)i.loadCart(),i.tax(0),i.secondaryCurrencyTaxAmount(0);else if(e.errorCode==c.GIFTCARD_APPLY_ERROR||e.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR||e.errorCode==c.INVALID_GIFTCARD_DATA_ERROR||e.errorCode==c.GIFTCARD_ORDER_PROCESSING_ERROR)i.handleGiftCardError(e,a);else if(e.errorCode==c.INVALID_SHIPPING_METHOD&&i.usingImprovedShippingWidgets())i.populateShipppingMethods();else if(e.errorCode==c.UNLINKED_ADD_ON_PRODUCT)i.loadCart();else if(e.errorCode==c.ADDON_VOLUME_PRICE_ERROR){var s=e.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(te,s,!0),i.isDirty(!1)}else if(e.errorCode==c.INVALID_SHOPPER_INPUT){var l=JSON.parse(e.moreInfo),d=l.productId,u=i.findCartProductById(d);u&&(d=u.displayName);var s=o.t("ns.common:resources.invalidShopperInputError",{productName:d});r.sendError(te,s,!0),i.isDirty(!1)}else i.isSplitShipping()&&e.errorCode==c.INVALID_SHIPPING_ADDRESS?(i.tax(0),i.secondaryCurrencyTaxAmount(0),n.Topic(t.topicNames.ORDER_PRICING_FAILED).publishWith(e)):e.errorCode==c.CART_ITEM_QUANTITY_NOT_FULY_ALLOCATED?i.isDirty(!1):(i.shippingMethod(""),i.loadCart(),i.tax(0),i.secondaryCurrencyTaxAmount(0),n.Topic(t.topicNames.ORDER_PRICING_FAILED).publishWith(e),n.Topic(t.topicNames.DESTROY_SHOPPING_CART_SPINNER).publish());n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(e)})}else{var g;h.profileType==c.PROFILE_TYPE_AGENT?(g=c.ENDPOINT_ORDERS_CREATE_ORDER,d.op="priceOrder"):g="orderPricing",i.adapter.loadJSON(g,"0",d,function(e){i.hardPricing=!1,i.userActionPending(!1),i.isPricingRequired(!1),i.updateCart(e,a,!1),n.Topic(t.topicNames.ORDER_PRICING_SUCCESS).publish([{message:"success"}]),n.Topic(t.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),i.associateShippingGroupsToItems(e.shippingGroups),n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(e)},function(e){if(e.errorCode==c.SELECTED_CURRENCY_NOT_FOUND)i.handleCurrencyPricingError();else if(e.errorCode==c.COUPON_APPLY_ERROR)i.handleCouponPricingError(e,a);else if(e.errorCode==c.CREATE_ORDER_PRODUCT_NOT_FOUND||e.errorCode==c.CREATE_ORDER_SKU_NOT_FOUND)i.loadCart(),i.tax(0),i.secondaryCurrencyTaxAmount(0);else if(e.errorCode==c.GIFTCARD_APPLY_ERROR||e.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR||e.errorCode==c.INVALID_GIFTCARD_DATA_ERROR||e.errorCode==c.GIFTCARD_ORDER_PROCESSING_ERROR)i.handleGiftCardError(e,a);else if(e.errorCode==c.INVALID_SHIPPING_METHOD&&i.usingImprovedShippingWidgets())i.populateShipppingMethods();else if(e.errorCode==c.UNLINKED_ADD_ON_PRODUCT)i.loadCart();else if(e.errorCode==c.ADDON_VOLUME_PRICE_ERROR){var s=e.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(te,s,!0),i.isDirty(!1)}else if(e.errorCode==c.INVALID_SHOPPER_INPUT){var l=JSON.parse(e.moreInfo),d=l.productId,u=i.findCartProductById(d);u&&(d=u.displayName);var s=o.t("ns.common:resources.invalidShopperInputError",{productName:d});r.sendError(te,s,!0),i.isDirty(!1)}else i.isSplitShipping()&&e.errorCode==c.INVALID_SHIPPING_ADDRESS?(i.tax(0),i.secondaryCurrencyTaxAmount(0),n.Topic(t.topicNames.ORDER_PRICING_FAILED).publishWith(e)):(i.shippingMethod(""),i.loadCart(),i.tax(0),i.secondaryCurrencyTaxAmount(0),n.Topic(t.topicNames.ORDER_PRICING_FAILED).publishWith(e));n.Topic(t.topicNames.DESTROY_SHIPPING_OPTIONS_SPINNER).publishWith(e)})}}else i.emptyCart(),n.Topic(t.topicNames.ORDER_PRICING_FAILED).publish(),h.profileType==c.PROFILE_TYPE_AGENT&&i.user().clonedOrderId()?n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish():i.user()&&i.user().loggedIn()&&!i.user().loggedinAtCheckout()&&i.removeCurrentProfileOrder()}else i.isOrderSubmissionInProgress&&console.warn(o.t("ns.common:resources.priceOrderBlockedText"))},S.prototype.handleGiftCardError=function(e,r){var i=this,a=r.product;if(r.type===V)i.giftCards.remove(function(e){return e.giftCardNumber()==a.giftCardNumber()});else if(r.type===K)for(var o=0;o<a.length;o++)i.giftCards.remove(function(e){return e.giftCardNumber()==a[o].giftCardNumber()});else r.type===q&&e.errorCode==c.GIFTCARD_INSUFFICIENT_ERROR&&(i.giftCards.remove(function(e){return e.giftCardNumber()==a.giftCardNumber()}),n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(i.giftCards()),i.isDirty(!1),i.isDirty(!0));n.Topic(t.topicNames.GIFTCARD_PRICING_FAILED).publish(e,a,r),i.isDirty(!1)},S.prototype.updateCart=function(e,r,i,a){var o=this;h.profileType==c.PROFILE_TYPE_AGENT&&o.isItemPriceOverrideAllowed(e.isItemPriceOverrideAllowed),(i||o.items().length>0)&&(o.updateCartData(e,i,a),o.updateGiftCardDetails(e,r),o.updateDynamicProperties(e),o.cartUpdated(),n.Topic(t.topicNames.CART_PRICE_COMPLETE).publish(),r&&r.type===k?n.Topic(t.topicNames.CART_ADD_SUCCESS).publish(r.product):r&&r.type===x?n.Topic(t.topicNames.CART_UPDATE_SUCCESS).publish():r&&r.type===F?n.Topic(t.topicNames.COUPON_APPLY_SUCCESSFUL).publish():r&&r.type===H&&n.Topic(t.topicNames.COUPON_DELETE_SUCCESSFUL).publish(),n.Topic(t.topicNames.CART_PRICE_SUCCESS).publish(o))},S.prototype.updateGiftCardDetails=function(e,i){var a=this;if(a.giftCards().length>0&&a.updateGiftCardDetailsHandler&&n.isFunction(a.updateGiftCardDetailsHandler))a.updateGiftCardDetailsHandler(e,i);else{var s=[];if(e.payments&&a.giftCards().length>0){for(var l=0;l<a.giftCards().length;l++){for(var d=!1,u=a.giftCards()[l],p=0;p<e.payments.length;p++){var h=e.payments[p];if(h.paymentMethod==c.GIFT_CARD_PAYMENT_TYPE&&u.giftCardNumber()==h.giftCardNumber){u.amountInGiftCard(h.balance),u.amountUsed(h.amount),u.isAmountRemaining(h.isAmountRemaining),u.maskedGiftCardNumber(h.maskedCardNumber),u.isApplyGiftCardClicked(!1),d=!0;break}}i&&i.product&&i.product.giftCardNumber&&i.product.giftCardNumber()===u.giftCardNumber()&&u.isPinCleared(!1),0==d&&s.push(u)}for(var g=0;g<s.length;g++)a.giftCards.remove(function(e){return e.giftCardNumber()==s[g].giftCardNumber()});s&&s.length>0&&r.sendError(te,o.t("ns.common:resources.orderPricingPromotionError"),!0)}n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).publish(a.giftCards()),a.updateRemainingAmount(e)}},S.prototype.updateRemainingAmount=function(e){var r=this,i=null;if(e.payments&&r.giftCards().length>0){for(var a=r.getDerivedTotal(r.secondaryCurrencyTotal(),r.total()),o=r.isChargeTaxShippingInSecondaryCurrency()?r.secondaryCurrency().fractionalDigits:r.currency.fractionalDigits,s=0,c=0,l=0;l<e.payments.length;l++){var d=e.payments[l];"true"!=d.default_initial&&(c=parseFloat(s)+parseFloat(d.amount),s=y.handleFractionalDigits(c,o))}c=parseFloat(a)-parseFloat(s),i=y.handleFractionalDigits(c,o)}n.Topic(t.topicNames.UPDATE_AMOUNT_REMAINING).publish(i)},S.prototype.updateCartData=function(e,t,r,i){var a=this;e&&(e.orderId||e.id)&&!e.isTransientOrder&&(e.orderId?a.user().orderId(e.orderId):e.id&&a.user().orderId(e.id),a.user().setLocalData("orderId"));var o=null;if(e.priceListGroup&&e.priceListGroup.currency)a.currency=e.priceListGroup.currency;else if(e.priceListGroup&&e.priceListGroup.repositoryId){"agentUI"===h.profileType&&(a.agentConfiguration=require("agentViewModels/agentConfiguration"));var s,l=a.agentConfiguration?a.agentConfiguration.getPriceListGroups():null;l&&(s=l[e.priceListGroup.repositoryId]),s&&(a.currency=s.currency)}if(n.when(u.getInstance().siteLoadedDeferred).done(function(){var t=u.getInstance().getCurrency(e.secondaryCurrencyCode);a.setSecondaryCurrencyData(t,e.exchangeRate,e.payShippingInSecondaryCurrency,e.payTaxInSecondaryCurrency)}),o=e.order&&(a.currentOrderId()||a.mergeCart())?O(e.order.items,a.items,t,a,e,r):O(e.shoppingCart.items,a.items,t,a,e,r,i),a.combineLineItems===c.COMBINE_YES&&(a.combineLineItems=1==a.shouldCombineLineItems(a.items())?c.COMBINE_YES:c.COMBINE_NO),e.order&&(a.currentOrderId()||a.mergeCart())?a.numberOfItems(e.order.numberOfItems):a.numberOfItems(e.shoppingCart.numberOfItems),a.total(e.priceInfo.total),a.totalWithoutTax(e.priceInfo.totalWithoutTax),a.subTotal(e.priceInfo.subTotal),a.shipping(e.priceInfo.shipping),a.secondaryCurrencyShippingAmount(e.priceInfo.secondaryCurrencyShippingAmount),a.taxExclusiveAmount(e.priceInfo.taxExclusiveAmount),a.tax(e.priceInfo.tax),a.secondaryCurrencyTaxAmount(e.priceInfo.secondaryCurrencyTaxAmount),a.currencyCode(e.priceInfo.currencyCode),a.shippingSurcharge(e.priceInfo.shippingSurchargeValue),a.secondaryCurrencyShippingSurcharge(e.priceInfo.secondaryCurrencyShippingSurchargeValue),a.secondaryCurrencyTotal(e.priceInfo.secondaryCurrencyTotal),a.primaryCurrencyTotal(e.priceInfo.primaryCurrencyTotal),a.quoteInfo(e.quoteInfo),e.recurringChargePriceInfo&&(a.recurringChargeAmount(e.recurringChargePriceInfo.amount),a.recurringChargeCurrencyCode(e.recurringChargePriceInfo.currencyCode),a.recurringChargeShipping(e.recurringChargePriceInfo).shipping,a.recurringChargeSubTotal(e.recurringChargePriceInfo.subTotal),a.recurringChargeSubTotalByFrequency(e.recurringChargePriceInfo.subTotalByFrequency),a.recurringChargeTax(e.recurringChargePriceInfo.tax),a.recurringChargeTaxByFrequency(e.recurringChargePriceInfo.taxByFrequency),a.recurringChargeTotal(e.recurringChargePriceInfo.total)),e.discountInfo){e.discountInfo.orderDiscount?a.orderDiscount(e.discountInfo.orderDiscount):a.orderDiscount(0),e.discountInfo.shippingDiscount?(a.shippingDiscount(e.discountInfo.shippingDiscount),a.secondaryCurrencyShippingDiscount(e.discountInfo.secondaryCurrencyShippingDiscount)):(a.shippingDiscount(0),a.secondaryCurrencyShippingDiscount(0)),e.discountInfo.orderImplicitDiscountList&&a.orderDiscountDescList(e.discountInfo.orderImplicitDiscountList),e.discountInfo.unclaimedCouponsMap&&a.populateCoupons(e.discountInfo.unclaimedCouponsMap,c.COUPON_STATUS_UNCLAIMED),e.discountInfo.orderCouponsMap&&a.populateCoupons(e.discountInfo.orderCouponsMap,c.COUPON_STATUS_CLAIMED),a.couponMultiPromotions.splice(0),e.discountInfo.unclaimedCouponMultiPromotions&&a.populateCouponMultiPromotions(e.discountInfo.unclaimedCouponMultiPromotions,c.COUPON_STATUS_UNCLAIMED,c.PROMOTION_NOT_APPLIED),e.discountInfo.claimedCouponMultiPromotions&&a.populateCouponMultiPromotions(e.discountInfo.claimedCouponMultiPromotions,c.COUPON_STATUS_CLAIMED,c.PROMOTION_APPLIED),e.pricingMessages&&a.populatePricingMessage(e.pricingMessages),a.populateClaimedCouponMultiPromotions(a.couponMultiPromotions());for(var d=a.coupons().length-1;d>=0;d--)e.discountInfo.orderCouponsMap.hasOwnProperty(a.coupons()[d].code())||e.discountInfo.unclaimedCouponsMap.hasOwnProperty(a.coupons()[d].code())||a.coupons.splice(d,1);e.shippingGroups&&e.shippingGroups[0].items?(e.shippingGroups.map(function(e,t){var r=e.items.reduce(function(e,t){return e+=t.quantity},0);if(null==e.shippingAddress&&(e.shippingAddress={}),e.shippingMethod)for(var i in e.shippingMethod)null==e.shippingMethod[i]&&(e.shippingMethod[i]="");else e.shippingMethod={};return e.totalItemQuantity=r}),a.orderShippingGroups(e.shippingGroups)):(a.shippingDiscount(0),a.secondaryCurrencyShippingDiscount(0))}if(a.amount(e.priceInfo.amount),a.skipGWPMessage||a.sendGWPMessages(e),a.skipGWPMessage=!1,a.giftWithPurchaseOrderMarkers=e.giftWithPurchaseOrderMarkers,a.placeHolderItems.removeAll(),e.giftWithPurchaseInfo&&e.giftWithPurchaseInfo.length&&a.updatePlaceHolderItems(e.giftWithPurchaseInfo),a.items().length>0){for(var d=0;d<a.items().length;d++)if(null==a.items()[d].productData()||!a.isChildItemHasProductData(a.items()[d].childItems)){a.getProductData();break}}else a.events.push(new M(Z,0));return o},S.prototype.isChildItemHasProductData=function(e){var t=this,r=!0;if(null!=e&&e.length>0)for(var i=0;i<e.length&&(r=null!=e[i].productData()&&(r&&t.isChildItemHasProductData(e.childItems)),r);i++);return r},S.prototype.addGiftDataToItem=function(e,t){if(e.discountInfo().length){var r=e.discountInfo();e.giftData=[];for(var i=0;i<r.length;i++)if(r[i].giftWithPurchaseDiscountInfo&&r[i].giftWithPurchaseDiscountInfo.length)for(var a=0;a<r[i].giftWithPurchaseDiscountInfo.length;a++){var o=r[i].giftWithPurchaseDiscountInfo[a];if(o.giftWithPurchaseChoicesAvailable)for(var s=o.giftWithPurchaseIdentifier,n=0;n<t.giftWithPurchaseInfo.length;n++)if(t.giftWithPurchaseInfo[n].giftWithPurchaseIdentifier==s&&t.giftWithPurchaseInfo[n].promotionId==r[i].promotionId){var c={};c.giftWithPurchaseType=t.giftWithPurchaseInfo[n].giftWithPurchaseType,c.giftWithPurchaseDetail=t.giftWithPurchaseInfo[n].giftWithPurchaseDetail,c.promotionId=t.giftWithPurchaseInfo[n].promotionId,c.giftWithPurchaseIdentifier=t.giftWithPurchaseInfo[n].giftWithPurchaseIdentifier,c.giftWithPurchaseQuantity=o.giftWithPurchaseQuantity,e.giftData.push(c),e.isGWPChoicesAvaliable(!0);break}}}},S.prototype.updatePlaceHolderItems=function(e){for(var t=this,r=0;r<e.length;r++)if(e[r].giftWithPurchaseQuantityAvailableForSelection){var i=e[r].giftWithPurchaseQuantityAvailableForSelection;if(i){var a=e[r];a.displayName=o.t("ns.common:resources.freeProductText"),a.imageData={primaryThumbImageURL:"/img/GWP_GiftWithPurchase.jpg",primaryImageAltText:a.displayName,primaryImageTitle:a.displayName},a.quantity=1,a.itemTotal=0,a.quantityDisabled=!0,a.id=Math.floor(1e4*Math.random()),a.isPlaceHolderItem=!0}for(;i;)t.placeHolderItems.push(a),i--}t.numberOfItems(t.numberOfItems()+t.placeHolderItems().length)},S.prototype.removePlaceHolderFromCart=function(e){var r=this;r.placeHolderItems.remove(e),r.allItems.remove(e),n.Topic(t.topicNames.CART_REMOVE_SUCCESS).publishWith([{message:"success"}]),r.numberOfItems(r.numberOfItems()-1)},S.prototype.sendGWPMessages=function(e){var i=this;if(r.clearError(re),i.gwpQualified&&(n.Topic(t.topicNames.GWP_CLEAR_QUALIFIED_MESSAGE).publish(),i.gwpQualified=!1),e.pricingMessages&&e.pricingMessages.giftWithPurchaseMessages&&e.pricingMessages.giftWithPurchaseMessages.length){for(var a,o,s,c=e.pricingMessages.giftWithPurchaseMessages,l=!1,d=!1,u=null,p=0;p<c.length;p++)"GWPFullFailure"!=c[p].identifier||d?"GWPQualified"!=c[p].identifier||i.gwpQualified?"GWPInvalidated"!=c[p].identifier||l||(s=c[p].summary,l=!0,n.Topic(t.topicNames.GWP_INVALIDATED_MESSAGE).publish(c[p])):(o=c[p].summary,u==c[p].params[0]?(n.Topic(t.topicNames.GWP_CLEAR_QUALIFIED_MESSAGE).publish(),i.gwpQualified=!1,u=null):(n.Topic(t.topicNames.GWP_QUALIFIED_MESSAGE).publish(c[p]),i.gwpQualified=!0,u=c[p].params[0])):(a=c[p].summary,d=!0,c[p].params[0]==u?(n.Topic(t.topicNames.GWP_CLEAR_QUALIFIED_MESSAGE).publish(),i.gwpQualified=!1,u=null):u=c[p].params[0],n.Topic(t.topicNames.GWP_FAILURE_MESSAGE).publish(c[p]));d&&!i.gwpQualified?r.sendError(re,a,!0):i.gwpQualified?r.sendSuccess(re,o,!0):l&&r.sendError(re,s,!0)}},S.prototype.populateCoupons=function(e,t){var r=this,i=[],a=!1,o=r.coupons().length;for(var s in e){for(var n=0;n<o;n++)if(s==r.coupons()[n].code()){r.coupons()[n].description(e[r.coupons()[n].code()].promotionDesc),r.coupons()[n].status(t),r.coupons()[n].level(e[r.coupons()[n].code()].promotionLevel),r.coupons()[n].id(e[r.coupons()[n].code()].promotionId),r.coupons()[n].totalAdjustment(e[r.coupons()[n].code()].totalAdjustment),r.coupons()[n].name(e[r.coupons()[n].code()].promotionName),r.coupons()[n].longDescription(e[r.coupons()[n].code()].promotionLongDesc),a=!0;break}a||i.push(new A(s,e[s].promotionDesc,t,e[s].promotionLevel,e[s].promotionId,e[s].totalAdjustment,e[s].promotionName,e[s].promotionLongDesc))}for(var n=0;n<i.length;n++)r.coupons.push(i[n])},S.prototype.populatePricingMessage=function(e){var t=this;e&&e.promotionUpsellMessages&&t.promotionUpsellContainer.populatePromotionUpsellMessages(e.promotionUpsellMessages)},S.prototype.populateCouponMultiPromotions=function(e,t,r){var i=this,a=[],o=!1,s=i.couponMultiPromotions().length;for(var n in e){o=!1;for(var c=0;c<s;c++)if(n==i.couponMultiPromotions()[c].code()){i.couponMultiPromotions()[c].couponStatus(t),i.couponMultiPromotions()[c].populateCouponData(e[n],r),o=!0;break}o||a.push(new _(n,e[n],t,r))}for(var c=0;c<a.length;c++)i.couponMultiPromotions.push(a[c])},S.prototype.populateClaimedCouponMultiPromotions=function(t){var r=this;r.claimedCouponMultiPromotions.splice(0);for(var i=0;i<t.length;i++)if(t[i].couponStatus()===c.COUPON_STATUS_CLAIMED){for(var a=[],o=0;o<t[i].promotions().length;o++)t[i].promotions()[o].promotionApplied()&&a.push(e.mapping.toJS(t[i].promotions()[o]));r.claimedCouponMultiPromotions.push(new _(t[i].code(),a,c.COUPON_STATUS_CLAIMED,c.PROMOTION_APPLIED))}},S.prototype.populateShippingMethodsForShippingGroup=function(t,r,i){var a=this,o={};o.shoppingCart={},o.shoppingCart.items=[],o.shoppingCart.items.push({catRefId:t.catRefId,productId:t.productId,quantity:t.quantity()}),a.adapter.persistCreate(c.ENDPOINT_ORDERS_PRICE_ORDER,"0",o,function(o){var s={},l=t.shippingAddress();if(l){s[c.PRODUCT_IDS_FOR_SHIPPING]=[t.productId],s[c.POPULATE_SHIPPING_METHODS]=!0,s[c.SHIPPING_ADDRESS_FOR_METHODS]=l.toJSON(),s.priceInfo={amount:a.amount(),total:a.total(),shipping:a.shipping(),totalWithoutTax:a.totalWithoutTax(),currencyCode:a.currencyCode(),shippingSurchargeValue:a.shippingSurcharge(),tax:a.tax(),subTotal:a.subTotal()};var d=e.observableArray();O(o.shoppingCart.items,d,!0),s.items=d(),t.shippingOptions.removeAll(),a.loadMultipleShippingMethods&&n.isFunction(a.loadMultipleShippingMethods)&&a.loadMultipleShippingMethods(r,i,s)}},function(e){i(e)})},S.prototype.events=new Array,S.prototype.validateCartAvailability=function(){var e=this,t=n.Deferred();if(e.items().length>0){var r=new D(e),i={},a={};i[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_AVAILABILITY,i[c.IDENTIFIER_KEY]="stockStatsToValidateCart";var o=e.storeConfiguration.getFilterToUse(i);o&&!e.storeConfiguration.isLargeCart()&&(a[c.FILTER_KEY]=o);var s=e.getThreshholdSizeForStockStatusData(r.products)<0?c.ENDPOINT_PRODUCTS_AVAILABILITY:c.ENDPOINT_LIST_STOCK_STATUS_LARGE_CART;a[c.PRODUCTS_PARAM]=r.products,a[c.CATALOG]=r.catalogId,a[c.LOCATION_IDS_PARAM]=r.locationIds,h.request(s,a,function(r){t.resolve(e.validateCartForCheckout(r))},function(r){t.reject(r),e.redirect(e.cartLink),e.notifyInvalidProducts("cart")})}return t},S.prototype.validateCartForCheckout=function(e){for(var t=this,r=0;r<t.items().length;r++)if(t.isConfigurableItem(t.items()[r]))t.items()[r].getItemQuantityInCart=t.getUpdatableItemQuantityInCart.bind(t,t.items(),t.items()[r].productId,t.items()[r].catRefId,null),t.items()[r].addConfigurableStockValidation(e,t.isPreOrderBackOrderEnabled);else for(var i=0;i<e.length;i++)if(t.items()[r].productId===e[i].productId&&t.items()[r].catRefId===e[i].catRefId){"IN_STOCK"===e[i].stockStatus||"PREORDERABLE"===e[i].stockStatus||"BACKORDERABLE"===e[i].stockStatus?(t.items()[r].getItemQuantityInCart=t.getUpdatableItemQuantityInCart.bind(t,t.items(),t.items()[r].productId,t.items()[r].catRefId,null),t.items()[r].addLimitsValidation(!0,e[i].orderableQuantity,e[i],t.isPreOrderBackOrderEnabled)):t.items()[r].addLimitsValidation(!1,e[i].orderableQuantity,e[i],t.isPreOrderBackOrderEnabled);break}for(var a=e.reduce(function(e,t){if(e[t.locationId]&&null!==e[t.locationId]){var r=e[t.locationId];r.push(t)}else{var r=new Array;r.push(t),e[void 0==t.locationId?null:t.locationId]=r}return e},{}),r=0;r<t.items().length;r++){var o=t.items()[r];if(o.shippingGroupRelationships&&o.shippingGroupRelationships()&&o.shippingGroupRelationships().length>0)for(var s=0;s<o.shippingGroupRelationships().length;s++){var n=o.shippingGroupRelationships()[s],c=[];if(n.isPickupInStore&&n.isPickupInStore()?c=a[n.selectedStore().locationId]:n.isPickupInStore&&!n.isPickupInStore()&&(c=t.contextData.global.site.siteInfo&&t.contextData.global.site.siteInfo.inventoryLocationId?a[t.contextData.global.site.siteInfo.inventoryLocationId]:a[null]),c&&c.length>0)for(var i=0;i<c.length;i++)if(n.productId===c[i].productId&&n.catRefId===c[i].catRefId){if("PREORDERABLE"!==c[i].stockStatus&&"IN_STOCK"!==c[i].stockStatus&&"BACKORDERABLE"!==c[i].stockStatus||!(n.quantity()<=c[i].orderableQuantity)||!n.updatableQuantity.isValid())return t.redirect(t.cartLink),t.checkoutWithPaypalClicked(!1),!1;break}}else for(var i=0;i<e.length;i++)if(t.items()[r].productId===e[i].productId&&t.items()[r].catRefId===e[i].catRefId){if("PREORDERABLE"!==e[i].stockStatus&&"IN_STOCK"!==e[i].stockStatus&&"BACKORDERABLE"!==e[i].stockStatus||!(t.items()[r].quantity()<=e[i].orderableQuantity)||!t.items()[r].updatableQuantity.isValid())return t.redirect(t.cartLink),t.checkoutWithPaypalClicked(!1),!1;break}}return!0},S.prototype.redirect=function(e){var r=this;r.validateAndRedirectCart()||(r.checkoutLink==e||e==c.PAYPAL_CHECKOUT_TYPE)&&(r.user().loggedIn()||r.user().isUserSessionExpired())?(r.validateAndRedirectCart(!1),e==c.PAYPAL_CHECKOUT_TYPE?r.user().validateAndRedirectPage(e):r.user().validateAndRedirectPage(r.checkoutLink)):l.isPathEqualTo(e)?r.reloadCart():e==c.PAYPAL_CHECKOUT_TYPE?n.Topic(t.topicNames.CONTINUE_TO_PAYPAL).publish():l.goTo(e)},S.prototype.setContext=function(e){this.contextData=e,this.cartLink=this.contextData.global.links.cart.route,this.checkoutLink=this.contextData.global.links.checkout.route,this.isTaxIncluded=this.contextData.global.site.isTaxIncluded,this.showTaxSummary=this.contextData.global.site.showTaxSummary,this.isPreOrderBackOrderEnabled=this.contextData.global.preorderBackorderEnabled,h.profileType==c.PROFILE_TYPE_AGENT&&(this.agentCheckout=window.applicationContextPath+this.contextData.global.links.agentCheckout.route,this.agentMultiShipCheckout=window.applicationContextPath+this.contextData.global.links.agentMultiShipCheckout.route)},S.prototype.validateDynamicProperties=function(){for(var e=this,t=0;t<e.dynamicProperties().length;t++){var r=e.dynamicProperties()[t];if(!r.validateNow())return!1}return!0},S.prototype.updateDynamicProperties=function(e){var t=this;if(e.dynamicProperties&&t.dynamicProperties){for(var r=!1,i=0;i<e.dynamicProperties.length;i++){for(var a=!1,o=0;o<t.dynamicProperties().length;o++)if(e.dynamicProperties[i].id===t.dynamicProperties()[o].id()){t.dynamicProperties()[o].value(e.dynamicProperties[i].value),a=!0;break}if(!a){r=!0;var s=new p;s.id(e.dynamicProperties[i].id),s.value(e.dynamicProperties[i].value),t.dynamicProperties.push(s)}}if(h.profileType===c.PROFILE_TYPE_AGENT){var n=t.dynamicProperties.slice(0);t.dynamicProperties.removeAll(),t.dynamicProperties(n)}r&&t.getDynamicPropertiesMetadata(!1)}},S.prototype.updateItemDynamicProperties=function(t,r){if(r.dynamicProperties)for(var i=0;i<r.dynamicProperties.length;i++)t[r.dynamicProperties[i].id]=e.observable(r.dynamicProperties[i].value)},S.prototype.updateItemPriceOverrideFields=function(e,t){if(h.profileType==c.PROFILE_TYPE_AGENT){var r=this;"number"==typeof t.overriddenPrice&&t.overriddenPrice>=0?e.overriddenPrice(t.overriddenPrice):e.overriddenPrice(void 0),t.priceOverrideReason&&e.priceOverrideReason(t.priceOverrideReason.key),e.isPriceOverridden(t.isPriceOverridden),e.discountAmount(t.discountAmount),e.isPriceOverridden()&&!r.hasPriceOverriddenItem()&&r.hasPriceOverriddenItem(!0),void 0!==e.externalPrice()&&r.hasExternalPriceItem(!0)}},S.prototype.populateDynamicProperties=function(e){for(var t=this,r=0;r<t.dynamicProperties().length;r++){var i=t.dynamicProperties()[r],a=i.id(),o=i.value();e[a]=o}},S.prototype.getDynamicPropertiesMetadata=function(e){var t=this,r=!0;if(e){var i=null;try{i=t.getStorageItem("cartDynPropsMetadata"),i&&(i=JSON.parse(i),t.processDynamicPropertiesMetadata(i,!1),r=!1)}catch(e){}}if(r){var a={},o={};o[c.ENDPOINT_KEY]=c.ENDPOINT_METADATA_GET_METADATA,o[c.IDENTIFIER_KEY]="dynamicProperties";var s=t.storeConfiguration.getFilterToUse(o);s&&(a[c.FILTER_KEY]=s),h.profileType==c.PROFILE_TYPE_AGENT?t.adapter.loadJSON(c.ENDPOINT_GET_ITEM_TYPE,"order",a,function(e){e&&t.processDynamicPropertiesMetadata(e.specifications,!0)},function(e){}):t.adapter.loadJSON("dynamicProperties","order",a,function(e){e&&t.processDynamicPropertiesMetadata(e,!0)},function(e){})}},S.prototype.getItemDynamicPropertiesMetadata=function(e){var t=this;t.adapter.loadJSON(c.ENDPOINT_GET_ITEM_TYPE,e,null,function(r){r&&t.processItemDynamicPropertiesMetadata(r,e)},function(e){})},S.prototype.processDynamicPropertiesMetadata=function(e,t){for(var r=this,i=[],a=0;a<e.length;a++){for(var o=!0,s=0;s<r.dynamicProperties().length&&o;s++)e[a].id===r.dynamicProperties()[s].id()&&(o=!1,r.dynamicProperties()[s].initializeMetadata(e[a],!1));if(o){var n=new p;n.initializeMetadata(e[a],!0),i.push(n)}}for(var a=0;a<i.length;a++)r.dynamicProperties.push(i[a]);if(t)try{for(var c=new Array,a=0;a<r.dynamicProperties().length;a++)c.push(r.dynamicProperties()[a].getMetadata());var l=JSON.stringify(c);r.setStorageItem("cartDynPropsMetadata",l,10800)}catch(e){}},S.prototype.processItemDynamicPropertiesMetadata=function(e,t){var r=this,i=[];if(t==c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM){for(var a=0;a<e.specifications.length;a++){for(var o=!0,s=0;s<r.lineAttributes().length&&o;s++)e.specifications[a].id===r.lineAttributes()[s].id()&&(o=!1,r.lineAttributes()[s].initializeMetadata(e.specifications[a],!1));if(o){var n=new p;n.initializeMetadata(e.specifications[a],!0),i.push(n)}}for(var a=0;a<i.length;a++)r.lineAttributes.push(i[a])}},S.prototype.setStorageItem=function(e,t,r){void 0!==r&&null!==r||(r=3600);var i=new Date,a=Math.round(i.setSeconds(i.getSeconds()+r)/1e3);d.getInstance().setItem(e,t),d.getInstance().setItem(e+"_time",a)},S.prototype.getStorageItem=function(e){var t=new Date,r=Math.round(t/1e3),i=d.getInstance().getItem(e),a=d.getInstance().getItem(e+"_time");return void 0!==a&&null!==a||(a=0),a<r?(this.removeStorageItem(e),null):i},S.prototype.removeStorageItem=function(e){d.getInstance().removeItem(e),d.getInstance().removeItem(e+"_time")},S.prototype.setCallbackFunctions=function(e){var t=this;if(e&&Object.keys(e)&&Object.keys(e).length>0)for(var r in e)t.callbacks[r]=e[r]},S.prototype.generateCommerceItemId=function(){this.cmIdSequence||(this.cmIdSequence=1),Date.now||(Date.now=function(){return(new Date).getTime()});var e="ci"+Date.now()+Math.floor(1e5*Math.random())+this.cmIdSequence++;return e},S.prototype.createShippingGroups=function(t){var r,i=this,a=null;if(this.user().emailAddress()&&(a=this.user().emailAddress()),!this.user().loggedIn()&&this.emailAddressForGuestUser&&(a=this.emailAddressForGuestUser),t)for(var o=0;o<this.items().length;o++)this.items()[o].shippingGroupRelationships()&&1===this.items()[o].shippingGroupRelationships().length&&this.items()[o].shippingGroupRelationships()[0].quantity()!=this.items()[o].quantity()&&this.items()[o].shippingGroupRelationships()[0].quantity(this.items()[o].quantity());var s=0;if(this.isSplitShipping()||t){var l=this.items().reduce(function(t,r){if((i.isConfigurableItem(r)&&!r.commerceItemId||!r.commerceItemId&&i.lineAttributes&&e.isObservable(i.lineAttributes)&&i.lineAttributes().length>0||!r.commerceItemId&&r.productData()&&r.productData().addOnProducts&&r.productData().addOnProducts.length>0||!r.commerceItemId&&i.combineLineItems===c.COMBINE_NO)&&(r.commerceItemId=i.generateCommerceItemId()),r.shippingGroupRelationships())for(var o=0;o<r.shippingGroupRelationships().length;o++)r.shippingGroupRelationships()[o].commerceItemId=r.commerceItemId,!i.isSplitShipping()&&i.shippingAddress&&i.shippingAddress()&&r.shippingGroupRelationships()[o].shippingAddress(i.shippingAddress()),!i.isSplitShipping()&&i.shippingMethod&&i.shippingMethod()&&r.shippingGroupRelationships()[o].shippingMethod(i.shippingMethod()),r.childItems&&r.childItems.length>0&&(r.shippingGroupRelationships()[o].childItems=r.childItems);return r.shippingGroupRelationships().forEach(function(e){var r=e.asMap(a),i=Object.keys(r)[0],o=t[i],c=r[i];if(e.commerceItemId)var l=e.catRefId+"_"+e.commerceItemId;else var l=e.catRefId;var d=o?o.items[l]:void 0,u=c.items[l];o?e.shippingGroupId=o.shippingGroupId:(c.shippingGroupId=s.toString(),e.shippingGroupId=s.toString(),s++),d?d.quantity+=u.quantity:n.extend(!0,t,r)}),t},{});r=Object.keys(l).map(function(e){return l[e]}).filter(function(e){if(e.items=Object.keys(e.items).map(function(t){return e.items[t]}).filter(function(e){if(e.quantity>0)return e}),e.items.length)return e})}return r},S.prototype.associateShippingGroupsToItems=function(t,r,i){var a=this;if(t&&0!=t.length){for(var s=t.reduce(function(t,r){return r.items.forEach(function(i){var s="",l=new E(i,i.quantity);if(l.commerceItemId=i.commerceItemId,l.detailedItemPriceInfo&&l.detailedItemPriceInfo.length>0){var d=0;n.each(l.detailedItemPriceInfo,function(e,t){d+=t.amount}),l.price(d)}if(r.type==c.INSTORE_PICKUP)l.selectedStore({store:r.store,locationId:r.store.locationId}),l.isPickupInStore(!0),r.firstName&&l.firstName(r.firstName),r.lastName&&l.lastName(r.lastName),r.phoneNumber&&l.phoneNumber(r.phoneNumber),i.availablePickupDate&&l.availablePickupDate(i.availablePickupDate),i.preferredPickupDate&&l.preferredPickupDate(i.preferredPickupDate);else{if(r.shippingAddress){var u={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},p=a.contextData&&a.contextData.page&&a.contextData.page.shippingCountriesPriceListGroup?a.contextData.page.shippingCountriesPriceListGroup:[],h=a.contextData&&a.contextData.page&&a.contextData.page.defaultShippingCountry?a.contextData.page.defaultShippingCountry:"",f=new g("split-shipping-address","",u,p,h);f.copyFrom(r.shippingAddress,[]),f&&f.isValid()&&(l.shippingAddress(f),l.shippingMethod(r.shippingMethod))}l.isPickupInStore(!1)}if(l.addOnItem=!1,i.childItems&&i.childItems.length>0)for(var m=0;m<i.childItems.length;m++)if(i.childItems[m].addOnItem){l.addOnItem=!0;break}a.isConfigurableItem(i)||a.combineLineItems===c.COMBINE_NO?(s=l.hashCode(i.commerceItemId),t[s]=l):a.lineAttributes&&e.isObservable(a.lineAttributes)&&a.lineAttributes().length>0?(s=a.combineLineItems==c.COMBINE_YES?l.hashCode():l.hashCode(i.commerceItemId),t[s]=l):(s=l.hashCode(),t&&t[s]&&null!==t[s]&&t[s].quantity&&l.quantity(parseInt(l.quantity())+parseInt(t[s].quantity())),t[s]=l)}),t},{}),d={},u=0;u<a.items().length;u++){var p=!!(a.lineAttributes&&e.isObservable(a.lineAttributes)&&a.lineAttributes().length>0);if(a.isConfigurableItem(a.items()[u])||p){var h=[];if(a.isConfigurableItem(a.items()[u])){var f=0;h=Object.keys(s).reduce(function(e,t){if(s[t].productId==a.items()[u].productId&&s[t].catRefId==a.items()[u].catRefId&&s[t].commerceItemId==a.items()[u].commerceItemId){var r=s[t];r.sgID=a.items()[u].productId+a.items()[u].catRefId+t+f,f++,delete s[t],e.push(r)}return e},[])}else if(p){var f=0;h=Object.keys(s).reduce(function(e,t){if(s[t].productId==a.items()[u].productId&&s[t].catRefId==a.items()[u].catRefId&&(r&&!S.isHardRefresh&&a.combineLineItems===c.COMBINE_YES||(!r||S.isHardRefresh||a.combineLineItems===c.COMBINE_NO)&&s[t].commerceItemId==a.items()[u].commerceItemId)){
var i=s[t];i.sgID=a.items()[u].productId+a.items()[u].catRefId+a.items()[u].commerceItemId+f,f++,delete s[t],e.push(i)}return e},[])}if(S.isHardRefresh=!1,i){if(!a.items()[u].productData()||null===a.items()[u].productData()){a.items()[u].shippingGroupRelationships.removeAll();for(var m=0;m<h.length;m++)a.items()[u].shippingGroupRelationships.push(h[m]);a.items()[u].shippingGroupRelationships.valueHasMutated()}}else{for(var I=[],v=0;v<a.items()[u].shippingGroupRelationships().length;v++){var y=a.items()[u].shippingGroupRelationships()[v],b=a.combineLineItems==c.COMBINE_YES?y.hashCode():y.hashCode(a.items()[u].commerceItemId),T=a.items()[u].commerceItemId,P=!1;n.each(h,function(e,t){if(p&&(a.combineLineItems==c.COMBINE_YES&&t.hashCode()===b||a.combineLineItems==c.COMBINE_NO&&t.hashCode(T)===b)||!p&&t.hashCode()===b)return y.update(t,r),d[b]=y,P=!0,h.splice(e,1),!1}),P||r||(d[b]&&d[b].updatableQuantity(parseInt(d[b].updatableQuantity())+parseInt(y.quantity())),I.push(v))}if(I.length>0)for(var f=I.length-1;f>=0;f--)a.items()[u].shippingGroupRelationships.splice(I[f],1);a.items()[u].shippingGroupRelationships.valueHasMutated(),h.length>0&&n.each(h,function(e,t){a.items()[u].shippingGroupRelationships().push(t)}),(!a.items()[u].shippingGroupRelationships||a.items()[u].shippingGroupRelationships()&&0===a.items()[u].shippingGroupRelationships().length)&&a.items().splice(u,1)}}else if(!l.isPathEqualTo(a.checkoutLink)||l.isPathEqualTo(a.checkoutLink)&&r){var f=0,h=Object.keys(s).reduce(function(e,t){if(s[t].productId==a.items()[u].productId&&s[t].catRefId==a.items()[u].catRefId&&(!s[t].addOnItem&&a.combineLineItems===c.COMBINE_YES||!s[t].addOnItem&&a.combineLineItems===c.COMBINE_NO&&s[t].commerceItemId===a.items()[u].commerceItemId||s[t].addOnItem&&s[t].commerceItemId===a.items()[u].commerceItemId)){var r=s[t];r.sgID=a.items()[u].productId+a.items()[u].catRefId+f,f++,delete s[t],e.push(r)}return e},[]);if(i){if(!a.items()[u].productData()||null===a.items()[u].productData()){a.items()[u].shippingGroupRelationships.removeAll();for(var m=0;m<h.length;m++)a.items()[u].shippingGroupRelationships.push(h[m]);a.items()[u].shippingGroupRelationships.valueHasMutated()}}else{for(var I=[],v=0;v<a.items()[u].shippingGroupRelationships().length;v++){var y=a.items()[u].shippingGroupRelationships()[v],b=y.hashCode(),P=!1;n.each(h,function(e,t){if(t.hashCode()===b)return y.update(t,r),d[b]=y,P=!0,h.splice(e,1),!1}),P||r||(d[b]&&d[b].updatableQuantity(parseInt(d[b].updatableQuantity())+parseInt(y.quantity())),I.push(v))}if(I.length>0)for(var f=I.length-1;f>=0;f--)a.items()[u].shippingGroupRelationships.splice(I[f],1);a.items()[u].shippingGroupRelationships.valueHasMutated(),h.length>0&&n.each(h,function(e,t){a.items()[u].shippingGroupRelationships().push(t)}),(!a.items()[u].shippingGroupRelationships||a.items()[u].shippingGroupRelationships()&&0===a.items()[u].shippingGroupRelationships().length)&&a.items().splice(u,1)}}else{if(!r&&i)continue;for(var C=[],f=0,I=[],A=0;A<a.items()[u].shippingGroupRelationships().length;A++){var _=a.items()[u].shippingGroupRelationships()[A],O=_.hashCode();if(a.combineLineItems===c.COMBINE_NO&&(O=_.hashCode(_.commerceItemId)),C.length>0&&C.indexOf(O)!=-1)d[O]&&!r&&d[O].updatableQuantity(parseInt(d[O].updatableQuantity())+parseInt(_.quantity())),I.push(A);else{if(s&&s[O]){var R=s[O];_.update(R,r),d[O]=_,C.push(O),delete s[O]}else{var h=Object.keys(s).reduce(function(e,t){if(s[t].productId==a.items()[u].productId&&s[t].catRefId==a.items()[u].catRefId){var r=s[t];r.sgID=a.items()[u].productId+a.items()[u].catRefId+f,delete s[t],e.push(r)}return e},[]);a.items()[u].shippingGroupRelationships.remove(_);for(var m=0;m<h.length;m++)a.items()[u].shippingGroupRelationships.push(h[m])}f++}}if(I.length>0)for(var f=I.length-1;f>=0;f--)a.items()[u].shippingGroupRelationships.splice(I[f],1)}}return r?s:void 0}},S.prototype.splitItems=function(e,t,r){var i=this,a=!1;i.combineLineItems=c.COMBINE_NO,i.events.push(new M(W,11,e)),i.removeItem(e);for(var o=0;o<t.length;o++){var s={productId:e.productId,productData:e.productData(),quantity:t[o],catRefId:e.catRefId,selectedOptions:e.selectedOptions,currency:i.currency,externalData:e.externalData(),actionCode:e.actionCode(),lineAttributes:i.lineAttributes,externalRecurringCharge:e.externalRecurringCharge(),externalRecurringChargeFrequency:e.externalRecurringChargeFrequency(),externalRecurringChargeDuration:e.externalRecurringChargeDuration(),assetKey:e.assetKey(),rootAssetKey:e.rootAssetKey(),parentAssetKey:e.parentAssetKey(),serviceId:e.serviceId(),customerAccountId:e.customerAccountId(),billingAccountId:e.billingAccountId(),serviceAccountId:e.serviceAccountId(),billingProfileId:e.billingProfileId(),activationDate:e.activationDate(),deactivationDate:e.deactivationDate(),transactionDate:e.transactionDate(),asset:e.asset(),childItems:e.childItems,addOnItem:e.addOnItem,shopperInput:e.shopperInput,commerceItemId:i.generateCommerceItemId()},n=new I(s);n.populateItemDynamicProperties(r[o]),n.isPersonalized(!0),!a&&R(e.discountInfo())&&(n.giftWithPurchaseCommerceItemMarkers=e.giftWithPurchaseCommerceItemMarkers,a=!0),i.items.push(n)}i.getCartAvailability(),i.markDirty()},S.prototype.addItemToCart=function(t,r,i){function a(e,t,r){var i=[{errorCode:e,catRefId:t,errorMessage:r}];return i}function s(e,t){for(var r=[],a=0;a<t.length;a++){var o={errorCode:t[a].errorCode,catRefId:t[a].catRefId,errorMessage:t[a].errorMessage};r.push(o)}"function"==typeof i&&i(e,r)}var l=this,d=[];d.push(t.catalogRefId),l.isConfigurableItem(t)&&t.childItems&&t.childItems.length>0&&l.addSkuIdFromConfigurableProduct(d,t);var p=new Array(l.catalogId(),d,!1,u.getInstance().selectedPriceListGroup().id),h={},g={};g[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_SKUS,g[c.IDENTIFIER_KEY]="skuListing";var f=l.storeConfiguration.getFilterToUse(g);f&&(h[c.FILTER_KEY]=f),l.adapter.loadJSON("sku",p,h,function(i){for(var d,u=[],p=!0,h=i.items?i.items:i,g=0;g<h.length;g++)h[g].parentProducts[0]&&!h[g].parentProducts[0].active&&(u.push(h[g].repositoryId),p=!1);if(p){for(var g=0;g<h.length;g++){var f=n.extend(!0,{},h[g]);if(f.repositoryId==t.catalogRefId){d=f.parentProducts[0];var m=f;delete m[c.PARENT_PRODUCTS],d.childSKUs=[m],f.productVariantOptions&&f.productVariantOptions.length>0&&(d.selectedOptions=f.productVariantOptions[0]),d.orderQuantity=parseInt(t.quantity),d.itemTotal=t.amount,d.price=t.externalPrice,d.catalogRefId=t.catalogRefId,l.isConfigurableItem(t)&&void 0!=t.configuratorId&&null!=t.configuratorId&&""!=t.configuratorId&&(d.configuratorId=t.configuratorId),d.externalData=t.externalData,d.actionCode=t.actionCode,d.externalRecurringCharge=t.externalRecurringCharge,d.externalRecurringChargeFrequency=t.externalRecurringChargeFrequency,d.externalRecurringChargeDuration=t.externalRecurringChargeDuration,d.assetKey=t.assetKey,d.rootAssetKey=t.rootAssetKey,d.parentAssetKey=t.parentAssetKey,d.serviceId=t.serviceId,d.customerAccountId=t.customerAccountId,d.billingAccountId=t.billingAccountId,d.serviceAccountId=t.serviceAccountId,d.billingProfileId=t.billingProfileId,d.activationDate=t.activationDate,d.deactivationDate=t.deactivationDate,d.asset=t.asset,l.cpqConfigMap&&l.cpqConfigMap.size>0&&l.cpqConfigMap.get(t.catalogRefId)&&null!==l.cpqConfigMap.get(t.catalogRefId)&&(d.selectedStore=e.observable(l.cpqConfigMap.get(t.catalogRefId).selectedStore),l.cpqConfigMap.set(t.catalogRefId,null)),d.transactionDate=t.transactionDate;break}}l.isConfigurableItem(t)&&(d.childItems=l.createChildItemTree(h,t));var I=new w(d,l.catalogId()),E={};E[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_AVAILABILITY,E[c.IDENTIFIER_KEY]="stockStatsForItem";var v=l.storeConfiguration.getFilterToUse(E);v&&(I[c.FILTER_KEY]=v),null!==d.selectedStore&&e.isObservable(d.selectedStore)&&d.selectedStore()&&(I[c.LOCATION_IDS]=d.selectedStore().locationId),l.adapter.loadJSON("getStockStatuses","0",I,function(e){for(var i=[],n=!0,u=0;u<e.length;u++)"IN_STOCK"!=e[u].stockStatus&&"PREORDERABLE"!=e[u].stockStatus&&"BACKORDERABLE"!=e[u].stockStatus&&(i.push(e[u].catRefId),n=!1);if(n){var p=l.getCookieDataAndCompare(),h=l.getCartItemForReconfiguration(d.id,d.childSKUs[0].repositoryId,d.configuratorId);null!==h?l.events.push(new M($,1,d)):l.events.push(new M(k,1,d)),p&&!l.isMatchingCookieData()?(l.getLocalData(p),0==p.items.length&&l.addItem(d)):l.addItem(d);var g={pricingsuccess:function(e){g&&"function"==typeof r&&(r(d),g=null)},pricingfailure:function(e){g&&(s(t,a(c.PRODUCT_ADD_TO_CART_PRICING_ERROR,"",e.message)),g=null)}};l.setCallbackFunctions(g)}else{for(var f=[],u=0;u<i.length;u++){var m={sku:i[u]},I={errorCode:c.PRODUCT_ADD_TO_CART_OUT_OF_STOCK,catRefId:i[u],errorMessage:o.t("ns.common:resources.skuOutOfStockError",m)};f.push(I)}s(d,f)}},function(e){s(t,a(c.PRODUCT_ADD_TO_CART_INVENTORY_ERROR,"",e.message))})}else{for(var y=[],g=0;g<u.length;g++){var b={sku:u[g]},T={errorCode:c.CREATE_ORDER_SKU_NOT_FOUND,catRefId:u[g],errorMessage:o.t("ns.common:resources.skuNotFoundError",b)};y.push(T)}s(t,y)}},function(e){s(t,a(c.PRODUCT_ADD_TO_CART_GET_SKU_ERROR,"",e.message))})},S.prototype.getSkuDataBatch=function(e,t){var r=this,i=n.Deferred(),a={},o={};o[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_LIST_SKUS,o[c.IDENTIFIER_KEY]="skuListing";var s=r.storeConfiguration.getFilterToUse(o);return s&&(a[c.FILTER_KEY]=s),r.adapter.loadJSON("sku",e,a,function(e){i.resolve(e)},function(e){i.reject(t(c.PRODUCT_ADD_TO_CART_GET_SKU_ERROR,"",e.message))}),i},S.prototype.addItemsToCart=function(e,t,r,i,a){function s(e,t,r){var i=[{errorCode:e,catRefId:t,errorMessage:r}];return i}function l(e){for(var t=[],i=0;i<e.length;i++){var a={errorCode:e[i].errorCode,catRefId:e[i].catRefId,errorMessage:e[i].errorMessage};t.push(a)}"function"==typeof r&&r(t)}var d,u=this,p=[],g=e.length,f=new Array,m=new Array;m.deletedSkus=[],m.items=[];for(var I=0;I<g;I++)if(d=e[I],d.catalogRefId?p.push(d.catalogRefId):d.catRefId&&p.push(d.catRefId),d.childItems)for(var E=0;E<d.childItems.length;E++)d.childItems[E].catalogRefId?p.push(d.childItems[E].catalogRefId):d.childItems[E].catRefId&&p.push(d.childItems[E].catRefId);var v=[],y=u.getBatchSizeForProdAndSkuData(p);if(y<0&&(y=p.length),p.length>0){for(var I=0;I<p.length;I){for(var b={},E=0;E<y&&I<p.length;E++,I++)b[p[I]]=!0;var T=Object.keys(b),P=new Array(u.catalogId(),T,!0,u.priceListGroupId(),!0);f.push(u.getSkuDataBatch(P,s))}n.when.apply(null,f).done(function(){for(var r=0;r<arguments.length;r++){var d=arguments[r];m.deletedSkus=null!=d.deletedSkus?m.deletedSkus.concat(d.deletedSkus):m.deletedSkus,m.items=m.items.concat(d.items||d)}var p=function(r){var d,p=[],g=[],f=[],m=!0,I=!1,E=!1,y=r.items||r;if(r.deletedSkus&&r.deletedSkus.length>0)for(var b=[],T=0;T<r.deletedSkus.length;T++)for(var P=0;P<e.length;P++)e[P].catalogRefId!=r.deletedSkus[T]&&e[P].catRefId!=r.deletedSkus[T]||g.push({displayName:e[P].displayName||r.deletedSkus[T]});0==y.length&&l(s(c.NONE_OF_THE_ITEMS_ADDED,"",o.t("ns.common:resources.noneOfTheItemsCanBeAdded")));for(var S=0;S<y.length;S++)y[S].parentProducts[0]&&!y[S].parentProducts[0].active?(g.push({displayName:y[S].parentProducts[0].displayName,SKUId:y[S].repositoryId}),m=!1):y[S]&&y[S].parentProducts[0]&&y[S].parentProducts[0].notForIndividualSale&&(g.push({displayName:y[S].parentProducts[0].displayName}),E=!0),y[S]&&y[S].configurable&&(f.push(y[S]),I=!0);for(var C,A=e.length,S=0;S<y.length;S++)for(var _=0;_<A;_++){C=e[_];var O=n.extend(!0,{},y[S]),R=C.catalogRefId;if(R||(R=C.catRefId),!O.listPrice&&i){g.push({displayName:O.parentProducts[0].displayName});break}if(O.repositoryId==R&&(O.listPrice||!i)&&(d=O.parentProducts[0],d.active&&!d.notForIndividualSale)){var N=O;delete N[c.PARENT_PRODUCTS],d.childSKUs=[N],O.productVariantOptions&&O.productVariantOptions.length>0&&(d.selectedOptions=O.productVariantOptions[0]),d.orderQuantity=parseInt(C.orderQuantity),d.orderQuantity||(void 0!=C.quantityDesired?d.orderQuantity=parseInt(C.quantityDesired()):d.orderQuantity=parseInt(C.quantity)),d.itemTotal=C.amount,d.catalogRefId=C.catalogRefId,d.catalogRefId||(d.catalogRefId=C.catRefId),C.configurationId&&(d.configuratorId=C.configurationId),C.childItems&&(d.childItems=C.childItems),u.combineLineItems===c.COMBINE_NO&&C.commerceItemId&&(d.commerceItemId=u.generateCommerceItemId()),C.dynamicProperties&&(d.dynamicProperties=C.dynamicProperties),p.push(d)}}if(0==p.length)return void l(s(c.NONE_OF_THE_ITEMS_ADDED,"",o.t("ns.common:resources.noneOfTheItemsCanBeAdded")));var D=new U(p,u.catalogId()),L={};L[c.ENDPOINT_KEY]=c.ENDPOINT_PRODUCTS_AVAILABILITY,L[c.IDENTIFIER_KEY]="stockStatsForItem";var w=u.storeConfiguration.getFilterToUse(L);w&&(D[c.FILTER_KEY]=w);var k={},x=u.getThreshholdSizeForStockStatusData(D.products)<0?c.ENDPOINT_PRODUCTS_AVAILABILITY:c.ENDPOINT_LIST_STOCK_STATUS_LARGE_CART;if(k[c.PRODUCTS_PARAM]=D.products,k[c.CATALOG]=D.catalogId,h.request(x,k,function(e){for(var r=[],i=!0,n=0;n<e.length;n++)"IN_STOCK"!=e[n].stockStatus&&"PREORDERABLE"!=e[n].stockStatus&&"BACKORDERABLE"!=e[n].stockStatus&&(r.push(e[n]),i=!1);for(var n=0;n<p.length;n++)for(var d=0;d<r.length;d++){if(p[n].catalogRefId==r[d].catRefId){r[d].displayName=p[n].displayName,p.splice(n,1),n--;break}if(p[n].childItems&&p[n].childItems.length>0){for(var h=p[n].childItems.length-1;h>=0;h--)p[n].childItems[h].catRefId==r[d].catRefId&&(r[d].displayName=p[n].childItems[d].displayName,p[n].childItems.splice(h,1));if(p[n].childItems&&0==p[n].childItems.length){p.splice(n,1),n--;break}}}if(0==p.length)return void l(s(c.NONE_OF_THE_ITEMS_ADDED,"",o.t("ns.common:resources.noneOfTheItemsCanBeAdded")));var g={pricingsuccess:function(e){g&&"function"==typeof t&&(t(p),g=null)},pricingfailure:function(e){g&&(l(s(c.PRODUCT_ADD_TO_CART_PRICING_ERROR,"",e.message)),g=null)},addItemsSuccess:function(e){g&&"function"==typeof successCallbackWithoutPricing&&(a(p),g[c.ADD_ITEMS_SUCCESS_CB]=null)}};if(u.setCallbackFunctions(g),u.storeConfiguration.isLargeCart()===!0)u.addItems(p);else{var f=u.getCookieDataAndCompare();u.events.push(new M(Q,1,p)),f&&!u.isMatchingCookieData()?(u.getLocalData(f),0==f.items.length&&u.addItems(p)):u.addItems(p)}if(!i){for(var m=r[0].displayName,I=r[0].catRefId,n=1;n<r.length;n++)m=m+" ,"+r[n].displayName,I=I+","+r[n].catRefId;var E={displayName:m},y={errorCode:c.PRODUCT_ADD_TO_CART_OUT_OF_STOCK,catRefId:I,errorMessage:o.t("ns.common:resources.outOfStockError",E)};v.push(y),l(v)}},function(e){l(s(c.PRODUCT_ADD_TO_CART_INVENTORY_ERROR,"",e.message))}),g&&g.length>0){var G={};b=g[0].displayName;for(var F=g[0].SKUId,S=1;S<g.length;S++)b+=g[S].displayName,F=F+","+g[S].SKUId;var G={displayName:b},H={errorCode:c.CREATE_ORDER_SKU_NOT_FOUND,catRefId:F,errorMessage:o.t("ns.common:resources.productNotFoundError",G)};v.push(H)}if(I&&f[0].parentProducts&&f[0].parentProducts[0]){var V=f[0].repositoryId;b=f[0].parentProducts[0].displayName;for(var S=1;S<f.length;S++)b=b+","+f[S].parentProducts[0].displayName,V=f[S].repositoryId;var G={displayName:b},H={errorCode:c.CONFIGURABLE_PRODUCTS_NOT_ALLOWED_FAILURE_CODE,catRefId:V,errorMessage:o.t("ns.common:resources.configurableProductError",G)};v.push(H)}v.length>0&&l(v)};p(m)}).fail(function(){for(var e,t=0;t<arguments.length;t++)e=arguments[t];l(e)})}else l(s(c.NONE_OF_THE_ITEMS_ADDED,"",o.t("ns.common:resources.noneOfTheItemsCanBeAdded")))},S.prototype.requestQuote=function(e,t,r,i){var a=this,o={};e&&(o.note=e),t&&(o.orderId=t),t&&(o.id=t),"agentUI"===h.profileType&&(a.contextManager=require("agentViewModels/agent-context-manager").getInstance(),o.profileId=a.user().id().length>0?a.user().id():a.contextManager.getShopperProfileId()),a.adapter.persistCreate("requestQuote","0",a.addDynamicProperties(o),null,r,i)},S.prototype.rejectQuote=function(e,t,r,i){var a={};e&&(a.note=e),t&&(a.orderId=t),t&&(a.id=t),h.request(c.ENDPOINT_QUOTE_REJECT,a,r,i)},S.prototype.addDynamicProperties=function(e){for(var t=this,r=0;r<t.dynamicProperties().length;r++){var i=t.dynamicProperties()[r],a=i.id(),o=null;null!=i.value&&(o=i.value()),e[a]=o}return e},S.getInstance=function(e,t,r,i){return S.singleInstance||(S.isHardRefresh=!0,S.singleInstance=new S(e,t,i,r),S.singleInstance.isPricingRequired(!0),S.singleInstance.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM)),t&&t.items&&(S.singleInstance.updatedFromRepository=!0,S.singleInstance.getLocalData(t)),r&&S.singleInstance.setContext(r),S.singleInstance},S.prototype.loadTemplateOrderItems=function(e){var i=this;if(i.user()&&i.user().loggedIn()&&!i.user().isUserSessionExpired()){var a={},o={};o[c.ENDPOINT_KEY]=c.ENDPOINT_GET_ORDER,o[c.IDENTIFIER_KEY]="templateOrder";var s=i.storeConfiguration.getFilterToUse(o);s&&(a[c.FILTER_KEY]=s),h.request(c.ENDPOINT_GET_ORDER,a,function(e){var a=e.state;a==c.TEMPLATE||a==c.PENDING_APPROVAL_TEMPLATE||a==c.SCHEDULED_ORDER_STATE_REJECTED||a==c.PENDING_PAYMENT_TEMPLATE?(i.mergeItems(e),i.markDirty(),n.Topic(t.topicNames.LOADED_ORDER_SHIPPING_ADDRESS).publish(e.shippingAddress),n.Topic(t.topicNames.POPULATE_SHIPPING_METHODS).publish(e.shippingMethod.value),i.shippingMethod(e.shippingMethod.value),i.cartUpdated(),i.user().validateAndRedirectPage("/cart")):r.sendError("scheduledOrder","Invalid order state.",!0)},function(e){l.goTo(i.contextData.global.links[404].route)},e)}else l.doLogin(l.getPath(),i.contextData.global.links.home.route)},S.prototype.loadOrderItems=function(e){var r=this;r.mergeItems(e),r.getProductData(),n.Topic(t.topicNames.LOADED_ORDER_SHIPPING_ADDRESS).publish(e.shippingAddress),n.Topic(t.topicNames.POPULATE_SHIPPING_METHODS).publish(e.shippingMethod.value),r.shippingMethod(e.shippingMethod.value),r.user().validateAndRedirectPage("/cart")},S.prototype.getParticularIncompleteOrder=function(e){var r=this;r.user()&&!r.user().loggedinAtCheckout()&&h.request(c.ENDPOINT_GET_ORDER,null,function(e){if(void 0===e&&n.Topic(t.topicNames.CART_READY).publish(r),e&&e.orderId){r.user().orderId(e.orderId),r.user().persistedOrder(e),r.user().setLocalData("orderId"),r.cartName(e.cartName);r.removeItems(e);r.mergeItems(e),r.isPricingRequired(!0),r.validateServerCart(),r.getProductData(),r.getDynamicPropertiesMetadata(!0),r.getItemDynamicPropertiesMetadata(c.ENDPOINT_COMMERCE_ITEM_TYPE_PARAM),r.updateDynamicProperties(e),e.discountInfo.orderImplicitDiscountList&&r.orderDiscountDescList(e.discountInfo.orderImplicitDiscountList),e.discountInfo.unclaimedCouponsMap&&r.populateCoupons(e.discountInfo.unclaimedCouponsMap,c.COUPON_STATUS_UNCLAIMED),e.discountInfo.orderCouponsMap&&r.populateCoupons(e.discountInfo.orderCouponsMap,c.COUPON_STATUS_CLAIMED),r.couponMultiPromotions.splice(0),e.discountInfo.unclaimedCouponMultiPromotions&&r.populateCouponMultiPromotions(e.discountInfo.unclaimedCouponMultiPromotions,c.COUPON_STATUS_UNCLAIMED,c.PROMOTION_NOT_APPLIED),e.discountInfo.claimedCouponMultiPromotions&&r.populateCouponMultiPromotions(e.discountInfo.claimedCouponMultiPromotions,c.COUPON_STATUS_CLAIMED,c.PROMOTION_APPLIED),r.populateClaimedCouponMultiPromotions(r.couponMultiPromotions());for(var i=r.coupons().length-1;i>=0;i--)e.discountInfo.orderCouponsMap.hasOwnProperty(r.coupons()[i].code())||e.discountInfo.unclaimedCouponsMap.hasOwnProperty(r.coupons()[i].code())||r.coupons.splice(i,0);if(e.shippingGroups&&1==e.shippingGroups.length&&r.shippingAddress&&""==r.shippingAddress()&&!(r.user()&&r.user().shippingAddressBook()&&r.user().shippingAddressBook.length>0)){var a={translate:function(e,t){return o.t("ns.common:resources."+e,t)}},s=new g("cart-shipping-address","",a,r.contextData.page.shippingCountriesPriceListGroup,r.contextData.page.defaultShippingCountry);s.copyFrom(e.shippingGroups[0].shippingAddress,r.contextData.page.shippingCountriesPriceListGroup),s.resetModified(),s.validateForShippingMethod()&&(r.shippingAddress(s),r.shippingMethod(e.shippingGroups[0].shippingMethod.value),n.Topic(t.topicNames.CART_SHIPPING_ADDRESS_UPDATED).publishWith())}}},function(e){r.loadCart()},e)},S.prototype.loadCartWithParticularIncompleteOrder=function(e){var t=this;r.clearError(te);t.emptyCart(),t.createNewCart(!1),h.clearStoredValue(c.LOCAL_STORAGE_CREATE_NEW_CART),t.user()&&!t.user().loggedinAtCheckout()&&t.getParticularIncompleteOrder(e)},S.prototype.mergeCartWithParticularIncompleteOrder=function(e){var t=this;t.createNewCart(!1),h.clearStoredValue(c.LOCAL_STORAGE_CREATE_NEW_CART),r.clearError(te);t.user()&&!t.user().loggedinAtCheckout()&&t.getParticularIncompleteOrder(e)},S.prototype.deleteParticularIncompleteOrders=function(e){var r=this;h.request(c.ENDPOINT_REMOVE_PROFILE_INCOMPLETE_ORDER_BY_ID,null,function(i){r.user().orderId()&&""!=r.user().orderId()&&e==r.user().orderId()&&(r.emptyCart(),r.user().orderId(""),r.user().persistedOrder(null),r.user().setLocalData("orderId"),r.cartName(""),r.reloadCart()),n.Topic(t.topicNames.CART_DELETE_SUCCESS).publish()},function(e){n.Topic(t.topicNames.CART_DELETE_ERROR).publish()},e)},S.setApplication=function(e){ie=e},S.prototype.getBatchSizeForProdAndSkuData=function(e){var t=this;return null!=e?P.getEntityCountLimitInGetRequest(t.storeConfiguration.batchSizeForProdAndSkuData,e.length):-1},S.prototype.getThreshholdSizeForStockStatusData=function(e){var t=this;if(null!=e){var r=e.split(",");return P.getEntityCountLimitInGetRequest(t.storeConfiguration.threshholdSizeForStockStatusData,r.length)}return-1},S.prototype.priceCartBeforeRefreshInLargeCart=function(e){var t=this;t.events.push(new M(ee,0,e)),t.hardPricing=!0,t.markDirty()},S.prototype.updateItemPriceForLargeCart=function(e,t){var r=e.childSKUs[0].salePrice?e.childSKUs[0].salePrice:e.childSKUs[0].listPrice;t.itemTotal(t.itemTotal()+r*e.orderQuantity)},S.prototype.updateItemShippingGroupRelationShipForLargeCart=function(e,t){var r,i=t.shippingGroupRelationships().length,a=-1,o=!1;if(1==i)a=0,r=t.shippingGroupRelationships()[a];else for(var s=t.shippingGroupRelationships()[i-1],n=0;n<i-1;n++)if(t.shippingGroupRelationships()[n].hashCode()===s.hashCode()){t.shippingGroupRelationships().splice(-1),a=n,r=t.shippingGroupRelationships()[a],o=!0;break}if(r){var c=e.childSKUs[0].salePrice?e.childSKUs[0].salePrice:e.childSKUs[0].listPrice;void 0===r.price()&&r.price(0),r.price(r.price()+c*e.orderQuantity)}if(o){var l=t.shippingGroupRelationships()[a].quantity()+e.orderQuantity;r.quantity(l),r.updatableQuantity(l)}},S.prototype.updateCartItemDataForLargeCart=function(e){var t=this,r=e.childSKUs[0].salePrice?e.childSKUs[0].salePrice:e.childSKUs[0].listPrice;t.numberOfItems(t.numberOfItems()+e.orderQuantity),t.events=[],t.shippingSurcharge(t.shippingSurcharge()+e.shippingSurcharge),t.subTotal(r*e.orderQuantity+t.subTotal()),t.total(t.total()+r+e.shippingSurcharge),t.saveCartCookie()},S.prototype.updateCartAfterLoginForLargeCart=function(e){var t=this;t.numberOfItems(t.numberOfItems()+e.shoppingCart.numberOfItems),t.total(t.total()+e.priceInfo.amount),t.subTotal(t.subTotal()+e.priceInfo.subTotal),t.saveCartCookie()},S.prototype.updateCartItemsDataForLargeCart=function(e){var t,r=this,i=0,a=0,o=0;for(t=0;t<e.length;t++){var s=e[t].childSKUs[0].salePrice?e[t].childSKUs[0].salePrice:e[t].childSKUs[0].listPrice;i+=e[t].orderQuantity,a+=e[t].shippingSurcharge,o+=s*e[t].orderQuantity}r.numberOfItems(i+r.numberOfItems()),r.events=[],r.shippingSurcharge(r.shippingSurcharge()+a),r.subTotal(o+r.subTotal()),r.total(r.total()+o+a),r.saveCartCookie(),r.callbacks&&r.callbacks.hasOwnProperty(c.ADD_ITEMS_SUCCESS_CB)&&"function"==typeof r.callbacks[c.ADD_ITEMS_SUCCESS_CB]&&r.callbacks[c.ADD_ITEMS_SUCCESS_CB](e)},S}),define("viewModels/paymentDetails",["knockout","ccConstants","pubsub"],function(e,t,r){"use strict";function i(a,o){if(i.singleInstance)throw new Error("Cannot instantiate more than one PaymentDetails, use getInstance(pAdapter, data)");var s=this;return s.nameOnCard=e.observable(),s.cardType=e.observable(),s.cardNumber=e.observable(),s.cardCVV=e.observable(),s.endMonth=e.observable(),s.endYear=e.observable(),s.selectedCardType=e.observable(),s.selectedEndMonth=e.observable(),s.selectedEndYear=e.observable(),s.cardTypeList=e.observableArray(),s.cards=null,s.gateways=null,s.payULatamCountryList=null,s.enabledTypes=null,s.IINPromotionsEnabled=!0,s.monthList=e.observableArray(),s.endYearList=e.observableArray(),s.cardIINPattern=e.observable("[0-9]"),s.cardNumberLength=e.observable("16"),s.cvvLength=e.observable("3"),s.startDateRequired=e.observable(!1),s.endMonthPlaceholderText=e.observable(""),s.endYearPlaceholderText=e.observable(""),s.cardTypePlaceholderText=e.observable(""),s.isCardPaymentDisabled=e.observable(!1),s.isPaypalDisabled=e.observable(!1),s.isCardEnabledForScheduledOrder=e.observable(!1),s.isGiftCardEnabledForScheduledOrder=e.observable(!1),s.isInvoiceEnabledForScheduledOrder=e.observable(!1),s.isCashEnabledForScheduledOrder=e.observable(!1),s.isPayULEnabledForScheduledOrder=e.observable(!1),s.isPaypalEnabledForScheduledOrder=e.observable(!1),s.isCardEnabledForApproval=e.observable(!1),s.isGiftCardEnabledForApproval=e.observable(!1),s.isInvoiceEnabledForApproval=e.observable(!1),s.isCashEnabledForApproval=e.observable(!1),s.isPayULEnabledForApproval=e.observable(!1),s.isPaypalEnabledForApproval=e.observable(!1),s.isValid=function(){return s.nameOnCard.isValid()&&s.cardType.isValid()&&s.cardNumber.isValid()&&s.cardCVV.isValid()&&s.endMonth.isValid()&&s.endYear.isValid()},s.isModified=function(){return s.nameOnCard.isModified||s.cardType.isModified||s.cardNumber.isModified||s.cardCVV.isModified||s.endMonth.isModified||s.endYear.isModified?s.nameOnCard.isModified&&s.nameOnCard.isModified()||s.cardType.isModified&&s.cardType.isModified()||s.cardNumber.isModified&&s.cardNumber.isModified()||s.cardCVV.isModified&&s.cardCVV.isModified()||s.endMonth.isModified&&s.endMonth.isModified()||s.endYear.isModified&&s.endYear.isModified():!!(s.nameOnCard&&s.cardType&&s.cardNumber&&s.cardCVV&&s.endMonth&&s.endYear)},s.resetModified=function(){s.nameOnCard.isModified&&s.nameOnCard.isModified(!1),s.cardType.isModified&&s.cardType.isModified(!1),s.cardNumber.isModified&&s.cardNumber.isModified(!1),s.cardCVV.isModified&&s.cardCVV.isModified(!1),s.endMonth.isModified&&s.endMonth.isModified(!1),s.endYear.isModified&&s.endYear.isModified(!1)},s.validatePaymentDetails=function(){return s.nameOnCard.isModified(!0),s.cardType.isModified(!0),s.cardNumber.isModified(!0),s.cardCVV.isModified(!0),s.endMonth.isModified(!0),s.endYear.isModified(!0),s.isValid()},s.resetPaymentDetails=function(e){s.nameOnCard(null),s.selectedCardType(null),s.cardType(void 0),s.cardNumber(null),s.cardCVV(null),s.selectedEndMonth(void 0),s.selectedEndYear(void 0),s.endMonth(null),s.endYear(null),s.nameOnCard.isModified&&s.nameOnCard.isModified(!1),s.cardType.isModified&&s.cardType.isModified(!1),s.cardNumber.isModified&&s.cardNumber.isModified(!1),s.cardCVV.isModified&&s.cardCVV.isModified(!1),s.endMonth.isModified&&s.endMonth.isModified(!1),s.endYear.isModified&&s.endYear.isModified(!1)},s.resetCVV=function(){s.cardCVV.isModified&&s.cardCVV.isModified(!1),s.cardCVV("")},s.populatePaymentData=function(r,i){if(s.cardTypeList=e.observableArray(r.cards),s.cards=r.cards,s.gateways=r.gateways,s.payULatamCountryList=r.payULatamCountryList,s.cashPaymentCountryList=r.cashPaymentCountryList,s.enabledTypes=r.enabledTypes,s.IINPromotionsEnabled=r.IINPromotionsEnabled,i().isB2BUser()){var a=i().currentOrganization().derivedUseAllPaymentMethodsFromSite;if(void 0!=a&&a)s.enabledTypes=r.enabledTypes;else{for(var o=r.enabledTypes.length,n=i().currentOrganization().derivedPaymentMethods,c=[],l=0;l<o;l++)for(var d=0;d<n.length;d++)r.enabledTypes[l]==n[d]&&c.push(r.enabledTypes[l]);s.enabledTypes=c}}else s.enabledTypes=r.enabledTypes;s.enabledTypes&&s.enabledTypes.indexOf(t.CARD_PAYMENT_TYPE)<0&&s.isCardPaymentDisabled(!0),s.enabledTypes&&s.enabledTypes.indexOf(t.PAYPAL_PAYMENT_TYPE)<0?s.isPaypalDisabled(!0):s.isPaypalDisabled(!1);for(var l=0;l<r.scheduledOrderEnabledGateways.length;l++)r.scheduledOrderEnabledGateways[l]===t.CARD_PAYMENT_TYPE&&s.isCardEnabledForScheduledOrder(!0),r.scheduledOrderEnabledGateways[l]===t.GIFT_CARD_PAYMENT_TYPE&&s.isGiftCardEnabledForScheduledOrder(!0),r.scheduledOrderEnabledGateways[l]===t.INVOICE_PAYMENT_TYPE&&s.isInvoiceEnabledForScheduledOrder(!0),r.scheduledOrderEnabledGateways[l]===t.CASH_PAYMENT_TYPE&&s.isCashEnabledForScheduledOrder(!0),r.scheduledOrderEnabledGateways[l]===t.PAYULATAM_CHECKOUT_TYPE&&s.isPayULEnabledForScheduledOrder(!0),r.scheduledOrderEnabledGateways[l]===t.PAYPAL_PAYMENT_TYPE&&s.isPaypalEnabledForScheduledOrder(!0);for(var l=0;l<r.approvalEnabledGateways.length;l++)r.approvalEnabledGateways[l]===t.CARD_PAYMENT_TYPE&&s.isCardEnabledForApproval(!0),r.approvalEnabledGateways[l]===t.GIFT_CARD_PAYMENT_TYPE&&s.isGiftCardEnabledForApproval(!0),r.approvalEnabledGateways[l]===t.INVOICE_PAYMENT_TYPE&&s.isInvoiceEnabledForApproval(!0),r.approvalEnabledGateways[l]===t.CASH_PAYMENT_TYPE&&s.isCashEnabledForApproval(!0),r.approvalEnabledGateways[l]===t.PAYULATAM_CHECKOUT_TYPE&&s.isPayULEnabledForApproval(!0),r.approvalEnabledGateways[l]===t.PAYPAL_PAYMENT_TYPE&&s.isPaypalEnabledForApproval(!0)},s.createCustomProperties=function(t){var r={};for(var i in t)"string"==typeof t[i]&&(r[t[i]]="");s.customProperties=e.mapping.fromJS(r)},$.Topic(r.topicNames.ORDER_SUBMISSION_SUCCESS).subscribe(this.resetPaymentDetails),$.Topic(r.topicNames.USER_LOGOUT_SUBMIT).subscribe(this.resetPaymentDetails),$.Topic(r.topicNames.USER_SESSION_RESET).subscribe(this.resetPaymentDetails),$.Topic(r.topicNames.ORDER_SUBMISSION_FAIL).subscribe(this.resetCVV),s}return i.getInstance=function(e,t,r){return i.singleInstance||(i.singleInstance=new i(e,t)),t&&i.singleInstance.populatePaymentData(t,r),i.singleInstance},i}),define("viewModels/giftCardViewModel",["knockout","ccConstants","koValidate","ccKoValidateRules","storeKoExtensions","CCi18n","pageLayout/site","viewModels/paymentDetails"],function(e,t,r,i,a,o,s,n){"use strict";function c(){var r=this;if(r.giftCardNumber=e.observable(""),r.maskedGiftCardNumber=e.observable(""),r.giftCardPin=e.observable(""),r.amountInGiftCard=e.observable(""),r.paymentGroupId=e.observable(""),r.amountUsed=e.observable(0),r.isAmountRemaining=e.observable(!1),r.GIFTCARD_PIN_MAX_LENGTH=e.observable(4),r.GIFTCARD_NUMBER_MAX_LENGTH=e.observable(19),r.isPinCleared=e.observable(!1),r.isApplyGiftCardClicked=e.observable(!1),r.IS_GIFT_CARD_PIN_REQUIRED=e.observable(!0),r.triggerValidations=e.observable(!0),c.prototype.setGiftCardNumberMaxLength=function(e){if(e){var t=this;t.GIFTCARD_NUMBER_MAX_LENGTH(e),t.giftCardNumber.extend({validatable:!1}),t.giftCardNumber.extend({required:{params:!0,onlyIf:t.conditionsApply,message:o.t("ns.common:resources.giftCardNumberRequired",{})},maxLength:{params:t.GIFTCARD_NUMBER_MAX_LENGTH(),message:o.t("ns.common:resources.maxlengthValidationMsg",{maxLength:t.GIFTCARD_NUMBER_MAX_LENGTH(),fieldName:o.t("ns.common:resources.giftCardNumberText",{})})}})}},c.prototype.setGiftCardPinDetails=function(e,t){if(void 0!=e&&null!=e&&void 0!=t&&null!=t){var r=this;t<=0&&(e=!1,t=0),r.IS_GIFT_CARD_PIN_REQUIRED(e),r.GIFTCARD_PIN_MAX_LENGTH(t),r.giftCardPin.extend({validatable:!1}),r.giftCardPin.extend({required:{params:r.IS_GIFT_CARD_PIN_REQUIRED(),onlyIf:r.conditionsApply,message:o.t("ns.common:resources.giftCardPinRequired",{})},maxLength:{params:r.GIFTCARD_PIN_MAX_LENGTH(),message:o.t("ns.common:resources.maxlengthValidationMsg",{maxLength:r.GIFTCARD_PIN_MAX_LENGTH(),fieldName:o.t("ns.common:resources.giftCardPinText",{})})}})}},n.getInstance()&&n.getInstance().enabledTypes&&n.getInstance().enabledTypes.indexOf(t.GIFT_CARD_PAYMENT_TYPE)>-1){var i=s.getInstance();for(var a in i.extensionSiteSettings){var l=i.extensionSiteSettings[a];if(l[t.PAYMENT_METHOD_TYPES]&&l[t.PAYMENT_METHOD_TYPES].indexOf(t.GIFT_CARD_PAYMENT_TYPE)!=-1){void 0!=l.giftCardMaxLength&&r.GIFTCARD_NUMBER_MAX_LENGTH(l.giftCardMaxLength),void 0!=l.giftCardPinRequired&&void 0!=l.giftCardPinMaxLength&&(r.IS_GIFT_CARD_PIN_REQUIRED(l.giftCardPinRequired),r.GIFTCARD_PIN_MAX_LENGTH(l.giftCardPinMaxLength));break}}}r.setGiftCardNumberMaxLength(r.GIFTCARD_NUMBER_MAX_LENGTH()),
r.setGiftCardPinDetails(r.IS_GIFT_CARD_PIN_REQUIRED(),r.GIFTCARD_PIN_MAX_LENGTH()),r.isValid=function(){return r.giftCardNumber.isValid()&&r.giftCardPin.isValid()},r.conditionsApply=function(){return r.triggerValidations()},r.validateNow=function(){return r.giftCardNumber.isModified(!0),r.giftCardPin.isModified(!0),r.isValid()},r.reset=function(){r.giftCardNumber(""),r.maskedGiftCardNumber(""),r.giftCardPin(""),r.amountInGiftCard(""),r.amountUsed(0),r.giftCardNumber.isModified(!1),r.giftCardPin.isModified(!1),r.isApplyGiftCardClicked(!1)},r.clearPin=function(){r.giftCardPin("")},r.createCustomProperties=function(t){var i={};for(var a in t)"string"==typeof t[a]&&(i[t[a]]="");r.customProperties=e.mapping.fromJS(i)}}return c}),define("ccStoreServerLogger",["knockout","pubsub","jquery","ccRestClient","ccConstants","storageApi","pageViewTracker"],function(e,t,r,i,a,o,s){"use strict";function n(){if(n.singleInstance)throw new Error("Cannot instantiate more than one CCStoreServerLogger. Use getInstance() method");var e=this;e.loggingEnabled=!0;var l="",d="",u=[],p=[],h=["debug","info","warning","error"],g={getPage:"0001",paymentTimeOut:"0002",createOrderFailure:"0003",updateOrderFailure:"0004",paymentGroupFailure:"0005",orderSubmissionFailure:"0006"},f={getPage:"Landed on __pageId__ page",paymentTimeOut:"Unable to Authorize payment due to time-out, while placing order for order ID __orderId__",createOrderFailure:"Unable to create order due to error code __errorCode__",updateOrderFailure:"Unable to update the order with order ID __orderId__ due to error code __errorCode__",paymentGroupFailure:"Unable to place order for order ID __orderId__ as the payment state is found to be __paymentState__ for the payment group ID __paymentGroupId__",orderSubmissionFailure:"Order Submission Failed for order with order ID __orderId__"},m={error:"[ERROR]",warning:"[WARN]",info:"[INFO]",debug:"[DEBUG]"},I=function(e){try{o.getInstance().setItem("logLevel",e)}catch(e){}},E=function(){var e=null;try{e=o.getInstance().getItem("logLevel")}catch(e){}return e},v=function(e){var t=[];switch(e){case"debug":t.push("debug");case"info":t.push("info");case"warning":t.push("warning");case"error":t.push("error");break;default:t=u}return t};e.setDefaultLogLevel=function(){"info"!=l&&(l="info",u=v(l),I(l))},e.setLogLevel=function(e){h.indexOf(e.toLowerCase())>-1&&l!=e.toLowerCase()&&(l=e.toLowerCase(),u=v(l),I(e))},E()?(l=E().toLowerCase(),u=v(l)):e.setDefaultLogLevel();var y=function(e){try{o.getInstance().setItem("pageIdListToLog",e)}catch(e){}},b=function(){var e=null;try{e=o.getInstance().getItem("pageIdListToLog"),e=e.split(",")}catch(e){}return e};if(e.setPagesToLog=function(e){null!=e&&(p=e,y(p))},e.addPageIdToLog=function(e){p.indexOf(e)<0&&(p.push(e),y(p))},e.disablePageIdToLog=function(e){var t=this;null!=e&&p.indexOf(e)>-1&&(p.splice(p.indexOf(e),1),t.setPagesToLog(p))},b())p=b();else{var T=["checkout","payment","confirmation"];e.setPagesToLog(T)}var P=function(e,t){var r={},o=function(e){},s=function(e){};null!=t&&null!=e&&(r={logLevel:e,messages:t},i.request(a.ENDPOINT_LOGS_CREATE_LOG,r,o,s))},S=function(e,t,r){var i=m[r];if(null!=i){var a=s.getVisitorId(),o=s.getVisitId(),n=e+"-"+i+" "+t+", "+o+", "+a,c={LogData:n},l=[];l.push(c),P(r,l)}},C=function(e,t,r,i,a){a.loggingEnabled&&u.indexOf(t)>-1&&p.indexOf(d)>-1&&null!=r&&(null!=e&&""!=e||(e=c),null==i&&(i=g[e],null==i&&(i=e)),S(i,r,t))};e.logInfo=function(e,t,r){var i=this,a="info";C(e,a,t,r,i)},e.logWarning=function(e,t,r){var i=this,a="warning";C(e,a,t,r,i)},e.logDebug=function(e,t,r){var i=this,a="debug";C(e,a,t,r,i)},e.logError=function(e,t,r){var i=this,a="error";C(e,a,t,r,i)},e.getMessage=function(e,t){var r="";if(null!=e){var i=f[e];if(null!=i)for(var a=0;a<Object.keys(t).length;a++)r=Object.keys(t)[a],i=i.replace("__"+r+"__",t[r])}return i};var A=function(e,t){d=t.pageId};r.Topic(t.topicNames.PAGE_LAYOUT_LOADED).subscribe(A)}var c="UnstatedEvent";return n.getInstance=function(){return n.singleInstance||(n.singleInstance=new n),n.singleInstance},n}),define("viewModels/cashViewModel",["knockout","pageLayout/site","ccConstants","viewModels/paymentDetails"],function(e,t,r,i){"use strict";function a(){if(a.singleInstance)throw new Error("Cannot instantiate more than one cashViewModels, use getInstance()");var s=this;s.isPayingByCash=e.observable(!1),s.isCashPaymentEnabled=e.observable(!1),s.paymentDetails=i.getInstance(),s.setCashEnabledCountries=function(){for(var e in t.getInstance().extensionSiteSettings){var i=t.getInstance().extensionSiteSettings[e];i[r.PAYMENT_METHOD_TYPES]&&i[r.PAYMENT_METHOD_TYPES].split(",").indexOf(r.CASH_PAYMENT_TYPE)!=-1&&i[r.SELECTED_COUNTRIES]&&(o=i[r.SELECTED_COUNTRIES])}},s.verifyCashPaymentToBeEnabled=function(e){s.paymentDetails.enabledTypes.indexOf(r.CASH_PAYMENT_TYPE)!=-1&&o.indexOf(e)!=-1?s.isCashPaymentEnabled(!0):(s.isCashPaymentEnabled(!1),s.isPayingByCash(!1))},s.createCustomProperties=function(t){var r={};for(var i in t)"string"==typeof t[i]&&(r[t[i]]="");s.customProperties=e.mapping.fromJS(r)}}var o=[];return a.getInstance=function(){return a.singleInstance||(a.singleInstance=new a),a.singleInstance},a}),define("ccClientErrorCodes",[],function(){"use strict";function e(){}return e.SYNTAX_ERROR="15000",e.REFERENCE_ERROR="15001",e.TYPE_ERROR="15002",e.EVAL_ERROR="15003",e.RANGE_ERROR="15004",e.URI_ERROR="15005",e.GENERIC_ERROR="15006",e.NO_SPECIFIED_ERROR="15007",e.FILE_IS_NOT_AN_EXTENSION="15008",e}),define("sfExceptionHandler",["knockout","ccRestClient","ccConstants","ccClientErrorCodes","pubsub","pageViewTracker"],function(e,t,r,i,a,o){"use strict";function s(){}var n,c,l,d,u=[],p=0,h=10,g={},f=[],m="";return s.prototype.subscribe=function(){n=this,n.logWindowOnErrorBinding=n.logWindowOnError.bind(n),n.logExceptionErrorBinding=n.logExceptionError.bind(n),$.Topic(a.topicNames.EXCEPTION_HANDLER).subscribe(n.logExceptionErrorBinding),$.Topic(a.topicNames.ONERROR_EXCEPTION_HANDLER).subscribe(n.logWindowOnErrorBinding)},s.prototype.getErrorCode=function(e){return e?(e=e.toLowerCase(),l=e==="RangeError".toLowerCase()||e==="RangeError:".toLowerCase()?i.RANGE_ERROR:e==="TypeError".toLowerCase()||e==="TypeError:".toLowerCase()?i.TYPE_ERROR:e==="SyntaxError".toLowerCase()||e==="SyntaxError:".toLowerCase()?i.SYNTAX_ERROR:e==="ReferenceError".toLowerCase()||e==="ReferenceError:".toLowerCase()?i.REFERENCE_ERROR:e==="EvalError".toLowerCase()||e==="EvalError:".toLowerCase()?i.EVAL_ERROR:e==="URIError".toLowerCase()||e==="URIError:".toLowerCase()?i.URI_ERROR:i.GENERIC_ERROR):l=i.NO_SPECIFIED_ERROR,l},s.prototype.logExceptionError=function(e){n=this,n.errorCode=n.getErrorCode(e.name),n.errorUrl=location.href,n.errorLine="",n.errorMessage="";var t;for(t in e)"fileName"===t?n.errorUrl=e[t]:"lineNumber"===t&&(n.errorLine=e[t]);n.errorMessage=e.toString(),!n.errorLine&&e.line>0&&(n.errorLine=e.line),n.sendErrorReport(n.errorMessage,n.errorLine,n.errorUrl,n.errorCode)},s.prototype.logWindowOnError=function(e,t,r,i,a){n=this;var o,s,c,l=e.split(" ");for(s=0,c=l.length;s<c;s+=1)if(l[s].indexOf("Error")>=0){o=l[s];break}n.errorCode=n.getErrorCode(o),n.errorCode||(n.errorCode=" "),e?n.errorMessage=e:n.errorMessage=" ",t?n.errorUrl=t:n.errorUrl=" ",r?n.errorLine=r:n.errorLine=" ",i?n.errorCol=i:n.errorCol=" ",a&&(n.errorObj=a),n.sendErrorReport(n.errorMessage,n.errorLine,n.errorUrl,n.errorCode,n.errorCol,n.errorObj)},navigator.findBrowserVersion=function(){var e,t,r=navigator.appName,i=navigator.userAgent;return t=i.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),t&&null!==(e=i.match(/version\/([\.\d]+)/i))&&(t[2]=e[1]),t=t?[t[1],t[2]]:[r,navigator.appVersion,"-?"]}(),s.prototype.sendErrorReport=function(e,t,r,i,a,s){var n=o.getVisitorId(),l=o.getVisitId(),d=window.location.href,g=null;s&&(g=s.stack),"undefined"!=typeof e&&p<h&&(p+=1,c={message:e,url:r,browserURL:d,line:t,column:a,osVersion:window.navigator.platform,locale:window.navigator.language,browserVersion:navigator.findBrowserVersion[0]+" "+navigator.findBrowserVersion[1],time:(new Date).toISOString(),clientErrorCode:i,visitorId:n,visitId:l,stack:g},m=i+"#"+d+"#"+r+"#"+t+"#"+a,f.indexOf(m)<0&&(f.push(m),u.push(c),this.reportErrorsToServer()))},s.prototype.reportErrorsToServer=function(){u.length>0&&(d=r.ENDPOINT_ERRORLOGS_CREATE_ERRORLOG,g={},g={clientSideErrors:u},t.request(d,g,this.sendSuccess,this.sendError),u=[],p=0)},s.prototype.sendSuccess=function(e){},s.prototype.sendError=function(e){},s}),define("viewModels/cash",["knockout","ccConstants","koMapping"],function(e,t,r){"use strict";function i(){var i=this;i.paymentMethodType=t.CASH_PAYMENT_TYPE,i.type=t.CASH_PAYMENT_TYPE,i.amount=e.observable(),i.billingAddress=e.observable(void 0),i.seqNum=null,i.message=e.observable(),i.paymentGroupId=null,i.isEdit=e.observable(!1),i.createCustomProperties=function(t){var r={};for(var a in t)"string"==typeof t[a]&&(r[t[a]]="");i.customProperties=e.mapping.fromJS(r)},i.toJSON=function(){var e=r.defaultOptions().ignore;r.defaultOptions().ignore=["message","paymentGroupId","gatewayName","isAmountRemaining","paymentMethod","paymentState","uiIntervention","isEdit"];var t=r.toJS(i);return r.defaultOptions().ignore=e,t},i.resetPaymentDetails=function(){},i.validatePaymentData=function(){return!0}}return i}),define("viewModels/creditCard",["knockout","ccConstants","CCi18n","koMapping","ccStoreUtils","ccStoreConfiguration"],function(e,t,r,i,a,o){"use strict";function s(){var s=this;s.paymentMethodType=t.CARD_PAYMENT_TYPE,s.type=t.CARD_PAYMENT_TYPE,s.amount=e.observable(),s.billingAddress=e.observable(void 0),s.nameOnCard=e.observable(),s.cardType=e.observable(),s.cardNumber=e.observable(),s.cardCVV=e.observable(),s.expiryMonth=e.observable(),s.expiryYear=e.observable(),s.nickname=e.observable(),s.isSavedCard=e.observable(),s.saveCard=e.observable(),s.setAsDefault=e.observable(),s.endMonth=e.observable(),s.endYear=e.observable(),s.triggerValidations=e.observable(!0),s.seqNum=null,s.cardIINPattern=e.observable("[0-9]"),s.cardNumberLength=e.observable("16"),s.cvvLength=e.observable("3"),s.startDateRequired=e.observable(!1),s.message=e.observable(),s.maskedNumber=e.observable(),s.paymentGroupId=null,s.gatewayName=null,s.uiIntervention=null,s.isEdit=e.observable(!1),s.isCardPaymentDisabled=e.observable(!1),Object.defineProperty(s,"gatewayName",{value:null,enumerable:!1,writable:!0}),Object.defineProperty(s,"uiIntervention",{value:null,enumerable:!1,writable:!0}),s.createCustomProperties=function(t){var r={};for(var i in t)"string"==typeof t[i]&&(r[t[i]]="");s.customProperties=e.mapping.fromJS(r)},s.toJSON=function(){var e=i.defaultOptions().ignore,t=i.defaultOptions().include;i.defaultOptions().ignore=["cardIINPattern","cardNumberLength","cvvLength","startDateRequired","message","maskedNumber","paymentGroupId","gatewayName","uiIntervention","isAmountRemaining","paymentMethod","paymentState","isCardPaymentDisabled","triggerValidations","isEdit","isSavedCard","isDefault","repositoryId"],s.isSavedCard()&&(i.defaultOptions().include=["seqNum","amount","type"],n!=o.getInstance().isCVVRequiredForSavedCards()&&(n=o.getInstance().isCVVRequiredForSavedCards()),i.defaultOptions().ignore.push("nameOnCard","billingAddress","cardNumber","expiryMonth","expiryYear","iin","nickname","cardType","hasExpired"),null!=n&&0==n?s.cardCVV&&null!=s.cardCVV()?i.defaultOptions().include.push("cardCVV"):i.defaultOptions().ignore.push("cardCVV"):i.defaultOptions().include.push("cardCVV"));var r=i.toJS(s);return s.billingAddress()&&(delete r.billingAddress,r.billingAddress=s.billingAddress().toJSON()),i.defaultOptions().ignore=e,i.defaultOptions().include=t,r},s.setMaskedNumber=function(e,t){s.maskedNumber(s.cardNumber().replace(e,t))},s.conditionsApply=function(){return!s.isSavedCard()&&s.triggerValidations()&&s.paymentMethodType==t.CARD_PAYMENT_TYPE&&!s.isCardPaymentDisabled()},s.conditionsApplyForCVV=function(){return!(s.isSavedCard()&&!o.getInstance().isCVVRequiredForSavedCards())&&s.triggerValidations()&&s.paymentMethodType==t.CARD_PAYMENT_TYPE&&!s.isCardPaymentDisabled()},s.nameOnCard.extend({required:{params:!0,onlyIf:s.conditionsApply,message:r.t("ns.common:resources.nameOnCardRequired")}}),s.cardType.extend({required:{params:!0,onlyIf:s.conditionsApply,message:r.t("ns.common:resources.cardTypeRequired")}}),s.cardNumber.extend({required:{params:!0,onlyIf:s.conditionsApply,message:r.t("ns.common:resources.cardNumberRequired")},maxLength:{params:t.CYBERSOURCE_CARD_NUMBER_MAXIMUM_LENGTH,message:r.t("ns.common:resources.cardNumberMaxLength",{maxLength:t.CYBERSOURCE_CARD_NUMBER_MAXIMUM_LENGTH})},creditcard:{params:{iin:s.cardIINPattern,length:s.cardNumberLength},onlyIf:s.conditionsApply,message:r.t("ns.common:resources.cardNumberInvalid")}}),s.cardCVV.extend({required:{params:!0,onlyIf:s.conditionsApplyForCVV,message:r.t("ns.common:resources.cardCVVRequired")},minLength:{params:3,onlyIf:s.conditionsApplyForCVV,message:r.t("ns.common:resources.cardCVVNumberMinLength")},maxLength:{params:4,onlyIf:s.conditionsApplyForCVV,message:r.t("ns.common:resources.cardCVVNumberMaxLength")},number:{param:!0,message:r.t("ns.common:resources.cardCVVNumberInvalid")},cvv:{params:s.cvvLength,onlyIf:s.conditionsApplyForCVV,message:r.t("ns.common:resources.cardCVVInvalid")}}),s.expiryMonth.extend({required:{params:!0,onlyIf:s.conditionsApply,message:r.t("ns.common:resources.endMonthRequired")},endmonth:{params:s.expiryYear,message:r.t("ns.common:resources.endMonthInvalid")}}),s.expiryYear.extend({required:{params:!0,onlyIf:s.conditionsApply,message:r.t("ns.common:resources.endYearRequired")}}),s.resetPaymentDetails=function(e){s.nameOnCard(null),s.cardType(null),s.cardNumber(null),s.cardCVV(null),s.expiryMonth(null),s.expiryYear(null),s.nameOnCard.isModified&&s.nameOnCard.isModified(!1),s.cardType.isModified&&s.cardType.isModified(!1),s.cardNumber.isModified&&s.cardNumber.isModified(!1),s.cardCVV.isModified&&s.cardCVV.isModified(!1),s.expiryMonth.isModified&&s.expiryMonth.isModified(!1),s.expiryYear.isModified&&s.expiryYear.isModified(!1),s.isCardPaymentDisabled(!1),void 0!==e&&null!==e&&e!==!1||(s.nameOnCard.extend({validatable:!1}),s.cardType.extend({validatable:!1}),s.cardNumber.extend({validatable:!1}),s.cardCVV.extend({validatable:!1}),s.expiryMonth.extend({validatable:!1}),s.expiryYear.extend({validatable:!1}))},s.resetCardCvv=function(){s.cardCVV(void 0)},s.validatePaymentData=function(){return s.nameOnCard.isModified(!0),s.cardType.isModified(!0),s.cardNumber.isModified(!0),s.cardCVV.isModified(!0),s.expiryMonth.isModified(!0),s.expiryYear.isModified(!0),s.billingAddress()&&s.billingAddress().validateNow&&s.billingAddress().validateNow(),s.isValid()},s.isModified=function(){return s.nameOnCard.isModified()||s.cardType.isModified()||s.cardNumber.isModified()||s.cardCVV.isModified()||s.expiryMonth.isModified()||s.expiryYear.isModified()},s.resetModified=function(){s.nameOnCard.isModified(!1),s.cardType.isModified(!1),s.cardNumber.isModified(!1),s.cardCVV.isModified(!1),s.expiryMonth.isModified(!1),s.expiryYear.isModified(!1)},s.isValid=function(){var e=!0;return s.nameOnCard.isValid()&&s.cardType.isValid()&&s.cardNumber.isValid()&&s.cardCVV.isValid()&&s.expiryMonth.isValid()&&s.expiryYear.isValid()||(e=!1),s.billingAddress()&&s.billingAddress().isValid&&!s.billingAddress().isValid()&&(e=!1),e},s.populateData=function(e){var t=this,r=!1,i=[],o=[],s=[];a.fromJS(e,t,r,i,o,s)}}var n=o.getInstance().isCVVRequiredForSavedCards();return s}),define("viewModels/giftCard",["knockout","ccConstants","CCi18n","pageLayout/site","koMapping"],function(e,t,r,i,a){"use strict";function o(){var o=this;o.paymentMethodType=t.GIFT_CARD_PAYMENT_TYPE,o.type=t.GIFT_CARD_PAYMENT_TYPE,o.amount=e.observable(),o.amountInGiftCard=e.observable(),o.billingAddress=e.observable(void 0),o.giftCardNumberMaxLength=e.observable(19),o.giftCardPinMaxLength=e.observable(4),o.isGiftCardPinRequired=e.observable(!0),o.message=e.observable(),o.paymentGroupId=null,o.maskedNumber=e.observable(),o.isGiftCardReApplied=e.observable(!1),o.giftCardNumber=e.observable(),o.giftCardPin=e.observable(),o.isEdit=e.observable(!1),o.triggerValidations=e.observable(!0),o.seqNum=null;var s=i.getInstance();for(var n in s.extensionSiteSettings){var c=s.extensionSiteSettings[n];if(c[t.PAYMENT_METHOD_TYPES]&&c[t.PAYMENT_METHOD_TYPES].indexOf(t.GIFT_CARD_PAYMENT_TYPE)!=-1){void 0!=c.giftCardMaxLength&&o.giftCardNumberMaxLength(c.giftCardMaxLength),void 0!=c.giftCardPinRequired&&void 0!=c.giftCardPinMaxLength&&(o.isGiftCardPinRequired(c.giftCardPinRequired),o.giftCardPinMaxLength(c.giftCardPinMaxLength));break}}o.createCustomProperties=function(t){var r={};for(var i in t)"string"==typeof t[i]&&(r[t[i]]="");o.customProperties=e.mapping.fromJS(r)},o.toJSON=function(){var e=a.defaultOptions().ignore;a.defaultOptions().ignore=["giftCardNumberMaxLength","giftCardPinMaxLength","isGiftCardPinRequired","message","paymentGroupId","maskedNumber","balance","gatewayName","isAmountRemaining","maskedCardNumber","paymentMethod","paymentState","uiIntervention","isGiftCardReApplied","triggerValidations","isEdit"];var t=a.toJS(o);return a.defaultOptions().ignore=e,t},o.setMaskedNumber=function(e,t){o.maskedNumber(o.giftCardNumber().replace(e,t))},o.conditionsApply=function(){return o.triggerValidations()&&o.paymentMethodType==t.GIFT_CARD_PAYMENT_TYPE},o.giftCardNumber.extend({required:{params:!0,onlyIf:o.conditionsApply,message:r.t("ns.common:resources.giftCardNumberRequired",{})},maxLength:{params:o.giftCardNumberMaxLength(),message:r.t("ns.common:resources.maxlengthValidationMsg",{maxLength:o.giftCardNumberMaxLength(),fieldName:r.t("ns.common:resources.giftCardNumberText",{})})}}),o.giftCardPin.extend({required:{params:o.isGiftCardPinRequired(),onlyIf:o.conditionsApply,message:r.t("ns.common:resources.giftCardPinRequired",{})},maxLength:{params:o.giftCardPinMaxLength(),onlyIf:function(){return o.paymentMethodType==t.GIFT_CARD_PAYMENT_TYPE},message:r.t("ns.common:resources.maxlengthValidationMsg",{maxLength:o.giftCardPinMaxLength(),fieldName:r.t("ns.common:resources.giftCardPinText",{})})}}),o.resetPaymentDetails=function(){o.giftCardNumber(null),o.giftCardPin(null),o.giftCardNumber.isModified&&o.giftCardNumber.isModified(!1),o.giftCardNumber.extend({validatable:!1}),o.giftCardPin.isModified&&o.giftCardPin.isModified(!1),o.giftCardPin.extend({validatable:!1})},o.resetGiftCardPin=function(){o.giftCardPin(null)},o.validatePaymentData=function(){return o.giftCardNumber.isModified(!0),o.giftCardPin.isModified(!0),o.isValid()},o.isValid=function(){return o.giftCardNumber.isValid()&&o.giftCardPin.isValid()}}return o}),define("viewModels/invoice",["knockout","ccConstants","CCi18n","koMapping"],function(e,t,r,i){"use strict";function a(){var a=this;a.paymentMethodType=t.INVOICE_PAYMENT_TYPE,a.type=t.INVOICE_PAYMENT_TYPE,a.amount=e.observable(),a.billingAddress=e.observable(void 0),a.message=e.observable(),a.paymentGroupId=null,a.maskedNumber=e.observable(""),a.isEdit=e.observable(!1),a.PONumber=e.observable(),a.seqNum=null,a.PONumber.extend({maxLength:{params:t.PONUMBER_MAXIMUM_LENGTH,message:r.t("maxPOLengthValidationMsg",{maxLength:t.PONUMBER_MAXIMUM_LENGTH})}}),a.createCustomProperties=function(t){var r={};for(var i in t)"string"==typeof t[i]&&(r[t[i]]="");a.customProperties=e.mapping.fromJS(r)},a.toJSON=function(){var e=i.defaultOptions().ignore;i.defaultOptions().ignore=["message","paymentGroupId","maskedNumber","gatewayName","isAmountRemaining","paymentMethod","paymentState","uiIntervention","isEdit"];var t=i.toJS(a);return i.defaultOptions().ignore=e,a.billingAddress()&&(delete t.billingAddress,t.billingAddress=a.billingAddress().toJSON()),t},a.setMaskedNumber=function(e,t){a.PONumber()&&a.maskedNumber(a.PONumber().replace(e,t))},a.resetPaymentDetails=function(){a.PONumber(null),a.PONumber.isModified&&a.PONumber.isModified(!1),a.PONumber.extend({validatable:!1})},a.validatePaymentData=function(){return a.PONumber.isModified(!0),a.billingAddress()&&a.billingAddress().validateNow&&a.billingAddress().validateNow(),a.isValid()},a.isValid=function(){var e=!0;return a.PONumber.isValid()||(e=!1),a.billingAddress()&&a.billingAddress().isValid&&!a.billingAddress().isValid()&&(e=!1),e}}return a}),define("viewModels/paypal",["knockout","ccConstants","koMapping"],function(e,t,r){"use strict";function i(){var i=this;i.paymentMethodType=t.PAYPAL_PAYMENT_TYPE,i.type=t.PAYPAL_PAYMENT_TYPE,i.amount=e.observable(),i.billingAddress=e.observable(),i.seqNum=null,i.message=e.observable(),i.paymentGroupId=null,i.isEdit=e.observable(!1),i.createCustomProperties=function(t){var r={};for(var a in t)"string"==typeof t[a]&&(r[t[a]]="");i.customProperties=e.mapping.fromJS(r)},i.toJSON=function(){var e=r.defaultOptions().ignore;r.defaultOptions().ignore=["message","isEdit","seqNum"];var t=r.toJS(i);return r.defaultOptions().ignore=e,t},i.validatePaymentData=function(){return!0},i.updatePaymentData=function(e){i.paymentId=e[t.PAYMENT_ID],i.token=e[t.TOKEN],i.PayerID=e[t.PAYER_ID]},i.resetPaymentDetails=function(){}}return i}),define("viewModels/payu",["knockout","ccConstants","koMapping"],function(e,t,r){"use strict";function i(){var i=this;i.paymentMethodType=t.PAYULATAM_CHECKOUT_TYPE,i.type=t.PAYULATAM_CHECKOUT_TYPE,i.amount=e.observable(),i.billingAddress=e.observable(void 0),i[t.CURRENCY]=void 0,i[t.PAYMENT_ID]=void 0,i[t.TRANSACTION_STATUS]=void 0,i[t.TRANSACTION_TYPE]=void 0,i[t.SIGNATURE]=void 0,i.seqNum=null,i.message=e.observable(),i.paymentGroupId=null,i.isEdit=e.observable(!1),i.createCustomProperties=function(t){var r={};for(var a in t)"string"==typeof t[a]&&(r[t[a]]="");i.customProperties=e.mapping.fromJS(r)},i.toJSON=function(){var e=r.defaultOptions().ignore;r.defaultOptions().ignore=["message","isEdit"];var t=r.toJS(i);return i.billingAddress()&&(delete t.billingAddress,t.billingAddress=i.billingAddress().toJSON()),r.defaultOptions().ignore=e,t},i.validatePaymentData=function(){var e=!0;return i.billingAddress()&&i.billingAddress().isValid&&!i.billingAddress().isValid()&&(e=!1),e},i.updatePaymentDetails=function(e,r){i[t.CURRENCY]=e,i.amount(r)},i.resetPaymentDetails=function(){}}return i}),define("viewModels/loyalty",["knockout","ccConstants","CCi18n","koMapping"],function(e,t,r,i){"use strict";function a(){}return a}),define("viewModels/storeCredit",["knockout","ccConstants","CCi18n","koMapping"],function(e,t,r,i){"use strict";function a(){var r=this;r.paymentMethodType=t.STORE_CREDIT_PAYMENT_TYPE,r.type=t.STORE_CREDIT_PAYMENT_TYPE,r.amount=e.observable(),r.storeCreditNumber=e.observable(),r.triggerValidations=e.observable(!0),r.billingAddress=e.observable(void 0),r.storeCreditNumber.extend({required:!1}),r.isEdit=e.observable(!1),r.seqNum=null,r.message=e.observable(),r.paymentGroupId=null,r.gatewayName=null,r.uiIntervention=null,r.isStoreCreditPaymentDisabled=e.observable(!1),Object.defineProperty(r,"gatewayName",{value:null,enumerable:!1,writable:!0}),Object.defineProperty(r,"uiIntervention",{value:null,enumerable:!1,writable:!0}),r.isEdit=e.observable(!1),r.maskedNumber=e.observable(),r.createCustomProperties=function(t){var i={};for(var a in t)"string"==typeof t[a]&&(i[t[a]]="");r.customProperties=e.mapping.fromJS(i)},r.toJSON=function(){var e=i.defaultOptions().ignore;i.defaultOptions().ignore=["message","maskedNumber","paymentGroupId","gatewayName","uiIntervention","isAmountRemaining","paymentMethod","paymentState","isStoreCreditPaymentDisabled","triggerValidations"];var t=i.toJS(r);return i.defaultOptions().ignore=e,t},r.setMaskedNumber=function(e,t){r.storeCreditNumber()&&r.maskedNumber(r.storeCreditNumber().replace(e,t))},r.conditionsApply=function(){return r.triggerValidations()&&r.paymentMethodType==t.STORE_CREDIT_PAYMENT_TYPE&&!r.isStoreCreditPaymentDisabled()},r.resetPaymentDetails=function(){r.storeCreditNumber(null)},r.validatePaymentData=function(){return!r.storeCreditNumber()||(r.storeCreditNumber.isModified(!0),r.isValid())},r.isModified=function(){return r.storeCreditNumber.isModified()},r.resetModified=function(){r.storeCreditNumber.isModified(!1)},r.isValid=function(){return r.storeCreditNumber.isValid()}}return a}),define("viewModels/inStorePayment",["knockout","ccConstants","CCi18n","pageLayout/site","koMapping"],function(e,t,r,i,a){"use strict";function o(){var r=this;r.paymentMethodType=t.IN_STORE_PAYMENT_TYPE,r.type=t.IN_STORE_PAYMENT_TYPE,r.amount=e.observable(),r.seqNum=null,r.isEdit=e.observable(!1),r.message=e.observable(),r.createCustomProperties=function(t){var i={};for(var a in t)"string"==typeof t[a]&&(i[t[a]]="");r.customProperties=e.mapping.fromJS(i)},r.toJSON=function(){var e=a.defaultOptions().ignore;a.defaultOptions().ignore=["triggerValidations"];var t=a.toJS(r);return a.defaultOptions().ignore=e,t},r.resetPaymentDetails=function(){},r.validatePaymentData=function(){return!0}}return o}),define("viewModels/paymentsViewModel",["knockout","pubsub","ccConstants","ccRestClient","CCi18n","pageLayout/site","viewModels/cash","viewModels/creditCard","viewModels/giftCard","viewModels/invoice","viewModels/paypal","viewModels/payu","viewModels/loyalty","viewModels/storeCredit","navigation","pageLayout/order","ccStoreConfiguration","viewModels/inStorePayment","notifier"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I,E){"use strict";function v(){if(v.singleInstance)throw new Error("Cannot instantiate more than one PaymentsViewModel, use getInstance(data)");var f=this;return f.completedPayments=e.observableArray([]),f.pendingPayments=e.observableArray([]),f.failedPayments=e.observableArray([]),f.paymentDue=e.observable(),f.loyaltyPaymentDue=e.observable(),f.historicalCompletedPayments=e.observableArray([]),f.historicalCompletedLoyaltyPayments=e.observableArray([]),f.cashEnabledCountries=[],f.scheduleOrderEnabledGateways=[],f.approvalEnabledGateways=[],f.isCardGatewayGeneric=!1,f.paypalPaymentGroupId=e.observable(),f.isLoyaltyEnabled=e.observable(!1),f.isCardPaymentDisabled=e.observable(!1),f.isPaypalDisabled=e.observable(!1),f.isPaypalVerified=e.observable(!1),f.isStoreCreditEnabled=e.observable(!1),f.isInStorePaymentEnabled=e.observable(!1),f.isCashPaymentEnabled=e.observable(!1),f.isPayuLPaymentEnabled=e.observable(!1),f.isCVVRequiredForSavedCards=!0,f.allowSavingCards=!1,f.isCardEnabledForScheduledOrder=e.observable(!1),f.isGiftCardEnabledForScheduledOrder=e.observable(!1),f.isInvoiceEnabledForScheduledOrder=e.observable(!1),f.isCashEnabledForScheduledOrder=e.observable(!1),f.isPayULEnabledForScheduledOrder=e.observable(!1),f.isPaypalEnabledForScheduledOrder=e.observable(!1),f.isLoyaltyEnabledForScheduledOrder=e.observable(!1),f.isStoreCreditEnabledForScheduledOrder=e.observable(!1),f.isInStorePaymentEnabledForScheduledOrder=e.observable(!1),f.isCardEnabledForApproval=e.observable(!1),f.isGiftCardEnabledForApproval=e.observable(!1),f.isInvoiceEnabledForApproval=e.observable(!1),f.isCashEnabledForApproval=e.observable(!1),f.isPayULEnabledForApproval=e.observable(!1),f.isPaypalEnabledForApproval=e.observable(!1),f.isLoyaltyEnabledForApproval=e.observable(!1),f.isStoreCreditEnabledForApproval=e.observable(!1),f.isInStorePaymentEnabledForApproval=e.observable(!1),f.totalAmountAuthorized=e.observable(0),f.totalAmountAuthorizedOnVoid=e.observable(0),f.partialPaymentOption="",f.toBeVoidedPayments=e.observableArray([]),f.amountRemaining="",f.primaryCurrencyAmountRemaining="",f.primaryCurrencyTotalAmountAuthorized=e.observable(0),f.excludeFieldsMap=["amount","cardNumber","cardType","giftCardNumber","seqNum","customPaymentProperties"],f.setCashEnabledCountries=function(){for(var e in o.getInstance().extensionSiteSettings){var t=o.getInstance().extensionSiteSettings[e];t[r.PAYMENT_METHOD_TYPES]&&t[r.PAYMENT_METHOD_TYPES].split(",").indexOf(r.CASH_PAYMENT_TYPE)!=-1&&t[r.SELECTED_COUNTRIES]&&(f.cashEnabledCountries=t[r.SELECTED_COUNTRIES])}},f.populatePaymentData=function(t,i){if(f.cardTypeList=e.observableArray(t.cards),f.gateways=t.gateways,f.payULatamCountryList=t.payULatamCountryList,f.paymentMethods=e.observableArray(),i().isB2BUser()){var o=i().currentOrganization().derivedUseAllPaymentMethodsFromSite;if(void 0!=o&&o)f.enabledTypes=t.enabledTypes;else{for(var s=t.enabledTypes.length,n=i().currentOrganization().derivedPaymentMethods,c=[],l=0;l<s;l++)for(var d=0;d<n.length;d++)t.enabledTypes[l]==n[d]&&c.push(t.enabledTypes[l]);f.enabledTypes=c}}else f.enabledTypes=t.enabledTypes;f.enabledTypes&&f.enabledTypes.indexOf(r.CARD_PAYMENT_TYPE)<0&&f.isCardPaymentDisabled(!0),f.enabledTypes&&f.enabledTypes.indexOf(r.PAYPAL_PAYMENT_TYPE)<0?f.isPaypalDisabled(!0):f.isPaypalDisabled(!1),f.enabledTypes&&f.enabledTypes.indexOf(r.STORE_CREDIT_PAYMENT_TYPE)!=-1?f.isStoreCreditEnabled(!0):f.isStoreCreditEnabled(!1),f.enabledTypes&&f.enabledTypes.indexOf(r.IN_STORE_PAYMENT_TYPE)!=-1&&f.isInStorePaymentEnabled(!0),f.enabledTypes&&f.enabledTypes.indexOf(r.PAYULATAM_CHECKOUT_TYPE)!=-1&&f.isPayuLPaymentEnabled(!0),f.enabledTypes&&f.enabledTypes.indexOf(r.CASH_PAYMENT_TYPE)!=-1?f.isCashPaymentEnabled(!0):f.isCashPaymentEnabled(!1),f.setCashEnabledCountries(),f.scheduleOrderEnabledGateways=t.scheduledOrderEnabledGateways,f.approvalEnabledGateways=t.approvalEnabledGateways,f.isCardGatewayGeneric=t.isCardGatewayGeneric,f.isCVVRequiredForSavedCards=t.isCVVRequiredForSavedCards,m.getInstance().isCVVRequiredForSavedCards(null!=t.isCVVRequiredForSavedCards&&1==t.isCVVRequiredForSavedCards),f.allowSavingCards=t.allowSavingCards,m.getInstance().allowSavingCards(null!=t.allowSavingCards&&1==t.allowSavingCards);for(var l=0;l<t.scheduledOrderEnabledGateways.length;l++)t.scheduledOrderEnabledGateways[l]===r.CARD_PAYMENT_TYPE&&f.isCardEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.GIFT_CARD_PAYMENT_TYPE&&f.isGiftCardEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.INVOICE_PAYMENT_TYPE&&f.isInvoiceEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.CASH_PAYMENT_TYPE&&f.isCashEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.PAYULATAM_CHECKOUT_TYPE&&f.isPayULEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.PAYPAL_PAYMENT_TYPE&&f.isPaypalEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.LOYALTY_POINTS_PAYMENT_TYPE&&f.isLoyaltyEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.STORE_CREDIT_PAYMENT_TYPE&&f.isStoreCreditEnabledForScheduledOrder(!0),t.scheduledOrderEnabledGateways[l]===r.IN_STORE_PAYMENT_TYPE&&f.isInStorePaymentEnabledForScheduledOrder(!0);for(var l=0;l<t.approvalEnabledGateways.length;l++)t.approvalEnabledGateways[l]===r.CARD_PAYMENT_TYPE&&f.isCardEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.GIFT_CARD_PAYMENT_TYPE&&f.isGiftCardEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.INVOICE_PAYMENT_TYPE&&f.isInvoiceEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.CASH_PAYMENT_TYPE&&f.isCashEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.PAYULATAM_CHECKOUT_TYPE&&f.isPayULEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.PAYPAL_PAYMENT_TYPE&&f.isPaypalEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.LOYALTY_POINTS_PAYMENT_TYPE&&f.isLoyaltyEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.STORE_CREDIT_PAYMENT_TYPE&&f.isStoreCreditEnabledForApproval(!0),t.approvalEnabledGateways[l]===r.IN_STORE_PAYMENT_TYPE&&f.isInStorePaymentEnabledForApproval(!0);for(var l=0;l<f.enabledTypes.length;l++)f.enabledTypes[l]==r.CASH_PAYMENT_TYPE?f.paymentMethods().push({name:a.t("ns.common:resources.cashPaymentMethod"),value:f.enabledTypes[l]}):f.enabledTypes[l]==r.LOYALTY_POINTS_PAYMENT_TYPE?f.isLoyaltyEnabled(!0):f.paymentMethods().push({name:a.t("ns.common:resources."+f.enabledTypes[l]),value:f.enabledTypes[l]})},f.createPaymentAuthDetails=function(t,r,i,a,o){var s={};return s.emailAddress=t,s.billingAddress=r,s.paymentDetails=i,o.payments=[],o.payments.push(e.toJS(a)),s.orderDetails=o,s},f.createPaymentGroup=function(t){var i=null;switch(t){case r.CARD_PAYMENT_TYPE:i=new n;break;
case r.GIFT_CARD_PAYMENT_TYPE:i=new c;break;case r.CASH_PAYMENT_TYPE:i=new s;break;case r.INVOICE_PAYMENT_TYPE:i=new l;break;case r.PAYPAL_PAYMENT_TYPE:i=new d;break;case r.PAYULATAM_CHECKOUT_TYPE:i=new u;break;case r.LOYALTY_POINTS_PAYMENT_TYPE:i=new p;break;case r.STORE_CREDIT_PAYMENT_TYPE:i=new h;break;case r.IN_STORE_PAYMENT_TYPE:i=new I}return i.useDefaultBillingAddress=e.observable(!1),i.isDefaultAddressValid=e.observable(!0),i},f.processPayments=function(t,a,o,s,n,c,l){var d=this,u=null;u=l?l:d.pendingPayments();for(var p=0;p<u.length;p++)if(!u[p].validatePaymentData())return;var h={};o&&(h.orderId=o),s&&(h.uuid=s),n&&(h.profileId=n),c&&(h.channel=c);var g=[];l&&l.length>0?g=d.preparePaymentsRequest(l):d.pendingPayments()&&d.pendingPayments().length>0&&(g=d.preparePaymentsRequest(d.pendingPayments())),h.payments=g;var f=function(r){var i=[];i=l?l:d.pendingPayments();for(var a=0;a<r.paymentResponses.length;a++)for(var o=0;o<i.length;o++)if(r.paymentResponses[a].seqNum==i[o].seqNum){for(var s in r.paymentResponses[a])$.inArray(s,d.excludeFieldsMap)==-1&&(e.isObservable(i[o][s])?i[o][s](r.paymentResponses[a][s]):i[o][s]=r.paymentResponses[a][s]);break}t(r)};i.request(r.ADD_ORDER_PAYMENTS,h,f,a)},f.inquireBalance=function(e,t,a,o){var s={};s.op=r.INQUIRE_GIFT_CARD_BALANCE;var n=[];a&&a.length>0&&(n=f.preparePaymentsRequest(a)),s.payments=n,o&&(s[r.PROFILE_ID]=o),i.request(r.ADD_ORDER_PAYMENTS,s,e,t)},f.preparePaymentsRequest=function(e){for(var t=[],r=0;r<e.length;r++){e[r].seqNum=r.toString();var i={},a=null;a=e[r].toJSON&&$.isFunction(e[r].toJSON)?e[r].toJSON():e[r];for(var o in a)$.isFunction(a[o])||(i[o]=a[o]);t.push(i)}return t},f.resetPaymentsContainer=function(){f.isPaypalVerified()||(f.completedPayments([]),f.pendingPayments([]),f.failedPayments([]),f.historicalCompletedPayments([]),f.historicalCompletedLoyaltyPayments([]),f.toBeVoidedPayments([]),f.paymentDue(0),f.loyaltyPaymentDue(0))},f.populateViewModelWithServerData=function(e,t){if(t.paymentResponses&&t.paymentResponses.length>0)for(var r in t.paymentResponses[0])e[r]=t.paymentResponses[0][r]},f.hasSufficientPoints=function(e,t,r){var i=!1;if(e&&e.selectedProgramDetails()&&e.selectedProgramDetails().loyaltyPointDetails)for(var a=e.selectedProgramDetails().loyaltyPointDetails,o=0;o<a.length;o++)if(a[o].pointsType&&a[o].pointsType==t&&a[o].pointsBalance&&a[o].pointsBalance>=r){i=!0;break}return i},f.updatePaymentGatewayData=function(e){var t=e.parameters;if(t){for(var i=t.split("&"),a={},o=0;o<i.length;o++){var s=i[o].split("=");a[s[0]]=s[1]}if(a[r.PAYMENT_ID]&&a[r.TOKEN]&&a[r.PAYER_ID]){var n=f.createPaymentGroup(r.PAYPAL_PAYMENT_TYPE);n.updatePaymentData(a),f.isPaypalVerified(!0),f.pendingPayments().length>0?f.pendingPayments()[0].paymentMethodType==r.PAYPAL_PAYMENT_TYPE&&(f.pendingPayments()[0]=n):f.pendingPayments().unshift(n)}else if(t.indexOf(r.PAYU_REFERENCE_POL)!=-1){var c=a[r.PAYU_TRANSACTION_STATE];if(c==r.PAYU_TRANSACTION_APPROVED_CODE||c==r.PAYU_TRANSACTION_PENDING_CODE||c==r.PAYU_TRANSACTION_DECLINED_CODE||c==r.PAYU_TRANSACTION_EXPIRED_CODE||c==r.PAYU_TRANSACTION_ERROR_CODE){a[r.PAYU_REFERENCE_CODE],a[r.PAYU_TX_VALUE],a[r.CURRENCY],a[r.SIGNATURE]}}else f.isPaypalVerified(!1)}else f.isPaypalVerified()&&g.getPathWithoutLocale()!=f.checkoutLink&&(f.isPaypalVerified(!1),f.resetPaymentsContainer())},f.populateGiftCardsCallBack=function(e,t){if(f.pendingPayments().length>0)for(var i=0;i<f.pendingPayments().length;i++)if("physicalGiftCard"==f.pendingPayments()[i].paymentMethodType){var a={},o=f.pendingPayments()[i];a.type=r.GIFT_CARD_PAYMENT_TYPE,a.giftCardNumber=o.giftCardNumber(),a.giftCardPin=o.giftCardPin(),o.amountInGiftCard()&&(t&&t.type===y&&t.product.giftCardNumber()===o.giftCardNumber()||(a.amount=o.amountInGiftCard())),e.payments.push(a)}},f.updateGiftCardDetailsCallBack=function(e,t){var i=[];if(e.payments&&f.pendingPayments().length>0){for(var o=0;o<f.pendingPayments().length;o++){for(var s=!1,n=f.pendingPayments()[o],c=0;c<e.payments.length;c++){var l=e.payments[c];if(l.paymentMethod==r.GIFT_CARD_PAYMENT_TYPE&&n.giftCardNumber()==l.giftCardNumber){n.amountInGiftCard(l.balance),n.amount(l.amount),n.maskedNumber(l.maskedCardNumber),s=!0;break}}0==s&&i.push(n)}for(var d=0;d<i.length;d++)f.pendingPayments.remove(function(e){return e.giftCardNumber()==i[d].giftCardNumber()});i&&i.length>0&&E.sendError(b,a.t("ns.common:resources.orderPricingPromotionError"),!0)}},f.retrieveStoreCreditBalance=function(e,t,a){var o=this,s={};i.request(r.ENDPOINT_PAYMENT_GET_GATEWAYS,s,function(i){for(var s=i.paymentGateways,n=0;n<s.length;n++)if(s[n].enabled&&s[n].type===r.GENERIC_PAYMENT_GATEWAY){var c=s[n].agentConfigEnabledTypes||[];if(0==c.length)continue;for(var l=0;l<c.length;l++)if(c[l]===r.STORE_CREDIT_PAYMENT_TYPE){var d=[];d.push({paymentMethodType:r.STORE_CREDIT_PAYMENT_TYPE}),o.inquireBalance(e,t,d,a)}}},function(e){})},f.resetAmountAuthorized=function(){f.totalAmountAuthorized(0),f.primaryCurrencyTotalAmountAuthorized(0),f.totalAmountAuthorizedOnVoid(0)},f.isPaymentAuthorized=function(e){return e==r.PAYMENT_STATE_AUTHORIZED||e==r.PAYMENT_GROUP_STATE_AUTHORIZED||e==r.PAYMENT_STATE_SETTLED||e==r.PAYMENT_GROUP_STATE_SETTLED||e==r.PAYMENT_STATE_PAYMENT_REQUEST_ACCEPTED||e==r.PAYMENT_GROUP_STATE_PAYMENT_REQUEST_ACCEPTED||e==r.PAYMENT_STATE_PAYMENT_DEFERRED||e==r.PAYMENT_GROUP_PAYMENT_DEFERRED},f.isVoidInitiatedForPaymentGroup=function(e){var t=!1;return e.transactionTypeInitiated&&"void"==e.transactionTypeInitiated&&(t=!0),t},f.voidAuthorizedPayment=function(e,t,r,a,o){var s=this,n=[],c={};s.removablePaymentGroup=e.array[e.index],s.removabelPaymentIndex=e.index,c.paymentGroupId=e.array[e.index].paymentGroupId,c.cancelReason=t,n.push(c);var l={},d="voidPayments";l.orderId=r,l.payments=n,i.request(d,l,function(e){a(e)},function(e){o(e)})},f.populateCompletedPayments=function(e){for(var t=this,r=e.length,i=0;i<r;i++){var a=t.isVoidInitiatedForPaymentGroup(e[i]);t.isPaymentAuthorized(e[i].paymentState)&&!a&&t.completedPayments.push(e[i])}},f.voidPaymentsInAmendment=function(e,t,r){var i=this,a=i.getDeferredVoidPaymentResponse(e);a.done(function(r){t(r,e)}),a.fail(function(e){r(e)})},f.getDeferredVoidPaymentResponse=function(e){var t=this,a={};a[r.ORDER_ID]=e,a[r.PAYMENTS]=t.toBeVoidedPayments();var o=$.Deferred();return i.request(r.END_POINT_VOID_PAYMENTS,a,function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise()},f.clearAuthorizedPayments=function(){var e=this;e.completedPayments.removeAll()},i.profileType!==r.PROFILE_TYPE_AGENT&&$.Topic(t.topicNames.PAGE_CHANGED).subscribe(f.updatePaymentGatewayData.bind(f)),f}var y=8,b="PaymentsViewModel";return v.getInstance=function(e,t){return v.singleInstance||(v.singleInstance=new v),e&&v.singleInstance.populatePaymentData(e,t),v.singleInstance},v}),define("pageLayout/order",["knockout","pubsub","notifier","CCi18n","ccLogger","ccRestClient","ccConstants","jquery","navigation","spinner","viewModels/address","viewModels/paymentDetails","viewModels/giftCardViewModel","storageApi","viewModels/dynamicProperty","ccStoreServerLogger","viewModels/cashViewModel","pageViewTracker","sfExceptionHandler","ccStoreConfiguration","viewModels/paymentsViewModel","pageLayout/site","currencyHelper"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I,E,v,y,b,T){"use strict";function P(a,l,p,h){if(P.prototype.singleInstance)throw new Error("Cannot instantiate more than one OrderViewModel, use OrderViewModel.getInstance(pAdapter, pCart, pData)");var g=this;return o.profileType==s.PROFILE_TYPE_AGENT&&(g.agentConfiguration=require("agentViewModels/agentConfiguration"),g.contextManager=require("agentViewModels/agent-context-manager")),g.cloneOrderData=e.observable(""),g.adapter=a,g.cart=l,g.restClient=o,g.schedule=e.observable(),g.showSchedule=e.observable(!1),g.id=e.observable(),g.billingAddress=e.observable(),g.shippingAddress=e.observable(),g.shippingAddressAsBilling=e.observable(!1),g.paymentDetails=e.observable(u.getInstance()),g.paymentsViewModel=e.observable(y.getInstance()),g.emailAddress=e.observable(),g.order=e.observable(),g.orderProfileId=e.observable(),g.paymentGateway=e.observable(),g.selectedShippingOption=e.observable(),g.isPaypalVerified=e.observable(!1),g.isPayULatamCheckout=e.observable(!1),g.op=e.observable(),g.giftCards=e.observableArray([]),g.amountRemaining=e.observable(),g.amountRemaining(null),g.isCashPayment=e.observable(!1),g.cashModel=e.observable(m.getInstance()),g.cashModel().isPayingByCash(g.isCashPayment()),g.isInvoicePayment=e.observable(!1),g.isPayLater=e.observable(!1),g.poNumber=e.observable(),g.isOrderValid=e.observable(!1),g.isSplitPayment=e.observable(!1),g.isShippingAddressModified=!1,g.isBillingAddressModified=!1,g.isInStorePayment=!1,g.enableOrderButton=e.observable(!0),g.isOrderLocked=!1,g.isOrderEditable=e.observable(!0),g.isOrderSubmitted=!1,g.checkoutGuest=e.observable(s.GUEST),g.checkoutLogin=e.observable(s.LOGIN),g.checkoutOption=e.observable(s.GUEST).extend({throttle:400}),g.guestEmailAddress=e.observable(""),g.createAccount=e.observable(!1),g.user=h,g.registerUser=!1,g.webCheckoutShippingMethodValue=null,g.storeServerLog=f.getInstance(),g.exceptionHandler=new E,g.loadedOrderShippingAddress=null,g.isPaymentDisabled=function(){var e=g.cart().getDerivedTotal(g.cart().secondaryCurrencyTotal(),g.cart().total());return 0==e},g.payments=e.observableArray([]),g.approvalRequired=e.observable(!1),g.isAutherizeCalled=!1,g.validationCallbacks=[],g.fields=null,g.storeConfiguration=v.getInstance(),g.isCashPayment.subscribe(function(e){g.cashModel().isPayingByCash(e)}),g.registerSplitPaymentCallbacks=function(e,t,r,i,a){g.createOrderSuccessHandler=e,g.createOrderFailureHandler=t,g.validateSplitPaymentsHandler=r,g.invokePaymentsAPIHandler=i,g.validateSplitPaymentsBillingAddresses=a},g.registerPendingPaymentCallback=function(e){g.pendingPaymentOrderHandler=e},g.validOrderQuantityMap={},g.guestEmailAddress.subscribe(function(e){g.guestEmailAddress.isValid()?g.cart().emailAddressForGuestUser=g.guestEmailAddress():g.cart().emailAddressForGuestUser=""}),g.registerPointsPaymentCallbacks=function(e){g.validatePointsPaymentHandler=e},g.registerUpdateShippingAddressDynamicPropertiesCallback=function(e){g.addDynamicPropertiesToAddressHandler=e},g.updateBillingAddress=function(){g.billingAddress(this)},g.preparePayULatamDataForCreateOrder=function(e){g.paymentGateway(new D(e,g.cart().total(),g.cart().currency.currencyCode))},g.updateShippingAddress=function(){g.shippingAddress(this);var e={};e[s.SHIPPING_ADDRESS_FOR_METHODS]=g.shippingAddress(),e[s.PRODUCT_IDS_FOR_SHIPPING]=l().getProductIdsForItemsInCart(),l().updateShippingAddress.bind(e)()},g.updatePaypalPaymentType=function(e){var t;g.paymentGateway()&&g.paymentGateway().type===e&&g.paymentGateway().customProperties&&(t=g.paymentGateway().customProperties),g.paymentGateway(new N(e)),t&&(g.paymentGateway().customProperties=t)},g.updateShippingMethod=function(){if(this&&this.repositoryId){var e={};e.value=this.repositoryId,e.shippingOption=this,g.selectedShippingOption(e)}else g.selectedShippingOption("")},g.updateEmail=function(){g.emailAddress(this)},g.resetAddress=function(){g.billingAddress()&&g.billingAddress().reset(),g.shippingAddress()&&g.shippingAddress().reset()},g.resetOrderId=function(){g.id("")},g.updatePaymentDetails=function(){var e=this;if(g.paymentDetails&&g.paymentDetails())for(var t in e)g.paymentDetails()[t]&&g.paymentDetails()[t](e[t]);else g.paymentDetails(e)},g.updatePaymentGatewayData=function(e){var t=e.parameters;if(t){for(var r=t.split("&"),i={},a=0;a<r.length;a++){var o=r[a].split("=");i[o[0]]=o[1]}if(i[s.PAYMENT_ID]&&i[s.TOKEN]&&i[s.PAYER_ID])g.paymentGateway(new N(s.PAYPAL_CHECKOUT_TYPE,i[s.PAYMENT_ID],i[s.TOKEN],i[s.PAYER_ID])),g.isPaypalVerified(!0);else if(t.indexOf(s.PAYU_REFERENCE_POL)!=-1){g.createSpinner();var n=i[s.PAYU_TRANSACTION_STATE];if(n==s.PAYU_TRANSACTION_APPROVED_CODE||n==s.PAYU_TRANSACTION_PENDING_CODE||n==s.PAYU_TRANSACTION_DECLINED_CODE||n==s.PAYU_TRANSACTION_EXPIRED_CODE||n==s.PAYU_TRANSACTION_ERROR_CODE){var l=i[s.PAYU_REFERENCE_CODE],d=i[s.PAYU_TX_VALUE],u=i[s.CURRENCY],p=i[s.SIGNATURE];g.paymentGateway(new D(s.PAYULATAM_CHECKOUT_TYPE,d,u,l,n,s.PAYULATAM_RESPONSE_TYPE,p)),g.getOrder()}}else g.clearPaypalData()}else g.isPaypalVerified()&&c.getPathWithoutLocale()!=g.checkoutLink&&g.clearPaypalData()},g.loadOrderForSubmit=function(e){var a=this;if(e.pageId==s.PAGE_TYPE_CHECKOUT&&a.user()&&a.user().loggedIn()&&!a.user().isUserSessionExpired()&&a.cart().currentOrderId()||(e.pageId==s.PAGE_TYPE_AGENT_CHECKOUT||e.pageId==s.PAGE_TYPE_AGENT_MULTISHIP_CHECKOUT||e.pageId==s.AGENT_ORDER_DETAILS_PAGE_TYPE)&&a.cart().currentOrderId()){var e=(e.pageId,{}),u={};u[s.ENDPOINT_KEY]=s.ENDPOINT_GET_ORDER,u[s.IDENTIFIER_KEY]="orderForSubmit";var p=a.storeConfiguration.getFilterToUse(u);p&&(e[s.FILTER_KEY]=p),e[s.INCLUDE_RESULT]="full",o.request(s.ENDPOINT_GET_ORDER,e,function(e){var u=e.hasOwnProperty("stateString")?e.stateString:e.state;if(u==s.QUOTED_STATES||u==s.INCOMPLETE)a.cart().loadOrderForProfile(e,a.user),n.Topic(t.topicNames.LOADED_ORDER_SHIPPING_ADDRESS).publish(e.shippingAddress),o.profileType==s.PROFILE_TYPE_AGENT?a.shippingAddress&&a.shippingAddress()&&a.shippingAddress().validateForShippingMethod()&&(a.cart().shippingAddress(a.shippingAddress()),a.cart().shippingMethod(e.shippingMethod.value),a.cart().populateShipppingMethods()):a.cart().shippingMethod(e.shippingMethod.value),a.user().orderId(a.cart().currentOrderId()),a.user().setLocalData("orderId");else if(u==s.PENDING_PAYMENTS||u==s.PENDING_PAYMENT_TEMPLATE){if(a.isOrderEditable(!1),a.cart().loadOrderForProfile(e,a.user),o.profileType==s.PROFILE_TYPE_AGENT&&(a.isAnonymousCheckout=!!e.profile.isAnonymous,a.populatePaymentsViewModel(e),a.pendingPaymentOrderHandler&&n.isFunction(a.pendingPaymentOrderHandler)&&a.pendingPaymentOrderHandler()),e.shippingGroups[0].type==s.HARDGOOD_SHIPPING_GROUP_TYPE){var p={translate:function(e,t){return i.t("ns.common:resources."+e,t)}},h=new d("cart-shipping-address","",p,a.contextData.page.shippingCountriesPriceListGroup,a.contextData.page.defaultShippingCountry);h.copyFrom(e.shippingGroups[0].shippingAddress,a.contextData.page.shippingCountriesPriceListGroup),h.resetModified(),n.Topic(t.topicNames.CHECKOUT_SHIPPING_ADDRESS).publishWith(h,[{message:"success"}]);var g={};g[s.SHIPPING_ADDRESS_FOR_METHODS]=a.shippingAddress(),g[s.PRODUCT_IDS_FOR_SHIPPING]=l().getProductIdsForItemsInCart(),n.Topic(t.topicNames.VERIFY_SHIPPING_METHODS).publishWith(g,[{message:"success"}]),a.cart().shippingMethod(e.shippingMethod.value)}n.Topic(t.topicNames.LOADED_ORDER_SHIPPING_ADDRESS).publish(e.shippingAddress),a.loadedOrderShippingAddress=e.shippingAddress;var f=a.cart().getDerivedTotal(e.priceInfo.secondaryCurrencyTotal,e.priceInfo.total);a.amountRemaining(f),n.Topic(t.topicNames.CART_UPDATED_PENDING_PAYMENT).publish(a),e.scheduledOrder&&e.scheduledOrder.length>0&&(a.showSchedule(!0),a.schedule()&&a.schedule().fromJS(e.scheduledOrder[0])),a.user().orderId(a.cart().currentOrderId()),a.user().setLocalData("orderId"),a.isAutherizeCalled||r.sendWarning(M,i.t("ns.common:resources.orderCannotBeUpdatePendingPaymentText"),!0),!a.emailAddress()&&a.user().emailAddress()&&a.emailAddress(a.user().emailAddress())}else u==s.INCOMPLETE_CANCEL?a.isOrderEditable(!1):c.goTo(a.contextData.global.links[404].route)},function(e){c.goTo(a.contextData.global.links[404].route)},a.cart().currentOrderId())}a.isOrderEditable(!0)},g.updatePayments=function(e){g.payments([]);for(var t=e.length,r=0;r<t;r++)g.payments().push(e[r])},g.addPayment=function(e){g.payments.push(e)},g.hasPaymentType=function(e){for(var t=g.payments().length,r=0;r<t;r++)if(g.payments()[r].type===e)return!0;return!1},g.validateShippingGroupRelationships=function(){if(r.clearError("checkoutAddressBook-ShippingGroupRelationships"),this.cart().hasSplitShippingInformation()||this.errorFlag){var e={};this.errorFlag=!this.cart().items().every(function(t){return t.shippingGroupRelationships().every(function(t){if(t.isPickupInStore())if(e[t.selectedStore().locationId+t.availablePickupDate()]){if(e[t.selectedStore().locationId+t.availablePickupDate()]!==t.firstName()+t.lastName()+t.phoneNumber())return!1}else e[t.selectedStore().locationId+t.availablePickupDate()]=t.firstName()+t.lastName()+t.phoneNumber();return!0})}),this.errorFlag&&r.sendError("checkoutAddressBook-ShippingGroupRelationships",i.t("ns.common:resources.pickupDetailsErrorMsg"),!0)}else this.errorFlag=!0,r.sendError("checkoutAddressBook-ShippingGroupRelationships",i.t("ns.common:resources.checkoutErrorMsg"),!0)},g.validateShippingAddress=function(){r.clearError("checkoutAddressBook-Shipping"),g.shippingAddress&&(g.shippingAddress().validateNow()||this.errorFlag?this.shippingAddress().afterValidation=!0:(this.errorFlag=!0,r.sendError("checkoutAddressBook-Shipping",i.t("ns.common:resources.checkoutErrorMsg"),!0))),g.addDynamicPropertiesToAddressHandler&&n.isFunction(g.addDynamicPropertiesToAddressHandler)&&g.addDynamicPropertiesToAddressHandler(this.shippingAddress())},g.validateSchedule=function(){r.clearError("checkoutScheduledOrder-Schedule"),g.showSchedule()&&g.schedule&&(g.schedule().validateNow()||this.errorFlag?this.schedule().afterValidation=!0:(this.errorFlag=!0,r.sendError("checkoutScheduledOrder-Schedule",i.t("ns.common:resources.checkoutErrorMsg"),!0)))},g.validateBillingAddress=function(){r.clearError("checkoutAddressBook-Billing"),r.clearError("splitPayments-Billing"),g.isSplitPayment()||g.billingAddress().phoneNumber.isValid()||g.billingAddress().phoneNumber(g.shippingAddress().phoneNumber()),g.isSplitPayment()?g.validateSplitPaymentsBillingAddresses&&!g.validateSplitPaymentsBillingAddresses()&&(this.errorFlag=!0,r.sendError("splitPayments-Billing",i.t("ns.common:resources.checkoutErrorMsg"),!0)):!g.billingAddress||g.isPaypalVerified()||!g.billingAddress()||g.billingAddress().validateNow()||this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutAddressBook-Billing",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validateCheckoutCartSummary=function(){r.clearError("checkoutCartSummary"),0!==g.cart().items().length||this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutCartSummary",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validateCheckoutOrderSummary=function(){!this.selectedShippingOption||this.selectedShippingOption()||this.errorFlag?r.clearError("checkoutOrderSummary-shippingMethods"):(this.errorFlag=!0,r.sendError("checkoutOrderSummary",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validateCheckoutPaymentDetails=function(){r.clearError("checkoutPaymentDetails");var e=g.cart().getDerivedTotal(this.cart().secondaryCurrencyTotal(),this.cart().total());this.paymentDetails&&this.payments()<1&&(e>0||this.paymentDetails().isModified())&&(this.isPaypalVerified()||this.cashModel().isPayingByCash()||this.isPayULatamCheckout()||this.isInvoicePayment()||this.showSchedule()&&!this.paymentDetails().isCardEnabledForScheduledOrder()||!(null==this.amountRemaining()||this.amountRemaining()>0)||this.paymentDetails().validatePaymentDetails()||this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutPaymentDetails",i.t("ns.common:resources.checkoutErrorMsg"),!0)))},g.validateGiftcards=function(){r.clearError("checkoutGiftCards"),this.giftCards&&this.giftCards().length>0&&(this.cart().validateGiftCards()||(n.Topic(t.topicNames.SHOW_GIFT_CARD_ERROR_PANEL).publish(),this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutGiftCards",i.t("ns.common:resources.checkoutErrorMsg"),!0))))},g.validatePaymentMethodsForScheduledOrder=function(){r.clearError("checkoutPaymentMethodsForScheduledOrder"),this.showSchedule()&&(this.cashModel().isPayingByCash()||this.paymentDetails&&this.paymentDetails().isCardEnabledForScheduledOrder()||this.giftCards&&this.giftCards().length>0||this.isInvoicePayment()||this.isPayULatamCheckout()||this.isPaypalVerified()||this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutPaymentMethodsForScheduledOrder",i.t("ns.common:resources.checkoutErrorMsg"),!0)))},g.validateRegisteredUser=function(){this.user().validateLogin(),this.user().isLoginValid()||this.errorFlag?(n.Topic(t.topicNames.CHECKOUT_EMAIL_ADDRESS).publishWith(this.user().emailAddress(),[{message:"success"}]),n.Topic(t.topicNames.USER_PROFILE_UPDATE_SUBMIT).publishWith(this.user(),[{message:"success"}])):(this.errorFlag=!0,r.sendError("checkoutRegistration",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validateGuestUser=function(){if(this.guestEmailAddress.isValid()||this.createAccount()!==!1)if(this.user().isValid()||this.createAccount()!==!0){var e=o.getStoredValue(s.LOCAL_STORAGE_USER_CONTENT_LOCALE);null!=e&&(e=JSON.parse(e),n.Topic(t.topicNames.CHECKOUT_USER_LOCALE).publishWith(e[0].name,[{message:"success"}])),n.Topic(t.topicNames.CHECKOUT_EMAIL_ADDRESS).publishWith(this.guestEmailAddress(),[{message:"success"}])}else this.user().validateUser(),this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutRegistration",i.t("ns.common:resources.checkoutErrorMsg"),!0));else this.guestEmailAddress.isModified(!0),this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutRegistration",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validateCheckoutRegistration=function(){r.clearError("checkoutRegistration"),this.user().loggedIn()||(this.checkoutOption()===this.checkoutLogin()?g.validateRegisteredUser():g.validateGuestUser())},g.isGiftCardDisabled=e.computed(function(){return!!g.approvalRequired()||!!(0==g.cart().items().length||0==g.amountRemaining()||g.isCashPayment()||g.isInvoicePayment()||g.showSchedule()&&!g.paymentDetails().isGiftCardEnabledForScheduledOrder()||g.approvalRequired()&&!g.paymentDetails().isGiftCardEnabledForApproval())}),g.validateDynamicProperties=function(){r.clearError("checkoutDynamicProperties");this.cart().validateDynamicProperties()||this.errorFlag||(this.errorFlag=!0,r.sendError("checkoutDynamicProperties",i.t("ns.common:resources.checkoutErrorMsg"),!0))},g.validatePlaceHolderItems=function(){r.clearError("placeHolderItems"),this.cart().placeHolderItems().length&&(this.errorFlag||(this.errorFlag=!0,this.placeHolderItemsMsgDisplayed=!0,r.sendWarning("placeHolderItems",i.t("ns.common:resources.placeHolderItemsErrorMsg"),!0)),this.cart().placeHolderItems.subscribe(function(){this.cart().placeHolderItems().length&&(this.placeHolderItemsMsgDisplayed=!1)},this))},g.invokePaymentValidations=function(){s.LOYALTY_POINTS_PAYMENT_TYPE==this.cart().currency.currencyType?this.paymentsViewModel().isLoyaltyEnabled()&&(this.cart().isChargeTaxShippingInSecondaryCurrency()&&(this.isSplitPayment()?this.validateSplitPaymentsHandler():(this.validateCheckoutPaymentDetails(),this.validateGiftcards(),this.validatePaymentMethodsForScheduledOrder())),this.validatePointsPaymentHandler&&this.validatePointsPaymentHandler()):this.isSplitPayment()?this.validateSplitPaymentsHandler():(this.validateCheckoutPaymentDetails(),this.validateGiftcards(),this.validatePaymentMethodsForScheduledOrder())},g.reset=function(){this.user().reset(),this.createAccount(!1),this.guestEmailAddress.isModified&&this.guestEmailAddress.isModified(!1),this.guestEmailAddress(""),g.cart().emailAddressForGuestUser=""},g.checkSingleException=function(e){if(e.errorCode==s.CHECKOUT_SESSION_EXPIRED_ERROR)return r.sendError(s.CHECKOUT_SESSION_EXPIRED,e.message,!0),!0;if(e.errorCode==s.CREATE_ORDER_PRODUCT_NOT_FOUND||e.errorCode==s.CREATE_ORDER_SKU_NOT_FOUND||e.errorCode==s.PRODUCT_NOT_FOR_INDIVIDUAL_SALE)return r.sendError(M,e.message,!0),g.cart().loadCart(),!0;if(e.errorCode==s.UNLINKED_ADD_ON_PRODUCT)return g.cart().loadCart(),!0;if(e.errorCode==s.ADDON_VOLUME_PRICE_ERROR){var t=e.message+" "+i.t("ns.common:resources.removeItemFromCart");r.sendError(M,t,!0)}else if(e.errorCode==s.INVALID_SHOPPER_INPUT){var a=JSON.parse(e.moreInfo),o=a.productId,n=g.cart().findCartProductById(o);n&&(o=n.displayName);var t=i.t("ns.common:resources.invalidShopperInputError",{productName:o});r.sendError(M,t,!0)}else{if(e.errorCode==s.ORDER_CANNOT_BE_UPDATED){g.id("");var c=i.t("ns.common:resources.orderSubmissionFailed");return r.sendError(M,c,!0),!0}if(e.errorCode==s.COUPON_APPLY_ERROR)g.cart().handleCouponPricingError(e,null);else if(e.errorCode==s.PROCESS_COMPLETION_FAILED_CODE){var c=i.t("ns.common:resources.processCompletionFailed");e.message=c,r.sendError(M,c,!0)}else if(e.errorCode==s.CONFIGURABLE_PRODUCTS_NOT_ALLOWED_FAILURE_CODE){var c=i.t("ns.common:resources.orderPricingPromotionError");e.message=c,r.sendError(M,c,!0)}else if(e.errorCode==s.PAYMENT_REVERSAL_FAILED_CODE){g.id("");var c=i.t("ns.common:resources.paymentReversalFailed");e.message=c,r.sendError(M,c,!0)}else if(e.errorCode==s.INVALID_PROFILE_FOR_CHECKOUT){var l=i.t("ns.common:resources.invalidProfileForCheckout");e.message=l,r.sendError(M,l,!0)}else{if(e.status==s.HTTP_UNAUTHORIZED_ERROR){var c=i.t("ns.common:resources.orderSubmissionFailed");return r.sendError(M,c,!0),!1}if(!g.isPaypalVerified())return r.sendError(M,e.message,!0),!0}}},n.Topic(t.topicNames.ORDER_CREATE).subscribe(this.createOrder.bind(this)),n.Topic(t.topicNames.CHECKOUT_EMAIL_ADDRESS).subscribe(g.updateEmail),n.Topic(t.topicNames.CHECKOUT_BILLING_ADDRESS).subscribe(g.updateBillingAddress),n.Topic(t.topicNames.CHECKOUT_SHIPPING_ADDRESS).subscribe(g.updateShippingAddress),n.Topic(t.topicNames.USER_PROFILE_ADDRESSES_REMOVED).subscribe(g.resetAddress),n.Topic(t.topicNames.CHECKOUT_PAYMENT_DETAILS).subscribe(g.updatePaymentDetails),n.Topic(t.topicNames.ORDER_CREATED).subscribe(this.authPayment.bind(this)),n.Topic(t.topicNames.PAYMENT_AUTH_SUCCESS).subscribe(this.paymentAuthorized.bind(this)),n.Topic(t.topicNames.PAYMENT_AUTH_DECLINED).subscribe(this.paymentDeclined),n.Topic(t.topicNames.PAYMENT_AUTH_TIMED_OUT).subscribe(this.paymentTimeout),n.Topic(t.topicNames.CHECKOUT_SHIPPING_METHOD).subscribe(g.updateShippingMethod),n.Topic(t.topicNames.ORDER_COMPLETED).subscribe(this.clear.bind(this)),n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).subscribe(g.handleRedirect.bind(g)),n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).subscribe(g.handleSubmissionSuccess.bind(g)),n.Topic(t.topicNames.SCHEDULED_ORDER_SUBMISSION_SUCCESS).subscribe(g.handleScheduledOrderSubmissionSuccess.bind(g)),n.Topic(t.topicNames.PAGE_CHANGED).subscribe(g.updatePaymentGatewayData.bind(g)),n.Topic(t.topicNames.PAGE_READY).subscribe(g.handlePageReady.bind(g)),n.Topic(t.topicNames.CONTINUE_TO_PAYPAL).subscribe(this.createOrder.bind(this)),n.Topic(t.topicNames.USER_LOGOUT_SUCCESSFUL).subscribe(this.resetAddress.bind(this)),n.Topic(t.topicNames.USER_LOGOUT_SUCCESSFUL).subscribe(this.resetOrderId.bind(this)),n.Topic(t.topicNames.USER_LOGIN_SUCCESSFUL).subscribe(this.resetOrderId.bind(this)),n.Topic(t.topicNames.GIFTCARD_UPDATE_FROM_CART).subscribe(this.updateGiftCards.bind(this)),n.Topic(t.topicNames.UPDATE_AMOUNT_REMAINING).subscribe(this.updateAmountRemaining.bind(this)),n.Topic(t.topicNames.UPDATE_AMOUNT_REMAINING_PENDING_PAYMENT).subscribe(this.updateAmountRemainingPendingPayment.bind(this)),n.Topic(t.topicNames.USER_CREATION_FAILURE).subscribe(this.createOrderAfterRegistration.bind(this)),n.Topic(t.topicNames.AUTO_LOGIN_AND_GET_USER_DATA_SUCCESSFUL).subscribe(this.createOrderAfterRegistration.bind(this)),n.Topic(t.topicNames.USER_AUTO_LOGIN_FAILURE).subscribe(this.createOrderAfterRegistration.bind(this)),n.Topic(t.topicNames.USER_PROFILE_UPDATE_SUCCESSFUL).subscribe(this.createOrderAfterProfileUpdate.bind(this)),n.Topic(t.topicNames.USER_PROFILE_UPDATE_NOCHANGE).subscribe(this.createOrderAfterProfileUpdate.bind(this)),n.Topic(t.topicNames.USER_PROFILE_UPDATE_INVALID).subscribe(this.createOrderAfterProfileUpdate.bind(this)),n.Topic(t.topicNames.USER_PROFILE_UPDATE_FAILURE).subscribe(this.createOrderAfterProfileUpdate.bind(this)),n.Topic(t.topicNames.CART_PRICE_COMPLETE).subscribe(this.disablePaymentIfNecessary.bind(this)),g}function S(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f){var m=this;e&&(m.id=e),m.shoppingCart=t,m.appliedPromotions=r,m.isAnonymousCheckout=l,m.combineLineItems=f,a&&(m.scheduleOnly=!0,m.schedule=a),g?m.shippingGroups=g:(o&&(m.shippingAddress=o),i&&(m.shippingMethod={value:i.value})),s&&(m.billingAddress=s),u&&(m.payments=u),m.visitorId=n,m.visitId=c,l||(m.profileId=d),m.op=p,m.giftWithPurchaseOrderMarkers=h}function C(e){n.extend(this,{productId:e.productId,quantity:e.quantity,catRefId:e.productData().childSKUs[0].repositoryId,externalPrice:e.externalPrice,externalPriceQuantity:e.externalPriceQuantity,giftWithPurchaseCommerceItemMarkers:e.giftWithPurchaseCommerceItemMarkers,externalData:e.externalData,actionCode:e.actionCode,commerceItemId:e.commerceItemId,externalRecurringCharge:e.externalRecurringCharge,externalRecurringChargeFrequency:e.externalRecurringChargeFrequency,externalRecurringChargeDuration:e.externalRecurringChargeDuration,assetKey:e.assetKey,rootAssetKey:e.rootAssetKey,parentAssetKey:e.parentAssetKey,serviceId:e.serviceId,customerAccountId:e.customerAccountId,billingAccountId:e.billingAccountId,serviceAccountId:e.serviceAccountId,billingProfileId:e.billingProfileId,activationDate:e.activationDate,deactivationDate:e.deactivationDate,transactionDate:e.transactionDate,asset:e.asset,shopperInput:e.shopperInput})}function A(e,t,r){var i=this;i.items=e,i.coupons=t,i.orderTotal=r}function _(e,t,r,i){var a=this;a.emailAddress=e,a.billingAddress=t,a.paymentDetails=r,a.orderDetails=i}function O(e){var t=this;t.nameOnCard=e.nameOnCard(),null==e.selectedCardType()?t.cardType=e.cardType():t.cardType=e.selectedCardType(),t.cardNumber=e.cardNumber(),t.cardCVV=e.cardCVV(),t.endMonth=e.endMonth(),t.endYear=e.endYear(),null==e.selectedCardType()?t.selectedCardType=e.cardType():t.selectedCardType=e.selectedCardType(),null==e.selectedEndMonth()?t.selectedEndMonth=e.endMonth():t.selectedEndMonth=e.selectedEndMonth(),null==e.selectedEndYear()?t.selectedEndYear=e.endYear():t.selectedEndYear=e.selectedEndYear()}function R(e){var t=this;t.nameOnCard=e.nameOnCard(),null==e.selectedCardType()?t.cardType=e.cardType():t.cardType=e.selectedCardType(),t.cardNumber=e.cardNumber(),t.cardCVV=e.cardCVV(),t.expiryMonth=e.endMonth(),t.expiryYear=e.endYear().toString(),null==e.selectedCardType()?t.selectedCardType=e.cardType():t.selectedCardType=e.selectedCardType(),null==e.selectedEndMonth()?t.selectedEndMonth=e.endMonth():t.selectedEndMonth=e.selectedEndMonth(),null==e.selectedEndYear()?t.selectedEndYear=e.endYear():t.selectedEndYear=e.selectedEndYear()}function N(e,t,r,i,a){var o=this;o.type=e,o[s.PAYMENT_ID]=t,o[s.TOKEN]=r,o[s.PAYER_ID]=i,o[s.PAYMENT_GROUP_ID]=a}function D(e,t,r,i,a,o,n){var c=this;c.type=e,c[s.AMOUNT]=t,c[s.CURRENCY]=r,c[s.PAYMENT_ID]=i,c[s.TRANSACTION_STATUS]=a,c[s.TRANSACTION_TYPE]=o,c[s.SIGNATURE]=n}function L(t,r,i,a,o){var s={};return s.msg=t.toString(),s.shoppingCartItems=r,s.emailId=i,s.visitorId=a,s.visitId=o,s.toJSON=function(){var t=e.toJS(s);return t},s}var M="OrderViewModel";return P.prototype.isPaymentsDisabled=function(){var e=this,r=e.cart().getDerivedTotal(e.cart().secondaryCurrencyTotal(),e.cart().total()),i=0==r;return i&&n.Topic(t.topicNames.PAYMENTS_DISABLED).publish(),i},P.prototype.isPointPaymentsDisabled=function(){var e=this,t=e.cart().getDerivedTotal(e.cart().primaryCurrencyTotal(),e.cart().total()),r=0==t;return r},P.prototype.updateGiftCards=function(e){var t=this;t.giftCards([]);for(var r=0;r<e.length;r++){var i=e[r];t.giftCards.push(i)}},P.prototype.updateAmountRemaining=function(e){var t=this;t.amountRemaining(e)},P.prototype.updateAmountRemainingPendingPayment=function(e){var t=this,r=t.amountRemaining()+e;t.amountRemaining(r)},P.prototype.createOrderAfterRegistration=function(e){!this.registerUser||!this.contextData.global.guestCheckoutEnabled&&e&&e.errorCode===s.CREATE_PROFILE_USER_EXISTS?(this.destroySpinner(),this.enableOrderButton(!0),this.registerUser=!1,e&&r.sendError(M,e.message,!0),o.getStoredValue(s.PAYULATAM_CHECKOUT_REGISTRATION)===s.PAYULATAM_CHECKOUT_REGISTRATION_FAILURE&&o.clearStoredValue(s.PAYULATAM_CHECKOUT_REGISTRATION)):(this.createOrder(),
this.registerUser=!1)},P.prototype.createOrderAfterProfileUpdate=function(){this.user&&!this.user().isUserSessionExpired()?(this.placeOrder&&(this.cart().currentOrderState()==s.PENDING_PAYMENTS||this.cart().currentOrderState()==s.PENDING_PAYMENT_TEMPLATE?this.isSplitPayment()?this.invokePaymentsAPIHandler():this.addPaymentsToOrder():this.createOrder(),this.enableOrderButton(!0),this.placeOrder=!1),this.destroySpinner()):(this.enableOrderButton(!0),this.destroySpinner())},P.prototype.handleSubmissionSuccess=function(e){var t=this;t.restClient.profileType===s.PROFILE_TYPE_AGENT?c.goTo(this.contextData.global.links.AgentOrderDetails.route+"/"+(e[0].scheduledId?e[0].scheduledId+"?"+s.AGENT_PARAM_IS_SCHEDULED_ORDER+"=true":e[0].id)):c.goTo(this.contextData.global.links.confirmation.route+"/"+e[0].uuid),t.isOrderSubmitted=!0,t.approvalRequired(!1),t.enableOrderButton(!0),t.isPaypalVerified()&&t.clearPaypalData(),t.user().loggedIn()||t.reset()},P.prototype.handleScheduledOrderSubmissionSuccess=function(e){var t=this;t.restClient.profileType===s.PROFILE_TYPE_AGENT?c.goTo(this.contextData.global.links.AgentOrderDetails.route+"/"+e[0].scheduleOrderId+"?"+s.AGENT_PARAM_IS_SCHEDULED_ORDER+"=true"):c.goTo(this.contextData.global.links.scheduledOrders.route+"/"+e[0].scheduleOrderId),t.isOrderSubmitted=!0,t.enableOrderButton(!0),t.isPaypalVerified()&&t.clearPaypalData(),t.user().loggedIn()||t.reset(),this.destroySpinner()},P.prototype.handleRedirect=function(e){var t=this;t.enableOrderButton(!0);var i=c.getPathWithoutLocale().split("?");if(o.profileType==s.PROFILE_TYPE_AGENT){if(!t.order()||"PENDING_PAYMENT"!=t.order().state&&t.order().state!=s.PENDING_PAYMENT_TEMPLATE){var a=t.agentCheckoutLink,n=t.contextManager.getInstance().export();a=a+"?context="+encodeURIComponent(n),i[0]=a}else{t.contextManager.getInstance().setProperty(s.IS_PENDING_PAYMENT,!0),t.contextManager.getInstance().includedAgentContextProperties.push(s.IS_PENDING_PAYMENT);var n=t.contextManager.getInstance().export();i[0]=t.agentCheckoutLink+"?orderId="+t.order().id+"&context="+encodeURIComponent(n)}c.goTo(i[0])}else c.getPathWithoutLocale()==t.cartLink&&(t.isPaypalVerified()||t.cart().checkoutWithPaypalClicked())?c.goTo(t.cartLink):c.getPathWithoutLocale()==t.checkoutLink&&t.isPaypalVerified()?c.goTo(t.checkoutLink):i[0]==t.checkoutLink&&c.getPathWithoutLocale().indexOf("orderId=")!=-1?c.goTo(c.getPathWithoutLocale()):c.goTo(t.checkoutLink),e.data&&(t.isPaypalVerified()||t.cart().checkoutWithPaypalClicked())&&r.sendErrorToPage(s.PAYPAL_PLACE_ORDER_ERROR,e.data.message,!0,"checkout",!0),(t.isPaypalVerified()||t.cart().checkoutWithPaypalClicked())&&t.clearPaypalData()},P.prototype.handleCheckoutWithPaypal=function(){var e=this;e.cashModel().isPayingByCash(!1),e.shippingAddress()&&e.shippingAddress().address1()&&!e.emailAddress()&&c.getPathWithoutLocale()==e.checkoutLink&&!e.user().loggedIn()?n.Topic(t.topicNames.PAYPAL_EMAIL_VALIDATION).publishWith(e,[{message:"fail"}]):e.continueCheckoutWithPaypal()},P.prototype.continueCheckoutWithPaypal=function(){var e=this;!e.cart().shippingMethod()&&e.shippingAddress()&&e.shippingAddress().validateForShippingMethod()&&h.getInstance().setItem("checkoutAddressWithoutShippingMethod",JSON.stringify(e.shippingAddress().toJSON())),e.guestEmailAddress()&&h.getInstance().setItem("guestEmailAddress",e.guestEmailAddress()),e.updatePaypalPaymentType(s.PAYPAL_CHECKOUT_TYPE),e.cart().checkoutWithPaypalClicked(!0),e.cart().skipPriceChange(!0),e.cart().handleValidateCart(),e.id(null),e.op(s.ORDER_OP_INITIATE)},P.prototype.clear=function(){var e=this;e.id(null),e.emailAddress(""),e.order(null),e.orderProfileId(null),e.selectedShippingOption(null),e.op(null),e.giftCards([]),e.isInvoicePayment(!1),e.isPayLater(!1),e.poNumber(""),e.enableOrderButton(!0),e.createAccount(!1),e.guestEmailAddress.isModified&&e.guestEmailAddress.isModified(!1),e.guestEmailAddress(""),e.checkoutOption(s.GUEST),e.isOrderLocked=!1,e.isOrderSubmitted=!1,e.payments([]),e.amountRemaining(null),e.approvalRequired(!1),e.isAutherizeCalled=!1,e.loadedOrderShippingAddress=null,e.cart().currentOrderId(null),e.cart().currentOrderState(null),o.profileType==s.PROFILE_TYPE_AGENT&&e.user().clonedOrderId()&&(e.clearCloneOrderData(),e.paymentsViewModel().resetPaymentsContainer(),e.paymentsViewModel().totalAmountAuthorized(0),e.paymentsViewModel().totalAmountAuthorizedOnVoid(0),e.cart().emptyCart(),e.contextManager&&e.contextManager.getInstance().clearAgentContext())},P.prototype.clearPaypalData=function(){var e=this;e.paymentGateway(new N),e.cart().checkoutWithPaypalClicked(!1),e.isPaypalVerified(!1),e.id(null),e.op(null)},P.prototype.getOrder=function(){var e=this;e.giftCards([]),e.cart().giftCards([]),e.cart().dynamicProperties([]);var a=e.paymentGateway().type,l={};e.paymentGateway().type==s.PAYPAL_CHECKOUT_TYPE?(l[s.PAYER_ID]=e.paymentGateway().PayerID,l[s.TOKEN]=e.paymentGateway().token,l[s.PAYMENT_ID]=e.paymentGateway().paymentId):e.paymentGateway().type==s.PAYULATAM_CHECKOUT_TYPE?(l[s.AMOUNT]=e.paymentGateway().amount,l[s.CURRENCY]=e.paymentGateway().currency,l[s.PAYMENT_ID]=e.paymentGateway().paymentId,l[s.TRANSACTION_STATUS]=e.paymentGateway().transactionStatus,l[s.TRANSACTION_TYPE]=e.paymentGateway().transactionType,l[s.SIGNATURE]=e.paymentGateway().signature):e.payments().length>0&&(a=e.payments()[0].type,e.payments()[0].customProperties&&(l.customProperties=e.payments()[0].customProperties));var d={};d[s.ENDPOINT_KEY]=s.ENDPOINT_GET_INITIAL_ORDER,d[s.IDENTIFIER_KEY]="getOrder";var u=e.storeConfiguration.getFilterToUse(d);u&&(l[s.FILTER_KEY]=u),e.adapter.loadJSON(s.ENDPOINT_GET_INITIAL_ORDER,a,l,function(a){var l=!(!e.user()||!e.user().loggedIn());if(l)e.cart().emptyCart(),e.cart().mergeItems(a),e.cart().updateCartData(a,!1,l),e.cart().cartUpdated();else{e.cart().loadCart();var d=h.getInstance().getItem("guestEmailAddress");d&&(e.guestEmailAddress(d),h.getInstance().removeItem("guestEmailAddress"))}if(a.state==s.PENDING_PAYMENT||a.state==s.PENDING_PAYMENT_TEMPLATE){e.cart().currentOrderState(a.state),e.cart().currentOrderId(a.id),e.cart().orderCurrency=a.priceListGroup.currency,e.cart().orderItems(a.shoppingCart.items);var u=e.cart().getDerivedTotal(a.priceInfo.secondaryCurrencyTotal,a.priceInfo.total);e.amountRemaining(u),e.isAutherizeCalled=!0,e.isOrderEditable(!1)}if(a.state==s.QUOTED_STATES&&(e.cart().currentOrderState(a.state),e.cart().currentOrderId(a.id),e.cart().orderCurrency=a.priceListGroup.currency,e.cart().orderItems(a.shoppingCart.items),e.isOrderEditable(!1)),a.state==s.INCOMPLETE_CANCEL&&(e.cart().currentOrderState(a.state),e.cart().currentOrderId(a.id),e.cart().orderCurrency=a.priceListGroup.currency,e.cart().orderItems(a.shoppingCart.items),e.isOrderEditable(!1)),e.isPaypalVerified()){e.id(a.id);for(var p=a.payments,g="",f=0;f<p.length;f++)if(p[f]&&p[f].type==s.PAYPAL_CHECKOUT_TYPE){g=p[f].paymentGroupId;var m=new N(s.PAYPAL_CHECKOUT_TYPE,e.paymentGateway().paymentId,e.paymentGateway().token,e.paymentGateway().PayerID,g);e.paymentGateway(m),e.paymentsViewModel().paypalPaymentGroupId(g)}var I=h.getInstance().getItem("checkoutAddressWithoutShippingMethod");n.Topic(t.topicNames.PAYPAL_CHECKOUT_SHIPPING_ADDRESS).publish(a.shippingAddress),n.Topic(t.topicNames.EXTERNAL_CHECKOUT_BILLING_ADDRESS).publish(a.billingAddress),a.shippingMethod&&!I?n.Topic(t.topicNames.PAYPAL_CHECKOUT_SHIPPING_METHOD_VALUE).publishWith(a.shippingMethod.value):n.Topic(t.topicNames.PAYPAL_CHECKOUT_NO_SHIPPING_METHOD).publish(),a.dynamicProperties&&e.cart().updateDynamicProperties(a);var E=a.priceInfo.secondaryCurrencyTotal?a.priceInfo.secondaryCurrencyTotal:a.priceInfo.total;if(1==p.length&&p[0]&&p[0].type==s.PAYPAL_PAYMENT_TYPE&&p[0].amount!=E){var v=i.t("ns.common:resources.reapplyGIftCards");r.sendError("GC",v,!0)}}else if(e.paymentGateway().type==s.PAYULATAM_CHECKOUT_TYPE){if(a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_APPROVED||a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_PENDING||a.payments[0].paymentState==s.PAYMENT_GROUP_STATE_SETTLED)n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).publish([{message:"success",id:a.id,uuid:a.uuid}]);else if(a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_DECLINED||a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_EXPIRED||a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_ERROR){n.Topic(t.topicNames.WEB_CHECKOUT_SHIPPING_ADDRESS).publish(a.shippingAddress),a.shippingMethod&&(e.webCheckoutShippingMethodValue=a.shippingMethod.value),!e.user().loggedIn()&&a.shippingAddress.email&&e.guestEmailAddress(a.shippingAddress.email);var y="";a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_DECLINED?y=i.t("ns.common:resources.paymentDeclinedMsg"):a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_EXPIRED?y=i.t("ns.common:resources.paymentExpiredMsg"):a.payments[0].transactionStatusByQuery==s.PAYU_TRANSACTION_ERROR&&(y=i.t("ns.common:resources.paymentErrorMsg")),o.clearStoredValue(s.PAYULATAM_CHECKOUT_REGISTRATION),o.profileType==s.PROFILE_TYPE_AGENT?c.goTo(e.agentCheckoutLink):c.goTo(e.checkoutLink),r.sendErrorToPage(M,y,!0,"checkout",!0),n("#CC-messages").attr("aria-live","assertive")}e.paymentGateway(null),e.destroySpinner()}n.Topic(t.topicNames.ORDER_RETRIEVED_INITIAL).publishWith(a,[{message:"success",order:a}])},function(i){e.destroySpinner(),e.clearPaypalData(),e.paymentGateway(null),e.payments([]),n.Topic(t.topicNames.GET_INITIAL_ORDER_FAIL).publish([{message:"fail"}]),r.sendError(M,i.message,!0)})},P.prototype.addPaymentsToOrder=function(){var t=this,r=void 0;t.billingAddress()&&(r=t.billingAddress().toJSON());var i="";if(t.op()==s.ORDER_OP_INITIATE)i=t.op();else var a=h.getInstance().getItem(s.PAYMENT_GROUP_AFTER_PAYPAL);var n=[];if(!t.isSplitPayment()&&s.LOYALTY_POINTS_PAYMENT_TYPE==t.cart().currency.currencyType&&t.paymentsViewModel().isLoyaltyEnabled())for(var c=t.paymentsViewModel().preparePaymentsRequest(t.paymentsViewModel().pendingPayments()),l=0;l<c.length;l++)if(c[l].paymentMethodType==s.LOYALTY_POINTS_PAYMENT_TYPE){if(c[l].amount&&null==c[l].amount){var d=t.cart().getDerivedTotal(t.cart().primaryCurrencyTotal(),t.cart().total());c[l].amount=d}c[l].billingAddress&&null==c[l].billingAddress&&(c[l].billingAddress=r),n.push(c[l])}if(t.cashModel().isPayingByCash()){var u={};u.paymentMethodType=s.CASH_PAYMENT_TYPE,t.cashModel().customProperties&&Object.keys(t.cashModel().customProperties).length-1>0&&(u.customProperties=e.mapping.toJS(t.cashModel().customProperties)),u.billingAddress=r,u.amount=t.amountRemaining(),n.push(u),i=s.ORDER_OP_INITIATE}else{if(t.giftCards())for(var l=0;l<t.giftCards().length;l++){var u={};u.paymentMethodType=s.GIFT_CARD_PAYMENT_TYPE,u.giftCardNumber=t.giftCards()[l].giftCardNumber(),u.giftCardPin=t.giftCards()[l].giftCardPin(),t.giftCards()[l].isAmountRemaining()&&!t.isPaypalVerified()||(u.amount=t.giftCards()[l].amountUsed()),u.paymentGroupId=t.giftCards()[l].paymentGroupId,t.giftCards()[l].customProperties&&Object.keys(t.giftCards()[l].customProperties).length-1>0&&(u.customProperties=e.mapping.toJS(t.giftCards()[l].customProperties)),u.amount=t.giftCards()[l].amountUsed(),u.billingAddress=r,n.push(u)}if(t.payments().length>0)e.utils.arrayForEach(t.payments(),function(e){e.billingAddress=r,e.type&&(e.paymentMethodType=e.type,delete e.type),n.push(e)});else if(t.isPaypalVerified()||t.amountRemaining&&0!=t.amountRemaining())if(t.paymentGateway()&&t.paymentGateway().type){var u={};u.paymentMethodType=t.paymentGateway().type,u.billingAddress=r,""==i&&t.paymentGateway().type==s.PAYPAL_CHECKOUT_TYPE?(u.PayerID=t.paymentGateway().PayerID,u.token=t.paymentGateway().token,u.paymentId=t.paymentGateway().paymentId,u.paymentGroupId=a):t.paymentGateway().type==s.PAYULATAM_CHECKOUT_TYPE&&(u.currency=t.paymentGateway().currency),u.amount=t.amountRemaining(),n.push(u),t.createSpinner()}else if(t.isInvoicePayment()){var u={};u={paymentMethodType:s.INVOICE_PAYMENT_TYPE,PONumber:t.poNumber()},u.billingAddress=r,u.amount=t.amountRemaining(),n.push(u)}else if(t.paymentDetails&&t.paymentDetails()&&t.paymentDetails().isModified()){var u={};u=new R(t.paymentDetails()),t.paymentDetails().customProperties&&Object.keys(t.paymentDetails().customProperties).length-1>0&&(u.customProperties=e.mapping.toJS(t.paymentDetails().customProperties)),u.paymentMethodType=s.CARD_PAYMENT_TYPE,u.billingAddress=r,u.amount=t.amountRemaining(),n.push(u)}}if(t.user()&&t.user().orderId()&&t.user().loggedIn()&&!t.hasPaymentType(s.GENERIC_PAYMENT_TYPE)){var p="addPayments",g={};g.orderId=t.user().orderId(),""!=i&&(g.op=i);var f=t.user().id();o.profileType!=s.PROFILE_TYPE_AGENT?g.profileId=f:f&&(g.profileId=f),g.payments=n,o.request(p,g,function(e){t.postPaymentOrderUpdateSuccess(e)},function(e){var r=new Object;r.orderId=t.id(),r.errorCode=e.errorCode,t.storeServerLog.logError("updateOrderFailure",t.storeServerLog.getMessage("updateOrderFailure",r)),t.postOrderCreateOrUpdateFailure(e)})}else if(!this.user().isB2BUser()){var p="addPayments",g={};if(g.orderId=t.user().orderId(),""!=i&&(g.op=i),g.uuid=t.order().uuid,g.payments=n,o.profileType==s.PROFILE_TYPE_AGENT){var f=t.user().id();f&&(g.profileId=f)}o.request(p,g,function(e){t.postPaymentOrderUpdateSuccess(e)},function(e){var r=new Object;r.orderId=t.id(),r.errorCode=e.errorCode,t.storeServerLog.logError("updateOrderFailure",t.storeServerLog.getMessage("updateOrderFailure",r)),t.postOrderCreateOrUpdateFailure(e)})}},P.prototype.createOrder=function(){if(this.cart().isOrderSubmissionInProgress=!0,this.cart().currentOrderState()==s.PENDING_PAYMENTS||this.cart().currentOrderState()==s.PENDING_PAYMENT_TEMPLATE)this.isSplitPayment()?this.invokePaymentsAPIHandler():this.addPaymentsToOrder();else{for(var t=this,i=e.observableArray([]),a=t.cart().giftWithPurchaseOrderMarkers,l=t.cart().items,d=0;d<l().length;d++){var u=new C(l()[d]);l()[d].childItems&&(u.childItems=l()[d].childItems,u.configuratorId=l()[d].configuratorId);for(var p=0;p<t.cart().lineAttributes().length;p++)u[t.cart().lineAttributes()[p].id()]=l()[d][t.cart().lineAttributes()[p].id()];i.push(u)}var h,g=new A(i,t.cart().coupons(),t.cart().total());h=t.cart().createShippingGroups();var f=void 0;t.showSchedule()&&t.schedule()&&(f=t.schedule().toJSON());var m=void 0;if(t.shippingAddress())if(t.paymentGateway()&&t.paymentGateway().type===s.PAYPAL_CHECKOUT_TYPE&&c.isPathEqualTo(t.cartLink)){var E=t.shippingAddress().isValid();E&&(m=t.shippingAddress().toJSON())}else m=t.shippingAddress().toJSON();var v=void 0;t.billingAddress()&&(v=t.billingAddress().toJSON());var y=!0;if(t.user().loggedIn()&&(y=!1,!t.emailAddress()&&t.user().emailAddress()&&t.emailAddress(t.user().emailAddress())),t.emailAddress()){var b=t.emailAddress().toString();h?h.forEach(function(e){e.shippingAddres?e.shippingAddress.email=b:e.email=b}):m&&(m.email=b)}for(var T=[],d=0;d<t.cart().orderDiscountDescList().length;d++)T.push(t.cart().orderDiscountDescList()[d].promotionId);for(var P=0;P<t.cart().claimedCouponMultiPromotions().length;P++)for(var _=0;_<t.cart().claimedCouponMultiPromotions()[P].promotions().length;_++)T.push(t.cart().claimedCouponMultiPromotions()[P].promotions()[_].promotionId());var R=[];if(!t.isPayLater()){if(s.LOYALTY_POINTS_PAYMENT_TYPE==t.cart().currency.currencyType&&t.paymentsViewModel().isLoyaltyEnabled())for(var N=t.paymentsViewModel().preparePaymentsRequest(t.paymentsViewModel().pendingPayments()),d=0;d<N.length;d++)if(N[d].paymentMethodType==s.LOYALTY_POINTS_PAYMENT_TYPE){if(N[d].amount&&null==N[d].amount){var D=t.cart().getDerivedTotal(t.cart().primaryCurrencyTotal(),t.cart().total());N[d].amount=D}N[d].billingAddress&&null==N[d].billingAddress&&(N[d].billingAddress=v),R.push(N[d])}if(t.isSplitPayment())for(var N=t.paymentsViewModel().preparePaymentsRequest(t.paymentsViewModel().pendingPayments()),d=0;d<N.length;d++)if(N[d].paymentMethodType==s.CARD_PAYMENT_TYPE&&t.isCardPaymentClientSide)R.push({type:"card",amount:N[d].amount,seqNum:N[d].seqNum});else if(N[d].paymentMethodType==s.PAYPAL_CHECKOUT_TYPE)t.paymentsViewModel().paypalPaymentGroupId()&&N[d].token&&(N[d].paymentGroupId=t.paymentsViewModel().paypalPaymentGroupId()),R.push(N[d]);else{if(N[d].paymentMethodType==s.LOYALTY_POINTS_PAYMENT_TYPE)continue;R.push(N[d])}else if(t.cashModel().isPayingByCash()){var L={};L.type=s.CASH_PAYMENT_TYPE,t.cashModel().customProperties&&Object.keys(t.cashModel().customProperties).length-1>0&&(L.customProperties=e.mapping.toJS(t.cashModel().customProperties)),R.push(L)}else{if(t.giftCards())for(var d=0;d<t.giftCards().length;d++){var L={};L.type=s.GIFT_CARD_PAYMENT_TYPE,L.giftCardNumber=t.giftCards()[d].giftCardNumber(),L.giftCardPin=t.giftCards()[d].giftCardPin(),t.giftCards()[d].isAmountRemaining()&&!t.isPaypalVerified()||(L.amount=t.giftCards()[d].amountUsed()),L.paymentGroupId=t.giftCards()[d].paymentGroupId,t.giftCards()[d].customProperties&&Object.keys(t.giftCards()[d].customProperties).length-1>0&&(L.customProperties=e.mapping.toJS(t.giftCards()[d].customProperties)),R.push(L)}if(t.payments().length>0)e.utils.arrayForEach(t.payments(),function(e){R.push(e)});else if(t.isPaypalVerified()||t.amountRemaining&&0!=t.amountRemaining())if(t.paymentGateway()&&t.paymentGateway().type)R.push(t.paymentGateway()),t.createSpinner();else if(t.isInvoicePayment())R.push({type:s.INVOICE_PAYMENT_TYPE,PONumber:t.poNumber()});else if(t.paymentDetails&&t.paymentDetails()&&t.paymentDetails().isModified()){var L={};t.isCardPaymentClientSide||(L=new O(t.paymentDetails()),t.paymentDetails().customProperties&&Object.keys(t.paymentDetails().customProperties).length-1>0&&(L.customProperties=e.mapping.toJS(t.paymentDetails().customProperties))),L.type=s.CARD_PAYMENT_TYPE,R.push(L)}}}var w="";w=t.op()!=s.ORDER_OP_INITIATE?s.ORDER_OP_COMPLETE:t.op(),r.clearError(M);var U=I.getVisitorId(),k=I.getVisitId();if(t.user()&&t.user().orderId()&&t.user().loggedIn()&&!t.user().loggedinAtCheckout()&&!t.hasPaymentType(s.GENERIC_PAYMENT_TYPE)&&o.profileType!=s.PROFILE_TYPE_AGENT){var x=e.observable(new S(t.user().orderId,g,T,t.selectedShippingOption(),f,m,v,U,k,y,null,R,w,a,h,t.cart().combineLineItems));t.adapter.persistUpdate("updateOrder",t.user().orderId(),t.addDynamicProperties(JSON.parse(e.toJSON(x))),function(e){t.createOrderSuccessHandler&&n.isFunction(t.createOrderSuccessHandler)?(t.id(e.id),t.order(e),t.orderProfileId(e.orderProfileId),t.createOrderSuccessHandler(e)):t.postOrderCreateOrUpdateSuccess(e)},function(e){var r=new Object;e&&e.errors&&e.errors instanceof Array?(r.orderId=t.id(),r.errorCode="",e.errors.forEach(function(e){r.errorCode+=e.errorCode+", "}),r.errorCode=r.errorCode.slice(0,-2)):(r.orderId=t.id(),r.errorCode=e.errorCode),t.storeServerLog.logError("updateOrderFailure",t.storeServerLog.getMessage("updateOrderFailure",r)),t.postOrderCreateOrUpdateFailure(e),t.createOrderFailureHandler&&n.isFunction(t.createOrderFailureHandler)&&t.createOrderFailureHandler(e)})}else{t.paymentGateway()&&t.paymentGateway().type==s.PAYPAL_CHECKOUT_TYPE||t.hasPaymentType(s.PAYPAL_CHECKOUT_TYPE)||t.hasPaymentType(s.GENERIC_PAYMENT_TYPE)||t.user().loggedIn()||t.id(""),t.cart().currentOrderId()?t.id(t.cart().currentOrderId()):t.user()&&t.user().orderId()&&t.user().loggedIn()&&!t.user().loggedinAtCheckout()&&t.hasPaymentType(s.GENERIC_PAYMENT_TYPE)&&t.id(t.user().orderId());var G,F=e.observable(new S(t.id(),g,T,t.selectedShippingOption(),f,m,v,U,k,y,t.user().id(),R,w,a,h,t.cart().combineLineItems));o.profileType==s.PROFILE_TYPE_AGENT&&(F().op="submitOrder",t.user().orderId()&&(F().orderId=t.user().orderId()));var G=s.ENDPOINT_ORDERS_CREATE_ORDER,H=t.addDynamicProperties(JSON.parse(e.toJSON(F)));o.request(G,H,function(e){t.createOrderSuccessHandler&&n.isFunction(t.createOrderSuccessHandler)?(t.id(e.id),t.order(e),e.orderProfileId=e.orderProfileId?e.orderProfileId:e.profileId,t.orderProfileId(e.orderProfileId),t.createOrderSuccessHandler(e)):(e.orderProfileId=e.orderProfileId?e.orderProfileId:e.profileId,t.postOrderCreateOrUpdateSuccess(e))},function(e){var r=new Object;e&&e.errors&&e.errors instanceof Array?(r.errorCode="",e.errors.forEach(function(e){r.errorCode+=e.errorCode+", "}),r.errorCode=r.errorCode.slice(0,-2)):r.errorCode=e.errorCode,t.storeServerLog.logError("createOrderFailure",t.storeServerLog.getMessage("createOrderFailure",r)),t.postOrderCreateOrUpdateFailure(e),t.createOrderFailureHandler&&n.isFunction(t.createOrderFailureHandler)&&t.createOrderFailureHandler(e)})}}},P.prototype.addDynamicProperties=function(e){for(var t=this,r=0;r<t.cart().dynamicProperties().length;r++){var i=t.cart().dynamicProperties()[r],a=i.id(),o=null;null!=i.value&&(o=i.value()),e[a]=o}var n=h.getInstance().getItem(s.LOCAL_STORAGE_CURRENT_CONTEXT);if(n){n=JSON.parse(n);for(var c in n)n.hasOwnProperty(c)&&e.hasOwnProperty(c)&&(e[c]=n[c])}return e},P.prototype.postOrderCreateOrUpdateSuccess=function(e){var a=this;if(a.cart().isOrderSubmissionInProgress=!1,a.id(e.id),a.order(e),a.orderProfileId(e.orderProfileId),a.op(""),a.user()&&a.user().loggedIn()&&a.user().id()==e.orderProfileId&&(a.user().orderId(e.id),a.user().setLocalData("orderId")),e.state==s.SUBMITTED||e.stateString==s.SUBMITTED)n.Topic(t.topicNames.ORDER_COMPLETED).publish({message:"success",id:e.id,uuid:e.uuid,payment:e.payments}),n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).publish([{message:"success",id:e.id,uuid:e.uuid}]);else if(e.state==s.TEMPLATE||e.stateString==s.TEMPLATE)n.Topic(t.topicNames.ORDER_COMPLETED).publish({message:"success",id:e.id,uuid:e.uuid,payment:e.payments}),n.Topic(t.topicNames.SCHEDULED_ORDER_SUBMISSION_SUCCESS).publish([{message:"success",id:e.id,scheduleOrderId:"agentUI"==a.restClient.profileType?e.scheduledOrderId:e.scheduledOrder.id?e.scheduledOrder.id:e.scheduledOrder[0].id,uuid:e.uuid}]);else if(e.state==s.PENDING_APPROVAL||e.state==s.PENDING_SCHEDULED_ORDER_APPROVAL)n.Topic(t.topicNames.ORDER_COMPLETED).publish({message:"success",id:e.id,uuid:e.uuid,payment:e.payments}),a.destroySpinner(),n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).publish([{message:"success",id:e.id,uuid:e.uuid}]);else{for(var o=e.payments,l=!1,d=!1,u=!1,p=0;p<o.length;p++)if(o[p].paymentState==s.PAYMENT_GROUP_STATE_AUTHORIZED_FAILED||o[p].paymentState==s.PAYMENT_GROUP_STATE_PAYMENT_REQUEST_FAILED){this.destroySpinner(),d=!0;var g="";if(o[p]&&o[p].message&&""!==o[p].message){g=o[p].message;var f={orderId:e.id,paymentState:o[p].paymentState,paymentGroupId:o[p].paymentGroupId};a.storeServerLog.logError("paymentGroupFailure",a.storeServerLog.getMessage("paymentGroupFailure",f))}else{var f={orderId:e.id};a.storeServerLog.logError("orderSubmissionFailure",a.storeServerLog.getMessage("orderSubmissionFailure",f)),g=i.t("ns.common:resources.orderSubmissionFailed")}r.sendError(M,g,!0),n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).publishWith(e,[{message:"fail",data:o[p]}]),l=!0,(a.isPaypalVerified()||a.cart().checkoutWithPaypalClicked())&&a.clearPaypalData();break}if(!l)for(var p=0;p<o.length;p++){if(o[p].type==s.PAYPAL_PAYMENT_TYPE&&o[p].uiIntervention==s.REDIRECT){d=!0,a.paymentGateway(null),h.getInstance().setItem(s.REDIRECTED_TO_WEB_PAYMENT,"true"),window.location=e.payments[p].REDIRECT;break}if(o[p].type===s.PAYPAL_PAYMENT_TYPE||o[p].type===s.GENERIC_PAYMENT_TYPE){u=!0,d=!0;break}if(o[p].type==s.CYBERSOURCE_GATEWAY&&o[p].uiIntervention==s.SOP){d=!0,this.destroySpinner(),c.goTo(a.paymentLink,!0),n.Topic(t.topicNames.ORDER_CREATED).publish([{message:"success",id:e.id,uuid:e.uuid}]);break}if(o[p].uiIntervention==s.PAYER_AUTH_REQUIRED){d=!0,this.destroySpinner(),c.goTo(a.paymentLink,!0),n.Topic(t.topicNames.ORDER_CREATED).publish([{message:"success",id:e.id,uuid:e.uuid,customPaymentProperties:o[p].customPaymentProperties}]);break}if(o[p].type&&o[p].type==s.PAYULATAM_CHECKOUT_TYPE&&o[p].uiIntervention==s.SOP){d=!0,n.Topic(t.topicNames.PAYULATAM_WEB_CHECKOUT).publishWith(o[p],[{message:"success",id:e.id,uuid:e.uuid}]),h.getInstance().setItem(s.REDIRECTED_TO_WEB_PAYMENT,"true");break}}if(d)(e.state===s.INCOMPLETE||u)&&n.Topic(t.topicNames.ORDER_CREATED_INITIAL).publishWith(e,[{message:"success",order:e}]),this.destroySpinner();else{this.destroySpinner();var g=i.t("ns.common:resources.orderSubmissionFailed");r.sendError(M,g,!0),n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).publishWith(e,[{message:"fail",data:e}])}}},P.prototype.postOrderCreateOrUpdateFailure=function(e){var a=this;if(this.destroySpinner(),a.cart().isOrderSubmissionInProgress=!1,e&&e.message&&""!==e.message)if(e.__stateData__&&(h.getInstance().removeItem(s.LOCAL_STORAGE_SHOPPER_CONTEXT),h.getInstance().setItem(s.LOCAL_STORAGE_SHOPPER_CONTEXT,e.__stateData__)),e.errorCode==s.INVENTORY_CONFIGURABLE_ITEM_CHECK_ERROR)e.message=i.t("ns.common:resources.orderPricingPromotionError"),r.sendError(M,e.message,!0);else if(e.errors instanceof Array){var o=!1;for(var c in e.errors){if(e.errors[c].errorCode==s.EXTERNAL_PRICE_CHANGED||e.errors[c].errorCode==s.EXTERNAL_PRICE_PARTIAL_FAILURE_ERROR){e.message=i.t("ns.common:resources.orderPricingPromotionError"),r.sendError(M,e.message,!0),o=!0;break}if(o=a.checkSingleException(e),1==o)break}}else a.checkSingleException(e);n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).publishWith(e,[{message:"fail",data:e}])},P.prototype.authPayment=function(){var r=this,i=(r.order(),new _(r.emailAddress(),e.toJS(r.billingAddress()),r.paymentDetails(),r.order()));n.Topic(t.topicNames.ORDER_AUTHORIZE_PAYMENT).publish([{message:"success",details:i}])},P.prototype.paymentAuthorized=function(e){e[0].orderState==s.SUBMITTED&&n.Topic(t.topicNames.ORDER_SUBMISSION_SUCCESS).publish([{message:"success",id:e[0].id,uuid:e[0].uuid}])},P.prototype.paymentDeclined=function(e){n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).publish([{message:"fail"}])},P.prototype.paymentTimeout=function(e){n.Topic(t.topicNames.ORDER_SUBMISSION_FAIL).publish([{message:"fail"}])},P.prototype.setContext=function(e){this.contextData=e,this.paymentLink=this.contextData.global.links.payment.route,this.checkoutLink=this.contextData.global.links.checkout.route,this.cartLink=this.contextData.global.links.cart.route,o.profileType==s.PROFILE_TYPE_AGENT&&(this.agentCheckoutLink=this.contextData.global.links.agentCheckout.route),this.isCardPaymentClientSide=this.contextData.page.payment.isCardPaymentClientSide,this.contextData&&this.contextData.global&&this.contextData.global.site&&this.contextData.global.site.extensionSiteSettings&&this.contextData.global.site.extensionSiteSettings.storeEndpointSettings&&this.contextData.global.site.extensionSiteSettings.storeEndpointSettings.cartFields&&(this.fields=this.contextData.global.site.extensionSiteSettings.storeEndpointSettings.cartFields)},P.prototype.destroySpinner=function(){n("#loadingModal").hide(),l.destroy()},P.prototype.createSpinner=function(e){var t={parent:"#loadingModal",posTop:"0",posLeft:"50%"},e=i.t("ns.common:resources.loadingText");n("#loadingModal").removeClass("hide"),n("#loadingModal").show(),t.loadingText=e,l.create(t)},P.prototype.addValidationCallback=function(e){e&&"function"==typeof e&&this.validationCallbacks.push(e)},P.prototype.triggerValidationCallbacks=function(){if(this.validationCallbacks.length>0)for(var e=this.validationCallbacks.length,t=0;t<e;t++)this.validationCallbacks[t]&&"function"==typeof this.validationCallbacks[t]&&this.validationCallbacks[t]()},P.prototype.addValidationError=function(e,t){this.errorFlag=!0;var a=t;a&&""!==a||(a=i.t("ns.common:resources.checkoutErrorMsg")),r.sendError(e,a,!0)},P.prototype.postPaymentOrderUpdateSuccess=function(e){for(var t=this,i=e.orderId,a=s.ENDPOINT_GET_ORDER,n=0;n<e.paymentResponses.length;n++)e.paymentResponses[n].type==s.PAYPAL_PAYMENT_TYPE&&h.getInstance().setItem(s.PAYMENT_GROUP_AFTER_PAYPAL,e.paymentResponses[n].paymentGroupId);o.request(a,null,function(r){for(var i=0;i<e.paymentResponses.length;i++)for(var a=0;a<r.payments.length;a++)if(e.paymentResponses[i].paymentGroupId==r.payments[a].paymentGroupId){r.payments[a].customPaymentProperties=e.paymentResponses[i].customPaymentProperties,r.payments[a].uiIntervention=e.paymentResponses[i].uiIntervention;break}t.postOrderCreateOrUpdateSuccess(r)},function(e){t.destroySpinner(),r.sendError(M,e.message,!0)},i)},P.prototype.handlePayments=function(){try{r.clearError("handlePlaceOrder"),this.enableOrderButton(!1),this.errorFlag=!1,this.isOrderSubmitted=!1,this.shippingAddressAsBilling()&&this.shippingAddress().copyTo(this.billingAddress()),this.isOrderLocked||this.isOrderSubmitted||(this.isOrderLocked=!0,this.triggerValidationCallbacks(),this.isPayLater()||this.invokePaymentValidations(),this.validateBillingAddress(),this.validateDynamicProperties(),this.errorFlag?(this.enableOrderButton(!0),r.sendError("handlePlaceOrder",i.t("ns.common:resources.checkoutErrorMsg"),!0)):(this.createSpinner(),this.isPayULatamCheckout()&&this.preparePayULatamDataForCreateOrder(s.PAYULATAM_CHECKOUT_TYPE),this.user().loggedIn()&&!this.user().isB2BUser()?(this.placeOrder=!0,this.user().handleUpdateProfile()):this.isSplitPayment()?this.invokePaymentsAPIHandler():this.addPaymentsToOrder()),this.isOrderLocked=!1)}catch(r){this.enableOrderButton(!0),this.isOrderLocked=!1;var e=this.user().loggedIn()?this.user().emailAddress():this.emailAddress(),t=new L(r,this.cart().items(),e,I.getVisitorId(),I.getVisitId());this.exceptionHandler.logWindowOnError(JSON.stringify(t),"","")}},P.prototype.disablePaymentIfNecessary=function(){var e=this;e.cart().items().length>0&&e.isPaymentsDisabled()?e.isPaymentDisabled(!0):e.isPaymentDisabled(!1)},P.prototype.handlePlaceOrder=function(){try{if(r.clearError("handlePlaceOrder"),this.enableOrderButton(!1),this.errorFlag=!1,this.isOrderSubmitted=!1,this.isShippingAddressModified=this.shippingAddress().isModified(),this.isBillingAddressModified=this.billingAddress().isModified(),this.shippingAddressAsBilling()&&this.shippingAddress().copyTo(this.billingAddress()),!this.isOrderLocked&&!this.isOrderSubmitted){if(this.isOrderLocked=!0,this.validateCheckoutRegistration(),this.validateCheckoutCartSummary(),this.showSchedule()&&this.validateSchedule(),this.cart().isSplitShipping()?this.validateShippingGroupRelationships():(this.validateShippingAddress(),this.validateCheckoutOrderSummary()),this.triggerValidationCallbacks(),this.isPayLater()||this.invokePaymentValidations(),this.validateBillingAddress(),this.validateDynamicProperties(),this.placeHolderItemsMsgDisplayed||this.validatePlaceHolderItems(),this.errorFlag)this.enableOrderButton(!0);else if(n.Topic(t.topicNames.CHECKOUT_SAVE_SHIPPING_ADDRESS).publishWith(this.shippingAddress(),[{message:"success"}]),this.createSpinner(),this.isPayULatamCheckout()&&this.preparePayULatamDataForCreateOrder(s.PAYULATAM_CHECKOUT_TYPE),this.createAccount()===!0){var e={widgetId:"checkoutRegistration"};this.user().updateLocalData(!0,!1),this.user().registerUser(e),this.registerUser=!0}else this.user().loggedIn()&&!this.user().isB2BUser()?(this.placeOrder=!0,this.user().handleUpdateProfile()):this.createOrder();this.isOrderLocked=!1}}catch(e){this.enableOrderButton(!0),this.isOrderLocked=!1;var i=this.user().loggedIn()?this.user().emailAddress():this.emailAddress(),a=new L(e,this.cart().items(),i,I.getVisitorId(),I.getVisitId());this.exceptionHandler.logWindowOnError(JSON.stringify(a),"","","",e),this.cart().isOrderSubmissionInProgress=!1}},P.prototype.checkOrderForApproval=function(e){var t=this,r={};r.orderId=e.orderId;var i="checkRequiresApproval";o.request(i,r,function(e){t.approvalRequired(e.requiresApproval)},function(e){})},P.prototype.handlePageReady=function(e){var t=this;t.loadOrderForSubmit(e)},P.getInstance=function(e,t,r,i,a){return P.prototype.singleInstance||(P.prototype.singleInstance=new P(e,t,r,a)),i&&P.prototype.singleInstance.setContext(i),P.prototype.singleInstance},P}),define("pageLayout/layout-mapping",["knockout"],function(e,t){"use strict";function r(t){var r=this;return this.ignore=["data"],this.regions={create:function(i){var a;return a=new t.RegionViewModel,e.mapping.fromJS(i.data,r,a),a.handleMetadata(),a}},
this.widget={create:function(i){var a,o=null;return i.data.id&&(a=t.widgetCache.get("widget",i.data.id),void 0!==a&&void 0!==a.hit&&a.hit?o=a.result:(o=new t.WidgetViewModel(t.basePath),e.mapping.fromJS(i.data,r,o),t.initializeWidget(o,!0),t.widgetCache.set("widget",i.data.id,o))),o}},this.widgets={create:function(e){return r.widget.create(e)}},this}return r}),define("pageLayout/context-handler",["knockout"],function(e){"use strict";function t(){return this.values={global:{},page:{},user:{}},this.eventAnchor=$({}),this}return t.prototype.exclusiveSet=function(t,r,i){var a,o;if(i=i||"user",o=this.values[i],t){for(a in o)o.hasOwnProperty(a)&&a!==t&&this.values[a]&&(this.eventAnchor.trigger(t,null),e.isObservable(o[a])?o[a](null):(o[a]=e.observable(null),o[a].isData=!0));this.set(t,r,i)}},t.prototype.set=function(t,r,i){var a,o;i=i||"user",o=this.values[i],t&&o&&(a=e.utils.unwrapObservable(r),(!o[t]||a!==o[t]()&&(a||o[t]()))&&(o[t]?o[t](a):(o[t]=e.observable(a),o[t].isData=!0),this.eventAnchor.trigger(t,o[t])))},t.prototype.get=function(t,r){var i;return r=r||"user",i=this.values[r],t&&i?e.isObservable(i[t])?i[t]:(i[t]=e.observable(),i[t].isData=!0,i[t]):null},t.prototype.listen=function(e,t){e&&(this.eventAnchor.on(e,t),t(null,this.values[e]))},t.prototype.unlisten=function(e,t){e&&this.eventAnchor.off(e,t)},t.prototype.flush=function(t){var r;t&&(this.eventAnchor=$({}));for(r in this.values.page)this.values.page.hasOwnProperty(r)&&(t||this.eventAnchor.trigger(r,null),e.isObservable(this.values[r])?this.values.page[r](null):this.values.page[r]=null);for(r in this.values.user)this.values.user.hasOwnProperty(r)&&(t||this.eventAnchor.trigger(r,null),e.isObservable(this.values.user[r])?this.values.user[r](null):this.values.user[r]=null)},t}),define("pageLayout/view-model-builder",["knockout","viewModels/paymentsViewModel"],function(e,t){"use strict";return{page:{scope:"global",cachable:!0,load:!0},layout:{cachable:!1,load:function(t,r,i){var a;a=i&&i.model?i.model:new r.masterViewModel;var o={ignore:["data","regions"]};return e.mapping.fromJS(t,o,a),a.data=t.data,a}},region:{cachable:!1,load:function(t,r,i){var a,o=null;return null!==t.id&&void 0!==t.id&&(a=r.cache.get("region",t.id),void 0!==a&&void 0!==a.hit&&a.hit?(o=a.result,t.metadata&&o.metadata(t.metadata)):(o=new r.RegionViewModel,e.mapping.fromJS(t,r.layoutMapping,o),r.cache.set("region",t.id,o))),o.handleMetadata(),o}},widgetDefinition:{cachable:!0,load:function(t,r,i){var a=!1,o=new r.WidgetViewModel(r.basePath);return i&&i.load===!0&&(a=!0),e.mapping.fromJS(t,{},o),r.initializeWidget(o,a),o}},widget:{cachable:!0,load:function(t,r,i){var a=!0,o=new r.WidgetViewModel(r.basePath);return i&&i.load===!1&&(a=!1),e.mapping.fromJS(t,{},o),r.initializeWidget(o,a),o}},category:{cachable:!0,load:!0},product:{cachable:!0,load:function(e,t,r){var i=!0;r&&r.load===!1&&(i=!1);var a=new t.ProductViewModel(e,r);return a.fetchSkuProperties(),a}},store:{scope:"global",cachable:!0,load:!0},links:{scope:"global",cachable:!1,load:!0},payment:{scope:"page",cachable:!1,create:!0,load:function(e,r,i){return t.getInstance(e,r.contextHandler.get("user","global")),r.PaymentDetails.getInstance(r.adapter,e,r.contextHandler.get("user","global"))}},cart:{scope:"global",cachable:!1,load:function(e,t,r){return t.CartViewModel.getInstance(t.adapter,e,r,t.contextHandler.get("user","global"))}},order:{scope:"page",cachable:!1,load:function(e,t,r){return t.OrderViewModel.getInstance(t.adapter,t.contextHandler.get("cart","global"),e,r,t.contextHandler.get("user","global"))}},confirmation:{cachable:!0,load:!0},productList:{cachable:!0,load:function(e,t,r){return e.products}},categoryList:{cachable:!1,load:function(e,t,r){return e}},search:{scope:"global",cachable:!1,load:function(e,t,r){return t.SearchViewModel.getInstance(t.adapter,e,r)}},site:{scope:"global",cachable:!1,load:function(e,t,r){return t.SiteViewModel.getInstance(t.adapter,e,r)}},shippingmethods:{scope:"page",cachable:!1,load:function(e,t,r){return t.ShippingMethodsViewModel.getInstance(t.adapter,e)}},paymentauthorization:{scope:"page",cachable:!1,load:function(e,t,r){var i=new t.PaymentAuthResponseViewModel(t.adapter,e);return i}},space:{scope:"global",cachable:!1,load:function(e,t,r){return t.SpaceViewModel.getInstance(t.adapter,e,r)}},user:{scope:"global",cachable:!1,load:function(e,t,r){return t.UserViewModel.getInstance(t.adapter,e,r)}},orderDetails:{scope:"page",cachable:!1,load:function(e,t,r){return new t.OrderDetailsViewModel(e)}},orderDetailsAgent:{scope:"page",cachable:!1,load:function(e,t,r){return new t.OrderDetailsWrapperViewModel.getInstance(e,r)}}}}),define("viewModels/searchResultDetails",["knockout","ccConstants","ccLogger"],function(e,t,r){"use strict";function i(){if(null!==a)throw new Error("Cannot instantiate more than one SearchResultDetails, use SearchResultDetails.getInstance()");this.initialize()}var a=null;return i.prototype={initialize:function(){this.searchResults=[],this.totalRecordsFound=0,this.recordsPerPage=t.DEFAULT_SEARCH_RECORDS_PER_PAGE,this.searchAdjustments={},this.breadcrumbs={},this.navigation={},this.pageCount=0,this.recordOffSet=0},update:function(e){var i=[],a=[];if(null!=e){if(e["@error"])return void r.error("An error occurred while searching -"+e["@error"]);if(e.searchEventSummary&&(this.searchEventSummary=e.searchEventSummary),e.resultsList){var o="records"in e.resultsList?e.resultsList.records:[];this.searchResults=this.formatSearchResults(o),this.totalRecordsFound="totalNumRecs"in e.resultsList?e.resultsList.totalNumRecs:0,this.recordsPerPage="totalNumRecs"in e.resultsList?e.resultsList.recsPerPage:t.DEFAULT_SEARCH_RECORDS_PER_PAGE,this.recordOffSet="firstRecNum"in e.resultsList?e.resultsList.firstRecNum-1:0;var s=this.totalRecordsFound%this.recordsPerPage>0?1:0;this.pageCount=this.totalRecordsFound>0?Math.floor(this.totalRecordsFound/this.recordsPerPage)+s:0,"pagingActionTemplate"in e.resultsList&&(this.pagingActionTemplate=e.resultsList.pagingActionTemplate)}e.searchAdjustments&&(e.searchAdjustments.originalTerms&&(i=e.searchAdjustments.originalTerms),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}),"undefined"!=typeof i[0]&&i[0]==t.PRODUCT_DISPLAYABLE&&i.splice(0,1),a=i.slice(),$.each(i,function(e,r){r.endsWith(t.SEARCH_WILDCARD)&&(i[e]=r.substr(0,r.length-1))}),e.searchAdjustments.originalTerms=i,e.searchAdjustments.originalSearchTerms=a),this.searchAdjustments=e.searchAdjustments,this.breadcrumbs=e.breadcrumbs,e.navigation&&(this.navigation=e.navigation.navigation),e.assemblerRequestInformation&&(this.assemblerRequestInformation=e.assemblerRequestInformation);var n=["@appFilterState","lastPublishedTime","___etag___","__stateData__","endeca:auditInfo","endeca:siteRootPath","resultsList"];for(var c in e)this.hasOwnProperty(c)||n.indexOf(c)!=-1||(this[c]=e[c])}},formatSearchResults:function(e){for(var r=[],i=0;i<e.length;i++)if(e[i].attributes[t.SEARCH_RECORD_COLLECTION])r.push(e[i]);else{var a=this.formatRecord(e[i].records[0]);a.childSKUs=this.formatChildSkus(e[i].records);var o=["sku.maxActivePrice","sku.minActivePrice","product.repositoryId"];for(var s in e[i].attributes)o.indexOf(s)==-1&&(a[s]=e[i].attributes[s]);e[i].attributes["sku.maxActivePrice"]&&e[i].attributes["sku.maxActivePrice"][0]&&(a.maxActivePrice=e[i].attributes["sku.maxActivePrice"][0]),e[i].attributes["sku.minActivePrice"]&&e[i].attributes["sku.minActivePrice"][0]&&(a.minActivePrice=e[i].attributes["sku.minActivePrice"][0]),a.originalRecord=e[i],r.push(a)}return r},formatChildSkus:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i]={salePrice:e[i].attributes["sku.salePrice"]?e[i].attributes["sku.salePrice"][0]:null,listPrice:e[i].attributes["sku.listPrice"]?e[i].attributes["sku.listPrice"][0]:null,repositoryId:e[i].attributes["sku.repositoryId"],largeImage:{url:e[i].attributes["sku.listingLargeImageURL"]?e[i].attributes["sku.listingLargeImageURL"][0]:""},smallImage:{url:e[i].attributes["sku.listingSmallImageURL"]?e[i].attributes["sku.listingSmallImageURL"][0]:""},primaryThumbImageURL:e[i].attributes["sku.listingThumbImageURL"]?e[i].attributes["sku.listingThumbImageURL"][0]:""};return r},formatRecord:function(e){var t,r,i={},a=["product.repositoryId","product.displayName","product.shippingSurcharge","product.listPrice","product.salePrice","product.description","sku.styleProperty","product.avgCustRating","product.primaryImageAltText","product.primaryImageTitle","product.primaryLargeImageURL","product.primarySmallImageURL","product.primaryMediumImageURL","product.primaryFullImageURL","product.primaryThumbImageURL","sku.listingFullImageURL"];for(var o in e.attributes)a.indexOf(o)==-1&&(i[o]=e.attributes[o]);if(e.attributes["product.repositoryId"]?(i.id=e.attributes["product.repositoryId"],i.repositoryId=e.attributes["product.repositoryId"]):(i.id="",i.repositoryId=""),e.attributes["product.displayName"]?i.displayName=e.attributes["product.displayName"][0]:i.displayName="",e.attributes["product.shippingSurcharge"]?i.shippingSurcharge=Number(e.attributes["product.shippingSurcharge"]):i.shippingSurcharge=0,i.listPrice=Number(e.attributes["product.listPrice"]),i.salePrice=Number(e.attributes["product.salePrice"]),e.attributes["product.description"]?e.attributes["product.description"]instanceof Array&&e.attributes["product.description"].length>0?(i.description=e.attributes["product.description"][0],i.longDescription=e.attributes["product.description"][0]):(i.description=e.attributes["product.description"],i.longDescription=e.attributes["product.description"]):(i.description="",i.longDescription=""),i.route=e.attributes["product.route"]&&e.attributes["product.route"][0]?e.attributes["product.route"][0]:"",Array.isArray(e.attributes["sku.styleProperty"])&&(t=e.attributes["sku.styleProperty"][0],t&&(Array.isArray(e.attributes["sku."+t])&&(r=e.attributes["sku."+t][0]),r&&(i.listingSku={},i.listingSku.images=[],i.listingSku.route=i.route+"?variantName="+t+"&variantValue="+r))),e.attributes["product.avgCustRating"]&&(i.avgCustRating=e.attributes["product.avgCustRating"]),e.attributes["product.primaryImageAltText"]&&(i.primaryImageAltText=e.attributes["product.primaryImageAltText"]),e.attributes["product.primaryImageTitle"]&&(i.primaryImageTitle=e.attributes["product.primaryImageTitle"]),i.primaryLargeImageURL=e.attributes["product.primaryLargeImageURL"]&&e.attributes["product.primaryLargeImageURL"][0]?e.attributes["product.primaryLargeImageURL"][0]:"",i.primarySmallImageURL=e.attributes["product.primarySmallImageURL"]&&e.attributes["product.primarySmallImageURL"][0]?e.attributes["product.primarySmallImageURL"][0]:"",i.primaryThumbImageURL=e.attributes["product.primaryThumbImageURL"]&&e.attributes["product.primaryThumbImageURL"][0]?e.attributes["product.primaryThumbImageURL"][0]:"",i.primaryMediumImageURL=e.attributes["product.primaryMediumImageURL"]&&e.attributes["product.primaryMediumImageURL"][0]?e.attributes["product.primaryMediumImageURL"][0]:"",i.primaryFullImageURL=e.attributes["product.primaryFullImageURL"]&&e.attributes["product.primaryFullImageURL"][0]?e.attributes["product.primaryFullImageURL"][0]:"",e.attributes["sku.listingFullImageURL"]&&e.attributes["sku.listingFullImageURL"][0]){var s={};s.metadata={},i.listingSku||(i.listingSku={},i.listingSku.images=[],i.listingSku.route=i.route),i.listingSku.images.push(s),e.attributes["sku.listingLargeImageURL"]&&(i.listingSku.primaryLargeImageURL=e.attributes["sku.listingLargeImageURL"][0]),e.attributes["sku.listingSmallImageURL"]&&(i.listingSku.primarySmallImageURL=e.attributes["sku.listingSmallImageURL"][0]),e.attributes["sku.listingThumbImageURL"]&&(i.listingSku.primaryThumbImageURL=e.attributes["sku.listingThumbImageURL"][0]),e.attributes["sku.listingMediumImageURL"]&&(i.listingSku.primaryMediumImageURL=e.attributes["sku.listingMediumImageURL"][0]),e.attributes["sku.listingFullImageURL"]&&(i.listingSku.primaryFullImageURL=e.attributes["sku.listingFullImageURL"][0])}return i}},i.getInstance=function(){return null===a&&(a=new i),a},i.getInstance()}),define("pageLayout/search",["knockout","pubsub","ccLogger","viewModels/searchResultDetails","ccConstants","pageViewTracker","navigation","ccStoreConfiguration"],function(e,t,r,i,a,o,s,n){"use strict";function c(l,d){if(c.prototype.singleInstance)throw new Error("Cannot instantiate more than one SearchViewModel, use SearchViewModel.getInstance(pAdapter, data)");var u=this;return u.siteId="Default",u.pagePath="searchresults",u.defaultTypeaheadService="Default/services/typeahead",u.popularTypeaheadSearchService="Default/keywords/typeahead",u.popularTypeaheadSearchInterface="keywords",u.searchPathPattern=RegExp("^.*("+u.pagePath+".*)$"),u.adapter=l,u.isNewSearch=!0,u.isCategorySearch=!1,u.isRequesting=!1,u.searchLocale=e.observable(),u.storeConfiguration=n.getInstance(),u.createSearch=function(e){var t,r=this,i=!(!window.clientConfigData||!window.clientConfigData.useEnhancedSearch||"true"!=window.clientConfigData.useEnhancedSearch);u.assemblerPagesPath=null,r.getFromUrlParam&&(r=u);for(var s in this)this.hasOwnProperty(s)&&(r[s]=this[s]);if(t={},"undefined"!=typeof r.navigationDescriptors&&""!=r.navigationDescriptors&&(t[a.SEARCH_NAV_DESCRIPTORS_KEY]=r.navigationDescriptors),null!==r.suppressResults&&void 0!==r.suppressResults&&(t[a.SEARCH_SUPPRESS_RESULTS]=r.suppressResults),r.searchType&&(t[a.SEARCH_TYPE]=r.searchType),null!==r.recordOffSet&&void 0!==r.recordOffSet&&(t[a.SEARCH_NAV_ERECS_OFFSET]=r.recordOffSet),null!==r.recordsPerPage&&void 0!==r.recordsPerPage&&(t[a.SEARCH_REC_PER_PAGE_KEY]=r.recordsPerPage),r.recSearchKey&&(t[a.SEARCH_NAV_EREC_SEARCHES_KEY]=r.recSearchKey),r.searchText&&(t[a.SEARCH_TERM_KEY]=r.searchText),r.searchInterface&&(t[a.SEARCH_NAV_EREC_SEARCHES_KEY]=r.searchInterface),r.sortDirectiveProperty){var n=r.sortDirectiveProperty;n+=void 0!==r.sortDirectiveOrder&&"desc"===r.sortDirectiveOrder?"|1":"|0",t[a.SEARCH_SORT_ORDER]=n}r.recSpellCorrectionKey&&(t[a.SEARCH_DYM_SPELL_CORRECTION_KEY]=r.recSpellCorrectionKey),r.rangeFilter&&(t[a.SEARCH_RANGE_FILTER]=r.rangeFilter),r.recFilter&&(t[a.SEARCH_NAV_RECORD_FILTER_KEY]=r.recFilter),r.additionalSearchQueryParams&&(t=Object.assign(t,r.additionalSearchQueryParams));var c=["page"];for(var l in r.searchKeysMap)c.indexOf(l)<0&&(null==t[l]||void 0==t[l])&&(t[l]=r.searchKeysMap[l]);t[a.VISITOR_ID]=o.getVisitorId(),t[a.VISIT_ID]=o.getVisitId(),t[a.SEARCH_LANGUAGE]=u.searchLocale(),void 0!==r.newSearch?u.isNewSearch=r.newSearch:u.isNewSearch=!0;var d=u.siteId+"/"+u.pagePath,p=window.location.pathname,h=u.searchPathPattern.exec(p);if(null!=h){var g=h[1];d=u.siteId+"/"+g}e.assemblerPagesPath?(d=d.replace(u.pagePath,e.assemblerPagesPath),u.assemblerPagesPath=e.assemblerPagesPath):u.assemblerPagesPath=null,u.isRequesting||(u.isRequesting=!0,void 0!==r.searchText?u.isCategorySearch=!1:u.isCategorySearch=!0,i||u.assemblerPagesPath?u.adapter.loadJSON(a.ENDPOINT_SEARCH_ASSEMBLER_PAGES,d,t,u.searchSuccess,u.searchError):u.adapter.loadJSON(a.ENDPOINT_SEARCH_SEARCH,d,t,u.searchSuccess,u.searchError),u.matchedSearchPath="")},u.createSearchAndAddData=function(e){u.searchKeysMap={},this.parameters.page&&"number"==typeof parseInt(this.parameters.page)?u.pageNumber=parseInt(this.parameters.page):u.pageNumber=1,null===this.parameters[a.SEARCH_NAV_ERECS_OFFSET]||void 0===this.parameters[a.SEARCH_NAV_ERECS_OFFSET]||"number"!=typeof parseInt(this.parameters[a.SEARCH_NAV_ERECS_OFFSET])?u.recordOffSet=0+(u.pageNumber-1)*a.DEFAULT_SEARCH_RECORDS_PER_PAGE:u.recordOffSet=parseInt(this.parameters[a.SEARCH_NAV_ERECS_OFFSET])+(u.pageNumber-1)*a.DEFAULT_SEARCH_RECORDS_PER_PAGE,u.searchKeysMap[a.SEARCH_NAV_ERECS_OFFSET]=u.recordOffSet,null===this.parameters[a.SEARCH_REC_PER_PAGE_KEY]||void 0===this.parameters[a.SEARCH_REC_PER_PAGE_KEY]||"number"!=typeof parseInt(this.parameters[a.SEARCH_REC_PER_PAGE_KEY])?u.recordsPerPage=a.DEFAULT_SEARCH_RECORDS_PER_PAGE:u.recordsPerPage=parseInt(this.parameters[a.SEARCH_REC_PER_PAGE_KEY]),u.searchKeysMap[a.SEARCH_REC_PER_PAGE_KEY]=u.recordsPerPage,null!==this.parameters[a.SEARCH_TERM_KEY]&&void 0!==this.parameters[a.SEARCH_TERM_KEY]?(u.searchText=decodeURIComponent(this.parameters[a.SEARCH_TERM_KEY]),u.searchKeysMap[a.SEARCH_TERM_KEY]=u.searchText):u.searchText="",null!==this.parameters[a.SEARCH_NAV_EREC_SEARCHES_KEY]&&void 0!==this.parameters[a.SEARCH_NAV_EREC_SEARCHES_KEY]&&(u.recSearchKey=decodeURIComponent(this.parameters[a.SEARCH_NAV_EREC_SEARCHES_KEY]),u.searchKeysMap[a.SEARCH_NAV_EREC_SEARCHES_KEY]=u.recSearchKey),void 0===u.recSearchKey&&(u.recSearchKey=""),null!==this.parameters[a.SEARCH_NAV_DESCRIPTORS_KEY]&&void 0!==this.parameters[a.SEARCH_NAV_DESCRIPTORS_KEY]?(u.navigationDescriptors=decodeURIComponent(this.parameters[a.SEARCH_NAV_DESCRIPTORS_KEY]).replace(/\+/g," "),u.searchKeysMap[a.SEARCH_NAV_DESCRIPTORS_KEY]=u.navigationDescriptors):u.navigationDescriptors="";for(var t in this.parameters)if(t==a.PARAMETERS_TYPE){if(this.parameters[t]!=a.PARAMETERS_SEARCH_QUERY)return}else null!==this.parameters[t]&&void 0!==this.parameters[t]&&(u.searchKeysMap[t]=decodeURIComponent(this.parameters[t]))},u.searchSuccess=function(e){if(e&&e["endeca:redirect"]&&e["endeca:redirect"].link&&e["endeca:redirect"].link.url){var o=e["endeca:redirect"].link.url;return"/"!==o.charAt(0)?navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)?window.open(o,"_newtab"):window.location.replace(o):s.goTo(o,!1,!0),void(u.isRequesting=!1)}var n=[{message:a.SEARCH_MESSAGE_SUCCESS,requestor:u}];e["@error"]?(r.error("search error returned :"+e["@error"]),n=[{message:a.SEARCH_MESSAGE_FAIL}]):(e.assemblerPagesPath=u.assemblerPagesPath,i.update(e),i.isNewSearch=u.isNewSearch),u.isCategorySearch?$.Topic(t.topicNames.SEARCH_RESULTS_FOR_CATEGORY_UPDATED).publishWith(i,n):$.Topic(t.topicNames.SEARCH_RESULTS_UPDATED).publishWith(i,n),u.isRequesting=!1},u.searchError=function(e){if(u.isCategorySearch)$.Topic(t.topicNames.SEARCH_FAILED_TO_PERFORM).publish();else{var r=[{message:a.SEARCH_MESSAGE_FAIL}];$.Topic(t.topicNames.SEARCH_RESULTS_UPDATED).publishWith(e,r)}u.isRequesting=!1},u.typeaheadSearch=function(e){var t,r;void 0!==this.searchText&&(this.searchText=this.searchText.trim()),void 0!==this.typeaheadConfig&&void 0!==this.typeaheadConfig.searchText&&(this.searchText=this.typeaheadConfig.searchText);var i=this.typeaheadConfig,s=function(e){u.successTypeahead(e,i)},n=o.getVisitorId(),c=o.getVisitId();r={},r[a.SEARCH_TERM_KEY]=this.searchText,r[a.SEARCH_NAV_EREC_SEARCHES_KEY]=a.TYPEAHEAD_SEARCH_INTERFACE,r[a.VISITOR_ID]=n,r[a.VISIT_ID]=c,r[a.SEARCH_TYPE]=a.SEARCH_TYPE_TYPEAHEAD,r[a.SEARCH_LANGUAGE]=u.searchLocale(),r[a.ASSEMBLER_PATH_QUERY_PARAM]=a.ASSEMBLER_DEFAULT_TYPEAHEAD_PATH,r[a.ASSEMBLER_REDIRECTS_QUERY_PARAM]="yes",r[a.ASSEMBLER_SITE_QUERY_PARAM]="default",void 0!==this.typeaheadConfig&&void 0!==this.typeaheadConfig.queryParams?(void 0!==this.newSearch&&(u.isNewSearch=this.newSearch),this.typeaheadConfig.queryParams.forEach(function(e,t){r[t]=e}),$.each(this.typeaheadConfig.queryParams,function(e,t){r[e]=t}),i.usePopularSearch===!0?(r[a.SEARCH_NAV_EREC_SEARCHES_KEY]=u.popularTypeaheadSearchInterface,t=u.popularTypeaheadSearchService,u.adapter.loadJSON(a.ENDPOINT_SEARCH_ASSEMBLER_PAGES,t,r,s,u.failureTypeahead)):(t=i.assemblerPagesPath?i.assemblerPagesPath:"Default/services/typeahead",u.adapter.loadJSON(a.ENDPOINT_SEARCH_ASSEMBLER_PAGES,t,r,s,u.failureTypeahead))):(r[a.SEARCH_NAV_ERECS_OFFSET]=this.recordOffSet,r[a.SEARCH_REC_PER_PAGE_KEY]=this.recordsPerPage,void 0!==this.newSearch&&(u.isNewSearch=this.newSearch),t="assembler",u.adapter.loadJSON("assembler",t,r,u.typeaheadSuccess,u.typeaheadError))},u.successTypeahead=function(e,t){var i=[{message:a.SEARCH_MESSAGE_SUCCESS}];if(e["@error"]&&(r.error("search error returned :"+e["@error"]),i=[{message:a.SEARCH_MESSAGE_FAIL}]),e.resultsList&&e.resultsList.records)for(var o=e.resultsList.records,s=0;s<o.length;s++)if(t.assemblerPagesPath||t.usePopularSearch===!0)t.searchResults.push(o[s].attributes);else{var n,c=o[s].records[0],l={};if($.each(t.displayProps,function(e,t){c.attributes[t]&&void 0!==c.attributes[t]?l[t]=c.attributes[t][0]:l[t]=""}),l["product.route"]=c.attributes["product.route"][0],Array.isArray(c.attributes["sku.styleProperty"])&&$.each(c.attributes["sku.styleProperty"],function(e,t){var r;Array.isArray(c.attributes["sku."+t])&&(r=c.attributes["sku."+t][0]),r&&(l["product.route"]=l["product.route"]+"?variantName="+t+"&variantValue="+r)}),o[s].attributes&&o[s].attributes["sku.minActivePrice"]&&Array.isArray(o[s].attributes["sku.minActivePrice"]))n=o[s].attributes["sku.minActivePrice"][0];else{var d,u=c.attributes["product.salePrice"]?c.attributes["product.salePrice"][0]:null,p=c.attributes["product.listPrice"]?c.attributes["product.listPrice"][0]:null,h=u?u:p;Array.isArray(o[s].records)&&o[s].records.length>0&&$.each(o[s].records,function(e,t){var r=t.attributes["sku.salePrice"]?t.attributes["sku.salePrice"][0]:null,i=t.attributes["sku.listPrice"]?t.attributes["sku.listPrice"][0]:null,a=r?r:i;a||(a=h),(!d||a<d)&&(d=a)}),n=d}l.displayPrice=n,l["product.repositoryId"]=c.attributes["product.repositoryId"][0],Array.isArray(c.attributes["product.primaryImageAltText"])?l["product.primaryImageAltText"]=c.attributes["product.primaryImageAltText"][0]:l["product.primaryImageAltText"]="",Array.isArray(c.attributes["product.primaryImageTitle"])?l["product.primaryImageTitle"]=c.attributes["product.primaryImageTitle"][0]:l["product.primaryImageTitle"]="",t.searchResults.push(l)}var e=void 0!==t.getSearchResponse&&t.getSearchResponse?e:null;t.displayCallback(t,e)},u.failureTypeahead=function(e){r.error("Couldn't execute typeahead search query.")},u.typeaheadSuccess=function(e){var o=[{message:a.SEARCH_MESSAGE_SUCCESS}];e["@error"]&&(r.error("search error returned :"+e["@error"]),o=[{message:a.SEARCH_MESSAGE_FAIL}]);var s=[];if(e.resultsList&&e.resultsList.records){var n=[];s=e.resultsList.records,i.update(e),n.push(i.searchResults),n.push(s)}$.Topic(t.topicNames.SEARCH_TYPEAHEAD_UPDATED).publishWith(n,[{message:"success"}])},u.typeaheadError=function(e){var r=([{message:a.SEARCH_MESSAGE_FAIL}],[]);$.Topic(t.topicNames.SEARCH_TYPEAHEAD_UPDATED).publishWith(r,[{message:"success"}])},$.Topic(t.topicNames.SEARCH_CREATE_CATEGORY_LISTING).subscribe(u.createSearch),$.Topic(t.topicNames.SEARCH_CREATE).subscribe(u.createSearch),$.Topic(t.topicNames.PAGE_PARAMETERS).subscribe(u.createSearchAndAddData),$.Topic(t.topicNames.SEARCH_TYPEAHEAD).subscribe(u.typeaheadSearch),u}return c.prototype.setContext=function(e){var t=this;e.global.locale&&t.searchLocale(e.global.locale),t.contextData=e},c.getInstance=function(e,t,r){return c.prototype.singleInstance||(c.prototype.singleInstance=new c(e,t)),r&&c.prototype.singleInstance.setContext(r),c.prototype.singleInstance},c.prototype.getFilteredNavState=function(e){for(var t=[],r=[a.VISITOR_ID,a.VISIT_ID,a.SEARCH_LANGUAGE,a.SEARCH_TYPE],i=e.split("&"),o=0;o<i.length;o++){var s=i[o].split("=");r.indexOf(s[0])==-1&&t.push(i[o])}return t.join("&")},c}),define("viewModels/shippingMethodItemViewModel",["knockout","pubsub","ccStoreUtils"],function(e,t,r){"use strict";function i(i,a){var o=this;return r.fromJS(i,o,!0),o.cartValue=e.observable(a),o.estimatedCostText=e.computed(function(){var e=o.calcCorrectAmout(o.cartValue());if(null!=e)var t=e.toFixed(2).toString();return t},o),o.secondaryCurrencyShippingCost=e.pureComputed(function(){var e=o.calcCorrectAmountInSecondaryCurrency(o.cartValue());if(null!=e)var t=e.toFixed(2).toString();return t},o),o.shippingCost=e.computed(function(){var e=o.calcCorrectAmout(o.cartValue());return e},o),o.cartUpdatedMethod=function(e){o.cartValue(e.amount())},$.Topic(t.topicNames.CART_UPDATED).subscribe(o.cartUpdatedMethod),o}return i.prototype.calcCorrectAmout=function(e){for(var t=this,r=0,i=0;i<t.ranges.length;i++){var a=t.ranges[i].high,o=t.ranges[i].low;null==t.ranges[i].high&&(a=Number.MAX_VALUE),e>=o&&e<=a&&(r=t.ranges[i].amount)}return r},i.prototype.calcCorrectAmountInSecondaryCurrency=function(e){for(var t=this,r=0,i=0;i<t.ranges.length;i++){var a=t.ranges[i].high,o=t.ranges[i].low;null==t.ranges[i].high&&(a=Number.MAX_VALUE),e>=o&&e<=a&&(r=t.ranges[i].secondaryCurrencyShippingAmount)}return r},i}),define("pageLayout/shippingmethods",["knockout","pubsub","ccConstants","viewModels/shippingMethodItemViewModel","ccLogger","pageLayout/cart","jquery","ccRestClient"],function(e,t,r,i,a,o,s,n){"use strict";function c(l,d){if(c.singleInstance)throw new Error("Cannot instantiate more than one ShippingMethodsViewModel, use getInstance(pAdapter, data)");var u=this;return u.adapter=l,u.shippingOptions=e.observableArray(),u.defaultShipping=e.observable(),u.defaultShippingName=e.observable(),u.isOrderInRequestPayloadAllowed=e.observable(!1),u.fetchRequestPayloadFlag=function(){var e=r.ENDPOINT_GET_CLOUD_CONFIGURATION;n.request(e,null,function(e){e&&e.clientConfiguration&&e.clientConfiguration.includeOrderDetailsInShippingMethodsPayload&&u.isOrderInRequestPayloadAllowed(!0)},function(e){u.isOrderInRequestPayloadAllowed(!1)})},u.loadShippingOptions=function(){var e=this[r.SHIPPING_ADDRESS_FOR_METHODS];if(e){if(!e.afterValidation||!u.cart.shippingMethod())if(u.isOrderInRequestPayloadAllowed()){var c=function(e){if(e.items&&1==e.items.length){u.shippingOptions.removeAll(),u.cart=o.getInstance(null,null,null);for(var a=0;a<e.items[0].shippingMethods.length;a++)u.shippingOptions.push(new i(e.items[0].shippingMethods[a],u.cart?u.cart.amount():0));u.setDefaultShipping();var n=[{message:r.SEARCH_MESSAGE_SUCCESS}];s.Topic(t.topicNames.SHIPPING_METHODS_LOADED).publishWith(u,n),u.cart.shippingMethodsLoaded.call(u)}},l=function(e){e&&e.message&&""!==e.message?a.error("order.loadShippingMethod"+e.message):a.error("order.loadShippingMethod - unknown error returned"),s.Topic(t.topicNames.LOAD_SHIPPING_METHODS_FAILED).publishWith(e)};void 0!==this[r.PROFILE_ID]&&(u[r.PROFILE_ID]=this[r.PROFILE_ID]),u.loadMultipleShippingOptions(c,l)}else{var d={};u.cart=o.getInstance(null,null,null),d[r.PRODUCT_IDS_FOR_SHIPPING]=this[r.PRODUCT_IDS_FOR_SHIPPING],void 0!==this[r.PROFILE_ID]&&(d[r.PROFILE_ID]=this[r.PROFILE_ID]),void 0!==this[r.SECONDARY_CURRENCY_CODE]&&(d[r.SECONDARY_CURRENCY_CODE]=this[r.SECONDARY_CURRENCY_CODE]),d.priceInfo={amount:u.cart.amount(),total:u.cart.total(),shipping:u.cart.shipping(),totalWithoutTax:u.cart.totalWithoutTax(),currencyCode:u.cart.currencyCode(),shippingSurchargeValue:u.cart.shippingSurcharge(),tax:u.cart.tax(),subTotal:u.cart.subTotal(),orderDiscount:u.cart.orderDiscount(),coupons:u.cart.coupons()},d.items=[];for(var p=0;p<u.cart.items().length;p++){var h=u.cart.items()[p];h.price=h.itemTotal,d.items.push(h)}d[r.SHIPPING_ADDRESS_FOR_METHODS]=e.toJSON(),d[r.POPULATE_SHIPPING_METHODS]=!0;var g=function(e){var a;if(u.shippingOptions.removeAll(),u.cart=o.getInstance(null,null,null),n.profileType!=r.PROFILE_TYPE_AGENT||""!=u.cart.shippingAddress()){if(void 0!==e){for(a=0;a<e.length;a++)u.shippingOptions.push(new i(e[a],u.cart?u.cart.amount():0));u.setDefaultShipping()}var c=[{message:r.SEARCH_MESSAGE_SUCCESS}];s.Topic(t.topicNames.SHIPPING_METHODS_LOADED).publishWith(u,c),u.cart.shippingMethodsLoaded.call(u)}},f=function(e){e&&e.message&&""!==e.message?a.error("order.loadShippingMethod"+e.message):a.error("order.loadShippingMethod - unknown error returned"),s.Topic(t.topicNames.LOAD_SHIPPING_METHODS_FAILED).publishWith(e)};u.loadMultipleShippingOptions(g,f,d)}delete e.afterValidation}},s.Topic(t.topicNames.RELOAD_SHIPPING_METHODS).subscribe(u.loadShippingOptions),u.createProductIdsFromShippingGroupItems=function(e,t){for(var r=0;r<e.length;r++)t.indexOf(e[r].productId)==-1&&t.push(e[r].productId),e[r].childItems&&e[r].childItems.length>0&&u.createProductIdsFromShippingGroupItems(e[r].childItems,t)},u.loadMultipleShippingOptions=function(e,t,i){var a=null;if(i)a=i;else{u.cart=o.getInstance(null,null,null);var s=u.cart.createCartPricingModel();s.priceInfo={amount:u.cart.amount(),total:u.cart.total(),shipping:u.cart.shipping(),totalWithoutTax:u.cart.totalWithoutTax(),currencyCode:u.cart.currencyCode(),shippingSurchargeValue:u.cart.shippingSurcharge(),tax:u.cart.tax(),subTotal:u.cart.subTotal(),orderDiscount:u.cart.orderDiscount(),coupons:u.cart.coupons()},s.shippingGroups=u.cart.createShippingGroups(!0);for(var c=0;c<s.shippingGroups.length;c++){var l=[];u.createProductIdsFromShippingGroupItems(s.shippingGroups[c].items,l),s.shippingGroups[c].productIdForShippingSurcharge=l,delete s.shippingGroups[c].shippingMethod}void 0!==this[r.PROFILE_ID]&&(s[r.PROFILE_ID]=this[r.PROFILE_ID]),a=s,a.id&&delete a.id}n.request(r.ENDPOINT_SHIPPING_METHODS_LIST_SHIPPING_METHODS,a,function(t){e(t)},function(e){t(e)})},u.cart=o.getInstance(null,null,null),u.cart.registerMultiShippingMethodsCallback(u.loadMultipleShippingOptions),u}return c.prototype.updateEstimatedTextCost=function(t){var r=this;e.utils.arrayForEach(r.shippingOptions(),function(e){e.cartValue(t)})},c.prototype.calcCorrectAmout=function(e,t){for(var r=0,i=0;i<e.ranges.length;i++){var a=e.ranges[i].high,o=e.ranges[i].low;null==e.ranges[i].high&&(a=Number.MAX_VALUE),t>=o&&t<=a&&(r=e.ranges[i].amount)}return r},c.prototype.setDefaultShipping=function(){var e=this;e.shippingOptions().length>=1&&(e.defaultShipping(e.shippingOptions()[0].repositoryId),e.defaultShippingName(e.shippingOptions()[0].displayName))},c.getInstance=function(e,t){return c.singleInstance||(c.singleInstance=new c(e,t),c.singleInstance.fetchRequestPayloadFlag()),c.singleInstance},c}),define("pageLayout/payment-auth-response",["pubsub","ccConstants","ccLogger","ccStoreServerLogger","ccStoreConfiguration"],function(e,t,r,i,a){"use strict";function o(r,o){var n=this;return n.adapter=r,n.numOfRetries=o.maxTries?o.maxTries:t.PAYMENT_AUTHORIZATION_DEFAULT_TRIES,n.delay=o.interval?o.interval:t.PAYMENT_AUTHORIZATION_DEFAULT_INTERVAL,n.storeServerLog=i.getInstance(),n.storeConfiguration=a.getInstance(),void 0!=s&&$.Topic(e.topicNames.PAYMENT_GET_AUTH_RESPONSE).unsubscribe(s),s=n.paymentAuthorizedRequest.bind(this),$.Topic(e.topicNames.PAYMENT_GET_AUTH_RESPONSE).subscribe(s),n}var s;return o.prototype.paymentAuthorizedRequest=function(e){var t=this;e[0].numOfRetries&&(t.numOfRetries=e[0].numOfRetries),e[0].delay&&(t.delay=e[0].delay),t.getPaymentAuthorization(e[0].transactionuuid,e[0].orderid,e[0].orderuuid,e[0].gatewayname,e[0].paymentGroupId)},o.prototype.getPaymentAuthorization=function(e,t,r,i,a){var o=this;o.checkForAuthorization(e,t,r,i,0,a)},o.prototype.checkForAuthorization=function(i,a,o,s,n,c){function l(){if(n<=u.numOfRetries)setTimeout(function(){u.checkForAuthorization(i,a,o,s,n+1,c)},u.delay);else{var t={orderId:a};u.storeServerLog.logError("paymentTimeOut",u.storeServerLog.getMessage("paymentTimeOut",t));var r=[{message:"fail",id:a,gatewayName:s,type:s}];$.Topic(e.topicNames.PAYMENT_AUTH_TIMED_OUT).publish(r)}}function d(e){var t;return e.length>0&&(t=e[e.length-1]),t}var u=this,p={},h={};h[t.ENDPOINT_KEY]=t.ENDPOINT_GET_PAYMENT_GROUP;var g=u.storeConfiguration.getFilterToUse(h);g&&(p[t.FILTER_KEY]=g),u.adapter.loadJSON("paymentGroup",c,p,function(r){if(r.stateAsString&&r.orderStatus)if(r.stateAsString===t.PAYMENT_GROUP_STATE_INITIAL)l();else if(r.stateAsString===t.PAYMENT_GROUP_STATE_REMOVED){var i=d(r.authorizationStatus);if(i){var n=[{message:"fail",id:a,uuid:o,responsedata:i,gatewayName:s,type:s}];n[0].responsedata.reasonCode=t.PROCESS_COMPLETION_FAILED,$.Topic(e.topicNames.PAYMENT_AUTH_DECLINED).publish(n)}}else if(r.stateAsString===t.PAYMENT_GROUP_STATE_AUTHORIZED||r.stateAsString===t.PAYMENT_GROUP_STATE_SETTLED){var i=d(r.authorizationStatus);if(i){var n=[{message:"success",id:a,uuid:o,responsedata:i,gatewayName:s,orderState:r.orderStatus,paymentGroupId:r.id,type:s}];i.authorizationDecision!==t.PAYMENT_AUTHORIZATION_ACCEPT&&1!=i.transactionSuccess||r.orderStatus!==t.SUBMITTED?i.authorizationDecision===t.PAYMENT_AUTHORIZATION_ACCEPT&&r.orderStatus==t.FAILED?(n[0].responsedata.reasonCode=t.PAYMENT_REVERSAL_FAILED,
n[0].message="fail",$.Topic(e.topicNames.PAYMENT_AUTH_DECLINED).publish(n)):i.authorizationDecision!==t.PAYMENT_AUTHORIZATION_ACCEPT&&1!=i.transactionSuccess||r.orderStatus!==t.PENDING_PAYMENT&&r.orderStatus!==t.BEING_AMENDED?l():(n[0].orderState=r.orderStatus,$.Topic(e.topicNames.PAYMENT_AUTH_SUCCESS).publish(n)):($.Topic(e.topicNames.ORDER_COMPLETED).publish(n),$.Topic(e.topicNames.PAYMENT_AUTH_SUCCESS).publish(n))}}else{var i=d(r.authorizationStatus);if(i){var n=[{message:"success",id:a,uuid:o,responsedata:i,gatewayName:s,orderState:r.orderStatus,paymentGroupId:r.id,type:s}];i.authorizationDecision===t.PAYMENT_AUTHORIZATION_ACCEPT?($.Topic(e.topicNames.ORDER_COMPLETED).publish(n),$.Topic(e.topicNames.PAYMENT_AUTH_SUCCESS).publish(n)):(n[0].message="fail",$.Topic(e.topicNames.PAYMENT_AUTH_DECLINED).publish(n))}}else l()},function(e,t,i){e&&e.message&&""!==e.message?r.error("PaymentAuthResponseViewModel.checkForAuthorization - error -"+e.message):r.error("PaymentAuthResponseViewModel.checkForAuthorization -unknown error returned"),l()})},o}),define("pageLayout/parent-organisation",["knockout"],function(e){"use strict";function t(){this.id=e.observable(""),this.name=e.observable(""),this.description=e.observable(""),this.organizationLogoURL=e.observable(""),this.organizationLogoAltText=e.observable(""),this.organizationLogoTitle=e.observable(""),this.delegateApprovalManagement=e.observable("")}return t}),define("pageLayout/organization",["knockout","ccConstants","ccRestClient","viewModels/dynamicPropertyMetaContainer","pageLayout/parent-organisation"],function(e,t,r,i,a){"use strict";function o(o,s){var n=this,c=n.listOfIgnoreProperties();return e.mapping.fromJS(o,c,n),n.blockSize=20,n.sortProperty="email:asc",n.adapter=s,n.id=e.observable(""),n.active=e.observable(!1),n.relativeRoles=e.observable([]),n.approvalRequired=e.observable(!1),n.orderPriceLimit=e.observable(""),n.delegateApprovalManagement=e.observable(!1),n.numberOfActiveApprovers=e.observable(),n.isApprovalWebhookEnabled=e.observable(!1),n.parentOrganization=new a,n.dynamicProperties=e.observableArray(),n.dynamicPropertyMetaInfo=i.getInstance(),o&&(n.id(o.id),n.active(o.active),n.relativeRoles(o.relativeRoles),n.approvalRequired(o.approvalRequired),n.orderPriceLimit(o.orderPriceLimit),n.delegateApprovalManagement(o.delegateApprovalManagement),n.isApprovalWebhookEnabled(o.useExternalApprovalWebhook),e.mapping.fromJS(o.parentOrganization,{},n.parentOrganization),r.profileType==t.PROFILE_TYPE_AGENT?n.getApproverList():n.updatenumberOfActiveApprovers()),n}return o.prototype.updatenumberOfActiveApprovers=function(){var e,r,i=this;r={},r[t.OFFSET]=0,r[t.LIMIT]=i.blockSize,r[t.SORTS]=i.sortProperty;for(var a=i.relativeRoles().length,o=0;o<a;o++)"approver"===i.relativeRoles()[o].function&&(e=i.relativeRoles()[o].repositoryId);r.q='roles.id eq "'+e+'" AND active eq "1"',i.adapter.loadJSON(t.ENDPOINT_LIST_CONTACTS_BY_ORGANIZATION,null,r,function(e){i.numberOfActiveApprovers(e.totalResults)},function(e){})},o.prototype.populateOrganizationViewModel=function(i){var o=this,s=o.listOfIgnoreProperties();e.mapping.fromJS(i,s,o),i&&(o.id(i.id),o.active(i.active),o.relativeRoles(i.relativeRoles),o.approvalRequired(i.approvalRequired),o.orderPriceLimit(i.orderPriceLimit),o.delegateApprovalManagement(i.delegateApprovalManagement),o.isApprovalWebhookEnabled(i.useExternalApprovalWebhook),r.profileType==t.PROFILE_TYPE_AGENT?o.getApproverList():o.updatenumberOfActiveApprovers()),o.parentOrganization=new a,e.mapping.fromJS(i.parentOrganization,{},o.parentOrganization)},o.prototype.populateDynamicPropertiesMetaData=function(){var e=this,i={};i[t.PARENT]=t.ENDPOINT_ORGANIZATION_PARAM,e.dynamicPropertyMetaInfo&&e.dynamicPropertyMetaInfo.dynamicPropertyMetaCache&&!e.dynamicPropertyMetaInfo.dynamicPropertyMetaCache.hasOwnProperty(t.ENDPOINT_ORGANIZATION_PARAM)&&r.request(t.ENDPOINT_GET_ITEM_TYPE,i,function(r){e.dynamicPropertyMetaInfo.intializeDynamicProperties(r.specifications,t.ENDPOINT_ORGANIZATION_PARAM)},function(e){},t.ENDPOINT_ORGANIZATION_PARAM)},o.prototype.listOfIgnoreProperties=function(){var e={ignore:["id","active","relativeRoles","approvalRequired","orderPriceLimit","delegateApprovalManagement","numberOfActiveApprovers","isApprovalWebhookEnabled","parentOrganization"]};return e},o.prototype.getApproverList=function(){for(var e=this,i="",a=0;a<e.relativeRoles().length;a++)"approver"==e.relativeRoles()[a].function&&(i=e.relativeRoles()[a].repositoryId);var o={};o.q='(profileType eq "'+t.B2B_PROFILE_TYPE+'"',o.q+=' AND (roles co "'+i+'") AND active eq "1")',o.queryFormat="SCIM";var s=t.ENDPOINT_SEARCH_CUSTOMERS;r.request(s,o,function(t){e.numberOfActiveApprovers(t.items.length)},function(e){})},o.prototype.loadOrganizationsWithSelfRegistration=function(e,i){var a={};a.q='source eq "selfRegistration"',a.useAdvancedQParser=!0,r.request(t.ENDPOINT_B2B_ADMINISTRATION_LIST_ORGANIZATIONS,a,e,i)},o.prototype.getRegistrationRequest=function(e,i){var a=this,o={};o.q=t.ENDPOINT_ORGANIZATION_TYPE_PARAM+' eq "'+a.id()+'"',o.fields="id",r.request(t.ENDPOINT_LIST_ORGANIZATION_REQUESTS,o,e,i)},o.prototype.getRegistrationRequestNotes=function(e,i,a){var o={};o.fields="approverComments,requesterComments,siteId,relatedOrganizationName",r.request(t.ENDPOINT_GET_ORGANIZATION_REQUEST,o,i,a,e)},o.prototype.updateOrganization=function(e,i,a){var o=this;r.request(t.ENDPOINT_UPDATE_ORGANIZATION,e,i,a,o.id())},o.prototype.updateDynamicProperties=function(e){var r=this,i=r.dynamicPropertyMetaInfo.dynamicPropertyMetaCache[t.ENDPOINT_ORGANIZATION_TYPE_PARAM];r.initializeDynamicProperties(i,e)},o.prototype.initializeDynamicProperties=function(e,t){var r=this;r.dynamicProperties.removeAll();for(var i=[],a=0;a<e.length;a++)if(r.hasOwnProperty(e[a].id())){var o=r[e[a].id()]();if("checkbox"===e[a].type()&&o!==!0&&(o=!1),"update"===t||void 0!==o&&null!==o||"boolean"==typeof o)if("enum"===e[a].type()){for(var s=0;s<o.length;s++)value=o[s],e[a].values.push(value);i.push(e[a])}else e[a].value(o),i.push(e[a])}r.dynamicProperties(r.dynamicProperties().concat(i))},o.prototype.isOrganizationDynamicPropertiesValid=function(){for(var e=this,t=0;t<e.dynamicProperties().length;t++){var r=e.dynamicProperties()[t];if(!r.isValid())return!1}return!0},o.prototype.resetDynamicPropertiesValueIsModified=function(){for(var e=this,t=0;t<e.dynamicProperties().length;t++)e.dynamicProperties()[t].value.isModified&&e.dynamicProperties()[t].value.isModified(!1)},o}),define("viewModels/storeCreditContainer",["knockout"],function(e){"use strict";function t(){if(t.singleInstance)throw new Error("Cannot instantiate more than one StoreCreditContainer, use getInstance(data)");var r=this;r.userStoreCreditDetails={},r.totalStoreCredits=e.observable()}return t.prototype.populateViewModelWithServerData=function(e){var t=this;if(e&&e.paymentResponses&&e.paymentResponses.length>0){var r=0;e.paymentResponses[0].totalAvailableAmount&&!isNaN(e.paymentResponses[0].totalAvailableAmount)&&(r=e.paymentResponses[0].totalAvailableAmount,t.userStoreCreditDetails=e.paymentResponses[0].storeCredits),t.totalStoreCredits(r)}},t.getInstance=function(){return t.singleInstance||(t.singleInstance=new t),t.singleInstance},t}),define("pageLayout/user",["knockout","pubsub","notifier","CCi18n","ccRestClient","ccConstants","koValidate","ccKoValidateRules","storeKoExtensions","navigation","viewModels/address","storageApi","pageLayout/parent-organisation","viewModels/dynamicProperty","pageLayout/organization","ccStoreConfiguration","viewModels/loyalty","viewModels/storeCreditContainer"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I){"use strict";function E(s,n){if(E.singleInstance)throw new Error("Cannot instantiate more than one UserViewModel, use getInstance(pAdapter, pUserData)");var c=this;c.selectedPriceListGroup=e.observable(n.priceListGroup),c.currentOrganization=e.observable(),c.activePriceListGroups=e.observableArray([]),c.dynamicProperties=e.observableArray([]),c.profileType=e.observable(),c.loyaltyPrograms=e.observableArray([]),e.mapping.fromJS(n,{ignore:["links","dynamicProperties"]},c),c.id=e.observable(""),c.login=e.observable(""),c.customerContactId=e.observable(),c.adapter=s,c.resetAll=e.observable(!1),c.emailAddress=e.observable(""),c.emailAddressForForgottenPwd=e.observable(""),c.emailMarketingMails=e.observable(!1),c.emailMarketingModified=e.observable(!1),c.receiveEmailGlobally=e.observable(!1),c.GDPRProfileP13nConsentGranted=e.observable(!1),c.GDPRProfileP13nConsentModified=e.observable(!1),c.previousVisitDate=e.observable(),c.justAfterLogin=e.observable(!1),c.firstName=e.observable(""),c.loggedInUserName=e.observable(""),c.lastName=e.observable(""),c.password=e.observable(""),c.newPassword=e.observable(""),c.confirmPassword=e.observable(""),c.token="",c.primaryShippingAddress=e.observable(""),c.shippingAddressBook=e.observableArray().extend({deferred:!0}),c.defaultShippingAddress=e.observable(),c.editShippingAddress=e.observable(),c.deleteShippingAddress=e.observable(!1),c.locale=e.observable(""),c.supportedLocales=[],c.ssoLoginAccountName=e.observable(""),c.client=e.observable(a),c.loginError=e.observable(""),c.loggedIn=e.observable(c.client().loggedIn),c.isLoginFailed=e.observable(!1),c.readyToDisplay=e.observable(!0),c.autoLoginComplete=$.Deferred(),c.pageAppeared=$.Deferred(),c.registeringUser=!1,c.oldPassword=e.observable(""),c.emailAddress.isData=!0,c.firstName.isData=!0,c.lastName.isData=!0,c.password.isData=!0,c.newPassword.isData=!0,c.confirmPassword.isData=!0,c.oldPassword.isData=!0,c.emailAddressForForgottenPwd.isData=!0,c.locale.isData=!0,c.ssoLoginAccountName.isData=!0,c.loggedinAtCheckout=e.observable(!1),c.loggedoutAtCheckout=e.observable(!1),c.persistedOrder=e.observable(),c.orderId=e.observable(""),c.countOfSubmittedOrders=e.observable(0),c.ignoreEmailValidation=e.observable(!0),c.isLoginNotEmail=e.observable(!1),c.ignorePasswordValidation=e.observable(!0),c.isUserProfileEdited=e.observable(!1),c.delaySuccessNotification=e.observable(!1),c.isSearchInitiatedWithUnsavedChanges=e.observable(!1),c.isUserSessionExpired=e.observable(!1),c.pageToRedirect=e.observable(),c.pageToRedirectAfterLogin=e.observable("/home"),c.isSessionExpiredDuringSave=e.observable(!1),c.isUserLoggedOut=e.observable(!0),c.isPageRedirected=e.observable(!1),c.isResourcesLoaded=e.observable(!1),c.errorMessageKey=e.observable(""),c.successMessageKey=e.observable(""),c.passwordPolicies=e.observable(),c.isChangePassword=e.observable(!1),c.showCreateNewPasswordMsg=e.observable(!1),c.createNewPasswordError=e.observable(""),c.isPasswordExpired=e.observable(!1),c.hasFieldLevelError=e.observable(!1),c.ignoreConfirmPasswordValidation=e.observable(!0),c.forgotPasswordMsg=e.observable(""),c.myWishLists=e.observableArray(),c.joinedWishLists=e.observableArray(),c.isSesExpDuringPlaceOrder=e.observable(!1),c.parentOrganization=new p,n.parentOrganization&&e.mapping.fromJS(n.parentOrganization,{},c.parentOrganization),c.refreshPageAfterContactLogout=e.observable(!1),c.catalogId=e.observable(""),c.roles=e.observableArray([]),c.rolesForCurrentOrganization=e.observableArray([]),c.isUserDataModified=e.observable(!1),c.isDelegatedAdmin=e.observable(!1),c.isApprover=e.observable(!1),c.isAccountAddressManager=e.observable(!1),c.isProfileAddressManager=e.observable(!1),c.organizations=e.observableArray([]),c.currentOrganizationDetails=e.observable(),c.defaultShippingAddressType=e.observable(),c.defaultBillingAddressType=e.observable(),c.redirectNotificationMessage=e.observable(""),c.sessionExpiredProfileRedirected=!1,c.approvalRequired=e.observable(!1),c.orderPurchaseLimit=e.observable(null),c.isHistoricalOrder=!1,c.loyaltyViewModel=e.observable(null),c.storeCreditContainer=e.observable(I.getInstance()),c.comments=e.observable(),c.clonedOrderId=e.observable(""),c.active=e.observable(),c.profileHomeRedirectRoutesArray=[o.PAGETYPE_PROFILE,o.PAGETYPE_ORDER_HISTORY,o.PAGETYPE_ORDER_DETAILS,o.PAGETYPE_SCHEDULED_ORDERS,o.PAGETYPE_ASSET_DETAILS,o.PAGETYPE_ASSETS,o.PAGETYPE_CONFIRMATION],c.onLoadCartSubscribe=null,c.emailAddressFocused=function(){return c.ignoreEmailValidation(!0),!0},c.emailAddressLostFocus=function(){return c.ignoreEmailValidation(!1),!0},c.updatedShippingAddress=null,c.updatedShippingAddressBook=null,c.confirmPassword.subscribe(function(e){c.newPassword.isModified(!0)}),c.emailMarketingMails.subscribe(function(e){c.emailMarketingModified(!0)}),c.GDPRProfileP13nConsentGranted.subscribe(function(e){c.GDPRProfileP13nConsentModified(!0)}),c.updateShippingAddress=function(e){if(c.shippingAddressBook()){var t={translate:function(e,t){return i.t("ns.common:resources."+e,t)}},r=new d("user-shipping-address","",t,c.contextData.page.shippingCountriesPriceListGroup,c.contextData.page.defaultShippingCountry);r.copyFrom(this.toJSON(),c.contextData.page.shippingCountriesPriceListGroup),r.isDefaultAddress(0===c.shippingAddressBook().length),!c.isAddressSaved(r)&&r.isValid()&&c.shippingAddressBook.push(r)}},c.updateLocale=function(){c.locale(this)},c.updateLocaleToSupported=function(){if(void 0!==c.locale.isModified){for(var e=a.getStoredValue(o.LOCAL_STORAGE_USER_CONTENT_LOCALE),r=!1,i=[],s=0;s<c.supportedLocales.length;s++)i.push(c.supportedLocales[s].name);a.previewMode&&!c.contextData&&e?(c.locale(JSON.parse(e)[0].name),r=!0):i.indexOf(c.contextData.global.user.locale)>-1?c.locale(c.contextData.global.user.locale):e?(c.locale(JSON.parse(e)[0].name),r=!0):(c.locale(c.contextData.global.locale),r=!0),c.locale.isModified(!0),r&&a.profileType!=o.PROFILE_TYPE_AGENT&&($.Topic(t.topicNames.USER_PROFILE_UPDATE_SUBMIT).publishWith(c,[{message:"success"}]),c.locale.isModified(!1),$.Topic(t.topicNames.UPDATE_USER_LOCALE_NOT_SUPPORTED_ERROR).publish())}},c.showExpiredPasswordErrorMsg=e.computed(function(){return!c.isPasswordExpired()||!(c.oldPassword.isModified()&&!c.oldPassword.isValid()||c.newPassword.isModified()&&!c.newPassword.isValid()||c.confirmPassword.isModified()&&!c.confirmPassword.isValid()||c.hasFieldLevelError())},c),c.validateUser=function(){return c.ignoreEmailValidation(!1),c.ignorePasswordValidation(!1),c.ignoreConfirmPasswordValidation(!1),c.emailAddress.isModified(!0),c.firstName.isModified(!0),c.lastName.isModified(!0),c.newPassword.isModified(!0),c.confirmPassword.isModified(!0),c.isValid()},c.isValid=function(){return c.emailAddress.isValid()&&c.firstName.isValid()&&c.lastName.isValid()&&c.newPassword.isValid()&&c.confirmPassword.isValid()},c.reset=function(){(c.isUserLoggedOut()||!c.loggedIn()&&!c.isUserSessionExpired())&&(c.login(""),c.isResourcesLoaded()&&c.login.isModified(!1),c.loggedInUserName("")),c.emailAddress(""),c.firstName(""),c.lastName(""),c.loginError(""),c.resetPassword(),c.isLoginFailed(!1),c.emailMarketingMails(!1),c.receiveEmailGlobally(!1),c.GDPRProfileP13nConsentGranted(!1),c.isResourcesLoaded()&&(c.lastName.isModified(!1),c.emailAddress.isModified(!1),c.firstName.isModified(!1))},c.resetPassword=function(){c.password(""),c.newPassword(""),c.confirmPassword(""),c.oldPassword(""),c.isResourcesLoaded()&&(c.password.isModified(!1),c.newPassword.isModified(!1),c.confirmPassword.isModified(!1),c.oldPassword.isModified(!1)),c.isChangePassword(!1)},c.resetDetails=function(){c.firstName(""),c.lastName(""),c.resetPassword(),c.emailMarketingMails(!1),c.GDPRProfileP13nConsentGranted(!1),c.firstName.isModified(!1),c.lastName.isModified(!1),c.emailMarketingModified(!1),c.GDPRProfileP13nConsentModified(!1)},c.isLoginValid=function(){return c.ignoreEmailValidation(!1),this.login.isValid()&&this.password.isValid()},c.validateLogin=function(){var e=this;return e.login.isModified(!0),e.password.isModified(!0),e.isLoginValid()},c.resetLoginData=function(){var e=this;e.login(""),e.password(""),e.loginError(""),e.isLoginFailed(!1),e.isResourcesLoaded()&&(e.login.isModified(!1),e.password.isModified(!1))},c.resetModified=function(){var e=this;e.emailAddress.isModified(!1),e.firstName.isModified(!1),e.lastName.isModified(!1),e.oldPassword.isModified(!1),e.newPassword.isModified(!1),e.confirmPassword.isModified(!1),e.emailMarketingModified(!1),e.GDPRProfileP13nConsentModified(!1)},c.resetShippingAddressBookModified=function(){var t=this;e.utils.arrayForEach(t.shippingAddressBook(),function(e){e.resetModified()})},c.isProfileModified=function(){return!!(c.firstName.isModified()||c.lastName.isModified()||c.emailAddress.isModified()||c.emailMarketingModified()||c.locale.isModified()||c.GDPRProfileP13nConsentModified())},c.isPasswordModified=function(){return!!(c.oldPassword.isModified()||c.newPassword.isModified()||c.confirmPassword.isModified())},c.isPasswordValid=function(e){return e||c.oldPassword.isModified(!0),c.newPassword.isModified(!0),c.confirmPassword.isModified(!0),!(!c.newPassword.isValid()||!c.confirmPassword.isValid()||!e&&!c.oldPassword.isValid())},c.isProfileValid=function(){return c.firstName.isModified(!0),c.lastName.isModified(!0),c.emailAddress.isModified(!0),c.ignoreEmailValidation(!1),!!(c.firstName.isValid()&&c.lastName.isValid()&&c.emailAddress.isValid())},c.isAddressSaved=function(e){for(var t=0;t<c.shippingAddressBook().length;t++)if(e.compare(c.shippingAddressBook()[t]))return!0;return!1},c.isB2BUser=function(){return!(!c.parentOrganization||!c.parentOrganization.name())},c.isB2BProfileType=function(){if(c.profileType()&&c.profileType()==o.B2B_PROFILE_TYPE)return!0},c.isShippingAddressBookModified=function(){if(c.deleteShippingAddress())return!0;for(var e=0;e<c.shippingAddressBook().length;e++)if(c.shippingAddressBook()[e].isModified())return!0;return!1},c.isShippingAddressBookValid=function(){for(var e=0;e<c.shippingAddressBook().length;e++)if(!c.shippingAddressBook()[e].isValid())return!1;return!0},c.isDynamicPropertiesModified=function(){for(var e=0;e<c.dynamicProperties().length;e++)if(c.dynamicProperties()[e].value.isModified())return!0;return!1},c.selectDefaultAddress=function(e){for(var t=0;t<c.shippingAddressBook().length;t++){var r=c.shippingAddressBook()[t];r.isDefaultAddress(r===e)}},c.sortShippingAddresses=function(){c.updatedShippingAddressBook&&c.updatedShippingAddressBook.length&&c.updatedShippingAddressBook.sort(function(e,t){return e.isDefaultAddress?-1:t.isDefaultAddress?1:e.lastName&&t.lastName&&e.lastName.toLowerCase()==t.lastName.toLowerCase()?e.address1.toLowerCase()==t.address1.toLowerCase()?0:e.address1.toLowerCase()<t.address1.toLowerCase()?-1:1:e.lastName&&t.lastName&&e.lastName.toLowerCase()<t.lastName.toLowerCase()?-1:1})},c.loginSuccessFunc=function(e){if(c.loggedIn(c.client().loggedIn),c.isUserSessionExpired(!1),c.isLoginFailed(!1),c.isSesExpDuringPlaceOrder(!1),c.isUserLoggedOut(!1),c.password(""),c.password.isModified(!1),r.clearError(c.WIDGET_ID),c.id(c.client().profileId),l.isPathEqualTo(c.myAccountHash)||c.pageToRedirect()!=c.myAccountHash||(c.sessionExpiredProfileRedirected=!0),c.pageToRedirect()&&""!=c.pageToRedirect()&&c.pageToRedirect()!=c.checkoutHash){var i=c.pageToRedirect();if(c.pageToRedirect(null),l.isPathEqualTo(i)){var a=c.getLocalData();null!=a&&a.login==c.login()&&l.isPathEqualTo(c.myAccountHash)&&!c.isPasswordExpired()&&c.isSessionExpiredDuringSave()||(c.getCurrentUser(e,!0),l.isPathEqualTo(c.myAccountHash)&&(c.isSessionExpiredDuringSave(!1),$.Topic(t.topicNames.USER_PROFILE_SESSION_RESET).publish()))}c.isPageRedirected(!0),l.goTo(i)}else c.getCurrentUser(e,!0),null==c.onLoadCartSubscribe&&(c.onLoadCartSubscribe=$.Topic(t.topicNames.CART_LOADED_FOR_PROFILE).subscribe(function(){if(!c.registeringUser||!c.loggedinAtCheckout()){c.registeringUser=!1;var r=l.getPathWithoutLocale().split("?"),i={pageId:l.getPath(),parameters:r[1],onLogin:!0};c.pageAppeared=$.Deferred(),$.when($.Topic(t.topicNames.PAGE_VIEW_CHANGED).publish(i)).done(function(){e&&(c.storeConfiguration.enablePrioritizedLoading?$.when(c.pageAppeared).done(function(){c.autoLoginComplete.resolve(),c.pageAppeared=$.Deferred()}):c.autoLoginComplete.resolve())})}}));c.isPasswordExpired(!1)},c.loginErrorFunc=function(){c.isLoginFailed(!0),c.loginError(i.t("ns.common:resources.loginError")),c.password(""),c.password.isModified(!1)},c.processDynamicPropertiesMetadata=function(e){for(var t=this,r=[],i=0;i<e.length;i++){for(var a=!0,o=0;o<t.dynamicProperties().length&&a;o++)e[i].id===t.dynamicProperties()[o].id()&&(a=!1,t.dynamicProperties()[o].initializeMetadata(e[i],!1),t.dynamicProperties()[o].value(e[i].value));if(a){var s=new h;s.initializeMetadata(e[i],!0),s.value(e[i].value),r.push(s)}}for(var i=0;i<r.length;i++)t.dynamicProperties.push(r[i])},n.dynamicProperties&&c.processDynamicPropertiesMetadata(n.dynamicProperties),c.populateUserFromLocalData(!1),c.storeConfiguration=f.getInstance(),c.isPunchout=e.observable(!1),c.isPunchout(!!n.isPunchout&&n.isPunchout);var u=a.getStoredValue(o.LOCAL_STORAGE_ADDITIONAL_FORM_DATA);if(u){var g=JSON.parse(u);g&&g.orderId&&c.orderId(g.orderId)}return $.Topic(t.topicNames.USER_REGISTRATION_SUBMIT).subscribe(c.registerUser),$.Topic(t.topicNames.USER_LOGIN_SUBMIT).subscribe(c.handleLogin),$.Topic(t.topicNames.USER_LOGIN_CANCEL).subscribe(c.handleCancel),$.Topic(t.topicNames.SAML_LOGIN_SUCCESSFUL).subscribe(c.SamlLoginSuccessCallback.bind(c)),$.Topic(t.topicNames.SAML_LOGIN_FAILURE).subscribe(c.SamlLoginErrorCallback.bind(c)),$.Topic(t.topicNames.LOCALE_READY).subscribe(c.loadResources.bind(c)),$.Topic(t.topicNames.USER_PROFILE_UPDATE_SUBMIT).subscribe(c.handleUpdateProfile),$.Topic(t.topicNames.USER_PROFILE_UPDATE_CANCEL).subscribe(c.handleUpdateCancel),$.Topic(t.topicNames.PAGE_LAYOUT_LOADED).subscribe(c.handlePageChanged.bind(c)),$.Topic(t.topicNames.PAGE_METADATA_CHANGED).subscribe(c.handlePageChanged.bind(c)),$.Topic(t.topicNames.USER_LOGOUT_SUBMIT).subscribe(c.handleLogout.bind(c)),$.Topic(t.topicNames.USER_SESSION_VALID).subscribe(c.handleSessionValid.bind(c)),$.Topic(t.topicNames.USER_SESSION_EXPIRED).subscribe(c.handleSessionExpired.bind(c)),$.Topic(t.topicNames.CHECKOUT_SAVE_SHIPPING_ADDRESS).subscribe(c.updateShippingAddress),$.Topic(t.topicNames.CHECKOUT_USER_LOCALE).subscribe(c.updateLocale),$.Topic(t.topicNames.USER_LOCALE_NOT_SUPPORTED).subscribe(c.updateLocaleToSupported),c}return E.prototype.loadResources=function(){var e=this;e.firstName.extend({required:{params:!0,message:i.t("ns.common:resources.firstNameRequired")}}),e.lastName.extend({required:{params:!0,message:i.t("ns.common:resources.lastNameRequired")}}),e.locale.extend({required:{params:!0,message:i.t("ns.common:resources.localeRequired")}}),e.emailAddressForForgottenPwd.extend({required:{params:!0,message:i.t("ns.common:resources.emailAddressRequired")},maxLength:{params:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH,message:i.t("ns.common:resources.maxLengthEmailAdd",{maxLength:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH})},email:{params:!0,onlyIf:function(){return!e.ignoreEmailValidation()},message:i.t("ns.common:resources.emailAddressInvalid")}}),e.emailAddress.extend({required:{params:!0,message:i.t("ns.common:resources.emailAddressRequired")},maxLength:{params:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH,message:i.t("ns.common:resources.maxLengthEmailAdd",{maxLength:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH})},email:{params:!0,onlyIf:function(){return!e.ignoreEmailValidation()},message:i.t("ns.common:resources.emailAddressInvalid")}}),e.isLoginNotEmail?e.login.extend({required:{params:!0,message:function(){return e.isLoginNotEmail()?i.t("ns.common:resources.loginRequired"):i.t("ns.common:resources.emailAddressRequired")}},maxLength:{params:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH,message:i.t("ns.common:resources.maxLengthEmailAdd",{maxLength:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH})},email:{params:!0,onlyIf:function(){return!e.ignoreEmailValidation()&&!e.isLoginNotEmail()},message:i.t("ns.common:resources.emailAddressInvalid")}}):e.login.extend({required:{params:!0,message:i.t("ns.common:resources.emailAddressRequired")},maxLength:{params:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH,message:i.t("ns.common:resources.maxLengthEmailAdd",{maxLength:o.CYBERSOURCE_EMAIL_MAXIMUM_LENGTH})},email:{params:!0,onlyIf:function(){return!e.ignoreEmailValidation()},message:i.t("ns.common:resources.emailAddressInvalid")}}),e.password.extend({required:{params:!0,message:i.t("ns.common:resources.passwordRequired")}}),e.newPassword.extend({password:{params:{policies:e.passwordPolicies,login:e.emailAddress,observable:e.newPassword,includePreviousNPasswordRule:e.isChangePassword},onlyIf:function(){return(!e.ignoreEmailValidation()||e.newPassword.isModified())&&!e.ignorePasswordValidation()},message:i.t("ns.common:resources.passwordPoliciesErrorText")},required:{params:!0,message:i.t("ns.common:resources.passwordRequired")}}),e.oldPassword.extend({required:{params:!0,message:i.t("ns.common:resources.currentPasswordRequired")}}),e.confirmPassword.extend({required:{params:!0,message:i.t("ns.common:resources.confirmPasswordRequired")},match:{params:e.newPassword,onlyIf:function(){return!e.ignoreConfirmPasswordValidation()},message:i.t("ns.common:resources.passwordUnmatched")}}),e.isResourcesLoaded(!0)},E.prototype.populateUserFromLocalData=function(e){var t=this,r=t.getLocalData();null!=r&&a.profileType!=o.PROFILE_TYPE_AGENT&&(t.loggedinAtCheckout(r.loggedinAtCheckout),t.loggedoutAtCheckout(r.loggedoutAtCheckout),t.orderId(r.orderId),e&&r.login&&(t.loggedInUserName(r.loggedInUserName),t.login(r.login),t.isUserSessionExpired(r.isUserSessionExpired),t.isUserLoggedOut(r.isUserLoggedOut)))},E.prototype.getLocalData=function(){var e=null;try{e=u.getInstance().getItem("user"),e&&(e=JSON.parse(e))}catch(e){}return e},E.prototype.setLocalData=function(e){var t=this;if(!e&&""==e)return!0;var r=t.getLocalData();switch(null==r&&(r={}),e){case"all":r={loggedinAtCheckout:t.loggedinAtCheckout(),loggedoutAtCheckout:t.loggedoutAtCheckout(),orderId:t.orderId(),loggedInUserName:t.loggedInUserName(),login:t.login(),isUserSessionExpired:t.isUserSessionExpired(),isUserLoggedOut:t.isUserLoggedOut()};break;case"checkoutFlag":r.loggedinAtCheckout=t.loggedinAtCheckout(),r.loggedoutAtCheckout=t.loggedoutAtCheckout();break;case"orderId":r.orderId=t.orderId();break;case"sessionExpiry":r.isUserSessionExpired=t.isUserSessionExpired(),r.isUserLoggedOut=t.isUserLoggedOut()}try{u.getInstance().setItem("user",JSON.stringify(r))}catch(e){}},E.prototype.updateLocalData=function(e,t){var r=this;r.loggedinAtCheckout(e),r.loggedoutAtCheckout(t),r.setLocalData("checkoutFlag")},E.prototype.removeLocalData=function(){try{u.getInstance().removeItem("user")}catch(e){}},E.prototype.removeSoftLoginCookie=function(){try{u.getInstance().saveToCookies("SOFT_LOGIN","",-1)}catch(e){}},E.prototype.resetForgotPassword=function(e){var r=this,i={};i[o.LOGIN]=e||r.emailAddressForForgottenPwd();var s=function(e){$.Topic(t.topicNames.USER_RESET_PASSWORD_SUCCESS).publish(e)},n=function(e){$.Topic(t.topicNames.USER_RESET_PASSWORD_FAILURE).publish(e)};a.profileType==o.PROFILE_TYPE_AGENT?a.request(o.ENDPOINT_FORGOT_PASSWORD,i,s,n,r.id()):r.adapter.persistCreate(o.ENDPOINT_FORGOT_PASSWORD,"id",i,null,s,n)},E.prototype.handleLogin=function(){var e=this;return e.isLoginValid()?(a.setStoredValue(o.LOCAL_STORAGE_ORGANIZATION_ID,null),void e.client().login(this.login(),this.password(),function(){e.loginSuccessFunc(!1),$.Topic(t.topicNames.USER_LOGIN_SUCCESSFUL).publish()},function(r){r.error==o.PASSWORD_EXPIRED?(e.isPasswordExpired(!0),$.Topic(t.topicNames.USER_PASSWORD_EXPIRED).publish()):r.error==o.PASSWORD_GENERATED?(e.isPasswordExpired(!0),$.Topic(t.topicNames.USER_PASSWORD_GENERATED).publish()):(e.loginErrorFunc(),$.Topic(t.topicNames.USER_LOGIN_FAILURE).publish(r))})):(e.login.isModified(!0),e.password.isModified(!0),!1)},E.prototype.handleSamlLogin=function(){var e=this;a.setStoredValue(o.LOCAL_STORAGE_ORGANIZATION_ID,null);var r=l.getPathWithoutLocale();if(r.indexOf("?loggedIn=false")>-1){var i=r.indexOf("page=")+5;r=decodeURIComponent(r.substr(i)),r="/"===r.charAt(0)?r:"/"+r}else r=l.getRelativePath()+l.getQueryString();e.client().setSessionStoredValue("SSO_RETURN_URL",r),u.getInstance().removeFromMemory(o.CC_IS_SSO_LOGIN_FAILURE),e.client().generateSamlAuthnRequest(function(t){var r=$("<form/>",{action:t.authnRequestTarget,method:"POST"});r.append($("<input>",{type:"text",name:"SAMLRequest",value:t.authnRequest})),r.append($("<input>",{type:"text",name:"RelayState",value:e.ssoLoginAccountName()})),$(document.body).append(r),r.submit()},function(r){e.loginErrorFunc(),$.Topic(t.topicNames.USER_LOGIN_FAILURE).publish(r)})},E.prototype.SamlLoginSuccessCallback=function(){var e=this,r=a.getSessionStoredValue("SSO_RETURN_URL");null==r&&(r="/"),e.pageToRedirect(r),a.setSessionStoredValue("SSO_RETURN_URL",null),e.loginSuccessFunc(!1),u.getInstance().removeFromMemory(o.CC_IS_SSO_LOGIN_UNDER_PROGRESS),$.Topic(t.topicNames.USER_LOGIN_SUCCESSFUL).publish()},E.prototype.SamlLoginErrorCallback=function(e){var r=this;a.setSessionStoredValue("SSO_RETURN_URL",null),r.loginErrorFunc(),u.getInstance().removeFromMemory(o.CC_IS_SSO_LOGIN_UNDER_PROGRESS),u.getInstance().saveToMemory(o.CC_IS_SSO_LOGIN_FAILURE,!0),$.Topic(t.topicNames.USER_LOGIN_FAILURE).publish(e)},E.prototype.handleLogout=function(){var e=this;$.Topic(t.topicNames.USER_CLEAR_CART).publish([{message:"success"}]);var r=function(){if($.Topic(t.topicNames.USER_LOGOUT_SUCCESSFUL).publish([{message:"success"}]),u.getInstance().removeItem(o.LOCAL_STORAGE_SHOPPER_CONTEXT),u.getInstance().removeItem(o.LOCAL_STORAGE_CURRENT_CONTEXT),a.clearStoredValue(o.LOCAL_STORAGE_PRICELISTGROUP_ID),e.clearUserData(),e.profileRedirect(),e.refreshPageAfterContactLogout())e.refreshPageAfterContactLogout(!1),window.location.assign(e.contextData.global.links.home.route);else{var r={pageId:l.getPath()};$.Topic(t.topicNames.PAGE_VIEW_CHANGED).publish(r)}},i=function(t){e.clearUserData(),e.profileRedirect(),window.location.assign(e.contextData.global.links.home.route)};e.loggedIn()?(e.parentOrganization&&e.parentOrganization.name()&&e.refreshPageAfterContactLogout(!0),e.client().logout(r,i)):(e.clearUserData(),$.Topic(t.topicNames.USER_LOGOUT_SUCCESSFUL).publish([{message:"success"}]),e.profileRedirect())},E.prototype.profileRedirect=function(){var e=this,t=l.getPathWithoutLocale();t="/"===t.charAt(0)?t.substr(1):t;for(var r=0;r<e.profileHomeRedirectRoutesArray.length;r++){var i=l.getPathWithoutLocale(e.contextData.global.links[e.profileHomeRedirectRoutesArray[r]].route);if(i="/"===i.charAt(0)?i.substr(1):i,0===t.indexOf(i)){l.goTo(e.contextData.global.links.home.route);break}}},E.prototype.clearUserData=function(){var e=this;e.isUserSessionExpired(!1),e.isUserLoggedOut(!0),e.removeLocalData(),e.removeSoftLoginCookie(),e.loggedIn(!1),e.editShippingAddress(null),e.deleteShippingAddress(!1),e.shippingAddressBook([]),e.resetLoginData(),e.reset(),e.updatedShippingAddress=null,e.updatedShippingAddressBook=null,e.id(null),e.parentOrganization=new p,e.organizations([]),e.locale(""),e.loyaltyViewModel(null),e.storeCreditContainer(null),$.Topic(t.topicNames.USER_LOAD_SHIPPING).publish([{message:"success"}]);for(var r=0;r<e.dynamicProperties().length;r++)e.dynamicProperties()[r].reset()},E.prototype.handleCancel=function(){var e=this;e.resetLoginData(),r.clearError(e.WIDGET_ID)},E.prototype.registerUser=function(e){var r=this,s=!1,n=!1;r.receiveEmail=r.emailMarketingMails()?"yes":"no";var c={};if(e.inputParams)c=e.inputParams;else{if(c[o.PROFILE_EMAIL]=r.emailAddress(),c[o.PROFILE_PASSWORD]=r.newPassword(),c[o.PROFILE_FIRST_NAME]=r.firstName(),c[o.PROFILE_LAST_NAME]=r.lastName(),c[o.PROFILE_RECEIVE_EMAIL]=r.receiveEmail,c[o.PROFILE_GDPR_CONSENT_GRANTED_KEY]=r.GDPRProfileP13nConsentGranted(),null!==r.shippingAddressBook()&&void 0!=r.shippingAddressBook()&&r.isShippingAddressBookValid()&&(c[o.PROFILE_SHIPPING_ADDRESSES]=r.shippingAddressBook()),!r.locale()){var l=a.getStoredValue(o.LOCAL_STORAGE_USER_CONTENT_LOCALE);l&&r.locale(JSON.parse(l)[0].name)}c[o.PROFILE_LOCALE]=r.locale()}if(r.dynamicProperties().length>0&&r.isDynamicPropertiesModified()){for(var d=0;d<r.dynamicProperties().length;d++){var u=r.dynamicProperties()[d];if(!u.isValid()){
s=!0;break}}s||(n=!0)}return s?void $.Topic(t.topicNames.USER_PROFILE_UPDATE_INVALID).publish():(n&&r.handleDynamicPropertiesUpdate(c),void r.adapter.persistCreate(o.ENDPOINT_CREATE_PROFILE,o.ENDPOINT_CREATE_PROFILE,c,function(t){r.resetDynamicPropertiesValueIsModified(),e.successCallback?e.successCallback(t):(r.registeringUser=!0,t.widgetId=e.widgetId,r.handleAutoLogin(e))},function(r){r.widgetId=e.widgetId,r.errorCode==o.CREATE_PROFILE_USER_EXISTS&&(r.message=i.t("ns.common:resources.accountAlreadyExists")),$.Topic(t.topicNames.USER_CREATION_FAILURE).publish(r)}))},E.prototype.handleAutoLogin=function(e){var r=this;r.orderId(""),r.login(r.emailAddress()),a.setStoredValue(o.LOCAL_STORAGE_ORGANIZATION_ID,null),r.client().login(r.login(),r.newPassword(),function(){var i={};i.widgetId=e.widgetId,i.isAutoLogin=!0,r.loginSuccessFunc(!0),$.Topic(t.topicNames.USER_AUTO_LOGIN_SUCCESSFUL).publish(i)},function(i){i.widgetId=e.widgetId,r.loginErrorFunc(),$.Topic(t.topicNames.USER_AUTO_LOGIN_FAILURE).publish(i)})},E.prototype.resetDynamicPropertiesValueIsModified=function(){for(var e=this,t=0;t<e.dynamicProperties().length;t++)e.dynamicProperties()[t].value.isModified&&e.dynamicProperties()[t].value.isModified(!1)},E.prototype.getCurrentUser=function(i,s,n,c){var d=this;d.redirectNotificationMessage("");var u={},p={};p[o.ENDPOINT_KEY]=o.ENDPOINT_GET_CURRENT_USER,p[o.IDENTIFIER_KEY]="userData";var h=d.storeConfiguration.getFilterToUse(p);h&&(u[o.FILTER_KEY]=h);var g=function(r){d.currentOrganization(r.currentOrganization),e.mapping.fromJS(r,{ignore:["links","dynamicProperties"]},d),d.populateUserViewModel(r),d.resetModified(),d.readyToDisplay(!0),i?$.Topic(t.topicNames.AUTO_LOGIN_AND_GET_USER_DATA_SUCCESSFUL).publish():s&&!d.loggedinAtCheckout()?$.Topic(t.topicNames.CART_READY).subscribe(function(){$.Topic(t.topicNames.USER_LOAD_SHIPPING).publish([{message:"success"}]),$.Topic(t.topicNames.CART_READY).unsubscribe()}):$.Topic(t.topicNames.USER_LOAD_SHIPPING).publish([{message:"success"}]),d.sessionExpiredProfileRedirected&&(s=!0,d.sessionExpiredProfileRedirected=!1),s&&(r.parentOrganization&&r.parentOrganization.name&&(l.isPathEqualTo(d.checkoutHash)||$.Topic(t.topicNames.CART_READY).subscribe(d.navigateToHome())),$.Topic(t.topicNames.USER_LOAD_CART).publish(r)),"undefined"!=typeof n&&n&&n(r)},f=function(e){e.status==o.HTTP_UNAUTHORIZED_ERROR&&(d.handleSessionExpired(),(l.isPathEqualTo(d.contextData.global.links.profile.route)||l.isPathEqualTo(d.contextData.global.links.orderHistory.route))&&l.doLogin(l.getPath(),d.contextData.global.links.home.route)),"undefined"!=typeof c&&c&&c(e)};a.profileType==o.PROFILE_TYPE_AGENT?a.request(o.ENDPOINT_GET_CUSTOMER,{},function(e){var t=e.profileDetail;t.dynamicProperties=e.dynamicProperties,t.priceListGroup.id=t.priceListGroup.repositoryId,g(t)},f,d.id()):d.adapter.loadJSON("getUser","getCurrentUser",u,g,f),d.navigateToHome=function(){setTimeout(function(){var e=d.pageToRedirectAfterLogin();void 0!=e&&""!=e||(e=l.getPathWithoutLocale()),d.navigateToPage(e,function(){""!==d.redirectNotificationMessage()&&(r.sendWarningToPage("UserViewModel",d.redirectNotificationMessage(),!0,"home",!0),d.redirectNotificationMessage(""))})},2e3)}},E.prototype.populateUserViewModel=function(t){var r=this;r.emailAddress(t.email),r.firstName(t.firstName),r.lastName(t.lastName),r.loggedInUserName(t.firstName),r.login(r.emailAddress()),r.GDPRProfileP13nConsentGranted(t.GDPRProfileP13nConsentGranted),r.customerContactId(t.customerContactId);var i=t.receiveEmail;if("yes"==i?r.emailMarketingMails(!0):r.emailMarketingMails(!1),r.id(t.id),r.approvalRequired(t.derivedApprovalRequired),r.orderPurchaseLimit(t.derivedOrderPriceLimit),r.isPunchout(!!t.isPunchout&&t.isPunchout),r.locale(""),r.isDelegatedAdmin(!1),r.isAccountAddressManager(!1),r.isProfileAddressManager(!1),r.isApprover(!1),r.comments(t.comments),t.catalog&&r.catalogId(t.catalog.repositoryId),r.loyaltyPrograms(t.loyaltyPrograms),r.catalog&&(r.catalog=void 0),r.profileType(t.profileType),t.currentOrganization){r.currentOrganization(t.currentOrganization),null==r.parentOrganization&&(r.parentOrganization=new p),e.mapping.fromJS(t.currentOrganization,{},r.parentOrganization),r.parentOrganization.id(t.currentOrganization.repositoryId);var s=JSON.parse(a.getStoredValue(o.LOCAL_STORAGE_ORGANIZATION_ID));!s&&t.currentOrganization&&a.setStoredValue(o.LOCAL_STORAGE_ORGANIZATION_ID,e.toJSON(t.currentOrganization.repositoryId))}else if(t.parentOrganization&&t.parentOrganization.active)r.parentOrganization||(r.parentOrganization=new p),e.mapping.fromJS(t.parentOrganization,{},r.parentOrganization),r.parentOrganization.id(t.parentOrganization.repositoryId),r.currentOrganization(t.parentOrganization);else if(t.secondaryOrganizations&&t.secondaryOrganizations.length>0){for(var n=t.secondaryOrganizations,c=0;c<n.length;c++)if(n[c].active){r.parentOrganization||(r.parentOrganization=new p),e.mapping.fromJS(t.secondaryOrganizations[c],{},r.parentOrganization),r.parentOrganization.id(t.secondaryOrganizations[c].repositoryId),r.currentOrganization(t.secondaryOrganizations[c]);break}}else r.parentOrganization=null,r.currentOrganization(null);if(r.active(t.active),t.roles&&t.roles.length>0){var d=t.roles.length,u=r.currentOrganization()?r.currentOrganization().repositoryId:null;r.resetRoles();for(var h=[],f=0;f<d;f++){r.roles.push(t.roles[f]);var m=t.roles[f].relativeTo;("object"==typeof m&&m.repositoryId===u||m===u)&&(h.push(t.roles[f].function),"accountAddressManager"===t.roles[f].function&&r.isAccountAddressManager(!0),"profileAddressManager"===t.roles[f].function&&r.isProfileAddressManager(!0),"admin"===t.roles[f].function?r.isDelegatedAdmin(!0):"approver"===t.roles[f].function&&r.isApprover(!0))}r.rolesForCurrentOrganization(h)}r.isB2BUser()&&(r.isDelegatedAdmin()||a.profileType==o.PROFILE_TYPE_AGENT)&&(a.profileType===o.PROFILE_TYPE_AGENT&&(r.contextManager=require("agentViewModels/agent-context-manager").getInstance(),r.contextManager.setShopperProfileId(r.id()),r.contextManager.setCurrentOrganizationId(r.parentOrganization?r.parentOrganization.id():null)),a.request(o.ENDPOINT_GET_ORGANIZATION,null,function(e){r.defaultShippingAddressType(e.derivedShippingAddressType),r.defaultBillingAddressType(e.derivedBillingAddressType),r.organizations&&r.organizations().length>0?r.organizations()[0].populateOrganizationViewModel(e):r.organizations.push(new g(e,r.adapter)),r.organizations&&r.organizations().length>0&&r.organizations()[0].populateDynamicPropertiesMetaData(),r.currentOrganizationDetails(r.organizations()[0])},function(e){e.status==o.HTTP_UNAUTHORIZED_ERROR&&(r.handleSessionExpired(),(l.isPathEqualTo(r.contextData.global.links.profile.route)||l.isPathEqualTo(r.contextData.global.links.orderHistory.route))&&l.doLogin(l.getPath(),r.contextData.global.links.home.route))},r.parentOrganization.id())),r.selectedPriceListGroup(t.priceListGroup);var I=r.contextData.global.site.priceListGroup.activePriceListGroups;if(!r.isB2BUser()&&r.selectedPriceListGroup()){var E=!1;if(a.getStoredValue(o.LOCAL_STORAGE_PRICELISTGROUP_ID))for(var v=JSON.parse(a.getStoredValue(o.LOCAL_STORAGE_PRICELISTGROUP_ID)),c=0;c<I.length;c++)if(v&&v==I[c].id){r.selectedPriceListGroup(I[c]),E=!0;break}E||r.selectedPriceListGroup(r.contextData.global.site.priceListGroup.defaultPriceListGroup)}if(a.setStoredValue(o.LOCAL_STORAGE_PRICELISTGROUP_ID,e.toJSON(r.selectedPriceListGroup().id)),r.previousVisitDate(t.previousVisitDate),r.deleteShippingAddress(!1),r.updatedShippingAddress=t.shippingAddress,r.updatedShippingAddress&&(r.updatedShippingAddress.isDefaultAddress=!0),r.updatedShippingAddressBook=t.shippingAddresses,r.updatedShippingAddressBook.length)if(null==r.updatedShippingAddress)r.updatedShippingAddressBook[0].isDefaultAddress=!0;else for(var y=0,b=r.updatedShippingAddressBook.length;y<b;y++)r.updatedShippingAddressBook[y].isDefaultAddress=r.updatedShippingAddressBook[y].repositoryId===r.updatedShippingAddress.repositoryId;r.organizationAddressBook=[];for(var T in t.secondaryAddresses){var P=t.secondaryAddresses[T];P.isDefaultAddress=!1,r.organizationAddressBook.push(t.secondaryAddresses[T])}r.contactShippingAddress=t.contactShippingAddress,r.primaryShippingAddress(r.contactShippingAddress),r.contactBillingAddress=t.contactBillingAddress,r.sortShippingAddresses(),r.isUserSessionExpired(!1),r.isUserLoggedOut(!1),r.populateUserFromLocalData(!1),r.setLocalData("all");for(var c=0;c<this.supportedLocales.length;c++)t.locale===this.supportedLocales[c].name&&(r.locale(t.locale),void 0!==r.locale.isModified&&r.locale.isModified(!1));r.locale()||r.updateLocaleToSupported(),r.processDynamicPropertiesMetadata(t.dynamicProperties),r.resetDynamicPropertiesValueIsModified()},E.prototype.resetRoles=function(){var e=this;e.roles([]),e.isAccountAddressManager(!1),e.isProfileAddressManager(!1),e.isDelegatedAdmin(!1),e.isApprover(!1)},E.prototype.setContext=function(e){var t=this;t.contextData=e,t.myAccountHash=t.contextData.global.links.profile.route,t.checkoutHash=t.contextData.global.links.checkout.route,t.homeHash=t.contextData.global.links.home.route,t.passwordPolicies(e.global.passwordPolicies),t.readyToDisplay(!0),e.global.user.catalog&&t.catalogId(e.global.user.catalog.repositoryId),t.catalog&&(t.catalog=void 0),e.global.supportedLocales&&e.global.supportedLocales.length>0?t.supportedLocales=e.global.supportedLocales:t.supportedLocales=e.global.site.additionalLanguages,e.global.user.firstName?t.populateUserViewModel(e.global.user):(t.populateUserFromLocalData(!0),t.isUserLoggedOut()||t.loggedIn()||t.isUserSessionExpired()||void 0==t.login()||""==t.login()||t.handleSessionExpired())},E.prototype.handlePageChanged=function(e,r){var i=this,a=i.storeConfiguration.isFreshPageLoad,o=!1;if(i.storeConfiguration.isLargeCart()===!0&&a===!0){var s=u.getInstance().getItem("shoppingCart");s&&"string"==typeof s&&(s=JSON.parse(s),s.userActionPending===!0&&(o=!0))}(i.isPageRedirected()||!i.loggedIn()||i.loggedinAtCheckout()||r.onLogin||window.isAgentApplication||i.storeConfiguration.isLargeCart())&&(i.storeConfiguration.isLargeCart()!==!0||a!==!0||o!==!1)||$.Topic(t.topicNames.REFRESH_USER_CART).publish(i),i.isPageRedirected(!1)},E.prototype.handleSessionExpired=function(){var e=this;u.getInstance().removeItem(o.LOCAL_STORAGE_SHOPPER_CONTEXT),u.getInstance().removeItem(o.LOCAL_STORAGE_CURRENT_CONTEXT),e.isUserSessionExpired()||e.isUserLoggedOut()||(e.loggedIn(!1),l.isPathEqualTo(e.myAccountHash)||0!=e.isSesExpDuringPlaceOrder()||(e.resetLoginData(),e.reset(),e.id(null)),l.isPathEqualTo(e.checkoutHash)||l.getPath().indexOf(e.checkoutHash)>=0||$.Topic(t.topicNames.USER_CLEAR_CART).publish(e),e.populateUserFromLocalData(!0),e.orderId(""),e.loggedinAtCheckout(!1),e.loggedoutAtCheckout(!1),e.isUserSessionExpired(!0),e.isUserLoggedOut(!1),e.setLocalData("sessionExpiry"),e.readyToDisplay(!0))},E.prototype.handleSessionValid=function(){var e=this;e.loggedIn(e.client().loggedIn),e.isUserSessionExpired(!1),e.isUserLoggedOut(!1),e.setLocalData("sessionExpiry"),e.readyToDisplay(!0)},E.prototype.validatePrivilagePageRequest=function(e,t){var r=this;if(r.isUserProfileEdited())return!0;var i=t.currentTarget.pathname,a=i.indexOf("#!");return a>=0&&(i=i.substring(a+2)),r.validateAndRedirectPage(i),!1},E.prototype.navigateToPage=function(e,r){if(l.isPathEqualTo(e)){var i={pageId:l.getPath()};$.Topic(t.topicNames.PAGE_VIEW_CHANGED).publish(i)}else l.goTo(e),r&&r()},E.prototype.validateAndRedirectPage=function(e){var r,i=this;if(e!=o.PAYPAL_CHECKOUT_TYPE&&(r=[{message:"success",linkToRedirect:e}]),!i.loggedIn()&&i.isUserSessionExpired())e==o.PAYPAL_CHECKOUT_TYPE&&l.isPathEqualTo(i.checkoutHash)?$.Topic(t.topicNames.CONTINUE_TO_PAYPAL).publish():l.doLogin(e);else if(i.loggedIn()){var a=function(){i.handleSessionValid(),i.pageToRedirect()&&""!=i.pageToRedirect()&&i.pageToRedirect()==e&&i.pageToRedirect(null),e==o.PAYPAL_CHECKOUT_TYPE?$.Topic(t.topicNames.CONTINUE_TO_PAYPAL).publish():l.goTo(e)},s=function(t){t&&(i.handleSessionExpired(),l.doLogin(e))};i.client().refresh(a,s)}else l.goTo(e);return!1},E.prototype.handleUpdateProfile=function(){var e=this,r={},i=!1,s=!1,n=!1,c=!1,l=!1,d=!1;if(e.isProfileModified()&&(e.isProfileValid()?n=!0:i=!0,s=!0),e.isPasswordModified()&&(e.isPasswordValid()?l=!0:i=!0,s=!0),null!=e.editShippingAddress()&&($.inArray(e.editShippingAddress(),e.shippingAddressBook())<0&&e.shippingAddressBook.push(e.editShippingAddress()),1===e.shippingAddressBook().length&&e.shippingAddressBook()[0].isDefaultAddress(!0),e.editShippingAddress().isDefaultAddress()&&e.selectDefaultAddress(e.editShippingAddress())),e.isShippingAddressBookModified()){for(var u=0;u<e.shippingAddressBook().length;u++)if(!e.shippingAddressBook()[u].validateNow()){i=!0;break}d=!i,s=!0}if(e.dynamicProperties().length>0&&e.isDynamicPropertiesModified()){for(var p=0;p<e.dynamicProperties().length;p++){var h=e.dynamicProperties()[p];if(!h.isValid()){i=!0;break}}i||(c=!0),s=!0}return e.isUserDataModified()&&(s=!0),s?i?void $.Topic(t.topicNames.USER_PROFILE_UPDATE_INVALID).publish():(n&&e.handleAccountDetailsUpdate(r),c&&e.handleDynamicPropertiesUpdate(r),l&&e.handleUpdatePassword(r),d&&e.handleShippingAddressUpdate(r),e.isB2BUser()&&e.isDelegatedAdmin()&&a.profileType==o.PROFILE_TYPE_AGENT&&e.updateRolesForCurrentOrganization(r),void e.invokeUpdateProfile(r)):void $.Topic(t.topicNames.USER_PROFILE_UPDATE_NOCHANGE).publish()},E.prototype.updateRolesForCurrentOrganization=function(e){for(var t=this,r=[],i=t.rolesForCurrentOrganization(),a=t.currentOrganization(),s=0;s<i.length;s++)r.push({function:i[s],relativeTo:{id:a.repositoryId}});e[o.ROLES_TEXT]=r},E.prototype.handleAccountDetailsUpdate=function(e){var t=this;t.receiveEmail=t.emailMarketingMails()?"yes":"no",e[o.PROFILE_EMAIL]=t.emailAddress(),e[o.PROFILE_FIRST_NAME]=t.firstName(),e[o.PROFILE_LAST_NAME]=t.lastName(),e[o.PROFILE_RECEIVE_EMAIL]=t.receiveEmail,e[o.PROFILE_LOCALE]=t.locale(),e[o.PROFILE_GDPR_CONSENT_GRANTED_KEY]=t.GDPRProfileP13nConsentGranted()},E.prototype.handleDynamicPropertiesUpdate=function(e){for(var t=this,r=0;r<t.dynamicProperties().length;r++)t.dynamicProperties()[r].value.isModified&&t.dynamicProperties()[r].value.isModified()&&(e[t.dynamicProperties()[r].id()]=t.dynamicProperties()[r].value())},E.prototype.handleUpdatePassword=function(e){var t=this;e[o.PROFILE_OLD_PASSWORD]=t.oldPassword(),e[o.PROFILE_NEW_PASSWORD]=t.newPassword(),e[o.PROFILE_CONFIRM_PASSWORD]=t.confirmPassword()},E.prototype.handleShippingAddressUpdate=function(e){var t=this;e[o.PROFILE_SHIPPING_ADDRESSES]=t.shippingAddressBook()},E.prototype.invokeUpdateProfile=function(e){var r=this;r.adapter.loadJSON(o.ENDPOINT_UPDATE_PROFILE,r.id(),e,function(e){r.editShippingAddress(null),r.resetPassword(),r.resetDynamicPropertiesValueIsModified(),$.Topic(t.topicNames.USER_PROFILE_UPDATE_SUCCESSFUL).publish(e)},function(e){var i=a.getStoredValue(o.LOCAL_STORAGE_USER_CONTENT_LOCALE);if(i){var s=JSON.parse(i)[0].name;r.locale()!==s&&r.locale(s)}else r.locale(r.contextData.global.locale);r.resetPassword(),$.Topic(t.topicNames.USER_PROFILE_UPDATE_FAILURE).publish(e)})},E.prototype.updateExpiredPassword=function(){var e=this,r={};r[o.PROFILE_LOGIN]=e.login(),r[o.PROFILE_OLD_PASSWORD]=e.oldPassword(),r[o.PROFILE_NEW_PASSWORD]=e.newPassword(),r[o.PROFILE_CONFIRM_PASSWORD]=e.confirmPassword(),e.adapter.persistCreate(o.ENDPOINT_UPDATE_EXPIRED_PASSWORD,"id",r,function(r){$.Topic(t.topicNames.USER_PROFILE_PASSWORD_UPDATE_SUCCESSFUL).publish(r);var i=e.newPassword();e.resetPassword(),e.password(i)},function(r){e.resetPassword(),$.Topic(t.topicNames.USER_PROFILE_PASSWORD_UPDATE_FAILURE).publish(r)})},E.prototype.validateTokenForPasswordUpdate=function(e,t,r){var i=this;e=decodeURIComponent(decodeURIComponent(e)),i.token=e;var a={};a[o.OP]=o.VALIDATE_TOKEN_OPERATION,a[o.TOKEN]=e,i.adapter.persistCreate(o.ENDPOINT_UPDATE_EXPIRED_PASSWORD,"id",a,function(e){"function"==typeof t&&t(e)},function(e){i.token="","function"==typeof r&&r(e)})},E.prototype.updateExpiredPasswordUsingToken=function(e,r,i,a,s,n){var c=this,l={};l[o.TOKEN]=e,l[o.PROFILE_LOGIN]=r,l[o.PROFILE_PASSWORD]=i,l[o.PROFILE_PASSWORD_CONFIRM]=a,c.adapter.persistCreate(o.ENDPOINT_UPDATE_EXPIRED_PASSWORD,"id",l,function(e){$.Topic(t.topicNames.USER_PROFILE_PASSWORD_UPDATE_SUCCESSFUL).publish(e),c.resetPassword(),c.token="","function"==typeof s&&s(e)},function(e){c.resetPassword(),c.emailAddressForForgottenPwd(""),$.Topic(t.topicNames.USER_PROFILE_PASSWORD_UPDATE_FAILURE).publish(e),"function"==typeof n&&n(e)})},E.prototype.createProductNotification=function(e){var r=this;r.adapter.persistCreate(o.ENDPOINT_PRODUCT_NOTIFY,"id",e,function(e){$.Topic(t.topicNames.USER_PRODUCT_NOTIFICATION_SUCCESS).publish(e)},function(e){$.Topic(t.topicNames.USER_PRODUCT_NOTIFICATION_FAILED).publish(e)})},E.getInstance=function(e,t,r){return E.singleInstance?!E.singleInstance.loggedInUserName()&&r&&r.global&&r.global.user&&r.global.user.firstName&&E.singleInstance.loggedInUserName(r.global.user.firstName):E.singleInstance=new E(e,t),r&&E.singleInstance.setContext(r),E.singleInstance},E.prototype.getOnBehlafOfToken=function(e,t){var r=this,i={};i.shopperProfileId=r.id(),a.request(o.ON_BEHALF_OF,i,e,t)},E.prototype.getSiteSpecificProperties=function(e,t,r){var i=this,s=function(r){for(var a=!1,o=!0,s=0;s<e.length;s++){for(var n=e[s],c=!1,l=0;l<r.items.length;l++)if(n.id==r.items[l].site.id){c=!0;break}if(!c){o=!1;break}}if(o){for(var l=0;l<r.items.length;l++){if("yes"!=r.items[l].properties.receiveEmail){a=!1;break}a=!0}a?i.receiveEmailGlobally(!0):(null!=i.receiveEmailGlobally()||i.receiveEmailGlobally())&&i.receiveEmailGlobally(!1)}else(null!=i.receiveEmailGlobally()||i.receiveEmailGlobally())&&i.receiveEmailGlobally(!1);i.originalReceiveEmailGlobally=i.receiveEmailGlobally(),t&&t()},n=function(){r&&r()};a.request(o.ENDPOINT_GET_SITE_SPECIFIC_PROFILE_PROPS,null,s,n,i.id())},E.prototype.updateSiteSpecificProperites=function(e,t,r){var i=this,s={},n=[],c="no";i.receiveEmailGlobally()&&(c="yes");for(var l=0;l<e.length;l++){var d={},u={};u.id=e[l].id,d.site=u;var p={};p.receiveEmail=c,d.properties=p,n.push(d)}s.siteProperties=n,a.request(o.ENDPOINT_UPDATE_SITE_SPECIFIC_PROFILE_PROPS,s,t,r,i.id())},E}),define("viewModels/skuPropertiesHandler",["knockout","ccRestClient","ccConstants","ccLogger","ccStoreConfiguration"],function(e,t,r,i,a){function o(){var e=this;return e.fetchSkuProperties=function(a,o,s,n,c){s.parent="sku";var l=function(e){e&&e.base&&e.base.forEach(function(e){"sku-base"===e.propertyType&&a().push(e)}),e&&e.specifications&&e.specifications.forEach(function(e){"sku-custom"===e.propertyType&&a().push(e)}),"function"==typeof n&&n(a)},d=function(e){i.error("Failed to fetch SKU properties for "+o,e),"function"==typeof c&&c()},u={};u[r.ENDPOINT_KEY]=r.ENDPOINT_GET_ITEM_TYPE;var p=e.storeConfiguration.getFilterToUse(u);p&&(s[r.FILTER_KEY]=p),t.request(r.ENDPOINT_GET_ITEM_TYPE,s,l,d,o)},e.getBase=function(t,r,i){e.fetchSkuProperties(t,"sku",{includeBase:!0},r,i)},e.getAll=function(t,r,i,a){r&&(r+"").trim()?e.fetchSkuProperties(t,"sku-"+r,{includeBase:!0},i,a):e.getBase(t,i,a)},e.getCustom=function(t,r,i,a){r&&(r+"").trim()?e.fetchSkuProperties(t,"sku-"+r,{includeBase:!1},i,a):e.fetchSkuProperties(t,"sku",{includeBase:!1},i,a)},e.storeConfiguration=a.getInstance(),e}return new o}),define("pageLayout/product",["knockout","ccRestClient","ccConstants","pubsub","CCi18n","ccLogger","viewModels/skuPropertiesHandler","ccStoreConfiguration"],function(e,t,r,i,a,o,s,n){"use strict";function c(t,r){var i=this;t.childSKUs||(t.childSKUs=[]);var a={ignore:["addOnProducts"]};e.mapping.fromJS(t,a,i),i.product=t,i.filterInactiveAddons(t),i.addOnProducts=t.addOnProducts;var o=["id","salePrice","listPrice","primaryFullImageURL","primaryLargeImageURL","primaryMediumImageURL","primarySmallImageURL","primaryThumbImageURL","shippingSurcharge","type","displayName"],s=["childSKUs","thumbImageURLs","smallImageURLs","mediumImageURLs","largeImageURLs","fullImageURLs","sourceImageURLs","productImagesMetadata"];for(var c in o)void 0==i[o[c]]&&(i[o[c]]=e.observable(""));for(var c in s)void 0==i[s[c]]&&(i[s[c]]=e.observableArray([]));return i.minPrice=i.getMinimumPrice(),i.maxPrice=i.getMaximumPrice(!1),i.productSalePrice=i.getSalePrice(),i.productListPrice=i.getListPrice(),i.isOnSale=i.isOnSale(),i.hasPriceRange=i.hasRange(),i.stockStatus=e.observable(),i.variantName=e.observable(),i.variantValue=e.observable(),i.relatedProducts=t.relatedProducts,i.productVariantOptions&&i.productVariantOptions()&&(i.variantOptionsArray=i.populateVariantOptions(e.mapping.toJS(i.productVariantOptions()))),i.inStock=e.observable(!1),i.showStockStatus=e.observable(!1),i.filtered=e.observable(!1),i.skuProperties=e.observableArray([]),i.storeConfiguration=n.getInstance(),i.minListPrice=i.getMinimumPrice(!0),i.maxListPrice=i.getMaximumPrice(!0),r&&r.hasOwnProperty("externalPrice")&&(i.externalPrice=r.externalPrice),r&&r.hasOwnProperty("quantity")&&(i.quantity=r.quantity),i}return c.prototype.getMinimumPrice=function(e){var t,r,i,a,o,s=this,n=s.childSKUs()?s.childSKUs().length:0;if(s.minActivePrice&&!e)return s.minActivePrice();if(t=e?s.listPrice():s.salePrice()||0===s.salePrice()?s.salePrice():s.listPrice(),s.childSKUs())if(n>0)for(var o in s.childSKUs())i=s.childSKUs()[o],a=e?i.listPrice():i.salePrice()||0===i.salePrice()?i.salePrice():i.listPrice(),a||0==a||null==a||(a=t),(!r&&0!=r||a<r)&&(r=a);else r=t;return r},c.prototype.getMaximumPrice=function(e){var t,r,i,a,o,s=this,n=s.childSKUs().length;if(s.maxActivePrice&&!e)return s.maxActivePrice();if(t=e?s.listPrice():s.salePrice()||0===s.salePrice()?s.salePrice():s.listPrice(),s.childSKUs())if(n>0)for(var o in s.childSKUs())i=s.childSKUs()[o],a=e?i.listPrice():i.salePrice()||0===i.salePrice()?i.salePrice():i.listPrice(),a||0==a||null==a||(a=t),(!r&&0!=r||a>r)&&(r=a);else r=t;return r},c.prototype.isOnSale=function(){var e=this,t=e.childSKUs().length;if(!t&&e.product.salePrice)return!0;for(var r in e.childSKUs()){var i=e.childSKUs()[r];if(null!=i.salePrice()&&i.salePrice()>=0)return!0}return!1},c.prototype.hasRange=function(){var e=this;return e.minPrice=e.getMinimumPrice(),e.maxPrice=e.getMaximumPrice(!1),e.minPrice!=e.maxPrice&&!isNaN(parseFloat(e.minPrice))&&!isNaN(parseFloat(e.maxPrice))},c.prototype.getListPrice=function(){var e=this;return e.childSKUs().length>=1?e.getMaximumPrice(!0):e.listPrice()},c.prototype.getSalePrice=function(){var e=this;return!e.hasRange()&&e.isOnSale()?e.minPrice:e.salePrice()},c.prototype.getPrices=function(e,a){var o=this,s={},n=e,c={};c[r.ENDPOINT_KEY]=r.ENDPOINT_GET_PRODUCT_PRICES;var l=o.storeConfiguration.getFilterToUse(c);l&&(s[r.FILTER_KEY]=l);var d=r.ENDPOINT_GET_PRODUCT_PRICES;t.request(d,s,function(e){var t=function(e,t){e.levels(t.levels),e.numLevels(t.numLevels)};if(e.skuPrices)for(var a=o.childSKUs().length,s=e.skuPrices.length,n=0;n<a;n+=1)for(var c=0;c<s;c+=1)o.childSKUs()&&o.childSKUs()[n].repositoryId()==e.skuPrices[c].skuId&&(o.childSKUs()[n].listPrice(e.skuPrices[c].listPrice),o.childSKUs()[n].salePrice(e.skuPrices[c].salePrice),e.skuPrices[c].hasOwnProperty(r.LIST_VOLUME_PRICE)&&(e.skuPrices[c].listVolumePrice.hasOwnProperty(r.BULK_PRICE)?t(o.childSKUs()[n].listVolumePrice.bulkPrice,e.skuPrices[c].listVolumePrice.bulkPrice):e.skuPrices[c].listVolumePrice.hasOwnProperty(r.TIERED_PRICE)&&t(o.childSKUs()[n].listVolumePrice.tieredPrice,e.skuPrices[c].listVolumePrice.tieredPrice)),e.skuPrices[c].hasOwnProperty(r.SALE_VOLUME_PRICE)&&(e.skuPrices[c].saleVolumePrice.hasOwnProperty(r.BULK_PRICE)?t(o.childSKUs()[n].saleVolumePrice.bulkPrice,e.skuPrices[c].saleVolumePrice.bulkPrice):e.skuPrices[c].saleVolumePrice.hasOwnProperty(r.TIERED_PRICE)&&t(o.childSKUs()[n].saleVolumePrice.tieredPrice,e.skuPrices[c].saleVolumePrice.tieredPrice)));o.hasPriceRange=e.priceRange,e.priceRange===!0&&(o.maxPrice=e.priceMax,o.minPrice=e.priceMin),e.list&&o.listPrice(e.list),null===o.product.type&&e.skuPrices&&(o.childSKUs()&&o.childSKUs()[0]&&(o.childSKUs()[0].listPrice(e.skuPrices.listPrice||e.list),o.listPrice(e.skuPrices.listPrice||e.list)),e.skuPrices.hasOwnProperty(r.LIST_VOLUME_PRICE)&&(e.skuPrices.listVolumePrice.hasOwnProperty(r.BULK_PRICE)?t(o.childSKUs()[0].listVolumePrice.bulkPrice,e.skuPrices.listVolumePrice.bulkPrice):e.skuPrices.listVolumePrice.hasOwnProperty(r.TIERED_PRICE)&&t(o.childSKUs()[0].listVolumePrice.tieredPrice,e.skuPrices.listVolumePrice.tieredPrice)),e.skuPrices.hasOwnProperty(r.SALE_VOLUME_PRICE)&&(e.skuPrices.saleVolumePrice.hasOwnProperty(r.BULK_PRICE)?t(o.childSKUs()[0].saleVolumePrice.bulkPrice,e.skuPrices.saleVolumePrice.bulkPrice):e.skuPrices.saleVolumePrice.hasOwnProperty(r.TIERED_PRICE)&&t(o.childSKUs()[0].saleVolumePrice.tieredPrice,e.skuPrices.saleVolumePrice.tieredPrice))),e.sale||0===e.sale?o.salePrice(e.sale):o.salePrice(null),null===o.product.type&&e.skuPrices&&(o.childSKUs()&&o.childSKUs()[0]&&o.childSKUs()[0].salePrice(e.skuPrices.salePrice),o.salePrice(e.skuPrices.salePrice)),$.Topic(i.topicNames.PRODUCT_PRICE_CHANGED).publish()},function(e){},n)},c.prototype.getAvailability=function(e,i,a){var o=this,s={},n=e;s[r.SKU_ID]=i,s[r.CATALOG]=null==a?"":a;var c=r.ENDPOINT_GET_PRODUCT_AVAILABILITY,l={};l[r.ENDPOINT_KEY]=r.ENDPOINT_GET_PRODUCT_AVAILABILITY,l[r.IDENTIFIER_KEY]="productStockStatus";var d=o.storeConfiguration.getFilterToUse(l);d&&(s[r.FILTER_KEY]=d),t.request(c,s,function(e){if(null!=e.productSkuInventoryStatus)for(var t=e.productSkuInventoryStatus,r=o.product.childSKUs?o.product.childSKUs.length:0,i=0;i<r;i++){var a=o.product.childSKUs[i];a.quantity=t[a.repositoryId]}o.stockStatus(e)},function(e){var t={stockStatus:r.OUT_OF_STOCK};o.stockStatus(t)},n)},c.prototype.getSkuPrice=function(e){var t=this,r={};for(var i in t.childSKUs())t.childSKUs()[i].repositoryId()==e.repositoryId&&(r.listPrice=t.childSKUs()[i].listPrice(),r.salePrice=t.childSKUs()[i].salePrice(),r.listVolumePrice=t.childSKUs()[i].listVolumePrice,r.saleVolumePrice=t.childSKUs()[i].saleVolumePrice);return r},c.prototype.isConfigurable=function(){var e=this;if(e.configurable&&e.configurable())return!0;for(var t in e.childSKUs())if(e.childSKUs()[t].configurable&&e.childSKUs()[t].configurable())return!0;return!1},c.prototype.fetchSkuProperties=function(){var e=this;e.skuProperties([]),s.getAll(e.skuProperties,e.product.type)},c.prototype.populateVariantOptions=function(e){var t=this;if(e&&null!==e&&e.length>0)for(var r,i,a=[],o=0;o<e.length;o++)r=t.mapOptionsToArray(e[o].optionValueMap),i=t.productVariantModel(e[o].optionName,e[o].mapKeyPropertyAttribute,r,e[o].optionId),a.push(i);else t.imgMetadata=t.productImagesMetadata;return a},c.prototype.mapOptionsToArray=function(t){var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push({key:i,value:t[i],visible:e.observable(!0)});return r},c.prototype.productVariantModel=function(t,r,i,o){var s=this,n={},c={};n.optionDisplayName=t,n.parent=this,n.optionId=r,n.originalOptionValues=e.observableArray(i),n.actualOptionId=o;var l=e.observable(!0);1===i.length&&l(s.checkOptionValueWithSkus(r,i[0].value)),l()&&(n.optionCaption=a.t("ns.common:resources.optionCaption",{optionName:t},!0)),n.selectedOptionValue=e.observable(),n.countVisibleOptions=e.computed(function(){for(var e=0,t=0;t<n.originalOptionValues().length;t++)1==i[t].visible()&&(e+=1);return e},n),n.disable=e.computed(function(){return 0==n.countVisibleOptions()},n),n.selectedOption=e.computed({write:function(e){s.filtered(!1),n.selectedOptionValue(e),s.filterOptionValues(n.optionId)},read:function(){return n.selectedOptionValue()},owner:n}),n.selectedOption.extend({required:{params:!0,message:a.t("ns.common:resources.optionRequiredMsg",{optionName:t},!0)}}),n.optionValues=e.computed({write:function(e){n.originalOptionValues(e)},read:function(){return e.utils.arrayFilter(n.originalOptionValues(),function(e){return 1==e.visible()})},owner:n}),c.thumbImageURLs=1==s.thumbImageURLs().length&&s.thumbImageURLs()[0].indexOf("/img/no-image.jpg&")>0?[]:s.thumbImageURLs(),c.smallImageURLs=1==s.smallImageURLs().length&&s.smallImageURLs()[0].indexOf("/img/no-image.jpg&")>0?[]:s.smallImageURLs(),c.mediumImageURLs=1==s.mediumImageURLs().length&&s.mediumImageURLs()[0].indexOf("/img/no-image.jpg&")>0?[]:s.mediumImageURLs,c.largeImageURLs=1==s.largeImageURLs().length&&s.largeImageURLs()[0].indexOf("/img/no-image.jpg&")>0?[]:s.largeImageURLs(),c.fullImageURLs=1==s.fullImageURLs().length&&s.fullImageURLs()[0].indexOf("/img/no-image.jpg&")>0?[]:s.fullImageURLs(),c.sourceImageURLs=1==s.sourceImageURLs().length&&s.sourceImageURLs()[0].indexOf("/img/no-image.jpg")>0?[]:s.sourceImageURLs();var d=[];if(s.thumbImageURLs&&s.thumbImageURLs().length>0)for(var u=0;u<s.thumbImageURLs().length;u++)d.push(s.productImagesMetadata[u]);return n},c.prototype.filterOptionValues=function(e){var t=this;if(!t.filtered()){for(var r=t.variantOptionsArray,i=0;i<r.length;i++){var a=r[i],o=t.getMatchingSKUs(r[i].optionId),s=t.updateOptionValuesFromSku(o,e,a);r[i].optionValues(s),t.filtered(!0)}t.updateSingleSelection(e)}},c.prototype.getMatchingSKUs=function(e){for(var t=this,r=t.childSKUs(),i=[],a=t.variantOptionsArray,o={},s=0;s<a.length;s++)a[s].optionId!=e&&void 0!=a[s].selectedOption()&&(o[a[s].optionId]=a[s].selectedOption().value);for(var n=0;n<r.length;n++){var c=!0;for(var l in o)if(o.hasOwnProperty(l)&&(!r[n].dynamicPropertyMapLong[l]||r[n].dynamicPropertyMapLong[l]()!=o[l])){c=!1;break}c&&i.push(r[n])}return i},c.prototype.updateOptionValuesFromSku=function(e,t,r){for(var i=r.optionId,a=[],o=r.originalOptionValues(),s=0;s<e.length;s++){var n=e[s].dynamicPropertyMapLong[i];void 0!=n&&a.push(n())}for(var c=0;c<o.length;c++){var l=o[c].value,d=!1,u=a.indexOf(l);u!=-1&&(d=!0),o[c].visible(d)}return o},c.prototype.updateSingleSelection=function(e){for(var t=this,r=t.variantOptionsArray,i=0;i<r.length;i++){var a=r[i].optionId;if(1==r[i].countVisibleOptions()&&void 0==r[i].selectedOption()&&a!=e)for(var o=(t.validForSingleSelection(a),r[i].originalOptionValues()),s=0;s<o.length;s++)if(1==o[s].visible()){r[i].selectedOption(o[s]);break}}},c.prototype.validForSingleSelection=function(e){for(var t=this,r=t.variantOptionsArray,i=0;i<r.length;i++){if(r[i].disable()||r[i].optionId!=e&&void 0!=r[i].selectedOption())return!0;if(r[i].optionId!=e&&void 0==r[i].selectedOption()&&1==r[i].countVisibleOptions())return!0}return!1},c.prototype.checkOptionValueWithSkus=function(e,t){for(var r=this,i=r.childSKUs(),a=i.length,o=0;o<a;o++)if(!i[o].dynamicPropertyMapLong[e]||void 0===i[o].dynamicPropertyMapLong[e]())return!0;return!1},c.prototype.getSelectedSkuOptions=function(e){for(var t=[],r=0;r<e.length;r++)e[r].disable()||t.push({optionName:e[r].optionDisplayName,optionValue:e[r].selectedOption().key,optionId:e[r].actualOptionId,optionValueId:e[r].selectedOption().value});return t},c.prototype.getProductsAvailability=function(e,i,a,o,s){var n={};n[r.PRODUCTS_PARAM]=a,n[r.CATALOG]=null==o?"":o,s&&null!==s&&""!==s&&(n[r.LOCATION_IDS]=s);var c=r.ENDPOINT_PRODUCTS_AVAILABILITY;t.request(c,n,e,i)},c.prototype.filterInactiveAddons=function(e){if(e.addOnProducts&&e.addOnProducts.length>0)for(var t=e.addOnProducts.length,r=t-1;r>=0;r--)if(e.addOnProducts[r].addOnOptions&&0!=e.addOnProducts[r].addOnOptions.length&&e.addOnProducts[r].addOnOptions[0].product&&e.addOnProducts[r].addOnOptions[0].product.active)for(var i=e.addOnProducts[r].addOnOptions.length-1;i>=0;i--)e.addOnProducts[r].addOnOptions[i].sku.active||e.addOnProducts[r].addOnOptions.splice(i,1);else e.addOnProducts.splice(r,1)},c}),define("swmRestClientConstructor",["jquery","ccRestClient","ccLogger","storageApi","pageLayout/site"],function(e,t,r,i,a){"use strict";function o(e,r){var a=this;a.isInitialized=!1,a.usingCCAuthentication=!1,a.isSynced=!1,a.unauthorizedCount=0,a.cors="withCredentials"in new XMLHttpRequest,a.corsFrameReady=!1,a.ccsyncInProgress=!1,a.ccsyncBlockedCallQue={items:[]},a.refreshTimeoutID=null,a.siteid="",a.ccsiteid="",a.apiuserid="",a.apiuserauth="";
try{i.getInstance().removeItem("social.ccsyncprofileid"),i.getInstance().removeItem("social.ccsyncapiuserid")}catch(e){}a.ccrestapi=t,a.tenantid="",a.swmhost="",a.isPreview=!1,a.currentRequestId=0,a.commonSuccessCallback=e,a.commonErrorCallback=r,a.doRefresh=function(){if(a.usingCCAuthentication){var e=function(){},r=function(e){};a.refresh(e,r),t.storeRequestWasMade=!0}},a.stackedPostMessages={items:[]},a.setCorsFrameReady=function(){if(a.corsFrameReady=!0,a.stackedPostMessages&&a.stackedPostMessages.items.length>0){for(var e=0;e<a.stackedPostMessages.items.length;e++)a.proxyFrame.postMessage(a.stackedPostMessages.items[e].msgObj,a.swmhost);a.stackedPostMessages={items:[]}}}}return o.GET="GET",o.POST="POST",o.JSON="json",o.REQUEST_JSON_CONTENT_TYPE="application/json",o.REQUEST_FORM_URL_ENCODED="application/x-www-form-urlencoded",o.SWM_CCSYNC_ENDPOINT="/swm/rs/v1/users/cc",o.SWM_REFRESH_ENDPOINT="/swm/rs/v1/users/refresh",o.AUTH_HEADER_NAME="Authorization",o.CC_TENANTID_HEADER_NAME="X-CCTenantId",o.CC_SITEID_HEADER_NAME="X-CCSiteId",o.CC_ISPREVIEW_HEADER_NAME="X-CCIsPreview",o.ACCEPT_LANGUAGE_HEADER_NAME="Accept-Language",o.X_REQUESTED_WITH="X-Requested-With",o.X_REQUESTED_WITH_AJAX_VALUE="XMLHttpRequest",o.SWM_ACCESS_TOKEN="access_token",o.AUTH_HEADER_PREFIX="Bearer ",o.JWT_BEARER_GRANT_TYPE="urn:ietf:params:oauth:grant-type:jwt-bearer",o.TOKEN_REFRESH_TIMEOUT=5e3,o.IFRAME_ELEMENT="iframe",o.ZERO="0",o.IFRAME_STYLE="width: 0; height: 0; border: none;",o.IFRAME_NAME="swm_iframe",o.ID_ATTRIBUTE="id",o.NAME_ATTRIBUTE="name",o.WIDTH_ATTRIBUTE="width",o.HEIGHT_ATTRIBUTE="height",o.BORDER_ATTRIBUTE="border",o.STYLE_ATTRIBUTE="style",o.SRC_ATTRIBUTE="src",o.MAX_INT=4294967295,o.prototype.setSWMHost=function(e){this.swmhost=e},o.prototype.init=function(e,t,r){var i=this;if(i.tenantid=e,i.isPreview=1==t?"true":"false",i.locale=r,i.ccsiteid=a.getInstance().siteInfo.id,!i.cors&&!i.isInitialized){i.crossDomainUrl=i.swmhost+"/swm/pm/?tenantId="+e+"&isPreview="+i.isPreview,i.eventHandlerMap={},i.eventHandlerMap.initializedSWMFrame={success:i.setCorsFrameReady,error:i.setCorsFrameReady},i.initXDomainMessageListener();var o=i.createCrossDomainIFrame();null!=o&&(i.proxyFrame=o.contentWindow)}i.isInitialized=!0},o.prototype.createCrossDomainIFrame=function(){var e=this,t=o.IFRAME_NAME,r=document.createElement(o.IFRAME_ELEMENT);r.setAttribute(o.ID_ATTRIBUTE,t),r.setAttribute(o.NAME_ATTRIBUTE,t),r.setAttribute(o.WIDTH_ATTRIBUTE,o.ZERO),r.setAttribute(o.HEIGHT_ATTRIBUTE,o.ZERO),r.setAttribute(o.BORDER_ATTRIBUTE,o.ZERO),r.setAttribute(o.STYLE_ATTRIBUTE,o.IFRAME_STYLE),r.setAttribute(o.SRC_ATTRIBUTE,e.crossDomainUrl);var i=null;try{document.body.appendChild(r),window.frames[t].name=t,i=document.getElementById(t)}catch(e){}return i},o.prototype.initXDomainMessageListener=function(){var e=this;window.addEventListener("message",function(t){var r=t.origin;if(r===e.swmhost){var i;i="string"==typeof t.data?JSON.parse(t.data):t.data;var a=i.id,o=i.success,s=i.payload,n=e.eventHandlerMap[a];n&&(o?n.success(s):n.error(JSON.stringify(s)))}},!1)},o.prototype.proxyRequest=function(e,t,r,i,a,s){var n=this;n.currentRequestId>=o.MAX_INT?n.currentRequestId=0:n.currentRequestId++;var c=n.currentRequestId;n.eventHandlerMap[c]={success:i,error:a};var l=t.replace("{siteid}",n.siteid);l=n.swmhost+n.insertParamsIntoUri(l,s),l.indexOf(o.SWM_REFRESH_ENDPOINT)==-1&&l.indexOf(o.SWM_CCSYNC_ENDPOINT)==-1&&(null==n.refreshTimeoutID?n.refreshTimeoutID=setTimeout(n.doRefresh,o.TOKEN_REFRESH_TIMEOUT):(clearTimeout(n.refreshTimeoutID),n.refreshTimeoutID=setTimeout(n.doRefresh,o.TOKEN_REFRESH_TIMEOUT)));var d=0===t.indexOf(o.SWM_CCSYNC_ENDPOINT),u=(d?o.REQUEST_FORM_URL_ENCODED:o.REQUEST_JSON_CONTENT_TYPE,r?d?r:JSON.stringify(r):""),p={};p.id=c,p.pMethod=e,p.pUrl=l,p.pData=u,p.pIsPreview=n.isPreview,p.pTenantId=n.tenantid,p.pCCSiteId=n.ccsiteid,p.pLocale=n.locale,p.pApiuserauth=n.apiuserauth,p.pAssertion=n.ccrestapi.tokenSecret,n.corsFrameReady?n.proxyFrame.postMessage(JSON.stringify(p),n.swmhost):n.stackedPostMessages.items.push({msgObj:JSON.stringify(p)})},o.prototype.syncCCUser=function(e,t){var r=this,a=function(t){r.isSynced=!0,r.siteid=t.siteId,r.apiuserid=t.userId,r.apiuserauth=t.access_token;try{i.getInstance().setItem("social.ccsyncprofileid",r.ccrestapi.profileId),i.getInstance().setItem("social.ccsyncapiuserid",t.userId)}catch(e){}e&&e(t)},s=function(e){r.isSynced=!1,null!=r.refreshTimeoutID&&clearTimeout(r.refreshTimeoutID),t&&t(e)};this.cors?this.corsRequest(o.POST,o.SWM_CCSYNC_ENDPOINT+"/{ccprofileid}","grant_type="+encodeURIComponent(o.JWT_BEARER_GRANT_TYPE)+"&assertion="+encodeURIComponent(r.ccrestapi.tokenSecret),a,s,{ccprofileid:r.ccrestapi.profileId}):this.proxyRequest(o.POST,o.SWM_CCSYNC_ENDPOINT+"/{ccprofileid}","grant_type="+encodeURIComponent(o.JWT_BEARER_GRANT_TYPE)+"&assertion="+encodeURIComponent(r.ccrestapi.tokenSecret),a,s,{ccprofileid:r.ccrestapi.profileId})},o.prototype.refresh=function(e,t){var r=this,i=function(t){r.isSynced=!0,r.apiuserauth=t.access_token,e&&e(t)},a=function(e){};r.apiuserauth?r.cors?r.corsRequest(o.POST,o.SWM_REFRESH_ENDPOINT,{},i,a):r.proxyRequest(o.POST,o.SWM_REFRESH_ENDPOINT,{},i,a):a()},o.prototype.clear=function(){var e=this;e.usingCCAuthentication=!1,e.isSynced=!1,e.siteid="",e.apiuserid="",e.apiuserauth="";try{i.getInstance().removeItem("social.ccsyncprofileid"),i.getInstance().removeItem("social.ccsyncapiuserid")}catch(e){}},o.prototype.request=function(e,t,a,o,s,n){var c=this,l=o,d=s;if(""==c.swmhost||!c.isInitialized)return void r.warn("rest client not initialized properly");null!=c.ccrestapi.profileId&&null!=c.ccrestapi.tokenSecret&&(c.usingCCAuthentication=!0);var u=i.getInstance().getItem("social.ccsyncprofileid"),p=i.getInstance().getItem("social.ccsyncapiuserid");if(u&&c.ccrestapi.profileId!==u||p&&c.apiuserid!==p){c.clear();var h='{"o:errorCode":"401.99"}';return void c.commonErrorCallback(h)}if(c.apiuserid===p&&c.ccrestapi.profileId===u||(c.isSynced=!1),c.usingCCAuthentication&&!c.isSynced){var g=function(r){c.ccsyncInProgress=!1,c.cors?c.corsRequest(e,t,a,l,d,n):c.proxyRequest(e,t,a,l,d,n),c.ccsyncBlockedCallQueExecution()},f=function(e){c.ccsyncInProgress=!1,null!=c.refreshTimeoutID&&clearTimeout(c.refreshTimeoutID),d&&d(e)};c.ccsyncInProgress?c.ccsyncBlockedCallQue.items.push({pMethod:e,pUrl:t,pData:a,pSuccessCallback:o,pErrorCallback:s,pJSONParams:n}):(c.ccsyncInProgress=!0,c.syncCCUser(g,f))}else c.cors?this.corsRequest(e,t,a,o,s,n):this.proxyRequest(e,t,a,o,s,n)},o.prototype.ccsyncBlockedCallQueExecution=function(){var e=this;if(e.ccsyncBlockedCallQue.items.length>0){for(var t=0;t<e.ccsyncBlockedCallQue.items.length;t++)e.cors?e.corsRequest(e.ccsyncBlockedCallQue.items[t].pMethod,e.ccsyncBlockedCallQue.items[t].pUrl,e.ccsyncBlockedCallQue.items[t].pData,e.ccsyncBlockedCallQue.items[t].pSuccessCallback,e.ccsyncBlockedCallQue.items[t].reqErrorCB,e.ccsyncBlockedCallQue.items[t].pJSONParams):e.proxyRequest(e.ccsyncBlockedCallQue.items[t].pMethod,e.ccsyncBlockedCallQue.items[t].pUrl,e.ccsyncBlockedCallQue.items[t].pData,e.ccsyncBlockedCallQue.items[t].pSuccessCallback,e.ccsyncBlockedCallQue.items[t].reqErrorCB,e.ccsyncBlockedCallQue.items[t].pJSONParams);e.ccsyncBlockedCallQue={items:[]}}},o.prototype.corsRequest=function(t,r,i,a,s,n){var c=this,l=t,d=r.replace("{siteid}",c.siteid);d=c.swmhost+c.insertParamsIntoUri(d,n),d.indexOf(o.SWM_REFRESH_ENDPOINT)==-1&&d.indexOf(o.SWM_CCSYNC_ENDPOINT)==-1&&(null==c.refreshTimeoutID?c.refreshTimeoutID=setTimeout(c.doRefresh,o.TOKEN_REFRESH_TIMEOUT):(clearTimeout(c.refreshTimeoutID),c.refreshTimeoutID=setTimeout(c.doRefresh,o.TOKEN_REFRESH_TIMEOUT)));var u=function(e){r.indexOf(o.SWM_CCSYNC_ENDPOINT)==-1&&(c.unauthorizedCount=0);var t=function(e,t){c.commonSuccessCallback(e,t),a(e,t)};t(e.data,e.textStatus)},p=function(e){var l=function(e,t,r){c.commonErrorCallback(e,t,r),s(e,t,r)};if(c.usingCCAuthentication)try{var d=JSON.parse(e.jqXHR.responseText);c.unauthorizedCount<=1&&401===d.status&&r.indexOf(o.SWM_CCSYNC_ENDPOINT)==-1?(c.isSynced=!1,c.unauthorizedCount++,c.request(t,r,i,a,s,n)):l(e.jqXHR.responseText,e.jqXHR.status,e.errorThrown)}catch(e){}else l(e.jqXHR.responseText,e.jqXHR.status,e.errorThrown)};l===o.GET&&(d=c.fixIECaching(d));var h=0===r.indexOf(o.SWM_CCSYNC_ENDPOINT),g=h?o.REQUEST_FORM_URL_ENCODED:o.REQUEST_JSON_CONTENT_TYPE,f=i?h?i:JSON.stringify(i):"",m={};m={dataType:o.JSON,contentType:g,type:l,url:d,data:f,processData:!1,success:function(e,t,r){u({data:e,textStatus:t,jqXHR:r})},error:function(e,t,r){p({jqXHR:e,textStatus:t,errorThrown:r})}};var I={};I[o.X_REQUESTED_WITH]=o.X_REQUESTED_WITH_AJAX_VALUE,I[o.CC_ISPREVIEW_HEADER_NAME]=c.isPreview,I[o.ACCEPT_LANGUAGE_HEADER_NAME]=c.locale,h?(I[o.CC_TENANTID_HEADER_NAME]=c.tenantid,I[o.CC_SITEID_HEADER_NAME]=c.ccsiteid):c.apiuserauth&&c.apiuserauth.length>0&&(I[o.AUTH_HEADER_NAME]=o.AUTH_HEADER_PREFIX+c.apiuserauth),m.headers=I,e.ajax(m)},o.prototype.insertParamsIntoUri=function(e,t){var r=e;for(var i in t)t.hasOwnProperty(i)&&(r=r.replace("{"+i+"}",encodeURIComponent(t[i])));return r},o.prototype.fixIECaching=function(e){return e},o.getTimestamp=function(e){var t=new Date/1e3,r=parseInt(e,10),i=t+r;return parseInt(+i,10)},o}),define("swmRestClient",["swmRestClientConstructor","ccRestClient","ccLogger","pubsub","jquery","ccConstants","storageApi"],function(e,t,r,i,a,o,s){"use strict";var n=function(e){},c=function(e,t){try{var o=JSON.parse(e);if(o.error&&o.status)switch(o.status){case"400.12":a.Topic(i.topicNames.SOCIAL_SPACE_UNAVAILABLE).publish({reason:"ccsync_failed"});break;default:a.Topic(i.topicNames.SOCIAL_SPACE_UNAVAILABLE).publish({reason:"config"})}else 401===o.status?(a.Topic(i.topicNames.SOCIAL_SPACE_UNAVAILABLE).publish({reason:"unauthorized"}),"401.99"===o["o:errorCode"]&&a.Topic(i.topicNames.SOCIAL_REFRESH_SPACES).publish({})):"403.1"!==o["o:errorCode"]&&"403.2"!==o["o:errorCode"]||s.getInstance().removeItem("social.currentSpaceId")}catch(e){r.warn("swm error occurred, response code: "+t),a.Topic(i.topicNames.SOCIAL_SPACE_UNAVAILABLE).publish({})}},l=new e(n,c);if(window.externalServiceData){var d=window.externalServiceData.social.scheme+"://"+window.externalServiceData.social.host;"0"!=window.externalServiceData.social.port&&(d+=":"+window.externalServiceData.social.port),l.setSWMHost(d)}return l}),define("swmKoValidateRules",["knockout","jqueryui","koValidate"],function(e,t,r){"use strict";e.validation.rules.multiemail={validator:function(t,r){if(!r)return!0;var i=!0;if(!e.validation.utils.isEmptyVal(t)){var a=t.replace(/,/g,";").split(";");$(a).each(function(t){return i=e.validation.rules.email.validator($.trim(this),r)})}return i},message:"Please enter valid email addresses (separate multiple email addresses using a colon or semicolon)."},e.validation.rules.multiemailmax={validator:function(t,r){if(!r)return!1;if(!e.validation.utils.isEmptyVal(t)){var i=t.trim().replace(/,/g,";"),a=i.split(";"),o=a.length;if(";"==i.charAt(i.length-1)&&(o-=1),o>r)return!1}return!0},message:"Please limit the number of valid email addresses"},e.validation.rules.uniquespacename={validator:function(t,r){var i=e.utils.unwrapObservable(r),a=t.trim().replace(/\s+/g," ");if(Array.isArray(i))for(var o=0;o<i.length;o++){var s;if(s="string"==typeof i[o].spaceNameFull?i[o].spaceNameFull.toUpperCase():i[o].spaceNameFull().toUpperCase(),s==a.toUpperCase())return!1}return!0},message:"Name must be unique"},e.validation.rules.editSpaceNameUniqueRule={validator:function(t,r){var i=t.trim().replace(/\s+/g," "),a=r.currentSpaceId,o=e.utils.unwrapObservable(r.spaces);if(Array.isArray(o))for(var s=0;s<o.length;s++){var n;if(n="string"==typeof o[s].spaceNameFull?o[s].spaceNameFull.toUpperCase():o[s].spaceNameFull().toUpperCase(),n==i.toUpperCase()){if(o[s].spaceid==a)continue;return!1}}return!0},message:"Name must be unique"},e.validation.rules.badrequestinvalidemail={validator:function(e){return!1},message:"Please type in valid email addresses for your recipients."},e.validation.rules.badrequestspacename={validator:function(e){return!1},message:"Name must be unique"},e.validation.registerExtenders()}),define("pageLayout/space",["jquery","knockout","pubsub","notifier","ccLogger","CCi18n","swmRestClient","swmKoValidateRules"],function(e,t,r,i,a,o,s,n){"use strict";function c(e,r){if(c.singleInstance)throw new Error("Cannot instantiate more than one SpaceViewModel, use getInstance(pAdapter, pUserData, pParams)");var i=this;return i.adapter=e,i.id=t.observable(""),i.name=t.observable(""),i.ownerId=t.observable(""),i.ownerFirstName=t.observable(""),i.ownerLastName=t.observable(""),i.ownerMediaId=t.observable(""),i.ownerMediaUrl=t.observable(""),i.accessLevel=t.observable(""),i.siteName=t.observable(""),i.fbAppId=t.observable(""),i.inviteAcceptInProgress=t.observable(!1),i.members=t.observableArray([]),i.ownerFullName=t.computed(function(){return i.ownerFirstName()+" "+i.ownerLastName()},i),i.contextId=t.observable(""),i.showSpace=t.observable(!1),i.spaceProductMediaUrl=t.observable(""),i}return c.prototype.isSpaceOwner=function(e){var t=this;return t.ownerId()===e},c.prototype.isMember=function(t){var r=this,i=!1;return e.each(r.members(),function(e,r){if(r.userId==t)return i=!0,!1}),i},c.prototype.isPrivate=function(){var e=this,t=!1;return"0"===e.accessLevel()&&(t=!0),t},c.prototype.isGroup=function(){var e=this,t=!1;return"2"===e.accessLevel()&&(t=!0),t},c.prototype.isShared=function(){var e=this,t=!1;return"1"===e.accessLevel()&&(t=!0),t},c.prototype.isPrivateOrGroup=function(){var e=this,t=!1;return(e.isPrivate()||e.isGroup())&&(t=!0),t},c.prototype.updateSpace=function(e){var t=this;e.id&&t.id(e.id),e.name&&t.name(e.name),e.ownerId&&t.ownerId(e.ownerId),e.ownerFirstName&&t.ownerFirstName(e.ownerFirstName),e.ownerLastName&&t.ownerLastName(e.ownerLastName),e.ownerMediaId&&t.ownerMediaId(e.ownerMediaId),e.ownerMediaUrl&&t.ownerMediaUrl(e.ownerMediaUrl),e.accessLevel&&t.accessLevel(e.accessLevel),e.siteName&&t.siteName(e.siteName),e.fbAppId&&t.fbAppId(e.fbAppId),e.spaceProductMediaUrl&&t.spaceProductMediaUrl(e.spaceProductMediaUrl)},c.prototype.updateMembers=function(t){var i=this;i.members.removeAll(),i.members(t),e.Topic(r.topicNames.SOCIAL_SPACE_MODEL_MEMBERS_CHANGED).publish()},c.getInstance=function(e,t,r){return c.singleInstance||(c.singleInstance=new c(e,t)),c.singleInstance},c}),define("viewModels/orderDetailsViewModel",["knockout","ccConstants","CCi18n","ccConstants","ccRestClient","notifier","ccStoreUtils"],function(e,t,r,i,a,o,s){"use strict";function n(t){var i=this;i.CCi18n=r,s.fromJS(t,i,!0),i.getReturnhistoryInvoked=e.observable(!1),i.returnRequesthistoryArray=e.observableArray([]),i.cancelRequesthistoryArray=e.observableArray([])}var c=i.INCOMPLETE_CANCEL,l=i.CANCEL_ORDER,d=i.CANCEL_REQUESTS;return n.prototype.getReturnhistory=function(e,r,i){var o=this,s={};a.request(t.ENDPOINT_LIST_RETURN_REQUESTS,s,function(e){o.getReturnhistorySuccess(e,r)}.bind(o),function(e){o.getReturnhistoryFailure(e,i)}.bind(o),e,"returnRequests")},n.prototype.getReturnhistorySuccess=function(e,t){"function"==typeof t&&t(e)},n.prototype.getReturnhistoryFailure=function(e,t){"function"==typeof t&&t(e)},n.prototype.getCancelhistory=function(e,r,i){var o=this,s={},n="";n+='state ne "'+c+'"',n+=' AND orderAction eq "'+l+'"',n+=' AND createdByOrderId eq "'+e+'"',s.q=n,a.request(t.ENDPOINT_GET_ALL_ORDERS_FOR_PROFILE,s,function(e){o.getCancelhistorySuccess(e,r)}.bind(o),function(e){o.getCancelhistoryFailure(e,i)}.bind(o),e,d)},n.prototype.getCancelhistorySuccess=function(e,t){"function"==typeof t&&t(e)},n.prototype.getCancelhistoryFailure=function(e,t){"function"==typeof t&&t(e)},n.prototype.populateCancelHistory=function(e){var t=this;t.cancelRequesthistoryArray(e.items)},n.prototype.populateReturnHistory=function(e){var t=this;t.returnRequesthistoryArray(e.items);var r,i,a,o,s=t.order.items;for(i=0;i<t.returnRequesthistoryArray().length;i++)for(r=t.returnRequesthistoryArray()[i].returnItems,a=0;a<r.length;a++)for(o=0;o<s.length;o++)if(s[o].productId==r[a].productId&&s[o].catRefId==r[a].catRefId){r[a].itemInfo=s[o];break}},n}),define("pageLayout/css-loader",["module","jquery","ccConstants","ccRestClient","storageApi","xDomainProxy"],function(e,t,r,i,a,o){function s(e){var t=0;if(0==e.length)return t;for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);t=(t<<5)-t+i,t&=t}return t}function n(){this.loadingOptimizedCSS=e.config().optimizingCSS}var c="agentUI"==i.profileType?"/ccagentui/v1/pages/css/":"/ccstoreui/v1/pages/css/",l="style",d="text/css";return n.prototype.loadCssForLayout=function(e,a){var n=c+e,u=t.Deferred(),p=t.extend({},a),h={};return h[r.AUTHORIZATION_HEADER]=r.BEARER="Bearer "+i.tokenSecret,h=i.updateHeaderWithAgentContext(h),h=i.updateHeaderWithViewport(h),h=i.updateHeaderWithSelectedOrganization(h),h=i.updateHeaderWithPriceListGroupId(h),h=i.updateHeaderWithShopperContext(h),h=i.updateHeaderWithVisitData(h),i.profileType==r.PROFILE_TYPE_AGENT&&(h[o.PROFILE_TYPE_HEADER_NAME]="fileAgent"),window.siteId&&(p[r.URL_SITE_PARAM]=window.siteId),this.loadingOptimizedCSS?t.ajax({url:n,data:p,headers:h}).then(function(e,t,r){if(200===r.status){var i=s(e);if(!document.getElementById(i)){var a=document.createElement(l);a.type=d,a.id=i,a.appendChild(document.createTextNode(e)),document.head.appendChild(a)}}u.resolve()}).fail(function(){u.resolve()}):u.resolve(),u},new n}),define("pageLayout/layout-container",["knockout","pageLayout/data","pageLayout/layout","pageLayout/region","pageLayout/widget","pageLayout/cart","pageLayout/order","pageLayout/layout-mapping","pageLayout/simple-cache","pageLayout/context-handler","pageLayout/view-model-builder","pageLayout/search","pageLayout/shippingmethods","pageLayout/payment-auth-response","pageLayout/user","pageLayout/product","pageLayout/space","pageViewTracker","viewModels/paymentDetails","pubsub","CCi18n","ccConstants","ccLogger","jquery","notifier","pageLayout/site","sfExceptionHandler","ccStoreServerLogger","viewportHelper","navigation","storageApi","ccRestClient","ccStoreConfiguration","spinner","viewModels/orderDetailsViewModel","pageLayout/css-loader","ccResourceLoader"],function(e,t,r,i,a,o,s,n,c,l,d,u,p,h,g,f,m,I,E,v,y,b,T,P,S,C,A,_,O,R,N,D,L,M,w,U,k){"use strict";function x(t,r){var i=this;this.isPreview,this.layoutMapping=new n(this),this.masterViewModel=e.observable(),this.basePath=r,this.adapter=t,this.cache=new c,this.widgetCache=new c,this.contextHandler=new l,this.viewModelBuilder=d,this.contextDataSet=P.Deferred(),this.contextDataSetSubscriber=this.contextDataSet.promise(),this.networkErrorMessage,this.networkErrorReloadText,i.storeServerLog=_.getInstance(),this.storeConfiguration=L.getInstance(),this.queue=new G,this.widgets={},this.displayQueue={},this.pageResponse,this.widgetCount=0,this.appLoadedDeferred=P.Deferred(),this.deferLoadLargeCartInPromptRefresh=!1,this.currentPage=null,this.pendingWidgets=e.observableArray().extend({deferred:!0}),P.Topic(v.topicNames.PAGE_VIEW_CHANGED).subscribe(i.pageViewChanged.bind(i)),P.Topic(v.topicNames.PAGE_CONTEXT_CHANGED).subscribe(i.pageContextChanged.bind(i)),P.Topic(v.topicNames.PAGE_PARAMETERS_CHANGED).subscribe(i.pageParametersChanged.bind(i)),P.Topic(v.topicNames.PAGE_READY).subscribe(i.pageReady.bind(i)),P.Topic(v.topicNames.RECORD_PAGINATION_PAGE_CHANGE).subscribe(i.pageReady.bind(i)),P.Topic(v.topicNames.PAGE_PAGINATION_CHANGE).subscribe(i.paginationChange.bind(i)),P.Topic(v.topicNames.USER_NETWORK_ERROR).subscribe(i.networkError.bind(i));var a=!0;return a&&(this.exceptionHandler=new A,this.exceptionHandler.subscribe&&this.exceptionHandler.subscribe()),P.when(i.appLoadedDeferred).then(function(e){k.callAppLevelJsMethod(Y,[i.currentPage,i.pageResponse]),i.callMethodInAllWidgets(Y)}),this}function G(){function e(){var e=P.Deferred();return P.when(t).always(function(){e.resolve()}),e.promise()}var t=null;return{display:function(r,i){function a(){0===i.widgetCount&&(i.callMethodInAllWidgets($),i.UserViewModel.getInstance().pageAppeared.resolve(),i.appLoadedDeferred.resolve())}var o=P.Deferred(),s=e();s.done(function(){i.widgets[r].initialized()?(i.widgets[r].occPrioritizedDisplay(!0),i.widgetCount--,a(),o.resolve()):i.displayQueue[r].done(function(e){e.occPrioritizedDisplay(!0),i.widgetCount--,a(),o.resolve()})}),t=o.promise()}}}function F(e){if(D.profileType===b.PROFILE_TYPE_AGENT){if(e.status==b.HTTP_NOT_FOUND)R.goTo("/agentError",!0,!0);else if(e.status==b.BAD_REQUEST){var t=window.location.origin+window.applicationContextPath+"/agentError";window.location.assign(t)}}else e.status==b.HTTP_NOT_FOUND&&R.goTo("/404",!0,!0)}function H(t,r){if(!t||!r)return!0;if(t.stackType&&t.stackType()==b.STACK_TYPE_POPUP&&r.stackType==b.STACK_TYPE_POPUP&&t.regions().length&&t.regions()[0].widgets().length&&t.regions()[0].widgets()[0].WIDGET_ID==b.WIDGET_ID_PRODUCT_LISTING&&t.regions()[0].widgets()[0].listType()!=r.regions[0].widgets[0].listType)return!0;if(t.similarRegions&&Object.keys(t.similarRegions).length>0&&t.similarRegions.hasOwnProperty(r.id))return!1;if(r.similarRegions&&Object.keys(r.similarRegions).length>0&&r.similarRegions.hasOwnProperty(t.id))return!1;var i=e.isObservable(t.widgets)?t.widgets():t.widgets,a=i?i.length:0;if(i&&a>0){if(r.widgets&&r.widgets.length>0){if(a!==r.widgets.length)return!0;var o=e.isObservable(t.width)?t.width():t.width;if(o!==r.width)return!0;for(var s=0;s<a;s++){var n=e.isObservable(i[s].id)?i[s].id():i[s].id;if(n!==r.widgets[s].id)return!0}return!(!t.metadata()||!r.metadata||t.id()==r.id)}return!0}return r.widgets,!0}function V(e,t){for(var r=-1,i=0;i<t.length;i++)if(!H(e,t[i])){r=i;break}return r}var Y="afterApplicationLoad",q="afterLoad",B="beforeDisappear",$="afterPageAppear";return String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),window.previewNavigation=function(e,t,r,i,a,o,s){var n=e+"?occsite="+t+"&ccvp="+i+"&audience="+a+"&usePageId="+s+"&disableMinify="+!o;D.setStoredValue(b.LOCAL_STORAGE_SITE_ID,t),D.setStoredValue("disableMinify",!o),D.setStoredValue("audience",a),O.setViewport(i),D.setStoredValue("viewport",r),console.log("Preview moving to: "+n),R.goTo(n,!1,!0)},x.prototype.getViewModelBuilder=function(e){var t=this.viewModelBuilder[e];return null==t&&(t={scope:"page",cacheable:!1,load:!0,create:!0}),t},x.prototype.setContextData=function(e){var t,r,i=0,a=this,o=function(){for(t=["global","page"],i=0;i<t.length;i++)for(r in e[t[i]])e[t[i]].hasOwnProperty(r)&&"__ko_mapping__"!==r&&a.loadCurrentFromJSON(r,e[t[i]][r],e);a.contextDataSet.resolve(),a.contextDataSet=P.Deferred(),a.contextDataSetSubscriber=a.contextDataSet.promise()},s=e.global.locale;s&&null!==s?y.setLocaleOnce(s,o):o()},x.prototype.pageContextChanged=function(e){var t=this;t.currentPage=e;var r=e.pageId,i={};i[b.PAGE_PARAM]=e.contextId,i[b.DATA_ONLY]=!0,this.load("layout",r,i,function(r){t.setContextData(r.data),t.updatePageEventData(r.data,e),r.data&&r.data.global&&r.data.global.site&&r.data.global.site.tenantId&&I.tenantId(r.data.global.site.tenantId),P.Topic(v.topicNames.PAGE_METADATA_CHANGED).publish(r),P.Topic(v.topicNames.PAGE_READY).publish(e)},t.handleServerError)},x.prototype.updatePageEventData=function(e,t){e.page&&e.page.repositoryId&&(t.pageRepositoryId=e.page.repositoryId)},x.prototype.handleServerError=function(e){this.networkError()},x.prototype.pageParametersChanged=function(e){var t=this.getParameterData(e.parameters);P.Topic(v.topicNames.PAGE_PARAMETERS).publishWith({pageId:e.pageId,seoslug:e.seoslug,parameters:t},[{message:"success"}])},x.prototype.pageViewChanged=function(e){var t=this;t.shouldPageBeRefreshed(e.path),t.currentPage=e;var r="home/";"agentUI"===D.profileType&&(r="agentHome/");var i=null;e.pageId&&(r=e.pageId),e.contextId&&(r=e.pageId,i={},i[b.PAGE_PARAM]=e.contextId,i[b.DATA_ONLY]=!1),e.path&&(r=e.path),r=R.getPathWithoutApplicationContext(r);var a=window.siteBaseURLPath;a&&"/"!==a&&(r=R.getPathWithoutSiteBasePath(r),""===r&&(r="home","agentUI"===D.profileType&&(r="agentHome/")));var o=window.location.href.split("?"),s=null,n=void 0;if(o.length>1&&(n=o[1],s=o[1].split("&")),s){null==i&&(i={});for(var c in s){var l=s[c].split("=");!e.path||"404"!==e.path||e.parameters&&""!==e.parameters?"occsite"!==l[0]&&(i[l[0]]=l[1]):"usePageId"!==l[0]&&"usePreviewData"!==l[0]&&(i[l[0]]=l[1])}}null==i&&(i={}),i.dataOnly||(i.dataOnly=!1),this.load("layout",r,i,function(r){t.isPreview=r.isPreview(),t.pageResponse=r,r.data.page.pageId&&(e.pageId=r.data.page.pageId),r.data.page.contextId&&(e.contextId=r.data.page.contextId),t.storeConfiguration.enablePrioritizedLoading&&(t.formWidgetQueue(r),t.displayWidgets());var i;t.setContextData(r.data),t.updatePageEventData(r.data,e),r.data&&r.data.global&&r.data.global.site&&r.data.global.site.tenantId&&I.tenantId(r.data.global.site.tenantId),e.parameters&&P.Topic(v.topicNames.PAGE_PARAMETERS).publishWith({pageId:e.pageId,seoslug:e.seoslug,parameters:t.getParameterData(e.parameters)},[{message:"success"}]),P.Topic(v.topicNames.PAGE_CHANGED).publish(e),P.Topic(v.topicNames.PAGE_LAYOUT_LOADED).publish(r,e);var a={pageId:e.pageId};t.storeServerLog.logInfo("getPage",t.storeServerLog.getMessage("getPage",a)),0===t.pendingWidgets().length?P.Topic(v.topicNames.PAGE_READY).publish(e):i=t.pendingWidgets.subscribe(function(t){0===t.length&&(P.Topic(v.topicNames.PAGE_READY).publish(e),i.dispose())})},t.handleServerError.bind(t))},x.prototype.create=function(e,t,r,i,a,o,s){var n,c,l,d=this;if(P.isFunction(i)?(P.isFunction(a)?(s=o,o=a):s=a,a=i,i=null):P.isFunction(o)||(s=o,o=null),n=this.getViewModelBuilder(e),n&&n.create){if(n.cachable){var u=d.idAndParamsToCacheKey(t,i);d.cache.set(e,u,r)}if(c=n.create,!c)throw"Loading of resource type: "+e+" forbidden";l=c===!0?r:c(r,i,s),this.adapter.persistCreate(e,t,l,i,function(e){a&&a(e,s)},function(e){o&&o(e,s)})}},x.prototype.update=function(e,t,r,i,a,o,s){var n,c,l;if(P.isFunction(i)?(P.isFunction(a)?(s=o,o=a):s=a,a=i,i=null):P.isFunction(o)||(s=o,o=null),n=this.getViewModelBuilder(e),n&&n.update){if(c=n.update,!c)throw"Updating of resource type: "+e+" forbidden";l=c===!0?r:c(r,i,s),this.adapter.persistUpdate(e,t,l,i,function(e){a&&a(e,s)},function(e){o&&o(e,s)})}},x.prototype.remove=function(e,t,r,i,a,o){var s,n,c=this;if(P.isFunction(r)?(P.isFunction(i)?(o=a,a=i):o=i,i=r,r=null):P.isFunction(a)||(o=a,a=null),s=this.getViewModelBuilder(e),s&&s.remove){if(s.cachable){var l=c.idAndParamsToCacheKey(t,r);this.cache.set(e,l,null)}if(n=s.remove,!n)throw"Deleting of resource type: "+e+" forbidden";this.adapter.persistDelete(e,t,r,function(e){i&&i(e,o)},function(e){a&&a(e,o)})}},x.prototype.loadRequestForLayout=function(e,t,r,i,a,o,s){var n=P.Deferred(),c=this;return D.request(e,t,function(e){c.shouldPageBeRefreshed(r),1==c.deferLoadLargeCartInPromptRefresh?n.reject(e):n.resolve(e)},function(e){n.reject(e),F(e)},r,i,a,o,s),n},e.observableArray.fn.setAt=function(e,t){this.valueWillMutate(),this()[e]=t,this.valueHasMutated()},x.prototype.loadDataForLayout=function(e,t,r,i,a,o){var s=this,n=e,c=a.load,l=P.extend({},e);l.hasOwnProperty(b.DATA_ONLY)&&delete l[b.DATA_ONLY];var d=O.viewportDesignation();if(s.storeConfiguration.enableLayoutsRenderedForLayout===!0){var u=s.storeConfiguration.getLayoutIdsRendered();u.length>0&&(l[b.LAYOUTS_RENDERED]=u.toString())}d&&(l.ccvp=d);var p=P.extend({},e,{cacheableDataOnly:!0});this.storageApi.getItem(b.LOCAL_STORAGE_CURRENT_CONTEXT)&&(p.cacheableDataOnly=!1);var h=!1;void 0!=s.contextHandler.get(b.PRODUCT_TYPES,"page")()||s.storeConfiguration.skipLoadingProductTypes||(h=!0),p.productTypesRequired=h;var g={};g[b.ENDPOINT_KEY]=b.ENDPOINT_PAGES_GET_PAGE,g[b.PAGE_KEY]=t,g[b.IDENTIFIER_KEY]="layoutOnly";var f=s.storeConfiguration.getFilterToUse(g);f&&(l[b.FILTER_KEY]=f),D.previewMode&&(l[b.DISABLE_MINIFY]=!("true"===n.minifyJS)),g[b.IDENTIFIER_KEY]="cachableData";var m=s.storeConfiguration.getFilterToUse(g);m&&(p[b.FILTER_KEY]=m);var I={currentDataOnly:!0};g[b.IDENTIFIER_KEY]="currentData";var E=s.storeConfiguration.getFilterToUse(g);E&&(I[b.FILTER_KEY]=E),s.storeConfiguration.enableSpinnerOnPageLoad&&s.pageLoading();var y=P.extend({},e);y.hasOwnProperty(b.DATA_ONLY)&&delete y[b.DATA_ONLY],P.when(this.loadRequestForLayout(b.ENDPOINT_GET_LAYOUT,l,t),this.loadRequestForLayout(b.ENDPOINT_PAGES_GET_PAGE,p,t),this.loadRequestForLayout(b.ENDPOINT_PAGES_GET_PAGE,P.extend({},e,{currentDataOnly:!0}),t),U.loadCssForLayout(t,y)).done(function(e,l,d){if(r){d.data.global.user.parentOrganization&&(l.data.global.site.priceListGroup.defaultPriceListGroup=d.data.global.user.priceListGroup,l.data.global.site.priceListGroup.activePriceListGroups=[d.data.global.user.priceListGroup],l.data.global.site.currency=d.data.global.user.priceListGroup.currency);var u,p=P.extend(!0,e,l,d);if(n.pageId=t,!p.data.page||"product"!==p.data.page.pageId&&"category"!==p.data.page.pageId||0!=p.data.page.hasOwnProperty(b.PRODUCT_TYPES)||void 0==s.contextHandler.get(b.PRODUCT_TYPES,"page")()||(p.data.page[b.PRODUCT_TYPES]=s.contextHandler.get(b.PRODUCT_TYPES,"page")()),s.storeConfiguration.storeLayoutIdsRendered(e),c===!0)u=p;else{u=c(p,s,n);var h=s.masterViewModel().regions(),g=p.regions,f=0;h.length=g.length;var m=new Array(h.length);for(s.masterViewModel().regions.valueWillMutate(),f=0;f<h.length;f++){var I=H(h[f],g[f]);if(I){var E=V(h[f],g);if(E!=-1&&(m[E]=h[f]),!m[f]){var y=s.getViewModelBuilder("region"),T=y.load(g[f],s,n);h[f]=T}}else h[f].similarRegions[g[f].id]={}}for(f=0;f<m.length;f++)void 0!==m[f]&&(s.masterViewModel().regions()[f]=m[f]);if(s.storeConfiguration.enablePrioritizedLoading)for(s.widgetCount=0,f=0;f<s.masterViewModel().regions().length;f++)s.iterateRegionsAndResetDisplay(s.masterViewModel().regions()[f]);s.masterViewModel().regions.valueHasMutated(),s.masterViewModel().buildRows()}if(s.masterViewModel().title(u.title()),s.masterViewModel().keywords(u.keywords()),s.masterViewModel().description(u.description()),s.masterViewModel().metaTags(u.metaTags()),s.masterViewModel().isPreview(u.isPreview()),s.masterViewModel().noindex(u.noindex()),O.layoutViewports(u.viewports?u.viewports():""),void 0===s.storeConfiguration.isFreshPageLoad?s.storeConfiguration.isFreshPageLoad=!0:s.storeConfiguration.isFreshPageLoad===!0&&(s.storeConfiguration.isFreshPageLoad=!1),P.Topic(v.topicNames.PAGE_LAYOUT_UPDATED).publish(p,n),P.Topic(v.topicNames.LOCALE_READY).subscribe(s.updatePageChangeMessage.bind(s,p)),""===s.masterViewModel().pageChangeMessage()&&s.masterViewModel().dataForPageChangeMessage(p.data),s.storeConfiguration.enableSpinnerOnPageLoad&&s.pageLoadingComplete(),a.cachable){var S=s.idAndParamsToCacheKey(t,n);s.cache.set(type,S,u)}r(u,o)}else u.status==b.HTTP_NOT_FOUND||u.status==b.BAD_REQUEST?F(u):i&&pResult&&i(pResult,o)})},x.prototype.iterateRegionsAndResetDisplay=function(e){var t=this;if(e.regions().length>0)for(var r=0;r<e.regions().length;r++)t.iterateRegionsAndResetDisplay(e.regions()[r]);else for(var r=0;r<e.widgets().length;r++){var i=e.widgets()[r].id();i in t.widgets&&delete t.widgets[i],e.widgets()[r].occPrioritizedDisplay(!1),t.widgetCount++}},x.prototype.updatePageChangeMessage=function(e){var t=this;e.data.page.category?t.masterViewModel().pageChangeMessage(y.t("ns.common:resources.categoryPageLoadedText",{collection:e.data.page.category.displayName})):e.data.page.product?t.masterViewModel().pageChangeMessage(y.t("ns.common:resources.productPageLoadedText",{product:e.data.page.product.displayName})):"userSpacesPage"===e.data.page.repositoryId?t.masterViewModel().pageChangeMessage(y.t("ns.common:resources.wishlistPageLoadedText")):"searchResultsPage"!=e.data.page.repositoryId&&t.masterViewModel().pageChangeMessage(y.t("ns.common:resources.pageLoadedText",{page:e.data.page.repositoryId})),P.Topic(v.topicNames.LOCALE_READY).unsubscribe(t.updatePageChangeMessage)},x.prototype.load=function(e,t,r,i,a,o){var s,n,c,l=this;if(P.isFunction(r)?(P.isFunction(i)?(o=a,a=i):o=i,i=r,r=null):P.isFunction(a)||(o=a,a=null),s=this.getViewModelBuilder(e),
s&&s.load){if(s.cachable){var d=l.idAndParamsToCacheKey(t,r);if(c=this.cache.get(e,d),c.hit===!0)return void(i&&i(c.result,o))}if(n=s.load,!n)throw"Loading of resource type: "+e+" forbidden";var u=r?r:{};"layout"==e&&u.dataOnly===!1?this.loadDataForLayout(u,t,i,a,s,o):this.adapter.loadJSON(e,t,r,function(a){var c;if(c=n===!0?a:n(a,l,r),s.cachable){var d=l.idAndParamsToCacheKey(t,r);l.cache.set(e,d,c)}i&&i(c,o)},function(e){a&&a(e,o)})}},x.prototype.loadCurrentFromJSON=function(e,t,r,i){var a,o,s;if(o=this.getViewModelBuilder(e),!o)return null;if(a=o.scope?o.scope:"page",o.load){if(o.load===!0){if(this.contextHandler.set(e,t,a),i&&o.cachable){var n=self.idAndParamsToCacheKey(i,r);this.cache.set(e,n,s)}return t}if(s=o.load(t,this,r),this.contextHandler.set(e,s,a),i&&o.cachable){var n=self.idAndParamsToCacheKey(i,r);this.cache.set(e,n,s)}return s}return null},x.prototype.instantiateWidget=function(t){var r,i=new this.WidgetViewModel(this.basePath);for(r in t)t.hasOwnProperty(r)&&(e.isObservable(t[r])&&!e.isComputed(t[r])?t[r].remove?i[r]=e.observableArray(t[r]()):i[r]=e.observable(t[r]()):e.isComputed(t[r])||(i[r]=t[r]));return this.initializeWidget(i,!0),i},x.prototype.initializeWidget=function(e,t,r){var i=this;i.contextDataSetSubscriber.done(function(){i.runWidgetInitialization(e,t,r)})},x.prototype.runWidgetInitialization=function(t,r,i){var a,o,s,n,c=this;if(c.pendingWidgets.push(t),r&&t.imports)for(o=e.utils.unwrapObservable(t.imports),n=o.length-1;n>=0;n-=1)a=o[n],s=this.getViewModelBuilder(a),s&&(s=s.scope||"page"),t[a]=this.contextHandler.get(a,s);if(e.utils.unwrapObservable(t.javascript)){var l=t.jsPath()+"/",d=t.javascript();if(t.assetMappings){var u="/js/"+t.javascript()+".js",p=t.assetMappings[u];if(p){var h=p().lastIndexOf("/");l=p().substring(0,h),d=p()}}requirejs.s.contexts._.nextTick=function(e){e()};var g=requirejs.s.contexts._.config.map?requirejs.s.contexts._.config.map:{};g[d]={};var f=!1,m=P.Deferred();if(null!==t.javascriptExtension()){var I=t.assetMappings["/js/ext/"+t.javascriptExtension()],E=e.unwrap(I);E&&require([E],function(e){e&&e.beforeAppear&&"function"==typeof e.beforeAppear&&(f=!0),e&&e.onLoad&&"function"==typeof e.onLoad&&e.onLoad.call(t,t),t.__cc__extjs=e,m.resolve(e)})}for(var y in t.assetMappings)if(0===y.indexOf("/js/")&&y.indexOf(t.javascript()+".js")===-1){var b=t.javascript().endsWith(".min"),S=b?".min.js":".js",C=y.indexOf(S);C==-1&&(C=y.indexOf(".js"));var A=t.assetMappings[y](),_=y.substring(1,C);(!g[d][_]||b&&!g[d][_].endsWith(".min.js"))&&(g[d][_]=A)}require({baseUrl:l,map:g},[d],function(a){"function"==typeof a&&(a=a().bind(e));var o;for(o in a)a.hasOwnProperty(o)&&(e.isObservable(a[o])&&!e.isComputed(a[o])?a[o].remove?t[o]=e.observableArray(a[o]()):t[o]=e.observable(a[o]()):t[o]=a[o]);if(t.allPropertiesSet(t),a||T.warn("Failed to execute javascript for widget: "+t.javascript()),r&&a&&a.onLoad)var s=a.onLoad(t);c.storeConfiguration.enablePrioritizedLoading&&P.when(s).always(function(){c.callWidgetMethodIfApplicable(q,t)}),r&&a&&a.resourcesLoaded&&(t.resources()&&a.resourcesLoaded(t),t.resources.subscribe(function(e){e&&a.resourcesLoaded(t)})),t.initialized(!0),c.storeConfiguration.enablePrioritizedLoading&&void 0!=c.displayQueue[t.id()]&&c.displayQueue[t.id()].resolve(t),i&&i.call(this,t),c.pendingWidgets.remove(t),(t.hasBeforeAppear()||f)&&P.Topic(v.topicNames.PAGE_READY).subscribe(t.maybeFireBeforeAppearExtJSDeferred(m).bind(t))}),requirejs.s.contexts._.nextTick=requirejs.nextTick}else c.pendingWidgets.remove(t),t.initialized(!0),c.storeConfiguration.enablePrioritizedLoading&&void 0!=c.displayQueue[t.id()]&&c.displayQueue[t.id()].resolve(t)},x.prototype.idAndParamsToCacheKey=function(e,t){if(null==t)return e;var r=new Array;return r.push(e),t[b.PAGE_PARAM]&&r.push(t[b.PAGE_PARAM]),t[b.DATA_ONLY]&&r.push(t[b.DATA_ONLY]),r},x.prototype.pageReady=function(){var e=this;if(!e.isServerSideProcess()&&!e.isPreview){var t=I.createPageViewEvent(1);I.recordPageChange(t)}},x.prototype.paginationChange=function(e){e.paginationOnly&&this.pageReady()},x.prototype.isServerSideProcess=function(){var e=!1,t=window.location.href;return t.indexOf(b.SERVERSIDE_PROCESS_STRING)!=-1&&(e=!0),e},x.prototype.getParameterData=function(e){for(var t=e.split("&"),r={},i=0;i<t.length;i++){var a=t[i].split("=");r[a[0]]=a[1]}return r},x.prototype.networkError=function(){var e=this;e.networkErrorMessage=y.t("ns.common:resources.networkConnectivityError",{}),e.networkErrorReloadText=y.t("ns.common:resources.reloadPage",{}),P(window).scrollTop("0"),P(".modal").modal("hide"),P("#loadingModal").hide(),P("body").removeClass("modal-open"),P(".modal-backdrop").remove(),S.sendTemplateInfo(b.LAYOUT_CONTAIER_ID,e,"notificationsNetworkError")},x.prototype.formWidgetQueue=function(e){var t=this,r=e.regions();t.displayQueue={};for(var i in t.widgets)t.callWidgetMethodIfApplicable(B,t.widgets[i]);t.widgets={};for(var a=0;a<r.length;a++)t.iterateRegionsAndFormQueue(r[a])},x.prototype.iterateRegionsAndFormQueue=function(t){var r=this;if(t.regions().length>0)for(var i=0;i<t.regions().length;i++)r.iterateRegionsAndFormQueue(t.regions()[i]);else for(var i=0;i<t.widgets().length;i++){var a=t.widgets()[i],o=e.unwrap(a.id);r.widgets[o]=a,r.displayQueue[o]=P.Deferred()}},x.prototype.displayWidgets=function(){for(var e in this.widgets)this.queue.display(e,this)},x.prototype.callMethodInAllWidgets=function(e){for(var t in this.widgets)this.callWidgetMethodIfApplicable(e,this.widgets[t])},x.prototype.callWidgetMethodIfApplicable=function(e,t){if(e in t&&"function"==typeof t[e])try{t[e].call(t,this.currentPage,this.pageResponse)}catch(r){T.error("Error in "+e+" of widget : "+t.displayName(),r)}},x.prototype.pageLoading=function(){var e={parent:"#loadingModal",posTop:"0",posLeft:"50%"},t=y.t("ns.common:resources.loadingText");P("#loadingModal").removeClass("hide"),P("#loadingModal").show(),e.loadingText=t,M.create(e)},x.prototype.pageLoadingComplete=function(){P("#loadingModal").addClass("hide"),M.destroy()},window.onerror=function(e,t,r,i,a){P.Topic(v.topicNames.ONERROR_EXCEPTION_HANDLER).publish(e,t,r,i,a)},x.prototype.LayoutViewModel=r,x.prototype.RegionViewModel=i,x.prototype.WidgetViewModel=a,x.prototype.CartViewModel=o,x.prototype.OrderViewModel=s,x.prototype.SearchViewModel=u,x.prototype.ShippingMethodsViewModel=p,x.prototype.PaymentDetails=E,x.prototype.PaymentAuthResponseViewModel=h,x.prototype.UserViewModel=g,x.prototype.ProductViewModel=f,x.prototype.OrderDetailsViewModel=w,x.prototype.SpaceViewModel=m,x.prototype.ServerData=t,x.prototype.SiteViewModel=C,x.prototype.shouldPageBeRefreshed=function(e){if(D.isRefreshRequired&&"payment"!==e)if(this.storeConfiguration.largeCart){if(this.deferLoadLargeCartInPromptRefresh)return;this.deferLoadLargeCartInPromptRefresh=!0,P.Topic(v.topicNames.SAVE_CART_BEFORE_REFRESH).publish(self)}else window.location.reload()},x.prototype.storageApi=N.getInstance(),x}),define("pageLayout/scheduled-order",["ccConstants","knockout","ccDate","pageLayout/rest-adapter","pubsub","ccStoreConfiguration","ccRestClient"],function(e,t,r,i,a,o,s){"use strict";function n(e,t){return e-t}function c(e){var r=t.observable(!1);return{isDirty:t.computed(function(){return!!r()||(t.toJS(e),r(!0),!1)}),reset:function(){r(!1)}}}function l(){this.id=t.observable(),this.organizationId=t.observable(),this.name=t.observable(),this.state=t.observable(),this.scheduleType=t.observable(),this.occurrenceInDay=t.observable(),this.daysOfWeek=t.observableArray(),this.daysInMonth=t.observableArray(),this.weeksInMonth=t.observableArray(),this.monthsInYear=t.observableArray(),this.startDate=t.observable(),this.endDate=t.observable(),this.nextScheduledRun=t.observable(),this.profileId=t.observable(),this.templateOrderId=t.observable(),this.templateOrder=t.observable(),this.clonedOrders=t.observableArray(),this.lastError=t.observable(),this.suspend=t.observable(!1),this.scheduleMode=t.observable(),this.executionStatusList=t.observableArray(),this._adapter=new i("/ccstore/v1/"),this._scheduleModes=u,this._scheduleModePatterns=p,this._scheduleSeeds=h,this.dirtyFlag=c(this),this.subscriptions=[],this.storeConfiguration=o.getInstance(),this.period=t.observable(),this.delay=t.observable(),this.catchUp=t.observable(),this.dateCreated,this.nextOrder,this.responseData=t.observable()}function d(e){var t=new Date(e),r=""+(t.getMonth()+1),i=""+t.getDate(),a=t.getFullYear();return r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),[a,r,i].join("-")}var u=[e.SCHEDULE_MODE_QUARTERLY,e.SCHEDULE_MODE_BI_MONTHLY,e.SCHEDULE_MODE_ONCE_MONTHLY,e.SCHEDULE_MODE_TWICE_DAILY,e.SCHEDULE_MODE_ONCE_DAILY,e.SCHEDULE_MODE_WEEKLY],p={};p[e.SCHEDULE_MODE_QUARTERLY]={occurrenceInDay:/^1$/,daysOfWeek:/^$/,daysInMonth:/^1$/,weeksInMonth:/^$/,monthsInYear:/^([0-9]|1[0-1])(,([0-9]|(1[0-1]))){3,3}$/},p[e.SCHEDULE_MODE_BI_MONTHLY]={occurrenceInDay:/^1$/,daysOfWeek:/^$/,daysInMonth:/^1$/,weeksInMonth:/^$/,monthsInYear:/^([0-9]|1[0-1])(,([0-9]|(1[0-1]))){5,5}$/},p[e.SCHEDULE_MODE_ONCE_MONTHLY]={occurrenceInDay:/^1$/,daysOfWeek:/^$/,daysInMonth:/^1$/,weeksInMonth:/^$/,monthsInYear:/^0,1,2,3,4,5,6,7,8,9,10,11$/},p[e.SCHEDULE_MODE_TWICE_DAILY]={occurrenceInDay:/^2$/,daysOfWeek:/^.*$/,daysInMonth:/^$/,weeksInMonth:/^1,2,3,4,5$/,monthsInYear:/^0,1,2,3,4,5,6,7,8,9,10,11$/},p[e.SCHEDULE_MODE_ONCE_DAILY]={occurrenceInDay:/^1$/,daysOfWeek:/^1,2,3,4,5,6,7$/,daysInMonth:/^$/,weeksInMonth:/^1,2,3,4,5$/,monthsInYear:/^0,1,2,3,4,5,6,7,8,9,10,11$/},p[e.SCHEDULE_MODE_WEEKLY]={occurrenceInDay:/^1$/,daysOfWeek:/^([1-7])(,[1-7]){0,6}$/,daysInMonth:/^$/,weeksInMonth:/^([1-5])(,[1-5]){0,4}$/,monthsInYear:/^0,1,2,3,4,5,6,7,8,9,10,11$/};var h={};return h[e.SCHEDULE_MODE_QUARTERLY]={occurrenceInDay:1,daysOfWeek:[],daysInMonth:[1],weeksInMonth:[],monthsInYear:[0,3,6,9]},h[e.SCHEDULE_MODE_BI_MONTHLY]={occurrenceInDay:1,daysOfWeek:[],daysInMonth:[1],weeksInMonth:[],monthsInYear:[0,2,4,6,8,10]},h[e.SCHEDULE_MODE_ONCE_MONTHLY]={occurrenceInDay:1,daysOfWeek:[],daysInMonth:[1],weeksInMonth:[],monthsInYear:[0,1,2,3,4,5,6,7,8,9,10,11]},h[e.SCHEDULE_MODE_TWICE_DAILY]={occurrenceInDay:2,daysOfWeek:[],daysInMonth:[],weeksInMonth:[1,2,3,4,5],monthsInYear:[0,1,2,3,4,5,6,7,8,9,10,11]},h[e.SCHEDULE_MODE_ONCE_DAILY]={occurrenceInDay:1,daysOfWeek:[1,2,3,4,5,6,7],daysInMonth:[],weeksInMonth:[1,2,3,4,5],monthsInYear:[0,1,2,3,4,5,6,7,8,9,10,11]},h[e.SCHEDULE_MODE_WEEKLY]={occurrenceInDay:1,daysOfWeek:[1],daysInMonth:[],weeksInMonth:[1,2,3,4,5],monthsInYear:[0,1,2,3,4,5,6,7,8,9,10,11]},h[e.SCHEDULE_MODE_CUSTOM]={occurrenceInDay:1,daysOfWeek:[],daysInMonth:[],weeksInMonth:[],monthsInYear:[]},l.prototype.subscribeForChanges=function(){this.subscriptions.push(this.scheduleMode.subscribe(this._setScheduleMode.bind(this),this))},l.prototype.dispose=function(){for(var e=this.subscriptions.length,t=0;t<e;t++)this.subscriptions[t].dispose()},l.prototype.save=function(e,t){var r=this.toJS(),i=function(t){this.fromJS(t),"function"==typeof e&&e(t)}.bind(this),a=function(e){"function"==typeof t&&t(e)}.bind(this);r.id?this._adapter.persistUpdate("scheduledOrder",r.id,r,null,i,a):this._adapter.persistCreate("scheduledOrder",null,r,null,i,a)},l.prototype.remove=function(e,t){var r=this.id(),i=function(t){"function"==typeof e&&e(t)}.bind(this),a=function(e){"function"==typeof t&&t(e)}.bind(this);this._adapter.persistRemove("scheduledOrder",r,null,i,a)},l.prototype.fromJS=function(e){e=e||{},e.schedule=e.schedule||{},this.dateCreated=r.dateTimeFormatter(e.createDate,"MM/DD/YY",null);var t=new Date(e.nextScheduledRun);t&&"Invalid Data"!=t&&(this.nextOrder=r.dateTimeFormatter(e.nextScheduledRun,"MM/DD/YY",null)),this.id(e.id),this.organizationId(e.templateOrder.organizationId?e.templateOrder.organizationId:e.templateOrder.profile&&e.templateOrder.profile.organization?e.templateOrder.profile.organization.id:void 0),this.name(e.name),this.state(e.state),this.scheduleType(e.schedule.scheduleType||"calendar"),e.schedule.scheduleType&&"calendar"==e.schedule.scheduleType?(this.occurrenceInDay(e.schedule.occurrenceInDay||1),this.daysOfWeek(e.schedule.daysOfWeek||[]),this.daysInMonth(e.schedule.daysInMonth||[]),this.weeksInMonth(e.schedule.weeksInMonth||[]),this.monthsInYear(e.schedule.monthsInYear||[])):e.schedule.scheduleType&&"periodic"==e.schedule.scheduleType&&(this.period(e.schedule.period),this.catchUp(e.schedule.catchUp)),this.startDate(e.startDate),this.endDate(e.endDate||""),this.nextScheduledRun(e.nextScheduledRun),this.profileId(e.profileId),this.templateOrderId(e.templateOrderId),this.templateOrder(e.templateOrder||{}),this.clonedOrders(e.clonedOrders||[]),this.lastError(e.lastError),this.executionStatusList(e.executionStatusList||[]),this.scheduleMode(this._getScheduleMode()),this.dirtyFlag.reset(),this.subscribeForChanges()},l.prototype.toJS=function(){var e={id:this.id(),name:this.name(),state:this.state(),scheduleType:this.scheduleType(),schedule:"periodic"==this.scheduleType()?{period:this.period(),catchUp:this.catchUp(),delay:this.delay()}:{occurrenceInDay:this.occurrenceInDay(),daysOfWeek:this.daysOfWeek(),daysInMonth:0!=this.daysInMonth().length?this.daysInMonth():void 0,weeksInMonth:this.weeksInMonth(),monthsInYear:this.monthsInYear()},startDate:d.call(this,this.startDate()),endDate:this.endDate()?d.call(this,this.endDate()):"",nextScheduledRun:this.nextScheduledRun(),profileId:this.profileId(),templateOrderId:this.templateOrderId(),clonedOrders:this.clonedOrders(),lastError:this.lastError()};return e},l.prototype._getScheduleMode=function(){var t=e.SCHEDULE_MODE_CUSTOM;for(var r in this._scheduleModes){var i=this._scheduleModes[r];if(this._testScheduleMode(i)){t=i;break}}return t},l.prototype._testScheduleMode=function(e){var t=this._scheduleModePatterns[e].occurrenceInDay.test(this.occurrenceInDay())&&this._scheduleModePatterns[e].daysOfWeek.test(this.daysOfWeek.sort(n)())&&this._scheduleModePatterns[e].daysInMonth.test(this.daysInMonth.sort(n)())&&this._scheduleModePatterns[e].weeksInMonth.test(this.weeksInMonth.sort(n)())&&this._scheduleModePatterns[e].monthsInYear.test(this.monthsInYear.sort(n)());return t},l.prototype._setScheduleMode=function(t){var r=this._scheduleSeeds[t]||this._scheduleSeeds[e.SCHEDULE_MODE_CUSTOM];if(this.occurrenceInDay(r.occurrenceInDay),this.daysOfWeek(r.daysOfWeek.slice(0)),this.daysInMonth(r.daysInMonth.slice(0)),this.weeksInMonth(r.weeksInMonth.slice(0)),t===e.SCHEDULE_MODE_BI_MONTHLY){for(var i=new Date(this.startDate()),a=[],o=0,s=i.getMonth();;){if(a[o]=s,s=(s+2)%12,s==i.getMonth())break;o++}this.monthsInYear(a.sort(n))}else this.monthsInYear(r.monthsInYear.slice(0))},l.prototype.reset=function(){var e=this;e.id(""),e.name(""),e.state(""),e.scheduleType(""),e.occurrenceInDay(""),e.daysOfWeek([]),e.daysInMonth([]),e.weeksInMonth([]),e.monthsInYear([]),e.startDate(""),e.endDate(""),e.nextScheduledRun(""),e.profileId(""),e.executionStatusList([]),e.templateOrderId(""),e.templateOrder(""),e.clonedOrders([]),e.lastError(""),e.suspend(""),e.dispose(),e.scheduleMode(""),e.dirtyFlag.reset(),e.period(""),e.delay(""),e.catchUp(""),e.dateCreated=null,e.nextOrder=null,e.responseData("")},l.prototype.load=function(t){var r=this,i={};i.orderDetails=!0;var o={};o[e.ENDPOINT_KEY]=e.ENDPOINT_GET_SCHEDULED_ORDER,o[e.IDENTIFIER_KEY]="loadOrder";var n=r.storeConfiguration.getFilterToUse(o);return n&&(i[e.FILTER_KEY]=n),i.includeResult="full",s.request(e.ENDPOINT_GET_SCHEDULED_ORDER,i,function(e){r.responseData(e),r.fromJS(e);var t={message:e.errorMessages?e.errorMessages:void 0};$.Topic(a.topicNames.SCHEDULED_ORDER_LOAD_SCUCCESS).publishWith(t),$.Topic(a.topicNames.SCHEDULED_ORDER_LOAD_SUCCESS_AGENT).publish(e,t)},function(e){$.Topic(a.topicNames.SCHEDULED_ORDER_LOAD_ERROR).publishWith(e)},t),this},l.getInstance=function(){return l.singleInstance||(l.singleInstance=new l),l.singleInstance},l}),define("viewModels/guidedNavigationViewModel",["knockout","pubsub","ccConstants","navigation","jquery","spinner","CCi18n","pageLayout/search","storageApi","pageLayout/site"],function(e,t,r,i,a,o,s,n,c,l){"use strict";function d(t,a,o,s){var n=this;n.displayWidget=e.observable(!0),n.maxDimensionCount=t,n.maxRefinementCount=a,n.dimensions=n.collapsibleList([],n.maxDimensionCount),n.allRefinementCrumbs=e.observableArray(),n.searchText=e.observable(""),n.categoryHref=e.observable(""),n.categoryName=e.observable(""),n.categoryDimensionId=e.observable(""),n.categoryRepositoryId=e.observable(""),n.priceRangeDimension=r.GUIDED_NAVIGATION_PRICERANGE,n.categoryDimension=r.GUIDED_NAVIGATION_CATEGORY,d.prototype.locale(o),d.prototype.searchResultsHash=s?s:r.SEARCH_RESULTS_HASH,n.initialize(),n.removeRefinement=function(e){if(d.prototype.createSpinner(),""===n.searchText()&&e.dimensionName===r.GUIDED_NAVIGATION_CATEGORY){for(var t=e.removeAction?e.removeAction.link?e.removeAction.link:e.removeAction.navigationState:void 0,a=t?t.split("&"):void 0,o=!1,s=0;s<a.length;s++)if(a[s].indexOf("N=")!==-1){var c=a[s].substring(a[s].indexOf("N=")+2),l=n.categoryDimensionId()+"+"+c;t=t.replace(c,l),o=!0}0==o?i.goTo(n.categoryHref()):i.goTo(n.searchResultsHash+t+"&"+r.SEARCH_TYPE+"="+r.SEARCH_TYPE_GUIDED+"&"+r.PARAMETERS_TYPE+"="+r.PARAMETERS_SEARCH_QUERY)}else i.goTo(n.searchResultsHash+(e.removeAction.link?e.removeAction.link:e.removeAction.navigationState)+"&"+r.SEARCH_TYPE+"="+r.SEARCH_TYPE_GUIDED+"&"+r.PARAMETERS_TYPE+"="+r.PARAMETERS_SEARCH_QUERY)},n.clearAllRefinements=function(){d.prototype.createSpinner(),n.searchText().trim()?i.goTo(n.searchResultsHash+"?"+r.SEARCH_TERM_KEY+"="+encodeURIComponent(n.searchText().trim())+"&"+r.SEARCH_DYM_SPELL_CORRECTION_KEY+"="+encodeURIComponent(r.DYM_ENABLED)+"&"+r.SEARCH_NAV_ERECS_OFFSET+"=0&"+r.SEARCH_REC_PER_PAGE_KEY+"="+r.DEFAULT_SEARCH_RECORDS_PER_PAGE+"&"+r.SEARCH_TYPE+"="+r.SEARCH_TYPE_SIMPLE+"&"+r.PARAMETERS_TYPE+"="+r.PARAMETERS_SEARCH_QUERY):i.goTo(n.categoryHref())},n.checkForRange=function(e){var t="dimval.match_type";return!(!e||!e.properties||"range"!==e.properties[t])},n.checkIfUnboundRange=function(e){var t="DGraph.Spec";return!(!e||!e.properties||e.properties[t].indexOf("-unbounded")==-1)},n.getLowerBound=function(e){var t="dimval.prop.lowerBound";return e&&e.properties&&e.properties[t]?e.properties[t]:null},n.getUpperBound=function(e){var t="dimval.prop.upperBound";return e&&e.properties&&e.properties[t]?this.correctUpperBound(e.properties[t]):null},n.correctUpperBound=function(e){for(var t=1,r=0;r<l.getInstance().selectedPriceListGroup().currency.fractionalDigits;r++)t*=.1;return t=t.toFixed(l.getInstance().selectedPriceListGroup().currency.fractionalDigits),e-t},n.getUpperBoundText=function(e){return e.label?e.label.substr(e.label.indexOf(" ")):null}}function u(t,r){var i=this;i.dimensionName=t.dimensionName,i.isExpanded=e.observable(!1),i.shouldDimensionExpand=e.observable(!1),i.ariaLabelText=e.observable("expandText"),i.displayName=t.displayName,"Category"===i.displayName?i.displayName=s.t("ns.common:resources.categoryText"):"Price Range"===i.displayName&&(i.displayName=s.t("ns.common:resources.priceRangeText")),i.refinements=d.prototype.refinementList(t.refinements,r,i.dimensionName,t.multiSelect),i.multiSelect=t.multiSelect,i.ancestors=t.ancestors,t.shouldMultiSelectDimensionExpand&&(i.shouldDimensionExpand(!0),i.isExpanded(!0))}var p=n.getInstance();return d.prototype.isSpinnerStarted=e.observable("false"),d.prototype.locale=e.observable(""),d.prototype.searchResultsHash="",d.prototype.refinementIndicatorOptions={parent:"#loadingModal"},d.prototype.destroySpinner=function(){a("#loadingModal").hide(),o.destroy()},d.prototype.createSpinner=function(){a("#loadingModal").removeClass("hide"),a("#loadingModal").show(),d.prototype.isSpinnerStarted("true"),(a(window)[0].innerWidth||a(window).width())<r.VIEWPORT_TABLET_LOWER_WIDTH?(d.prototype.refinementIndicatorOptions.posLeft="40%",d.prototype.refinementIndicatorOptions.posTop="80px"):(a(window)[0].innerWidth||a(window).width())<r.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?(d.prototype.refinementIndicatorOptions.posLeft="45%",d.prototype.refinementIndicatorOptions.posTop="100px"):(d.prototype.refinementIndicatorOptions.posLeft="50%",d.prototype.refinementIndicatorOptions.posTop="150px"),o.create(d.prototype.refinementIndicatorOptions)},d.prototype.updateWithSearchResultsData=function(i,o,s){var n=[];if(o&&o.breadcrumbs&&o.breadcrumbs.refinementCrumbs){n=o.breadcrumbs.refinementCrumbs.slice(0);for(var c=0;c<n.length;c++){if(!o.assemblerPagesPath||window.clientConfigData&&window.clientConfigData.useEnhancedSearch&&"true"==window.clientConfigData.useEnhancedSearch||(n[c].removeAction.link=s.toLegacyUrl(n[c].removeAction.link)),1==n[c].multiSelect&&n[c].count>0){for(var l=!1,d=0;d<o.navigation.length;d++)if(o.navigation[d].dimensionName==n[c].dimensionName){o.navigation[d].shouldMultiSelectDimensionExpand=!0,n[c].isSelected=!0,l=!0,o.navigation[d].refinements&&o.navigation[d].refinements instanceof Array&&o.navigation[d].refinements.indexOf(n[c])<0&&o.navigation[d].refinements.push(n[c]);break}if(0==l){n[c].isSelected=!0;var p={multiSelect:!0,name:n[c].name,ancestors:[],shouldMultiSelectDimensionExpand:!0,displayName:n[c].displayName,dimensionName:n[c].dimensionName,refinements:[n[c]]};o.navigation.push(p)}}""===s.searchText()&&n[c].dimensionName==r.GUIDED_NAVIGATION_CATEGORY&&a.Topic(t.topicNames.CATEGORY_CRUMB_UPDATED).publish(s.convertLabel(n[c]))}""===s.searchText()&&n.length>0&&n[0].dimensionName===r.GUIDED_NAVIGATION_CATEGORY&&n[0].properties&&s.categoryRepositoryId()===n[0].properties["dimval.prop.category.repositoryId"]?s.allRefinementCrumbs(n.slice(1)):s.allRefinementCrumbs(n.slice(0))}if(o.searchAdjustments&&o.searchAdjustments.originalTerms&&o.searchAdjustments.originalTerms.length>0&&s.searchText(o.searchAdjustments.originalSearchTerms[0]),i.message!==r.SEARCH_MESSAGE_FAIL&&(o.navigation&&o.navigation.length>0||n.length>0)){s.dimensions(e.utils.arrayMap(o.navigation,function(e){return new u(e,s.maxRefinementCount)}),s.maxDimensionCount),s.dimensions.showAll(!1),s.displayWidget(!0)}else s.displayWidget(!1)},d.prototype.initialize=function(){var e=this;a.Topic(t.topicNames.SEARCH_RESULTS_UPDATED).subscribe(function(t){var r=this;d.prototype.updateWithSearchResultsData(t,r,e),d.prototype.checkSpinner()}),a.Topic(t.topicNames.SEARCH_RESULTS_FOR_CATEGORY_UPDATED).subscribe(function(t){var r=this;d.prototype.updateWithSearchResultsData(t,r,e),d.prototype.checkSpinner()}),a.Topic(t.topicNames.CATEGORY_UPDATED).subscribe(function(t){e.categoryHref(t.categoryRoute),e.categoryName(t.categoryName),e.categoryDimensionId(t.dimensionId),e.categoryRepositoryId(t.repositoryId),e.searchText("")}),a.Topic(t.topicNames.OVERLAYED_GUIDEDNAVIGATION_CLEAR).subscribe(function(){d.prototype.resetViewModel(e)}),e.searchText()||e.categoryName()||e.loadCategoryFromLocalData()},d.prototype.loadCategoryFromLocalData=function(){var e=this,t=null;t=c.getInstance().getItem("category"),t&&"string"==typeof t&&(t=JSON.parse(t)),null!=t&&(e.categoryHref(t.categoryRoute),e.categoryName(t.categoryName),e.categoryRepositoryId(t.repositoryId),e.categoryDimensionId(t.dimensionId))},d.prototype.convertLabel=function(e){var t=e.label,r="dimval.prop.displayName_"+d.prototype.locale();return e&&e.properties&&e.properties[r]&&(t=e.properties[r]),t},d.prototype.toLegacyUrl=function(e){return e=e.replace(/\?/,"&"),e=e.replace(/^.*\/_\//,""),e=e.replace(/^N-/,"N="),"?"+e},d.prototype.checkSpinner=function(){d.prototype.isSpinnerStarted()&&d.prototype.destroySpinner(),d.prototype.isSpinnerStarted("false")},d.prototype.resetViewModel=function(e){e.displayWidget(!1),e.dimensions.removeAll(),e.allRefinementCrumbs.removeAll()},d.prototype.refinementList=function(t,r,i,o){var n=this;a.each(t,function(t,r){r.label=n.convertLabel(r),r.refinementValue=s.t("ns.common:resources.refinementValueText",{dataLabel:r.label,dataCount:r.count}),!r.link||window.clientConfigData&&window.clientConfigData.useEnhancedSearch&&"true"==window.clientConfigData.useEnhancedSearch||(r.link=n.toLegacyUrl(r.link)),this.hasOwnProperty("multiSelect")&&1==this.multiSelect||!this.hasOwnProperty("multiSelect")&&o?(r.checkedValue=e.observable(!1),this.isSelected&&1==this.isSelected&&r.checkedValue(!0),r.checkedValue.subscribe(function(e){e||(this.navigationState=this.removeAction.link?this.removeAction.link:this.removeAction.navigationState),d.prototype.createSpinnerAndHandleRedirect(this.link?this.link:this.navigationState)},r)):r.clickRefinement=function(){d.prototype.createSpinnerAndHandleRedirect(this.link?this.link:this.navigationState)}});var c=n.collapsibleList(t,r);return c},d.prototype.createSpinnerAndHandleRedirect=function(e){var t=this;d.prototype.createSpinner(),i.goTo(t.searchResultsHash+p.getFilteredNavState(e)+"&"+r.SEARCH_TYPE+"="+r.SEARCH_TYPE_GUIDED+"&"+r.PARAMETERS_TYPE+"="+r.PARAMETERS_SEARCH_QUERY)},d.prototype.collapsibleList=function(t,r){var i=e.observableArray(t);return i.limit=e.observable(r),i.showAll=e.observable(!1),i.toggleShowAll=function(){i.showAll(!i.showAll())},i.display=e.computed(function(){return i.showAll()?i():i().slice(0,i.limit())},i),i},d}),define("ccPaginated",["knockout","pubsub","navigation","crossroads","ccConstants","ccNavState"],function(e,t,r,i,a,o){"use strict";function s(){var t=this;t.active=!1,t.pageNumber=1,t.pageId=e.observable(""),t.contextId=e.observable(""),t.paginationOnly=e.observable(!1),t.seoslug=e.observable(""),t.previousHash=e.observable(""),t.currentHash=e.observable(""),t.isMobileView=e.observable(!1),t.paginationType=e.observable(0),t.targetPage=1,t.clearOnLoad=!1,t.itemsPerPage=40,t.blockSize=40,t.pageBatchSize=1,t.data=e.observableArray().extend({deferred:!0}),t.pageWindowSize=5,t.startIndex=0,t.lastIndex=t.pageWindowSize-1,t.pageIndex=0,t.middlePageOffset=0,t.focusPage=!1,t.pages=e.computed(t.pagesFunction,t),t.scrollToTop=!0,t.currentPage(1),t.firstPageIndex(1),t.totalNumber(0),t.sortDirectiveProp("displayName"),t.sortDirectiveOrder("asc"),t.totalNumberOfPages(0),t.clickedPage(-1),t.useGenericSort=!1,t.sortOptions=e.observableArray([]),t.selectedResultsPerPageOption=e.observable(),t.resultsPerPageOptions=e.observableArray([])}return s.prototype.currentPage=e.observable(0),s.prototype.totalNumber=e.observable(0),s.prototype.firstPageIndex=e.observable(1),s.prototype.data=e.observableArray([]).extend({deferred:!0}),s.prototype.sortDirectiveProp=e.observable("displayName"),s.prototype.sortDirectiveOrder=e.observable("asc"),s.prototype.totalNumberOfPages=e.observable(0),s.prototype.pageStartIndex=e.observable(),s.prototype.pageEndIndex=e.observable(),s.prototype.clickedPage=e.observable(-1),s.prototype.updatePagination=function(e){var t="";if(a.ALLOW_HASHBANG&&(t+=a.URL_HASH_SIGN+a.URL_PREPEND_HASH),1==this.paginationType())return t=o.route()+"/"+e,r.getPathWithLocale(t);if(2==this.paginationType()){var s="/searchresults?{parameters}";window.clientConfigData&&window.clientConfigData.useEnhancedSearch&&"true"==window.clientConfigData.useEnhancedSearch&&(s="/"+r.getPath()+"?{parameters}");var n=i.addRoute(s),c="",l=!1;for(var d in this.parameters)this.parameters.hasOwnProperty(d)&&("page"==d&&(this.parameters[d]=e,l=!0),c+=d+"="+this.parameters[d]+"&");return c=c.substring(0,c.length-1),l||(c+="&page="+e),t+=n.interpolate({parameters:c}),r.getPathWithLocale(t)}if(3==this.paginationType()){t=a.AGENT_BASE_CONTEXT+"/"+a.URL_HASH_SIGN+a.URL_PREPEND_HASH;var n=i.addRoute("/{pageId}/{contextId}?{parameters}"),c="",l=!1;for(var d in this.parameters)this.parameters.hasOwnProperty(d)&&("page"==d&&(this.parameters[d]=e,l=!0),c+=d+"="+this.parameters[d]+"&");return c=c.substring(0,c.length-1),l||(c&&(c+="&"),c+="page="+e),t+=n.interpolate({pageId:this.pageId(),contextId:this.contextId(),parameters:c}),r.getPathWithLocale(t)}return""},s.prototype.load=function(e){e?(this.clearData(),this.clearOnLoad=!0):(this.clearData(),this.pageNumber&&(this.totalNumberOfPages(this.pageNumber),this.firstPageIndex(null),this.currentPage(this.pageNumber),this.firstPageIndex(1))),this.getPage(this.pageNumber||this.currentPage()||1)},s.prototype.cleanPage=function(){if(1==this.paginationType())s=o.route(),r.goTo(s);else if(2==this.paginationType()){var e=i.addRoute("/searchresults?{parameters}"),t="";for(var a in this.parameters)this.parameters.hasOwnProperty(a)&&("page"==a||(t+=a+"="+this.parameters[a]+"&"));t=t.substring(0,t.length-1),s=e.interpolate({parameters:t}),r.goTo(s)}else if(3==this.paginationType()){var e=i.addRoute("/{pageId}/{contextId}?{parameters}"),t="";for(var a in this.parameters)this.parameters.hasOwnProperty(a)&&("page"==a||(t+=a+"="+this.parameters[a]+"&"));t=t.substring(0,t.length-1);var s=e.interpolate({pageId:this.pageId(),contextId:this.contextId(),parameters:t});r.goTo(s)}},s.prototype.firstPage=function(){return this.updatePagination(this.firstPageIndex())},s.prototype.goToFirstPageControls=function(){return this.initializeIndex(),!0},s.prototype.previousPage=function(){return this.currentPage()>this.startIndex+1?this.updatePagination(this.currentPage()-1):this.updatePagination(this.currentPage())},s.prototype.goToPage=function(e){return this.updatePagination(e.pageNumber)},s.prototype.nextPage=function(){return this.currentPage()<this.totalNumberOfPages()?this.updatePagination(this.currentPage()+1):this.updatePagination(this.currentPage())},s.prototype.lastPage=function(){return this.updatePagination(this.totalNumberOfPages())},s.prototype.incrementPage=function(){this.currentPage()<this.totalNumberOfPages()&&this.getPage(this.currentPage()+1)},s.prototype.getPage=function(e){if(this.totalNumberOfPages()>1&&this.adjustPageIndex(e),this.adjustStartAndEndPageIndex(e),e!==this.currentPage()&&e!==this.targetPage&&this.isMobileView()&&$.Topic(t.topicNames.RECORD_PAGINATION_PAGE_CHANGE).publish(),e===this.targetPage&&null!==this.targetPage&&void 0!==this.targetPage||(this.targetPage=e),this.clearOnLoad)return this.fetchBlock(this.pageStartIndex()),this.clickedPage(e),void this.currentPage(e);for(var r=this.pageStartIndex();r<this.pageEndIndex();r+=1)if("undefined"==typeof this.data()[r])return e!==this.currentPage()&&(this.targetPage=e),void this.fetchBlock(this.pageStartIndex());this.currentPage(e)},s.prototype.pagesFunction=function(){var e,t,r,i,a,o,s,n,c,l=1;for(this.clearOnLoad&&this.adjustStartAndEndPageIndex(this.pageNumber),this.totalNumber()?(t=(this.totalNumber()-this.totalNumber()%this.itemsPerPage)/this.itemsPerPage,r=this.totalNumber()%this.itemsPerPage>0?1:0,e=t+r):e=0,this.prevTotalNumberOfPages=this.totalNumberOfPages(),this.totalNumberOfPages(e),this.adjustPageIndex(this.pageNumber),i=[],n=this.startIndex;n<=this.lastIndex&&n<this.totalNumberOfPages();n+=1)a=n+1,o=a===this.currentPage(),s=!!this.focusPage&&o,c=Math.abs(a-n-l),l+=1,i[c]={pageNumber:a,selected:o,focused:s};return!this.focusPage&&i.length>0&&(this.focusPage=!0),i},s.prototype.adjustPageIndex=function(e){var t=Math.floor(this.pageWindowSize/2);if(e>=this.totalNumberOfPages())e>this.totalNumberOfPages()&&(e=this.totalNumberOfPages()),e==this.totalNumberOfPages()&&(this.lastIndex=this.totalNumberOfPages()-1,this.lastIndex<this.pageWindowSize-1?this.startIndex=0:this.startIndex=this.lastIndex-(this.pageWindowSize-1));else if(e<=t)this.startIndex=0,this.totalNumberOfPages()<=this.pageWindowSize?this.lastIndex=this.totalNumberOfPages()-1:this.lastIndex=this.pageWindowSize-1;else{var r=this.totalNumberOfPages()-e;r>=t?(this.startIndex=e-1-t,this.lastIndex=e-1+t):(this.startIndex=e-1-t-r,this.lastIndex=e-1+t-r),this.startIndex<0&&(this.startIndex=0)}},s.prototype.sort=function(e){var t,r,i;this.sortDirectiveOrder(),e.order();if(!e.notReversible||this.sortDirectiveOrder()!=e.order()){for(e.maintainSortOrder&&e.maintainSortOrder===!0?r=e.order():e.id&&(r="none"===e.order()||"desc"===e.order()?"asc":"desc"),this.sortDirectiveOrder(r),t=0;t<this.sortOptions().length;t+=1)this.sortOptions()[t]===e?this.sortOptions()[t].order(r):this.sortOptions()[t].maintainSortOrder||this.sortOptions()[t].order("none");if(this.sortDirectiveProp(e.id),2==this.paginationType()||3==this.paginationType()){
if(this.useGenericSort)var o=e.id+("desc"===r?"|1":"|0");else{var o="product.relevance";"listPrice"===e.id&&(o="sku.activePrice",o+="desc"===r?"|1":"|0")}this.parameters[a.SEARCH_SORT_ORDER]=encodeURIComponent(o)}if(this.data().length<this.totalNumber()||e.serverOnly)return this.clearOnLoad=!0,this.cleanPage(),this.initializeIndex(),this.targetPage=1,void(this.listType&&this.listType===a.LIST_VIEW_SEARCH||this.fetchBlock(0));if($.each(this.data(),function(e,t){if(!t)return i=!0,!1}),i)return this.clearOnLoad=!0,this.targetPage=1,void this.fetchBlock(0);this.data.sort(this.sortFunction.bind(this)),this.getPage(1)}},s.prototype.sortFunction=function(e,t){var r,i,a,o,s;for(s="desc"===this.sortDirectiveOrder()?-1:1,r=this.sortDirectiveProp()&&this.sortDirectiveProp().split("."),a=e,o=t,i=0;i<r.length;i+=1)$.isArray(a)&&(a=a[0]),$.isArray(a)&&(a=a[0]),a=a&&a[r[i]],$.isArray(o)&&(o=o[0]),o=o&&o[r[i]],$.isArray(o)&&(o=o[0]);return(a===o||"string"==typeof a&&a.toLowerCase()===o.toLowerCase())&&(e.displayName&&t.displayName?(a=e.displayName&&e.displayName.toString().toLowerCase(),o=t.displayName&&t.displayName.toString().toLowerCase()):e.dateTime&&t.dateTime&&(a=e.dateTime&&e.dateTime.toLowerCase(),o=t.dateTime&&t.dateTime.toLowerCase(),s=1)),a===o?0:isFinite(a)&&isFinite(o)?(parseFloat(a)-parseFloat(o))*s:a.toString().toLowerCase()>o.toString().toLowerCase()?s:-1*s},s.prototype.adjustStartAndEndPageIndex=function(e){this.pageEndIndex(e*this.itemsPerPage),this.totalNumber()&&this.pageEndIndex()>this.totalNumber()&&this.pageEndIndex(this.totalNumber()),this.pageStartIndex((e-1)*this.itemsPerPage)},s.prototype.initializeIndex=function(){this.startIndex=0,this.lastIndex=this.pageWindowSize-1,this.clickedPage(1)},s.prototype.clearData=function(){this.data([]),this.prevTotalNumber=this.totalNumber(),this.totalNumber(null)},s.prototype.addData=function(e,t,r){var i,a,o;if(this.pageStartIndex()>0&&(t<0||t===r)?(t=this.prevTotalNumber-this.blockSize>=0?this.prevTotalNumber-this.blockSize:0,this.removeLastPage()):t=t<0?0:t,this.totalNumber(t),a=r+this.blockSize*this.pageBatchSize,a>t&&(a=t),this.clearOnLoad?(i=[],this.initializeIndex()):i=this.data(),e)for(o=0;o<e.length;o+=1)i[o+r]=e[o];this.clearOnLoad?(this.data(i),this.clearOnLoad=!1):this.data.valueHasMutated(),this.currentPage()===this.targetPage&&this.currentPage.notifySubscribers(),this.targetPage?(1==this.targetPage&&this.initializeIndex(),this.adjustStartAndEndPageIndex(this.targetPage),this.scrollToTop===!0&&$(window).scrollTop(0),this.firstPageIndex(null),this.currentPage(this.targetPage),this.firstPageIndex(1),this.scrollToTop===!0&&$(window).scrollTop(0),this.targetPage=null):a<this.pageEndIndex()&&this.pageEndIndex(a)},s.prototype.fetchBlock=function(e){throw"Function Not Implemented!"},s.prototype.removeLastPage=function(){this.clearOnLoad=!1,this.startIndex=this.startIndex-1>=0?this.startIndex-1:this.startIndex,this.getPage(this.currentPage()-1)},s.prototype.sortReset=function(){this.sortDirectiveProp("displayName"),this.sortDirectiveOrder("asc"),$.each(this.sortOptions(),function(e,t){"displayName"===t.id?t.order("asc"):t.order("none")})},s}),define("viewModels/productListingViewModel",["knockout","ccPaginated","pubsub","ccRestClient","ccConstants","CCi18n","spinner","ccNumber","pageLayout/product","storageApi","pageLayout/site","navigation","ccStoreConfiguration"],function(e,t,r,i,a,o,s,n,c,l,d,u,p){"use strict";function h(o){var s=this;t.call(this),s.widget=o,s.productGridRefreshOrAppend=!0,s.catalog=e.observable(),s.display=e.observable(!0),s.showInactiveProducts=null,s.showInactiveSkus=null,s.scrolledViewModels=[],s.isLoadOnScroll=e.observable(!1),s.productGridExtension=!1,s.isCacheEnabled=!1,s.cachedViewModels=[],s.viewModelCacheLimit=3,s.refreshValues=!1,s.defaultBlockSize=60,s.selectedSort=e.observable(),s.categoryOrSearchChanged=!1,s.changedViaDropDown=!1,s.pageNumberOffSetIndexMapForCategories=[],s.productTypeListingVariantMap={},this.skipOffSetMapUpdateOnRefresh=!1,this.skipOffSetMapUpdateOnBrowserBack=!1,this.previousGetProductsBlockSize=0,i.profileType==a.PROFILE_TYPE_AGENT&&(s.showInactiveProducts=!1,s.showInactiveSkus=!1),this.handleResultsPerPage=function(e,t){setTimeout(this.doChangeResultsPerPage.bind(this,e,t),200)},this.doChangeResultsPerPage=function(e,t){var r=a.DEFAULT_ITEMS_PER_PAGE,i=this.defaultBlockSize,o=!1;e&&(this.prevTotalNumber=this.totalNumber&&null!==this.totalNumber()?this.totalNumber():this.prevTotalNumber,e.id==a.RESULTS_PER_PAGE_ALL?(r=this.prevTotalNumber,this.blockSize<r&&(i=r)):(r=e.value,this.widget&&this.widget.blockSize&&!isNaN(this.widget.blockSize())&&(i=parseInt(this.widget.blockSize()))),this.blockSize=i),this.itemsPerPage=r,this.widget&&(this.changedViaDropDown=!0,this.widget.listType()===a.LIST_VIEW_PRODUCTS?(this.cleanPage(),this.pageNumber=1,this.currentPage(null),this.getPage(1)):this.widget.listType()===a.LIST_VIEW_SEARCH&&(1==this.currentPage()&&(o=!0),this.pageNumber=1,this.currentPage(null),o?this.getPage(1):u.goTo(this.firstPage(),!1,!0)),this.changedViaDropDown=!1)},($(window)[0].innerWidth||$(window).width())<=a.VIEWPORT_TABLET_UPPER_WIDTH&&s.isLoadOnScroll(!0);s.spanClass=e.computed(function(){var e="",t=0,r=0,i=0,a=0;return this.itemsPerRowInPhoneView&&(t=12/this.itemsPerRowInPhoneView),this.itemsPerRowInTabletView&&(r=12/this.itemsPerRowInTabletView()),this.itemsPerRowInDesktopView&&(i=12/this.itemsPerRowInDesktopView()),this.itemsPerRowInLargeDesktopView&&(a=12/this.itemsPerRowInLargeDesktopView()),t>0&&(e+="col-xs-"+t),r>0&&r!=t&&(e+=" col-sm-"+r),i>0&&i!=r&&(e+=" col-md-"+i),a>0&&a!=i&&(e+=" col-lg-"+a),e},s).extend({deferred:!0}),s.type="ProductListingViewModel",this.productLoadingOptions={},this.productLoadingOptions.parent="#cc-product-spinner",this.productLoadingOptions.selector="#cc-product-spinner-area",this.removeSpinner=function(){setTimeout(function(){$("#cc-product-spinner-area").find(".cc-spinner").remove()},500)},this.handleSorting=function(e,t){setTimeout(this.doSort.bind(this,e,t),200)},this.doSort=function(e,t){if(this.isCacheEnabled){var r=this.findCachedResultIndex(1);if(void 0!=r)return this.sortDirectiveOrder(e.order()),this.sortDirectiveProp(e.id),1===this.currentPage()&&this.currentPage.notifySubscribers(),this.targetPage=1,void this.currentPage(1)}this.sort(e),t&&t(arguments[3])},this.itemsPerPage=a.DEFAULT_ITEMS_PER_PAGE,this.blockSize=this.defaultBlockSize,this.pageProductsTemp=[],this.widget&&this.widget.productsPerPage&&!isNaN(this.widget.productsPerPage())&&(this.itemsPerPage=parseInt(this.widget.productsPerPage())),this.widget&&this.widget.blockSize&&!isNaN(this.widget.blockSize())&&(this.blockSize=parseInt(this.widget.blockSize())),this.blockSize<=this.itemsPerPage&&(this.blockSize=this.itemsPerPage+1),this.recordsPerPage=e.observable(a.DEFAULT_ITEMS_PER_PAGE),this.lruSize=100,this.numberOfElementsToDelete=20,this.currentProductsComputed=e.observableArray([]),this.currentProducts=e.computed(function(){if(this.widget&&"product"===this.widget.listType()){var t=[];this.productGridRefreshOrAppend=!0;var r,i;r=(this.currentPage()-1)*this.itemsPerPage,i=r+this.itemsPerPage;var o=this.isLoadOnScroll.peek();if(!this.isCacheEnabled){var n=this.data.peek();t=n.slice(r,i)}var d,u,p,h,g,f,m=[],I=t.length,E=[];if(s.isLoadOnScroll()||(s.refreshValues=!0),this.isCacheEnabled){var v=!0,y=this.findCachedResultIndex();if(void 0!=y){i>this.cachedViewModels[y].totalResults&&(i=this.cachedViewModels[y].totalResults);for(var b=r;b<i;b++)if(void 0==this.cachedViewModels[y].viewModels[b]){v=!1;break}if(v)return this.cachedViewModels[y].visitCount++,m=this.cachedViewModels[y].viewModels.slice(r,i),this.currentProductsComputed(m),o?this.cachedViewModels[y].viewModels:m;t=this.cachedViewModels[y].products.slice(r,i),I=t.length}}for(var T=0;T<I;T++)if(t[T]){if(p=new c(t[T].product),d=this.listingImageSize(),u=p.primarySmallImageURL().match(/.+?(?=&height=)/),u=null==u?p.primarySmallImageURL():u[0],p.listingImageURL=e.observable(u+"&height="+d+"&width="+d),(this.widget.shouldUseStyleBased()||"true"==this.widget.shouldUseStyleBased())&&window.history&&window.history.pushState){if(0==T&&this.category()&&!this.skipOffSetMapUpdateOnRefresh&&!this.skipOffSetMapUpdateOnBrowserBack){var h=l.getInstance().getItem(a.LISTING_OFFSET_MAP_KEY);if(h&&"string"==typeof h&&(h=JSON.parse(h)),h){if(g=Object.keys(h),f=g.length,f&&f>this.lruSize){E=g.sort(function(e,t){return h[e].timestamp-h[t].timestamp});for(var P=0;P<this.numberOfElementsToDelete;P++)delete h[E[P]]}}else h={};var S=this.getIndexForOffSetMap();null!=S&&this.data()[S]&&(this.data()[S].offsetMap.timestamp=Date.now(),this.data()[S].offsetMap.offsetMapIndex=S,h[this.category().route+"/"+this.pageNumber]=this.data()[S].offsetMap,l.getInstance().setItem(a.LISTING_OFFSET_MAP_KEY,JSON.stringify(h)))}var C;p.productVariantOptions&&p.productVariantOptions().length>0&&(p.type()in s.productTypeListingVariantMap?C=s.productTypeListingVariantMap[p.type()]:(e.utils.arrayForEach(p.productVariantOptions(),function(t){t.listingVariant()===!0&&(C=e.mapping.toJS(t))}),s.productTypeListingVariantMap[p.type()]=C)),p.listingSku=t[T].listingSku,C&&(!C.variantBasedDisplay&&t[T].product.defaultProductListingSku&&t[T].product.defaultProductListingSku.images&&t[T].product.defaultProductListingSku.images.length>0&&(p.listingSku=t[T].product.defaultProductListingSku),p.listingSku&&(p.listingSku.route=t[T].product.route+"?variantName="+C.optionId+"&variantValue="+p.listingSku[C.optionId]))}m.push(p),this.pageProductsTemp.push(p),(this.pageProductsTemp.length>0&&this.pageProductsTemp.length%this.itemsPerRow()===0||o&&this.totalNumber.peek()===this.pageProductsTemp.length+this.scrolledViewModels.length||!o&&T+1===I)&&(this.scrolledViewModels.push.apply(this.scrolledViewModels,this.pageProductsTemp),this.productGridExtension||this.viewportMode()!=a.TABLET_VIEW&&this.viewportMode()!=a.PHONE_VIEW?this.currentProductsComputed(this.pageProductsTemp.splice(0)):this.currentProductsComputed(this.scrolledViewModels),this.pageProductsTemp=[],this.productGridRefreshOrAppend=!1)}var A=this.category();if(A&&void 0!=y&&this.isCacheEnabled)for(var b=0;b<m.length;b++)this.cachedViewModels[y].viewModels[b+r]=m[b];return o?this.scrolledViewModels:m}},this).extend({deferred:!0}),this.checkResponsiveFeatures=function(e){e>a.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?s.viewportMode()!=a.LARGE_DESKTOP_VIEW&&(s.viewportMode(a.LARGE_DESKTOP_VIEW),s.handleViewportChange(a.LARGE_DESKTOP_VIEW)):e>a.VIEWPORT_TABLET_UPPER_WIDTH&&e<=a.VIEWPORT_LARGE_DESKTOP_LOWER_WIDTH?s.viewportMode()!=a.DESKTOP_VIEW&&(s.viewportMode(a.DESKTOP_VIEW),s.handleViewportChange(a.DESKTOP_VIEW)):e>=a.VIEWPORT_TABLET_LOWER_WIDTH&&e<=a.VIEWPORT_TABLET_UPPER_WIDTH?s.viewportMode()!=a.TABLET_VIEW&&(s.viewportMode(a.TABLET_VIEW),s.handleViewportChange(a.TABLET_VIEW)):s.viewportMode()!=a.PHONE_VIEW&&(s.viewportMode(a.PHONE_VIEW),s.handleViewportChange(a.PHONE_VIEW))},this.getIndexForOffSetMap=function(){var e=this.itemsPerPage;if(this.widget&&this.widget.productsPerPage&&!isNaN(this.widget.productsPerPage())&&(e=parseInt(this.widget.productsPerPage())),this.itemsPerPage!==e)return null;if(this.sortOptions&&this.sortOptions()&&this.sortOptions().length>0&&this.sortOptions()[0]&&this.sortOptions()[0]!==this.selectedSort())return null;for(var t=null,r=0;r<this.pageNumberOffSetIndexMapForCategories.length;r++)if(this.pageNumberOffSetIndexMapForCategories[r].categoryId===this.category().id){t=this.pageNumberOffSetIndexMapForCategories[r].pageNumberOffSetIndexMap;break}if(!t)return null;if(this.totalExpandedResults<=this.itemsPerPage)return this.data().length-1;for(var i=0;i<t.length;i++){var a=null;if(i>0&&(a=t[i-1].offSetIndex),this.pageNumber===t[i].pageNumber)return t[i].offSetIndex;if(this.pageNumber<t[i].pageNumber&&a&&t[i-1].pageNumber>=this.pageNumber)return a}return this.totalExpandedResults===this.data().length&&t.length>0||1==t.length?t[t.length-1].offSetIndex:null},this.handleResponsiveViewports=function(){s.viewportMode()==a.TABLET_VIEW&&(s.itemsPerRow(s.itemsPerRowInTabletView()),s.isMobileView(!0),s.isLoadOnScroll(!0)),s.viewportMode()==a.PHONE_VIEW&&(s.itemsPerRow(s.itemsPerRowInPhoneView),s.isMobileView(!0),s.isLoadOnScroll(!0)),s.refreshValues=!0,s.scrolledViewModels=[],s.isLoadOnScroll()?(s.productGridExtension&&(1===s.currentPage()?s.currentPage.notifySubscribers():s.currentPage(1)),s.scrollToTop=!1):s.scrollToTop=!0},this.handleViewportChange=function(e){s.itemsPerRow();e!=s._internalViewportMode()&&(e&&s._internalViewportMode(e),s.viewportMode()==a.DESKTOP_VIEW?(s.itemsPerRow(s.itemsPerRowInDesktopView()),s.clearOnLoad=!0,s.targetPage=1,s.fetchBlock(0),s.isMobileView(!1),s.isLoadOnScroll(!1)):s.viewportMode()==a.LARGE_DESKTOP_VIEW&&(s.itemsPerRow(s.itemsPerRowInLargeDesktopView()),s.clearOnLoad=!0,s.targetPage=1,s.fetchBlock(0),s.isMobileView(!1),s.isLoadOnScroll(!1)),s.handleResponsiveViewports())},this.pageNumberDeferred=$.Deferred(),this.handleLinks=function(e,t){var i,a,o=e.totalNumberOfPages(),s=parseInt(t.page)||(t.paginationOnly?1:e.pageNumber);1==o||1==s?(a=null,i=""):(a="/"+(s-1),i="/"+s),$.Topic(r.topicNames.PAGE_PAGINATION_CALCULATED).publish({currPageNo:i,prevPageNo:a,nextPageNo:1==o||s==o?null:"/"+(s+1)})},this.handlePaginationChange=function(e){this.pageNumberDeferred.resolve(this,e),e.paginationOnly&&this.handleLinks(this,e)},$.Topic(r.topicNames.PAGE_PAGINATION_CHANGE).subscribe(this.handlePaginationChange.bind(this)),this.checkResponsiveFeatures($(window)[0].innerWidth||$(window).width()),this.handleResponsiveViewports(),this._internalViewportMode(this.viewportMode()),this.resultsText=e.computed(this.getResultsText,this),this.storeConfiguration=p.getInstance()}var g=function(){};return g.prototype=t.prototype,h.prototype=new g,h.prototype.constructor=h,h.prototype.category=e.observable(),h.prototype.resultsText=e.observable(),h.prototype.titleText=e.observable(),h.prototype.itemsPerRow=e.observable(4),h.prototype.itemsPerRowInTabletView=e.observable(4),h.prototype.itemsPerRowInPhoneView=2,h.prototype.itemsPerRowInDesktopView=e.observable(4),h.prototype.itemsPerRowInLargeDesktopView=e.observable(4),h.prototype._internalViewportMode=e.observable(4),h.prototype.viewportMode=e.observable(4),h.prototype.spanClass=e.observable(),h.prototype.listingImageSize=e.observable(300),h.prototype.resetSortOptions=function(){var e=this.sortOptions()[0];this.selectedSort(e),this.sortDirectiveProp(e.id),this.sortDirectiveOrder(e.order("none"))},h.prototype.clearData=function(){this.data([]),this.prevTotalNumber=this.totalNumber(),this.totalNumber(null),this.actualOffset=0,this.expandedOffset=0,this.scrolledViewModels=[]},h.prototype.getPage=function(e){if(this.totalNumberOfPages()>1&&this.adjustPageIndex(e),this.adjustStartAndEndPageIndex(e),e!==this.currentPage()&&e!==this.targetPage&&this.isMobileView()&&$.Topic(r.topicNames.RECORD_PAGINATION_PAGE_CHANGE).publish(),e===this.targetPage&&null!==this.targetPage&&void 0!==this.targetPage||(this.targetPage=e),this.isCacheEnabled){var t=!1,i=this.findCachedResultIndex(e);if(void 0==i)t=!0;else{var a=this.pageEndIndex();a>this.cachedViewModels[i].totalResults&&(a=this.cachedViewModels[i].totalResults);for(var o=this.pageStartIndex();o<a;o+=1)if("undefined"==typeof this.cachedViewModels[i].products[o]){t=!0;break}}if(t)return e!==this.currentPage()&&(this.targetPage=e),void this.fetchBlock(this.pageStartIndex());this.currentPage()===e&&this.currentPage.notifySubscribers(),this.totalNumber(this.cachedViewModels[i].totalResults),$.when(this.pageNumberDeferred).done(this.handleLinks),this.titleText(this.getTitleText())}else{if(this.clearOnLoad)return this.fetchBlock(this.pageStartIndex()),this.clickedPage(e),void this.currentPage(e);for(var o=this.pageStartIndex();o<this.pageEndIndex();o+=1)if("undefined"==typeof this.data()[o])return e!==this.currentPage()&&(this.targetPage=e),void this.fetchBlock(this.pageStartIndex())}this.currentPage(e)},h.prototype.findCachedResultIndex=function(){for(var e,t=this.category.peek(),r=this.selectedSort.peek(),i=0;i<this.cachedViewModels.length;i++)if(this.cachedViewModels[i]&&this.cachedViewModels[i].categoryId==t.repositoryId&&this.cachedViewModels[i].sortKey==r.id&&this.cachedViewModels[i].sortOrder==r.order()){e=i;break}return e},h.prototype.fetchBlock=function(e){var t,r;if(this.clearOnLoad&&(this.titleText(""),this.clearData()),r={},r[a.TOTAL_RESULTS]=!0,r[a.TOTAL_EXPANDED_RESULTS]=void 0===p.getInstance().PRODUCT_LISTING_TOTAL_EXPANDED_RESULTS||"true"===String(p.getInstance().PRODUCT_LISTING_TOTAL_EXPANDED_RESULTS),this.catalog&&(r[a.CATALOG]=this.catalog()),this.widget.user&&this.widget.user().catalogId&&(r[a.CATALOG]=this.widget.user().catalogId()),r[a.LIMIT]=this.blockSize,(this.widget.shouldUseStyleBased()||"true"==this.widget.shouldUseStyleBased())&&window.history&&window.history.pushState){if(0==e)this.actualOffset=0,this.expandedOffset=0,r[a.OFFSET]=this.actualOffset;else if(this.data()[e]){for(var o=1;o<=this.blockSize;o++)if(this.data()[e+this.itemsPerPage-o]){this.skipOffSetMapUpdateOnRefresh?this.actualOffset=this.data()[e+this.itemsPerPage-o].offsetMap.actualOffset+this.previousGetProductsBlockSize:this.actualOffset=this.data()[e+this.itemsPerPage-o].offsetMap.actualOffset+this.blockSize,this.expandedOffset=e+this.itemsPerPage+1-o,r[a.OFFSET]=this.actualOffset;break}if(void 0==r[a.OFFSET])for(var o=1;o<=this.blockSize;o++)if(this.data()[e+o]){this.actualOffset=this.data()[e+o].offsetMap.actualOffset-this.blockSize<0?0:this.data()[e+o].offsetMap.actualOffset-this.blockSize,this.expandedOffset=-1*(e+o-1),r[a.OFFSET]=this.actualOffset;break}}if(void 0==r[a.OFFSET]){var n,c,u=this.itemsPerPage;if(this.widget&&this.widget.productsPerPage&&!isNaN(this.widget.productsPerPage())&&(u=parseInt(this.widget.productsPerPage())),this.itemsPerPage===u&&(c=l.getInstance().getItem(a.LISTING_OFFSET_MAP_KEY),c&&"string"==typeof c&&(c=JSON.parse(c))),c&&(n=c[this.category().route+"/"+this.pageNumber],n&&!isNaN(i.lastPublishedTimeStamp)&&new Date(parseInt(i.lastPublishedTimeStamp))>new Date(n.timestamp)&&(n=void 0)),n&&void 0!==n){var h=0;if(0!=n.actualOffset&&(h=this.itemsPerPage>this.blockSize?this.itemsPerPage%this.blockSize:this.blockSize%this.itemsPerPage),0===h)this.actualOffset=n.actualOffset,this.expandedOffset=n.expandedOffset,r[a.OFFSET]=this.actualOffset;else{var g=c[this.category().route+"/"+(this.pageNumber-1)];this.actualOffset=g.actualOffset,this.expandedOffset=g.expandedOffset,r[a.OFFSET]=this.actualOffset,this.data()[this.actualOffset+this.blockSize]||(r[a.LIMIT]=2*this.blockSize),this.skipOffSetMapUpdateOnBrowserBack=!0}}else 0==this.data().length?(this.actualOffset=0,this.expandedOffset=0,r[a.OFFSET]=this.actualOffset,r[a.LIMIT]=this.itemsPerPage*(this.pageNumber||1),this.skipOffSetMapUpdateOnRefresh=!0):this.data().length!==(this.pageNumber-1)*this.itemsPerPage&&(this.actualOffset=this.data()[this.data().length-1].offsetMap.actualOffset+this.previousGetProductsBlockSize-1,this.expandedOffset=this.data().length-1,r[a.OFFSET]=this.actualOffset,r[a.LIMIT]=this.itemsPerPage*(this.pageNumber||1),this.skipOffSetMapUpdateOnRefresh=!0)}}void 0==r[a.OFFSET]&&(this.actualOffset=e,this.expandedOffset=e,r[a.OFFSET]=this.actualOffset),"default"!==this.sortDirectiveProp()&&(r[a.SORTS]=this.sortDirectiveProp()+":"+this.sortDirectiveOrder()),t=a.ENDPOINT_PRODUCTS_LIST_PRODUCTS,this.category()&&(this.requesting&&this.currentRequest==this.category().id||(this.requesting=!0,s.create(this.productLoadingOptions),r[a.CATEGORY]=this.category().id,this.currentRequest=this.category().id,r.includeChildren=!0,null!=this.showInactiveProducts&&null!=this.showInactiveSkus&&(r.showInactiveProducts=this.showInactiveProducts,r.showInactiveSkus=this.showInactiveSkus),this.widget&&this.widget.fields&&this.widget.fields()&&(r.fields=this.widget.fields()),this.requesting=!0,r[a.STORE_PRICELISTGROUP_ID]=d.getInstance().selectedPriceListGroup().id,this.widget&&this.widget.productListing&&this.widget.productListing.filterKey&&(r[a.FILTER_KEY]=this.widget.productListing.filterKey),i.request(t,r,function(e){this.successFunc(e)}.bind(this),this.errorFunc.bind(this))))},h.prototype.buildResultsPerPageOption=function(e,t){return{id:t?a.RESULTS_PER_PAGE_ALL:"rec-per-page-"+e,displayText:t?o.t("ns.productlisting:resources.resultsPerPageOptionAll"):e,value:e}},h.prototype.buildResultsPerPage=function(e,t,r){var i=this;if(i.widget.showResultsPerPageSection&&i.widget.showResultsPerPageSection()){var o=[],s=0,n=i.widget.productsPerPage&&i.widget.productsPerPage()||a.DEFAULT_ITEMS_PER_PAGE;this.resultsPerPageOptions().length&&!this.categoryOrSearchChanged||(this.categoryOrSearchChanged=!1,$.each(a.RESULTS_PER_PAGE_SERIES,function(t,r){0!=t&&(s=n*r,s<e&&o.push(i.buildResultsPerPageOption(s)))}),o.push(i.buildResultsPerPageOption(e,!0)),this.resultsPerPageOptions(o))}},h.prototype.successFunc=function(e){var t=this.selectedResultsPerPageOption(),r=this.prevTotalNumber;if((this.widget.shouldUseStyleBased()||"true"==this.widget.shouldUseStyleBased())&&window.history&&window.history.pushState){this.totalExpandedResults=e.totalExpandedResults,this.totalResults=e.totalResults,this.previousGetProductsBlockSize=e.limit,this.buildResultsPerPage(this.totalExpandedResults,r,t);for(var i=this.previousGetProductsBlockSize/this.blockSize,o=[],s=0,n=0;n<i;n++){var c={};c.actualOffset=e.offset+this.blockSize*n;var d,p=this.expandProducts(e.items.slice(n*this.blockSize,(n+1)*this.blockSize),c);d=this.expandedOffset>=0?this.expandedOffset+o.length:Math.abs(this.expandedOffset)-o.length-p.length,c.expandedOffset=d,o=o.concat(p)}if(s=this.expandedOffset>=0?this.expandedOffset:Math.abs(this.expandedOffset)-o.length,o&&o.length>0){this.isCacheEnabled&&this.populateData(o,e.totalExpandedResults,s),this.addData(o,e.totalExpandedResults<0?0:e.totalExpandedResults,s),this.pageNumber>this.totalNumberOfPages()&&u.goTo(this.widget.links()[404].route,!0,!0);var h=!1;if(this.data().length==(this.pageNumber+1)*this.itemsPerPage&&(h=!0),this.pageNumberOffSetIndexMapForCategories){var g=!1,f=this.pageNumber,m=this.itemsPerPage;this.widget&&this.widget.productsPerPage&&!isNaN(this.widget.productsPerPage())&&(m=parseInt(this.widget.productsPerPage())),this.itemsPerPage!==m&&(f=m>parseInt(this.itemsPerPage)?this.pageNumber-Math.ceil(m/this.itemsPerPage):this.pageNumber+Math.ceil(Math.abs(m/this.itemsPerPage)));for(var I=0;I<this.pageNumberOffSetIndexMapForCategories.length;I++)if(this.pageNumberOffSetIndexMapForCategories[I].categoryId===this.category().id){for(var E=!1,v=0;v<this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.length;v++)if(this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap[v].pageNumber===f){E=!0;break}if(E||this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.push({pageNumber:f,offSetIndex:this.data().length-1}),E=!1,h){for(var v=0;v<this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.length;v++)if(this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap[v].pageNumber===f+1){E=!0;break}E||this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.push({pageNumber:f+1,offSetIndex:this.data().length-1})}E=!1,this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap=this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.sort(function(e,t){return e.pageNumber-t.pageNumber}),g=!0;break}if(!g){var y=l.getInstance().getItem(a.LISTING_OFFSET_MAP_KEY);if(this.pageNumberOffSetIndexMapForCategories.push({categoryId:this.category().id,pageNumberOffSetIndexMap:[{pageNumber:this.pageNumber,offSetIndex:this.data().length-1}]}),1!=this.pageNumber&&y)for(var n=1;n<=this.totalNumberOfPages();n++)if(n!==this.pageNumber){var b=y[this.category().route+"/"+n];b&&b.offsetMapIndex&&this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.push({pageNumber:v,offSetIndex:b.offsetMapIndex})}this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap=this.pageNumberOffSetIndexMapForCategories[I].pageNumberOffSetIndexMap.sort(function(e,t){return e.pageNumber-t.pageNumber})}}}else u.goTo(this.widget.links()[404].route,!0,!0)}else{this.totalResults=e.totalResults,this.buildResultsPerPage(this.totalResults,r,t);var T=[];if(e&&e.items&&e.items.length>0)for(var I=0,P=e.items.length;I<P;I++){var S={};S.product=e.items[I],T[I]=S}else u.goTo(this.widget.links()[404].route,!0,!0);this.isCacheEnabled&&this.populateData(T,e.totalResults,e.offset),this.addData(T,e.totalResults<0?0:e.totalResults,e.offset)}$.when(this.pageNumberDeferred).done(this.handleLinks),this.removeSpinner(),this.titleText(this.getTitleText()),this.requesting=!1},h.prototype.errorFunc=function(e){this.removeSpinner(),this.requesting=!1},h.prototype.populateData=function(e,t,r){var i,a,o=this.findCachedResultIndex();if(void 0==o){for(a=[],i=0;i<e.length;i+=1)a[i+r]=e[i];this.cachedViewModels.push({categoryId:this.category().repositoryId,viewModels:[],visitCount:0,sortKey:this.selectedSort().id,sortOrder:this.selectedSort().order(),products:a,totalResults:t}),this.cachedViewModels.length>this.viewModelCacheLimit&&this.cachedViewModels.splice(0,1)}else{for(a=this.cachedViewModels[o].products,i=0;i<e.length;i+=1)a[i+r]=e[i];this.cachedViewModels[o].products=a,this.cachedViewModels[o].viewModels.splice(r)}},h.prototype.expandProducts=function(t,r){var i,a,o,s,n=this,c=[],l=(this.widget.productListingTypes,[]),d=[],u=0;if(t)for(var p=0,h=t.length;p<h;p++){if(i=t[p],s=void 0,i.childSKUs.length>0&&i.productVariantOptions&&i.productVariantOptions.length>0&&(o={},i.type in n.productTypeListingVariantMap?s=n.productTypeListingVariantMap[i.type]:(e.utils.arrayForEach(i.productVariantOptions,function(e){e.listingVariant===!0&&e.variantBasedDisplay===!0&&(s=e)}),n.productTypeListingVariantMap[i.type]=s),s)){d=i.variantValuesOrder[s.optionId];for(var g in s.optionValueMap)l[s.optionValueMap[g]]=g;for(var f=0,m=i.childSKUs.length;f<m;f++)if(a=i.childSKUs[f],!o[a[s.optionId]]||a.productListingSku){var I={};I.product=t[p],I.listingSku=a,o[a[s.optionId]]=I}var E=[];E=d&&d.length>0?d:l;for(var v=0;v<E.length;v++)o[E[v]]&&(c[u]=o[E[v]],c[u].offsetMap=r,u++)}if(void 0==s){var I={};I.product=t[p],c[u]=I,c[u].offsetMap=r,u++}}return c},h.prototype.getResultsText=function(){var e,t=this.pageStartIndex();return this.isLoadOnScroll()&&(t=0),n.formatNumber(this.totalNumber())&&(e=this.totalNumber()>0?o.t("ns.common:resources.productresultsText",{startIndex:n.formatNumber(t+1),endIndex:n.formatNumber(this.pageEndIndex()),totalProducts:n.formatNumber(this.totalNumber())}):o.t("ns.common:resources.emptyProductresultsText")),"ns.common:resources.productresultsText"===e&&(e=""),e},h.prototype.getTitleText=function(){var e="";return e=this.category()?this.category().displayName:o.t("ns.common:resources.TitleText")},h}),define("viewModels/productListingSearchViewModel",["knockout","viewModels/productListingViewModel","pubsub","CCi18n","ccConstants","ccNumber","navigation","pageLayout/product","pageLayout/search"],function(e,t,r,i,a,o,s,n,c){"use strict";function l(r){var i=this;i.initializationComplete=e.observable(!1),t.call(this),i.widget=r,i.initialize(),i.itemsPerRowInDesktopView=e.observable(4),i.itemsPerPage=a.DEFAULT_ITEMS_PER_PAGE,i.blockSize=a.DEFAULT_ITEMS_PER_PAGE,i.currentProductsComputed=e.observableArray([]),i.currentProducts=e.computed(function(){var t;this.pageProductsTemp=[],this.productGridRefreshOrAppend=!0;var r,i;r=(this.currentPage()-1)*this.itemsPerPage,i=r+this.itemsPerPage;var o=this.data.peek();t=o.slice(r,i);for(var s,c,l=this.isLoadOnScroll.peek(),d=[],u=t.length,p=0;p<u;p++)t[p]&&(t[p].attributes&&t[p].attributes[a.SEARCH_RECORD_COLLECTION]?(d.push(t[p]),this.pageProductsTemp.push(t[p])):(s=new n(t[p]),c=this.listingImageSize(),s.listingImageURL=e.observable(s.primaryFullImageURL()+"&width="+c+"&height="+c),s.listingSku&&(s.listingSku.route=s.listingSku.route(),s.listingSku.images=s.listingSku.images()),d.push(s),this.pageProductsTemp.push(s)),(this.pageProductsTemp.length>0&&this.pageProductsTemp.length%this.itemsPerRow()===0||l&&this.totalNumber.peek()-this.scrolledViewModels.length===this.pageProductsTemp.length||!l&&p+1===u)&&(this.scrolledViewModels.push.apply(this.scrolledViewModels,this.pageProductsTemp),this.productGridExtension||this.viewportMode()!=a.TABLET_VIEW&&this.viewportMode()!=a.PHONE_VIEW?this.currentProductsComputed(this.pageProductsTemp.splice(0)):this.currentProductsComputed(this.scrolledViewModels),this.pageProductsTemp=[],this.productGridRefreshOrAppend=!1));return $("#typeaheadDropdown").hide(),this.setFocus(),this.isLoadOnScroll.peek()?this.scrolledViewModels:d},this).extend({deferred:!0}),i.assemblerPagesPath=r.assemblerPagesPath,i.ntk=r.ntk,i.additionalSearchQueryParams=r.additionalSearchQueryParams}var d=c.getInstance(),u=function(){};return u.prototype=t.prototype,l.prototype=new u,l.prototype.constructor=l,l.base=t.prototype,l.prototype.itemsPerRowInTabletView=e.observable(4),l.prototype.itemsPerRowInPhoneView=2,l.prototype.itemsPerRowInDesktopView=e.observable(4),l.prototype.itemsPerRowInLargeDesktopView=e.observable(4),l.prototype.itemsPerRow=e.observable(4),l.prototype.type="ProductListingSearchViewModel",l.prototype.searchFailed=e.observable(!1),l.prototype.idToSearchIdMap={displayName:"product.relevance",listPrice:"sku.activePrice"},l.prototype.category=e.observable(),l.prototype.listingImageSize=e.observable(300),l.prototype.initialize=function(){var t=this;t.searchResults=[],t.recordsPerPage=e.observable(a.DEFAULT_SEARCH_RECORDS_PER_PAGE),t.searchAdjustments={},t.breadcrumbs={},t.navigation={},t.pageCount=0,t.recordOffSet=0,t.searchTerms=e.observableArray([]),t.adjustedSearchTerms=e.observableArray([]),t.suggestedSearches=e.observableArray([]),t.navigationDescriptors=e.observable(),t.display=e.observable(!0),t.totalNumber(0),t.pageStartIndex(0),t.pageEndIndex(0),t.searchText=e.observable(),t.resultsText=e.observable(),t.categoryName=e.observable(),t.noSearchResultsText=e.observable(),t.pageLoadedText=e.observable();$.Topic(r.topicNames.CATEGORY_CRUMB_UPDATED).subscribe(function(e){t.categoryName(e)}),$.Topic(r.topicNames.SEARCH_RESULTS_UPDATED).subscribe(function(e){if(t.noSearchResultsText(""),e.message===a.SEARCH_MESSAGE_FAIL)t.searchFailed(!0),s.goTo(t.widget.links().noSearchResults.route,!1,!0),$.Topic(r.topicNames.SEARCH_FAILED_TO_PERFORM).publish();else{if(!(0!==this.totalRecordsFound||this.searchAdjustments&&this.searchAdjustments.suggestedSearches))return s.goTo(t.widget.links().noSearchResults.route,!1,!0),$.Topic(r.topicNames.SEARCH_TERM).publishWith(this.searchAdjustments.originalTerms,[{message:"success"}]),void t.display(!1);t.display(!0),t.buildResultsPerPage(this.totalRecordsFound,t.prevTotalNumber,t.selectedResultsPerPageOption()),t.totalNumber(this.totalRecordsFound),this.searchAdjustments&&t.searchTerms(this.searchAdjustments.originalTerms),this.searchAdjustments&&this.searchAdjustments.adjustedSearches?t.adjustedSearchTerms(this.searchAdjustments.adjustedSearches[t.getSearchTerms()]):t.adjustedSearchTerms([]),this.searchAdjustments&&this.searchAdjustments.suggestedSearches?(t.formatSuggestedSearches(this.searchAdjustments.suggestedSearches[t.getSearchTerms()]),t.suggestedSearches(this.searchAdjustments.suggestedSearches[t.getSearchTerms()])):t.suggestedSearches([]),t.searchFailed(!1),this.pagingActionTemplate&&t.navigationDescriptors(t.getParameterByName(this.pagingActionTemplate.link?this.pagingActionTemplate.link:this.pagingActionTemplate.navigationState,a.SEARCH_NAV_DESCRIPTORS_KEY)),this.isNewSearch===!0?(t.clearOnLoad=!0,"displayName"!==t.sortDirectiveProp()&&t.selectedSort(t.sortOptions()[0])):t.clearOnLoad=!1,this.searchResults&&this.searchResults.length>0?t.addData(this.searchResults,t.totalNumber(),this.recordOffSet):(t.targetPage=1,this.searchAdjustments.suggestedSearches||s.goTo(t.widget.links()[404].route,!0,!0)),t.titleText(t.getTitleText(this.searchResults.length)),
t.resultsText(t.getResultsText()),t.pageLoadedText(t.getPageLoadedText())}}),t.initializationComplete(!0)},l.prototype.getPageLoadedText=function(){var e=i.t("ns.common:resources.searchPageLoadedText",{results:this.resultsText(),searchTerm:this.searchTerms()[0]});return e},l.prototype.getPage=function(e){this.resultsText(""),this.clickedPage(e),this.adjustStartAndEndPageIndex(e),e!==this.currentPage()&&e!==this.targetPage&&this.isMobileView()&&$.Topic(r.topicNames.RECORD_PAGINATION_PAGE_CHANGE).publish(),e===this.currentPage()&&null!==this.targetPage&&void 0!==this.targetPage||(this.targetPage=e),(this.parameters||"product.relevance"!==l.prototype.idToSearchIdMap[this.sortDirectiveProp()])&&this.fetchBlock(this.pageStartIndex()),this.setFocus()},l.prototype.getParameterByName=function(e,t){var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(e);return null===i?"":i[1]},l.prototype.fetchBlock=function(e){this.initializationComplete()&&(this.recordOffSet=e,this.searchText(this.searchTerms().length>0?this.searchTerms()[0]:""),this.blockSize=this.itemsPerPage,($(window)[0].innerWidth||$(window).width())<a.VIEWPORT_TABLET_UPPER_WIDTH&&(this.recordOffSet=0,this.blockSize=e+this.recordsPerPage()),this.submitSearch())},l.prototype.submitSearch=function(){var e="",t="";this.searchText().trim()&&(e=a.PRODUCT_DISPLAYABLE+a.SEARCH_PROPERTY_SEPARATOR+this.searchText().trim()),this.parameters&&this.parameters.searchType&&(t=this.parameters.searchType);var i={getFromUrlParam:!0,newSearch:!1,recordsPerPage:this.blockSize,recordOffSet:this.recordOffSet,recDYMSuggestionKey:this.recDYMSuggestionKey,suppressResults:!1,searchType:t};if(this.parameters.Ns){var o=decodeURIComponent(this.parameters.Ns).split("|");2===o.length&&(i.sortDirectiveProperty=o[0],i.sortDirectiveOrder="1"==o[1]?"desc":"asc")}else this.sortDirectiveProp("displayName");this.useGenericSort||"product.relevance"===l.prototype.idToSearchIdMap[this.sortDirectiveProp()]||(i.sortDirectiveProperty=l.prototype.idToSearchIdMap[this.sortDirectiveProp()],i.sortDirectiveOrder="product.relevance"==i.sortDirectiveProperty?"none":this.sortDirectiveOrder()),this.assemblerPagesPath&&this.ntk&&(i.searchInterface=this.ntk),this.additionalSearchQueryParams&&(i.additionalSearchQueryParams=this.additionalSearchQueryParams),$.Topic(r.topicNames.SEARCH_CREATE).publishWith(i,[{message:"success",assemblerPagesPath:this.assemblerPagesPath}])},l.prototype.getResultsText=function(){var e=this.pageStartIndex(),t="";if(0!==this.totalNumber()){if(this.isLoadOnScroll()&&(e=0),this.searchFailed&&!this.searchFailed()){var r=this.getSearchTerms(),a="ns.common:resources.searchresultsText",s=this.pageEndIndex();this.pageEndIndex()>this.totalNumber()&&(s=this.totalNumber()),o.formatNumber(this.totalNumber())&&(t=i.t(a,{count:o.formatNumber(this.totalNumber()),searchterm:r,startIndex:o.formatNumber(e+1),endIndex:o.formatNumber(s)}))}else t=i.t("ns.common:resources.searchFailedText");return t}},l.prototype.getSearchTerms=function(){var t="",r=0;return this.searchTerms&&e.utils.arrayForEach(this.searchTerms(),function(e){t=0===r?e:t+" "+e,r++}),t},l.prototype.getTitleText=function(e){var t="";return""==this.getSearchTerms()?t=this.categoryName():this.adjustedSearchTerms().length>0?(t=i.t("ns.common:resources.searchText",{searchTerm:'"'+this.adjustedSearchTerms()[0].adjustedTerms+'"'}),this.noSearchResultsText(i.t("ns.common:resources.noSearchResultsText",{searchTerm:'"'+this.getSearchTerms()+'"'}))):this.suggestedSearches().length>0&&0===e?this.noSearchResultsText(i.t("ns.common:resources.noSearchResultsText",{searchTerm:'"'+this.getSearchTerms()+'"'})):t=i.t("ns.common:resources.searchText",{searchTerm:'"'+this.getSearchTerms()+'"'}),t},l.prototype.pagesFunction=function(){var e,t,r,i;this.clearOnLoad&&this.adjustStartAndEndPageIndex(this.pageNumber),this.totalNumber()?(t=(this.totalNumber()-this.totalNumber()%this.itemsPerPage)/this.itemsPerPage,r=this.totalNumber()%this.itemsPerPage>0?1:0,e=t+r):e=0,d.contextData&&s.getPathWithoutLocale("/"+s.getPath())==d.contextData.global.links.searchresults.route?this.totalNumberOfPages(e):window.clientConfigData&&window.clientConfigData.useEnhancedSearch&&"true"==window.clientConfigData.useEnhancedSearch&&d.contextData&&s.getPathWithoutLocale("/"+s.getPath()).indexOf(d.contextData.global.links.searchresults.route)!==-1&&this.totalNumberOfPages(e),this.adjustPageIndex(this.pageNumber);var a=[];for(i=0;i<e;i++){var o={};o.pageNumber=i+1,o.selected=o.pageNumber===this.currentPage(),a.push(o)}var n=[];if(this.pageWindowSize>=e)n=a.slice(0);else{var c=this.startIndex+this.pageWindowSize;c>e&&(c=e),n=a.slice(this.startIndex,c)}return n},l.prototype.formatSuggestedSearches=function(e){$.each(e,function(e,t){t.clickSuggestion=function(){s.goTo(a.SEARCH_RESULTS_HASH+d.getFilteredNavState(this.link?this.link:this.navigationState)+"&"+a.SEARCH_TYPE+"="+a.SEARCH_TYPE_SIMPLE+"&"+a.PARAMETERS_TYPE+"="+a.PARAMETERS_SEARCH_QUERY)}})},l.prototype.setFocus=function(){var e=$("#region-megaMenu").next().attr("id"),t="#"+e+" :focusable";$(t).first().focus()},l}),define("viewModels/productListingViewModelFactory",["viewModels/productListingViewModel","viewModels/productListingSearchViewModel","ccConstants"],function(e,t,r){"use strict";function i(){if(null!==a)throw new Error("Cannot instantiate more than one ProductListingViewModelFactory, use ProductListingViewModelFactory.getInstance()")}var a=null;return i.prototype={createListingViewModel:function(e){var t,i=e.listType();return i===r.LIST_VIEW_PRODUCTS&&(t=this.createProductListingViewModel(e)),i===r.LIST_VIEW_SEARCH&&(t=this.createProductListingSearchViewModel(e)),t.listType=i,t},createProductListingViewModel:function(t){return new e(t)},createProductListingSearchViewModel:function(e){return new t(e)}},i.getInstance=function(){return null===a&&(a=new i),a},i.getInstance()}),define("viewModels/searchTypeahead",["knockout","pubsub","ccConstants","CCi18n","navigation","jquery","ccNumber","pageLayout/product","pageLayout/site","ccRestClient","bstypeahead","bootstrap"],function(e,t,r,i,a,o,s,n,c,l){"use strict";function d(e,t,i,a,o,s){if(null!==u)throw new Error("Cannot instantiate more than one SearchTypeahead, use SearchTypeahead.getInstance()");y=t.symbol,y.match(/^[0-9a-zA-Z]+$/)&&(y+=" "),b=t.fractionalDigits,this.productURLRoot=i?i:p,this.searchResultPage=a?a:r.SEARCH_RESULTS_HASH,A=null!=o&&o,C=null==s?null:s,this.initialize(e)}var u=null,p="/product/";r.ALLOW_HASHBANG&&(p="#!"+p);var h="ns.common:resources.",g="--noMatchesFound--",f="close",m="showall",I=2,E=l.getStoredValue(r.LOCAL_STORAGE_USER_CONTENT_LOCALE);E=null!=E?JSON.parse(E)[0].name:o(":root").attr("lang"),"zh_CN"!=E&&"zh_TW"!=E||(I=1);var v,y,b,T=5,P=300,S=10,C=e.observable(null),A=e.observable(!1),_=e.observable(!1),O=e.observable(!1),R=e.observable("/img/no-image.jpg");return o.fn.typeahead.Constructor.prototype.keyup=function(e){switch(e.keyCode){case 9:case 40:case 38:case 16:case 17:case 18:break;case 13:if(!this.shown)return;_(!0),this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},o.fn.typeahead.Constructor.prototype.move=function(e){if(this.shown){switch(e.keyCode){case 13:case 27:e.preventDefault();break;case 38:"keyup"==e.type&&(e.preventDefault(),this.prev());break;case 9:if(e.preventDefault(),e.stopPropagation(),e.shiftKey){var t=this.$menu.find(".active").removeClass("active"),r=t.prev();if(!r.length){if(!this.shown)return;this.hide()}r.addClass("active")}else{var t=this.$menu.find(".active").removeClass("active"),i=t.next();i.length||(0==i.prevObject.length&&this.$menu.find("li").length>1?i=o(this.$menu.find("li")[0]):this.$element.next().next().focus()),0===i.length?o("#desktopSearchSubmit").focus():i.addClass("active")}break;case 40:"keydown"==e.type&&(e.preventDefault(),this.next())}e.stopPropagation()}},o.fn.typeahead.Constructor.prototype.blur=function(e){if(this.focused=!1,!this.mousedover&&this.shown)return this.$menu.hide(),this},d.prototype={initialize:function(e){if(void 0===e)throw new Error("Cannot instantiate SearchTypeahead, without a selector");o(e).typeahead({source:this.typeaheadSource,minLength:I,items:T,matcher:this.typeaheadMatch,sorter:this.typeaheadSort,updater:this.typeaheadUpdater,highlighter:this.typeaheadHighlight,render:this.typeaheadRender,select:this.typeaheadSelect,hide:this.typeaheadHide,menu:"<ul id='typeaheadDropdown' class='typeahead dropdown-menu' aria-live='polite'></ul>",item:"<li class='typeaheadProduct'><a href='#' onclick = $('#typeaheadDropdown').hide()>                                           <img class='typeaheadProductThumbnail visible-md visible-lg img-responsive'/>                                           <span class='typeaheadProductName'></span>                                           <span class='typeaheadProductPrice'></span>                                         </a></li>"}),o.Topic(t.topicNames.SEARCH_TYPEAHEAD_UPDATED).subscribe(this.typeaheadResults),o.Topic(t.topicNames.SEARCH_TYPEAHEAD_CANCEL).subscribe(this.typeaheadCancel.bind(this))},typeaheadUpdater:function(e){return e},typeaheadSource:function(e,r){v=this,this.render=this.options.render||this.render,this.select=this.options.select||this.select,this.hide=this.options.hide||this.hide;var i=v.query;if(this.searchQuery="",this.$menu.css("width",this.$element.width()-S/2),this.$menu.css("margin-left",S),c.getInstance().noImageSrc()&&""!=c.getInstance().noImageSrc()){R(c.getInstance().noImageSrc());var a=new Image;a.onerror=function(){R("/img/no-image.jpg")},a.src=c.getInstance().noImageSrc()}this.timer&&clearTimeout(this.timer);var s=function(){v.callback=r,v.query=v.query?v.query:i,v.searchQuery=v.query,o.Topic(t.topicNames.SEARCH_TYPEAHEAD).publishWith({searchText:v.query,recordsPerPage:T,recordOffSet:0},[{message:"success"}])};this.timer=setTimeout(s,P)},typeaheadResults:function(e){if(v&&v.focused&&!O()&&"none"==o("#typeaheadDropdown").css("display")&&(o("#alert-modal-change").text(i.t("ns.common:resources.searchDropdownOpenedText")),O(!0)),v&&v.focused&&v.options){var t,a,s=[],n=this[0]?this[0]:[],c=this[1]?this[1]:[];o.each(c,function(e,i){if(i.records[0]){var n=i.records[0],c={};c.id=n.attributes["product.repositoryId"][0],n.attributes["product.displayName"]?c.name=n.attributes["product.displayName"][0]:c.name="",(o(window)[0].innerWidth||o(window).width())>r.VIEWPORT_TABLET_LOWER_WIDTH&&(c.thumb=n.attributes["sku.listingThumbImageURL"]?n.attributes["sku.listingThumbImageURL"]:n.attributes["product.primaryThumbImageURL"]?n.attributes["product.primaryThumbImageURL"][0]:R(),c.noImageSrc='src="'+R()+'"',"/img/no-image.jpg"==c.thumb&&(c.thumb=R(),c.noImageSrc='src="/img/no-image.jpg"')),n.attributes["product.primaryImageTitle"]&&(c.primaryImageTitle=n.attributes["product.primaryImageTitle"][0]),(c.primaryImageAltText=n.attributes["product.primaryImageAltText"])&&(c.primaryImageAltText=n.attributes["product.primaryImageAltText"][0]),c.link=n.attributes["product.route"][0],Array.isArray(n.attributes["sku.styleProperty"])&&(t=n.attributes["sku.styleProperty"][0],t&&(Array.isArray(n.attributes["sku."+t])&&(a=n.attributes["sku."+t][0]),a&&(c.link=c.link+"?variantName="+t+"&variantValue="+a))),c.price="",s.push(c)}}),o.each(n,function(e,t){if(t.id[0]===s[e].id){var r=function(e){var t,r,i,a,o,s=e.childSKUs?e.childSKUs.length:0;if(e.minActivePrice)return e.minActivePrice;if(t=e.salePrice||0===e.salePrice?e.salePrice:e.listPrice,e.childSKUs)if(s>0)for(var o in e.childSKUs)i=e.childSKUs[o],a=i.salePrice||0===i.salePrice?i.salePrice:i.listPrice,a||0==a||(a=t),(!r&&0!=r||a<r)&&(r=a);else r=t;return r}(t);s[e].price=r}}),s.length||s.push({id:g,name:"",price:"",thumb:"",link:""}),v.callback&&"function"==typeof v.callback&&v.callback(s)}},typeaheadCancel:function(){v=this,v.timer&&clearTimeout(v.timer)},typeaheadMatch:function(e){return!0},typeaheadSort:function(e){return e},typeaheadHighlight:function(e){return e},typeaheadRender:function(e){if(1===e.length&&e[0].id===g){var t=i.t(h+"noMatchesFound");return this.$menu.html(o("<li class='typeaheadTop' disabled>").text(t)),this}e=o(e).map(function(e,t){e=o(v.options.item).attr("data-value",t.name),A?null!=C&&e.find("a").attr("href","#").on("click",function(e){return C.getProductDetails.call(C,t.id,A),e.preventDefault(),!1}):e.find("a").attr("href",a.getPathWithLocale(t.link)).on("click",function(e){var t=o(this).attr("href");return a.goTo(t),e.preventDefault(),!1}),e.find("a").attr("title",t.name),e.find("a").attr("id",t.id),e.find(".typeaheadProductThumbnail").attr("src",t.thumb),e.find(".typeaheadProductThumbnail").attr("alt",t.primaryImageAltText),e.find(".typeaheadProductThumbnail").attr("title",t.primaryImageTitle),e.find(".typeaheadProductThumbnail").attr("onError",t.noImageSrc),e.find(".typeaheadProductName").html(t.name);var r,n=parseFloat(t.price).toFixed(b).toString();if("NaN"===n||""===n||null===n)r=i.t(h+"priceUnavailable");else{var c=n.split(".");r=s.formatNumber(c[0],!0),0===b?r=r.substring(0,r.length-3):(r=r.substring(0,r.length-2),r+=c[1]),r=y+r}return e.find(".typeaheadProductPrice").text(r),e[0]}),e.first().addClass("firstResult");var r=i.t(h+"closeText"),n=i.t(h+"showAllResultsText");return this.$menu.html(e),this.$menu.prepend(o("<li/>").attr({class:"typeaheadClose","data-value":f}).append(o("<a/>").attr({href:"#",tabindex:"0"}).text(r))),this.$menu.prepend(o("<li/>").attr({class:"typeaheadAllProducts visible-lg visible-md","data-value":m}).append(o("<a/>").attr({href:"#",title:"Show all results"}).text(n))),this},typeaheadSelect:function(){var e=this.$menu.find(".active"),t=e.children("a").attr("href"),i=e.children("a").attr("id");if(t&&""!==t&&"#"!==t)window.location=t;else if(t&&"#"===t&&A&&null!=C&&null!=i)C.getProductDetails.call(C,i,A);else{var s=e.attr("data-value");if(s===m||!e.length){u.typeaheadCancel(),this.searchQuery=this.query;var n;_()?(n=o.trim(this.query),_(!1)):n=this.query.trim()+r.SEARCH_WILDCARD,0!=n.length&&a.goTo(u.searchResultPage+"?"+r.SEARCH_TERM_KEY+"="+encodeURIComponent(n)+"&"+r.SEARCH_RANDOM_KEY+"="+Math.floor(1e3*Math.random())+"&"+r.SEARCH_TYPE+"="+r.SEARCH_TYPE_SIMPLE+"&"+r.PARAMETERS_TYPE+"="+r.PARAMETERS_SEARCH_QUERY)}}return this.hide()},typeaheadHide:function(){return this.$element.val()===this.searchQuery&&this.$element.val("").change(),this.$menu.hide(),this.shown=!1,O()&&"none"==o("#typeaheadDropdown").css("display")&&(o("#alert-modal-change").text(i.t("ns.common:resources.searchDropdownClosedText")),O(!1)),this}},d.performTypeAhead=function(e){this.timer&&clearTimeout(this.timer);var r=function(){o.Topic(t.topicNames.SEARCH_TYPEAHEAD).publishWith({typeaheadConfig:e},[{message:"success"}])};this.timer=setTimeout(r,P)},d.getTypeAheadDefaultQueryParams=function(){var e=new Map;return e.set("Ntk","TypeAhead"),e.set("Ntx","mode matchany"),e.set("No","0"),e.set("Nrpp","5"),e.set("typeaheadMinLength",I),e},d.getInstance=function(e,t,r,i,a,o){return u=null,u=new d(e,t,r,i,a,o)},d}),define("viewModels/giftProductListingViewModel",["knockout","pubsub","ccConstants","pageLayout/product","ccRestClient","ccStoreConfiguration"],function(e,t,r,i,a,o){"use strict";function s(e,t){var r=this;return r.products=r.getProductsInfo(e),r}return s.prototype.storeConfiguration=o.getInstance(),s.prototype.getProductsInfo=function(e){for(var t=[],a=0;a<e.length;a++){var o={};e[a].hasOwnProperty(r.INVENTORY_PRODUCT_TYPE)&&(o=new i(e[a][r.INVENTORY_PRODUCT_TYPE])),t[a]={},t[a]=o}return t},s.prototype.getGiftProductChoices=function(e){if(null!=e.giftWithPurchaseDetail&&null!=e.giftWithPurchaseType){var t,i={};i[r.GIFT_WITH_PURCHASE_DETAIL]=e.giftWithPurchaseDetail,i[r.GIFT_WITH_PURCHASE_TYPE]=e.giftWithPurchaseType;var o={};o[r.ENDPOINT_KEY]=r.ENDPOINT_GET_GIFT_CHOICES;var s=this.storeConfiguration.getFilterToUse(o);s&&(i[r.FILTER_KEY]=s),t=r.ENDPOINT_GET_GIFT_CHOICES,a.request(t,i,this.getGiftChoicesSuccessFunc.bind(this,e.id),this.getGiftChoicesFailureFunc.bind(this))}},s.prototype.getGiftChoicesSuccessFunc=function(e,r){if(r&&r.length>0){var i=new s(r);$.Topic(t.topicNames.GET_GIFT_CHOICES_SUCCESSFUL).publishWith([i,e],[{message:"success"}])}else $.Topic(t.topicNames.GIFT_CHOICES_NOT_AVAILABLE).publish()},s.prototype.getGiftChoicesFailureFunc=function(e){$.Topic(t.topicNames.GET_GIFT_CHOICES_FAILURE).publishWith(e,[{message:"failure"}])},s});
//# sourceMappingURL=main.js.map
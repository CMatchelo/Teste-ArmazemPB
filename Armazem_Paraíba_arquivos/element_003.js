define(["jquery","knockout","notifier","pubsub","navigation","ccConstants","CCi18n","storageApi","ccResourceLoader!global/murmurHash3","ccRestClient","ccResourceLoader!global/CustomTranslations","ccResourceLoader!global/jquery.mask","ccResourceLoader!global/masks","ccResourceLoader!global/validation","ccResourceLoader!global/CommunicationBetweenWidgets"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";return{elementName:"enext_amz_header_actions",searchValue:t.observable(""),searchElement:t.observable(null),clientDocument:t.observable(""),dayOfBirth:t.observable(""),phoneNumber:t.observable(""),registerErrorMessage:t.observable(""),loginErrorMessage:t.observable(""),loginDropDownVisible:t.observable(!1),registerVisible:t.observable(!1),loginVisible:t.observable(!1),registerOriginIsLogin:t.observable(!1),registerSuccess:t.observable(!1),miniCartVisible:t.observable(!1),isQtyLimitReached:t.observable({}),ct:l.pt_BR.userActions,masks:h,jqueryMask:c,validation:p,genderTypes:[{value:"",name:"Gênero*",enabled:!1},{value:"F",name:"Feminino",enabled:!0},{value:"M",name:"Masculino",enabled:!0}],onLoad:function(t){var i=this;i.isQtyLimitReached.subscribe(function(e){console.log("Quantidade limite chegou",e)}),i.registerErrorMessage(""),e.Topic(r.topicNames.USER_CREATION_FAILURE).subscribe(function(e){i.registerErrorMessage(e.message),e.errorCode=="92103"&&(e.message="Certifique-se de que sua senha tenho no mínimo 8 caracteres e seja composta de pelo menos 1 número.",i.registerErrorMessage(e.message)),console.log("USER_CREATION_FAILURE:",e.message),i.registerSuccess(!1)}),e.Topic(r.topicNames.USER_AUTO_LOGIN_SUCCESSFUL).subscribe(function(r){r.widgetId===t.WIDGET_ID&&(i.registerOriginIsLogin(!1),e.when(t.user().autoLoginComplete).then(function(){n.clearSuccess(t.WIDGET_ID),n.sendSuccess(t.WIDGET_ID,t.translate("createAccountSuccess")),e(window).scrollTop("0"),t.user().autoLoginComplete=e.Deferred()}))}),e.Topic(r.topicNames.USER_LOGIN_FAILURE).subscribe(function(e){console.log(e),e.errorCode&&e.errorCode===s.ACCOUNT_ACCESS_ERROR_CODE?i.loginErrorMessage(o.t("ns.common:resources.accountError")):i.loginErrorMessage(o.t("ns.common:resources.loginError"))}),e.Topic(r.topicNames.USER_LOGIN_SUCCESSFUL).subscribe(function(e){i.hideLogin(),i.loginErrorMessage(""),n.clearSuccess(t.WIDGET_ID)}),e.Topic("show-register").subscribe(function(){i.showRegister()}),e.Topic("show-login").subscribe(function(){i.showLogin()}),e.Topic("loggout").subscribe(function(e){i.handleLogout(e)}),e.Topic(r.topicNames.CART_ADD).subscribe(function(){i.showMiniCart()})},toggleMobileFunction:function(t){var n=this;e.Topic("enext.header.menu.mobile").publish(!0)},removeAllClasses:function(e,t){var n=this,r=document.querySelectorAll(e);for(var i=0;i<r.length;i+=1)r[i].classList.remove(t)},minicartRemoveItem:function(t,n){n.stopPropagation(),e.Topic(r.topicNames.CART_REMOVE).publishWith(t.productData(),[{message:"success",commerceItemId:t.commerceItemId}]),e.Topic(r.enextTopicNames.MINICART_ITEM_REMOVE).publishWith({data:t,event:n},[])},loginSend:function(t){t.validateLogin()&&(t.updateLocalData(!1,!1),e.Topic(r.topicNames.USER_LOGIN_SUBMIT).publishWith(t,[{message:"success"}]))},notifySuccess:function(){return new EnextNotification({boxMessage:"Uma chave de acesso foi enviada para seu e-mail.",boxClass:"x-notify",boxType:"is-forgot",timeout:!0,timeoutValue:3500})},forgotReset:function(e){var t=document.querySelector(".x-modal__content--forgot input");e.ignoreEmailValidation(!1),e.emailAddressForForgottenPwd.isModified(!0),e.emailAddressForForgottenPwd&&e.emailAddressForForgottenPwd.isValid()&&(e.resetForgotPassword(),t.value="",this.notifySuccess().open())},registerShow:function(){var e=this,t=document.querySelector(".x-modal__content--register");e.removeAllClasses(".x-modal__content","is-active"),t.classList.add("is-active")},registerCreateUser:function(t,n){var i=this;t.user().dynamicProperties().find(function(e){return e.id()=="document_number"}).value(i.clientDocument().replace(/\D/g,"")),t.user().dynamicProperties().find(function(e){return e.id()=="day_of_birth"}).value(i.dayOfBirth()),t.user().dynamicProperties().find(function(e){return e.id()=="shopper_phoneNumber"}).value(i.phoneNumber().replace(/\D/g,"")),t.user().dynamicProperties().find(function(e){return e.id()=="shopper_gender"}).value(t.user().gender());var s=!0,o=["firstName","lastName","emailAddress","newPassword","confirmPassword"];o.forEach(function(e){t.user()[e].isModified(!0),t.user()[e].isValid()||(s=!1)});var u=["dayOfBirth","clientDocument","phoneNumber"];u.forEach(function(e){i[e].isModified(!0),i[e].isValid()||(s=!1)}),t.user().dynamicProperties()[3].value.isValid()||(s=!1),s&&(i.registerSuccess(!0),e.Topic(r.topicNames.USER_REGISTRATION_SUBMIT).publishWith(t.user(),[{message:"success",widgetId:t.WIDGET_ID,widget:t}])),i.registerErrorMessage("")},showMiniCart:function(t,n){var r=this;r.miniCartVisible(!0),e(".x-menu-button-mobile").css("opacity","0"),window.innerWidth<=975&&e(".x-minicart-background").addClass("active")},hideMiniCart:function(t,n){var r=this;r.miniCartVisible(!1),e(".x-menu-button-mobile").css("opacity","1"),window.innerWidth<=975&&e(".x-minicart-background").removeClass("active")},showDropdownLogin:function(e,t){var n=this;n.loginDropDownVisible(!0)},hideDropdownLogin:function(e,t){var n=this;n.loginDropDownVisible(!1)},changeDropdownLogin:function(e,t){var n=this;n.loginDropDownVisible(!n.loginDropDownVisible())},showRegister:function(t,n){var r=this;e("#x-header-modal--register").modal("show"),e(".modal-backdrop").appendTo(".x-amz-header-container")},hideRegister:function(t,n){var r=this;e("#x-header-modal--register").modal("hide"),this.registerOriginIsLogin()&&(this.showLogin(),this.registerOriginIsLogin(!1)),e(".x-menu-button-mobile").css("opacity","1"),r.registerSuccess(!1)},showRegisterFromLogin:function(e,t){var n=this;this.registerOriginIsLogin(!0),this.hideLogin(),this.showRegister(e,t)},showLogin:function(t,n){var r=this;e("#x-header-modal--login").modal("show"),e(".modal-backdrop").appendTo(".x-amz-header-container")},hideLogin:function(t,n){var r=this;e("#x-header-modal--login").modal("hide"),e(".x-menu-button-mobile").css("opacity","1")},showForgotPasswordSection:function(e){var t=this;t.hideLogin(),d.registration.showForgottenPassword(!0)},onGetProductsSuccess:function(e){var t=e},onGetProductsError:function(){console.log("Erro")},getProducts:function(e){var t="listProducts",n="displayName co tenis",r={storePriceListGroupId:"amz-BRL",q:n};f.request(t,r,this.onGetProductsSuccess.bind(this),this.onGetProductsError.bind(this))},handleLogout:function(t){var i=this;if(t.isUserProfileEdited())return!0;n.clearSuccess(this.WIDGET_ID),n.clearError(this.WIDGET_ID),t.updateLocalData(t.loggedinAtCheckout(),!1),e.Topic(r.topicNames.USER_LOGOUT_SUBMIT).publishWith([{message:"success"}])},handleLogin:function(t,i){if("click"===i.type||("keydown"===i.type||"keypress"===i.type)&&i.keyCode===13)n.clearError(this.WIDGET_ID),t.user().validateLogin()&&(t.user().updateLocalData(!1,!1),e.Topic(r.topicNames.USER_LOGIN_SUBMIT).publishWith(t.user(),[{message:"success"}]));return!0},selectMinValue:function(e){var t=1/0;for(var n=0;n<e.length;n++){var r=parseInt(e[n],10);r&&t>r&&(t=r)}return t},insertItemToIsQtyLimitReached:function(e,t,n){var r=e.isQtyLimitReached;console.log(r);var i=r();console.log("insert",i),i[t.productData().childSKUs[0].repositoryId]=n,r(i)},removeItemFromIsQtyLimitReached:function(e,t){var n=e.isQtyLimitReached,r=n();delete r[t.productData().childSKUs[0].repositoryId],n(r)},addQuantity:function(t,n,i,s){n.removeItemFromIsQtyLimitReached(n,i);if(i.updatableQuantity()){var o=parseInt(i.updatableQuantity(),10),u=[];u.push(i.productData().childSKUs[0].quantity),u.push(i.productData().orderLimit),u.push(t.productQuantityThreshold);var a=n.selectMinValue(u);o++,o<=a?(i.updatableQuantity(o),e.Topic(r.topicNames.CART_UPDATE_QUANTITY).publishWith(i.productData(),[{message:"success",commerceItemId:i.commerceItemId,quantity:i.updatableQuantity()}]),t.cart().markDirty(),console.log("quantity",o)):n.insertItemToIsQtyLimitReached(n,i,a)}},removeQuantity:function(t,n,i,s){n.removeItemFromIsQtyLimitReached(n,i);if(i.updatableQuantity()){var o=parseInt(i.updatableQuantity(),10);o--,i.updatableQuantity(o),e.Topic(r.topicNames.CART_UPDATE_QUANTITY).publishWith(i.productData(),[{message:"success",commerceItemId:i.commerceItemId,quantity:i.updatableQuantity()}]),t.cart().markDirty()}}}})
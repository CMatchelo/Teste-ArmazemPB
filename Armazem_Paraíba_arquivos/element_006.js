define(["jquery","knockout","notifier","pubsub","navigation","ccRestClient","CCi18n","ccResourceLoader!global/CustomTranslations","ccResourceLoader!global/jquery.mask","ccResourceLoader!global/masks","ccResourceLoader!global/validation","ccResourceLoader!global/CommunicationBetweenWidgets"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";return{elementName:"enext_amz_forgotten_password",ct:u.pt_BR.userActions,masks:f,jqueryMask:a,validation:l,cb:c,emailSentMessage:t.observable(!1),emailSentSuccess:t.observable(!1),errorMsg:t.observable(""),passwordRedefinitionHasMessage:t.observable(!1),passwordRedefinitionSuccess:t.observable(!1),onLoad:function(t){var i=this;i.widgetOnload=t,e.Topic(r.topicNames.USER_RESET_PASSWORD_SUCCESS).subscribe(function(e){console.log("USER_RESET_PASSWORD_SUCCESS"),n.sendSuccess(t.WIDGET_ID,o.t("ns.common:resources.resetPasswordMessage"),!0),i.emailSentMessage(!0),i.emailSentSuccess(!0)}),e.Topic(r.topicNames.USER_RESET_PASSWORD_FAILURE).subscribe(function(e){console.log("USER_RESET_PASSWORD_FAILURE"),n.sendError(t.WIDGET_ID,e.message,!0),i.emailSentMessage(!0),i.emailSentSuccess(!1)}),e.Topic(r.topicNames.USER_PASSWORD_GENERATED).subscribe(function(n){console.log("USER_PASSWORD_GENERATED"),e("#alert-modal-change").text(o.t("ns.common:resources.resetPasswordModalOpenedText")),t.user().ignoreEmailValidation(!1),e("#CC-forgotPasswordSectionPane").show(),e("#CC-forgotPwd-input").focus(),t.user().emailAddressForForgottenPwd(""),t.user().emailAddressForForgottenPwd.isModified(!1)}),e.Topic(r.topicNames.PAGE_PARAMETERS).subscribe(function(){var e=this.parameters.occsAuthToken;e&&(c.registration.tokenAlreadyUsed===null||c.registration.tokenAlreadyUsed!==null&&c.registration.tokenAlreadyUsed!=e)&&(t.user().validateTokenForPasswordUpdate(e,function(t){c.registration.showPasswordRedefinition(!0),console.log("realToken",e,c.registration.tokenAlreadyUsed)},function(t){console.log("fakeToken",e),i.passwordRedefinitionHasMessage(!0),i.passwordRedefinitionSuccess(!1),c.registration.showPasswordRedefinition(!0)}),c.registration.tokenAlreadyUsed=e)}),c.registration.showForgottenPassword.subscribe(function(e){e&&(console.log("dsa"),i.showForgottenPassword("forgottenSubscribed"))}),c.registration.showPasswordRedefinition.subscribe(function(e){e&&(console.log("asd"),i.showPasswordRedefinition("redefinitionSubscribed"))})},resetAllMessages:function(){var e=this;e.emailSentMessage(!1),e.passwordRedefinitionHasMessage(!1)},savePassword:function(e,t){var r=this;return n.clearError(this.WIDGET_ID),e.user().ignoreConfirmPasswordValidation(!1),e.user().ignoreEmailValidation(!1),e.user().emailAddressForForgottenPwd.isModified(!0),e.user().isPasswordValid(!0)&&e.user().emailAddressForForgottenPwd&&e.user().emailAddressForForgottenPwd.isValid()&&e.user().updateExpiredPasswordUsingToken(e.user().token,e.user().emailAddressForForgottenPwd(),e.user().newPassword(),e.user().confirmPassword(),function(e){console.log("savePassword sucess"),r.passwordRedefinitionHasMessage(!0),r.passwordRedefinitionSuccess(!0)},function(e){r.errorMsg(e.message),console.log("savePassword error"),r.passwordRedefinitionHasMessage(!0),r.passwordRedefinitionSuccess(!1)}),!0},resetForgotPassword:function(e,t){return e.user().ignoreEmailValidation(!1),e.user().emailAddressForForgottenPwd.isModified(!0),e.user().emailAddressForForgottenPwd&&e.user().emailAddressForForgottenPwd.isValid()&&e.user().resetForgotPassword(),!0},showForgottenPassword:function(t){if(t&&t=="forgottenSubscribed"){var n=this;e("#x-header-modal--forgottenPassword").modal("show"),e(".modal-backdrop").appendTo(".x-amz-header-container")}},hideForgottenPassword:function(t,n){var r=this,i=r.widgetOnload;e("#x-header-modal--forgottenPassword").modal("hide"),e(".x-menu-button-mobile").css("opacity","1"),c.registration.showForgottenPassword(!1),r.resetAllMessages()},showPasswordRedefinition:function(t){if(t&&t=="redefinitionSubscribed"){var n=this;e("#x-header-modal--passwordRedefinition").modal("show"),e(".modal-backdrop").appendTo(".x-amz-header-container")}},hidePasswordRedefinition:function(t,n){var r=this,i=r.widgetOnload;e("#x-header-modal--passwordRedefinition").modal("hide"),e(".x-menu-button-mobile").css("opacity","1"),c.registration.showPasswordRedefinition(!1),r.resetAllMessages()}}})
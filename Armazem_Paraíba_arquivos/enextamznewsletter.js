define(["knockout","CCi18n","notifier"],function(e,t,n){"use strict";return{nameNews:e.observable(""),emailNews:e.observable(""),resourcesLoaded:function(e){},onLoad:function(t){t.loadingNewsletter=e.observable(!1)},beforeAppear:function(e){},handleStep:function(e,t){var r=t;r.loadingNewsletter(!1);var i=e.path||e.composedPath&&e.composedPath(),s=i[2].classList;if(Object.values(s).includes("step-2")){var o=new RegExp(/^([ \u00c0-\u01ffa-zA-Z'\-])+$/igm),u=new RegExp(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/),i=e.path||e.composedPath&&e.composedPath(),a=i[1].children;if(e.target.previousElementSibling){var f=e.target.previousElementSibling.classList;Object.values(f).includes("fields")&&(a=e.target.previousElementSibling.children)}if(!o.test(t.nameNews()))return a[0].classList.add("has-error"),!1;if(!u.test(t.emailNews()))return a[1].classList.add("has-error"),!1;console.log("Send Email"),r.loadingNewsletter(!0);var l="https://polska.nclaudino.com.br/occ/api/newsletter",c={nome:t.nameNews(),email:t.emailNews()},h={"Content-Type":"application/json"};fetch(l,{method:"POST",body:JSON.stringify(c),headers:h}).then(function(e){return e.json()}).then(function(e){return e.status&&e.status=="OK"?(s.add("step-3"),s.remove("step-2"),r.loadingNewsletter(!1)):(n.sendError(e.WIDGET_ID,"Ops, não foi possível cadastrar o e-mail. Tente novamente.",!0),r.loadingNewsletter(!1)),!0}).catch(function(e){return n.sendError(t.WIDGET_ID,"Ops, não foi possível cadastrar o e-mail. Tente novamente.",!0),r.loadingNewsletter(!1),!1})}else s.add("step-2"),e.target.form&&e.target.form[0].focus()},eraseError:function(e){if(e&&e.type=="keyup"){var t=e.path||e.composedPath&&e.composedPath();t[2].classList.remove("has-error"),e.target.parentElement.classList.remove("has-error")}}}})
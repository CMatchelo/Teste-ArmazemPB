define(["jquery"],function(e){var t=[],n=function(e,t){return e.replace(/^(.*:*\/\/)*([^\/]+[^\.])\//,function(e,n,r){return(t?"https:":document.location.protocol)+"//"+r+"/"})},r=function(r,i){var s=[],o=[],u=i||{},a=function(e){var t=0,n;if(e)for(;t<o.length;t++)n=e[o[t][1]],n&&o[t][0](n)};this.addResource=function(t,n){var r=s.length;while(r--)if(s[r]==t)break;!~r&&s.push(t);var i=e.inArray("view",s);i!=-1&&s.length>1&&i!=0&&(s.splice(i,1),s.unshift("view")),i=e.inArray("recommendations",s),i!=-1&&s.length>1&&i!=s.length-1&&(s.splice(i,1),s.push("recommendations")),e.extend(!0,u,n)},this.addCallback=function(e,t){o.push([e,t])},this.addParam=function(e){var t,n;for(t in e||{})n=e[t],typeof n!="object"&&t!="retailerId"&&(u[t]=n)},this.send=function(e){if(!s.length)return;var i=n(r(s.join("/")),e),o="utf-8",f=window,l=f.JSON,c,h,p,c=new XMLHttpRequest;h=l.stringify(u),t.push({url:i,params:h}),c.open("POST",i,!0),c.onreadystatechange=function(){p=this.responseText?this.responseText.trim():this.responseText,this.readyState==4&&this.status==200&&p&&a(l.parse(p))},c.withCredentials="true",c.setRequestHeader("Content-Type","text/plain;charset="+o),c.send(h)}};return{RESTRequest:r}})